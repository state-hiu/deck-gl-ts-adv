function GI(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var zI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hA={},jI={get exports(){return hA},set exports(t){hA=t}},fh={},Se={},HI={get exports(){return Se},set exports(t){Se=t}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $A=Symbol.for("react.element"),WI=Symbol.for("react.portal"),QI=Symbol.for("react.fragment"),XI=Symbol.for("react.strict_mode"),JI=Symbol.for("react.profiler"),YI=Symbol.for("react.provider"),KI=Symbol.for("react.context"),ZI=Symbol.for("react.forward_ref"),qI=Symbol.for("react.suspense"),$I=Symbol.for("react.memo"),eM=Symbol.for("react.lazy"),z1=Symbol.iterator;function tM(t){return t===null||typeof t!="object"?null:(t=z1&&t[z1]||t["@@iterator"],typeof t=="function"?t:null)}var nw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},iw=Object.assign,rw={};function ja(t,e,n){this.props=t,this.context=e,this.refs=rw,this.updater=n||nw}ja.prototype.isReactComponent={};ja.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ja.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function sw(){}sw.prototype=ja.prototype;function qg(t,e,n){this.props=t,this.context=e,this.refs=rw,this.updater=n||nw}var $g=qg.prototype=new sw;$g.constructor=qg;iw($g,ja.prototype);$g.isPureReactComponent=!0;var V1=Array.isArray,ow=Object.prototype.hasOwnProperty,em={current:null},aw={key:!0,ref:!0,__self:!0,__source:!0};function lw(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)ow.call(e,i)&&!aw.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var A=Array(a),h=0;h<a;h++)A[h]=arguments[h+2];r.children=A}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:$A,type:t,key:s,ref:o,props:r,_owner:em.current}}function nM(t,e){return{$$typeof:$A,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function tm(t){return typeof t=="object"&&t!==null&&t.$$typeof===$A}function iM(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var j1=/\/+/g;function pd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?iM(""+t.key):e.toString(36)}function Vu(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case $A:case WI:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+pd(o,0):i,V1(r)?(n="",t!=null&&(n=t.replace(j1,"$&/")+"/"),Vu(r,e,n,"",function(h){return h})):r!=null&&(tm(r)&&(r=nM(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(j1,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",V1(t))for(var a=0;a<t.length;a++){s=t[a];var A=i+pd(s,a);o+=Vu(s,e,n,A,r)}else if(A=tM(t),typeof A=="function")for(t=A.call(t),a=0;!(s=t.next()).done;)s=s.value,A=i+pd(s,a++),o+=Vu(s,e,n,A,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function zc(t,e,n){if(t==null)return t;var i=[],r=0;return Vu(t,i,"","",function(s){return e.call(n,s,r++)}),i}function rM(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Pn={current:null},ju={transition:null},sM={ReactCurrentDispatcher:Pn,ReactCurrentBatchConfig:ju,ReactCurrentOwner:em};Ke.Children={map:zc,forEach:function(t,e,n){zc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return zc(t,function(){e++}),e},toArray:function(t){return zc(t,function(e){return e})||[]},only:function(t){if(!tm(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ke.Component=ja;Ke.Fragment=QI;Ke.Profiler=JI;Ke.PureComponent=qg;Ke.StrictMode=XI;Ke.Suspense=qI;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sM;Ke.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=iw({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=em.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(A in e)ow.call(e,A)&&!aw.hasOwnProperty(A)&&(i[A]=e[A]===void 0&&a!==void 0?a[A]:e[A])}var A=arguments.length-2;if(A===1)i.children=n;else if(1<A){a=Array(A);for(var h=0;h<A;h++)a[h]=arguments[h+2];i.children=a}return{$$typeof:$A,type:t.type,key:r,ref:s,props:i,_owner:o}};Ke.createContext=function(t){return t={$$typeof:KI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:YI,_context:t},t.Consumer=t};Ke.createElement=lw;Ke.createFactory=function(t){var e=lw.bind(null,t);return e.type=t,e};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(t){return{$$typeof:ZI,render:t}};Ke.isValidElement=tm;Ke.lazy=function(t){return{$$typeof:eM,_payload:{_status:-1,_result:t},_init:rM}};Ke.memo=function(t,e){return{$$typeof:$I,type:t,compare:e===void 0?null:e}};Ke.startTransition=function(t){var e=ju.transition;ju.transition={};try{t()}finally{ju.transition=e}};Ke.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Ke.useCallback=function(t,e){return Pn.current.useCallback(t,e)};Ke.useContext=function(t){return Pn.current.useContext(t)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(t){return Pn.current.useDeferredValue(t)};Ke.useEffect=function(t,e){return Pn.current.useEffect(t,e)};Ke.useId=function(){return Pn.current.useId()};Ke.useImperativeHandle=function(t,e,n){return Pn.current.useImperativeHandle(t,e,n)};Ke.useInsertionEffect=function(t,e){return Pn.current.useInsertionEffect(t,e)};Ke.useLayoutEffect=function(t,e){return Pn.current.useLayoutEffect(t,e)};Ke.useMemo=function(t,e){return Pn.current.useMemo(t,e)};Ke.useReducer=function(t,e,n){return Pn.current.useReducer(t,e,n)};Ke.useRef=function(t){return Pn.current.useRef(t)};Ke.useState=function(t){return Pn.current.useState(t)};Ke.useSyncExternalStore=function(t,e,n){return Pn.current.useSyncExternalStore(t,e,n)};Ke.useTransition=function(){return Pn.current.useTransition()};Ke.version="18.2.0";(function(t){t.exports=Ke})(HI);const Aw=VI(Se);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oM=Se,aM=Symbol.for("react.element"),lM=Symbol.for("react.fragment"),AM=Object.prototype.hasOwnProperty,cM=oM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,uM={key:!0,ref:!0,__self:!0,__source:!0};function cw(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)AM.call(e,i)&&!uM.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:aM,type:t,key:s,ref:o,props:r,_owner:cM.current}}fh.Fragment=lM;fh.jsx=cw;fh.jsxs=cw;(function(t){t.exports=fh})(jI);const uw=hA.Fragment,gn=hA.jsx,Sa=hA.jsxs;var sp={},dA={},fM={get exports(){return dA},set exports(t){dA=t}},si={},op={},hM={get exports(){return op},set exports(t){op=t}},fw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(oe,ye){var Ce=oe.length;oe.push(ye);e:for(;0<Ce;){var Le=Ce-1>>>1,ke=oe[Le];if(0<r(ke,ye))oe[Le]=ye,oe[Ce]=ke,Ce=Le;else break e}}function n(oe){return oe.length===0?null:oe[0]}function i(oe){if(oe.length===0)return null;var ye=oe[0],Ce=oe.pop();if(Ce!==ye){oe[0]=Ce;e:for(var Le=0,ke=oe.length,Wt=ke>>>1;Le<Wt;){var zn=2*(Le+1)-1,bs=oe[zn],ai=zn+1,Bt=oe[ai];if(0>r(bs,Ce))ai<ke&&0>r(Bt,bs)?(oe[Le]=Bt,oe[ai]=Ce,Le=ai):(oe[Le]=bs,oe[zn]=Ce,Le=zn);else if(ai<ke&&0>r(Bt,Ce))oe[Le]=Bt,oe[ai]=Ce,Le=ai;else break e}}return ye}function r(oe,ye){var Ce=oe.sortIndex-ye.sortIndex;return Ce!==0?Ce:oe.id-ye.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var A=[],h=[],p=1,m=null,y=3,T=!1,b=!1,C=!1,R=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(oe){for(var ye=n(h);ye!==null;){if(ye.callback===null)i(h);else if(ye.startTime<=oe)i(h),ye.sortIndex=ye.expirationTime,e(A,ye);else break;ye=n(h)}}function F(oe){if(C=!1,I(oe),!b)if(n(A)!==null)b=!0,Ye(j);else{var ye=n(h);ye!==null&&Qe(F,ye.startTime-oe)}}function j(oe,ye){b=!1,C&&(C=!1,S(ee),ee=-1),T=!0;var Ce=y;try{for(I(ye),m=n(A);m!==null&&(!(m.expirationTime>ye)||oe&&!D());){var Le=m.callback;if(typeof Le=="function"){m.callback=null,y=m.priorityLevel;var ke=Le(m.expirationTime<=ye);ye=t.unstable_now(),typeof ke=="function"?m.callback=ke:m===n(A)&&i(A),I(ye)}else i(A);m=n(A)}if(m!==null)var Wt=!0;else{var zn=n(h);zn!==null&&Qe(F,zn.startTime-ye),Wt=!1}return Wt}finally{m=null,y=Ce,T=!1}}var X=!1,q=null,ee=-1,Q=5,V=-1;function D(){return!(t.unstable_now()-V<Q)}function re(){if(q!==null){var oe=t.unstable_now();V=oe;var ye=!0;try{ye=q(!0,oe)}finally{ye?le():(X=!1,q=null)}}else X=!1}var le;if(typeof P=="function")le=function(){P(re)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,Be=pe.port2;pe.port1.onmessage=re,le=function(){Be.postMessage(null)}}else le=function(){R(re,0)};function Ye(oe){q=oe,X||(X=!0,le())}function Qe(oe,ye){ee=R(function(){oe(t.unstable_now())},ye)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(oe){oe.callback=null},t.unstable_continueExecution=function(){b||T||(b=!0,Ye(j))},t.unstable_forceFrameRate=function(oe){0>oe||125<oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<oe?Math.floor(1e3/oe):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_getFirstCallbackNode=function(){return n(A)},t.unstable_next=function(oe){switch(y){case 1:case 2:case 3:var ye=3;break;default:ye=y}var Ce=y;y=ye;try{return oe()}finally{y=Ce}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(oe,ye){switch(oe){case 1:case 2:case 3:case 4:case 5:break;default:oe=3}var Ce=y;y=oe;try{return ye()}finally{y=Ce}},t.unstable_scheduleCallback=function(oe,ye,Ce){var Le=t.unstable_now();switch(typeof Ce=="object"&&Ce!==null?(Ce=Ce.delay,Ce=typeof Ce=="number"&&0<Ce?Le+Ce:Le):Ce=Le,oe){case 1:var ke=-1;break;case 2:ke=250;break;case 5:ke=1073741823;break;case 4:ke=1e4;break;default:ke=5e3}return ke=Ce+ke,oe={id:p++,callback:ye,priorityLevel:oe,startTime:Ce,expirationTime:ke,sortIndex:-1},Ce>Le?(oe.sortIndex=Ce,e(h,oe),n(A)===null&&oe===n(h)&&(C?(S(ee),ee=-1):C=!0,Qe(F,Ce-Le))):(oe.sortIndex=ke,e(A,oe),b||T||(b=!0,Ye(j))),oe},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(oe){var ye=y;return function(){var Ce=y;y=ye;try{return oe.apply(this,arguments)}finally{y=Ce}}}})(fw);(function(t){t.exports=fw})(hM);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hw=Se,ii=op;function Ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dw=new Set,pA={};function fo(t,e){Pa(t,e),Pa(t+"Capture",e)}function Pa(t,e){for(pA[t]=e,t=0;t<e.length;t++)dw.add(e[t])}var Er=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ap=Object.prototype.hasOwnProperty,dM=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,H1={},W1={};function pM(t){return ap.call(W1,t)?!0:ap.call(H1,t)?!1:dM.test(t)?W1[t]=!0:(H1[t]=!0,!1)}function gM(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function mM(t,e,n,i){if(e===null||typeof e>"u"||gM(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function In(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var An={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){An[t]=new In(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];An[e]=new In(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){An[t]=new In(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){An[t]=new In(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){An[t]=new In(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){An[t]=new In(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){An[t]=new In(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){An[t]=new In(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){An[t]=new In(t,5,!1,t.toLowerCase(),null,!1,!1)});var nm=/[\-:]([a-z])/g;function im(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(nm,im);An[e]=new In(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(nm,im);An[e]=new In(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(nm,im);An[e]=new In(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){An[t]=new In(t,1,!1,t.toLowerCase(),null,!1,!1)});An.xlinkHref=new In("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){An[t]=new In(t,1,!1,t.toLowerCase(),null,!0,!0)});function rm(t,e,n,i){var r=An.hasOwnProperty(e)?An[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(mM(e,n,r,i)&&(n=null),i||r===null?pM(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Ir=hw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Vc=Symbol.for("react.element"),Jo=Symbol.for("react.portal"),Yo=Symbol.for("react.fragment"),sm=Symbol.for("react.strict_mode"),lp=Symbol.for("react.profiler"),pw=Symbol.for("react.provider"),gw=Symbol.for("react.context"),om=Symbol.for("react.forward_ref"),Ap=Symbol.for("react.suspense"),cp=Symbol.for("react.suspense_list"),am=Symbol.for("react.memo"),Jr=Symbol.for("react.lazy"),mw=Symbol.for("react.offscreen"),Q1=Symbol.iterator;function _l(t){return t===null||typeof t!="object"?null:(t=Q1&&t[Q1]||t["@@iterator"],typeof t=="function"?t:null)}var Mt=Object.assign,gd;function Gl(t){if(gd===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);gd=e&&e[1]||""}return`
`+gd+t}var md=!1;function _d(t,e){if(!t||md)return"";md=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var i=h}Reflect.construct(t,[],e)}else{try{e.call()}catch(h){i=h}t.call(e.prototype)}else{try{throw Error()}catch(h){i=h}t()}}catch(h){if(h&&i&&typeof h.stack=="string"){for(var r=h.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var A=`
`+r[o].replace(" at new "," at ");return t.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",t.displayName)),A}while(1<=o&&0<=a);break}}}finally{md=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Gl(t):""}function _M(t){switch(t.tag){case 5:return Gl(t.type);case 16:return Gl("Lazy");case 13:return Gl("Suspense");case 19:return Gl("SuspenseList");case 0:case 2:case 15:return t=_d(t.type,!1),t;case 11:return t=_d(t.type.render,!1),t;case 1:return t=_d(t.type,!0),t;default:return""}}function up(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Yo:return"Fragment";case Jo:return"Portal";case lp:return"Profiler";case sm:return"StrictMode";case Ap:return"Suspense";case cp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case gw:return(t.displayName||"Context")+".Consumer";case pw:return(t._context.displayName||"Context")+".Provider";case om:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case am:return e=t.displayName||null,e!==null?e:up(t.type)||"Memo";case Jr:e=t._payload,t=t._init;try{return up(t(e))}catch{}}return null}function vM(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return up(e);case 8:return e===sm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function fs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _w(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function yM(t){var e=_w(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function jc(t){t._valueTracker||(t._valueTracker=yM(t))}function vw(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=_w(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function mf(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function fp(t,e){var n=e.checked;return Mt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function X1(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=fs(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function yw(t,e){e=e.checked,e!=null&&rm(t,"checked",e,!1)}function hp(t,e){yw(t,e);var n=fs(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?dp(t,e.type,n):e.hasOwnProperty("defaultValue")&&dp(t,e.type,fs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function J1(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function dp(t,e,n){(e!=="number"||mf(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var zl=Array.isArray;function ga(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+fs(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function pp(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ae(91));return Mt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Y1(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ae(92));if(zl(n)){if(1<n.length)throw Error(Ae(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:fs(n)}}function Ew(t,e){var n=fs(e.value),i=fs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function K1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Tw(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Tw(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Hc,ww=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Hc=Hc||document.createElement("div"),Hc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Hc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function gA(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Kl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},EM=["Webkit","ms","Moz","O"];Object.keys(Kl).forEach(function(t){EM.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Kl[e]=Kl[t]})});function bw(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Kl.hasOwnProperty(t)&&Kl[t]?(""+e).trim():e+"px"}function xw(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=bw(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var TM=Mt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mp(t,e){if(e){if(TM[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ae(62))}}function _p(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vp=null;function lm(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var yp=null,ma=null,_a=null;function Z1(t){if(t=nc(t)){if(typeof yp!="function")throw Error(Ae(280));var e=t.stateNode;e&&(e=mh(e),yp(t.stateNode,t.type,e))}}function Cw(t){ma?_a?_a.push(t):_a=[t]:ma=t}function Sw(){if(ma){var t=ma,e=_a;if(_a=ma=null,Z1(t),e)for(t=0;t<e.length;t++)Z1(e[t])}}function Pw(t,e){return t(e)}function Iw(){}var vd=!1;function Mw(t,e,n){if(vd)return t(e,n);vd=!0;try{return Pw(t,e,n)}finally{vd=!1,(ma!==null||_a!==null)&&(Iw(),Sw())}}function mA(t,e){var n=t.stateNode;if(n===null)return null;var i=mh(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ae(231,e,typeof n));return n}var Ep=!1;if(Er)try{var vl={};Object.defineProperty(vl,"passive",{get:function(){Ep=!0}}),window.addEventListener("test",vl,vl),window.removeEventListener("test",vl,vl)}catch{Ep=!1}function wM(t,e,n,i,r,s,o,a,A){var h=Array.prototype.slice.call(arguments,3);try{e.apply(n,h)}catch(p){this.onError(p)}}var Zl=!1,_f=null,vf=!1,Tp=null,bM={onError:function(t){Zl=!0,_f=t}};function xM(t,e,n,i,r,s,o,a,A){Zl=!1,_f=null,wM.apply(bM,arguments)}function CM(t,e,n,i,r,s,o,a,A){if(xM.apply(this,arguments),Zl){if(Zl){var h=_f;Zl=!1,_f=null}else throw Error(Ae(198));vf||(vf=!0,Tp=h)}}function ho(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Bw(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function q1(t){if(ho(t)!==t)throw Error(Ae(188))}function SM(t){var e=t.alternate;if(!e){if(e=ho(t),e===null)throw Error(Ae(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return q1(r),t;if(s===i)return q1(r),e;s=s.sibling}throw Error(Ae(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(Ae(189))}}if(n.alternate!==i)throw Error(Ae(190))}if(n.tag!==3)throw Error(Ae(188));return n.stateNode.current===n?t:e}function Lw(t){return t=SM(t),t!==null?Rw(t):null}function Rw(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Rw(t);if(e!==null)return e;t=t.sibling}return null}var Ow=ii.unstable_scheduleCallback,$1=ii.unstable_cancelCallback,PM=ii.unstable_shouldYield,IM=ii.unstable_requestPaint,Nt=ii.unstable_now,MM=ii.unstable_getCurrentPriorityLevel,Am=ii.unstable_ImmediatePriority,Fw=ii.unstable_UserBlockingPriority,yf=ii.unstable_NormalPriority,BM=ii.unstable_LowPriority,Dw=ii.unstable_IdlePriority,hh=null,or=null;function LM(t){if(or&&typeof or.onCommitFiberRoot=="function")try{or.onCommitFiberRoot(hh,t,void 0,(t.current.flags&128)===128)}catch{}}var Ni=Math.clz32?Math.clz32:FM,RM=Math.log,OM=Math.LN2;function FM(t){return t>>>=0,t===0?32:31-(RM(t)/OM|0)|0}var Wc=64,Qc=4194304;function Vl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ef(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Vl(a):(s&=o,s!==0&&(i=Vl(s)))}else o=n&~r,o!==0?i=Vl(o):s!==0&&(i=Vl(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Ni(e),r=1<<n,i|=t[n],e&=~r;return i}function DM(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kM(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Ni(s),a=1<<o,A=r[o];A===-1?(!(a&n)||a&i)&&(r[o]=DM(a,e)):A<=e&&(t.expiredLanes|=a),s&=~a}}function wp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function kw(){var t=Wc;return Wc<<=1,!(Wc&4194240)&&(Wc=64),t}function yd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ec(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ni(e),t[e]=n}function NM(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Ni(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function cm(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Ni(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ut=0;function Nw(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Uw,um,Gw,zw,Vw,bp=!1,Xc=[],is=null,rs=null,ss=null,_A=new Map,vA=new Map,Kr=[],UM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ev(t,e){switch(t){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":rs=null;break;case"mouseover":case"mouseout":ss=null;break;case"pointerover":case"pointerout":_A.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vA.delete(e.pointerId)}}function yl(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=nc(e),e!==null&&um(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function GM(t,e,n,i,r){switch(e){case"focusin":return is=yl(is,t,e,n,i,r),!0;case"dragenter":return rs=yl(rs,t,e,n,i,r),!0;case"mouseover":return ss=yl(ss,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return _A.set(s,yl(_A.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,vA.set(s,yl(vA.get(s)||null,t,e,n,i,r)),!0}return!1}function jw(t){var e=Hs(t.target);if(e!==null){var n=ho(e);if(n!==null){if(e=n.tag,e===13){if(e=Bw(n),e!==null){t.blockedOn=e,Vw(t.priority,function(){Gw(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Hu(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);vp=i,n.target.dispatchEvent(i),vp=null}else return e=nc(n),e!==null&&um(e),t.blockedOn=n,!1;e.shift()}return!0}function tv(t,e,n){Hu(t)&&n.delete(e)}function zM(){bp=!1,is!==null&&Hu(is)&&(is=null),rs!==null&&Hu(rs)&&(rs=null),ss!==null&&Hu(ss)&&(ss=null),_A.forEach(tv),vA.forEach(tv)}function El(t,e){t.blockedOn===e&&(t.blockedOn=null,bp||(bp=!0,ii.unstable_scheduleCallback(ii.unstable_NormalPriority,zM)))}function yA(t){function e(r){return El(r,t)}if(0<Xc.length){El(Xc[0],t);for(var n=1;n<Xc.length;n++){var i=Xc[n];i.blockedOn===t&&(i.blockedOn=null)}}for(is!==null&&El(is,t),rs!==null&&El(rs,t),ss!==null&&El(ss,t),_A.forEach(e),vA.forEach(e),n=0;n<Kr.length;n++)i=Kr[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Kr.length&&(n=Kr[0],n.blockedOn===null);)jw(n),n.blockedOn===null&&Kr.shift()}var va=Ir.ReactCurrentBatchConfig,Tf=!0;function VM(t,e,n,i){var r=ut,s=va.transition;va.transition=null;try{ut=1,fm(t,e,n,i)}finally{ut=r,va.transition=s}}function jM(t,e,n,i){var r=ut,s=va.transition;va.transition=null;try{ut=4,fm(t,e,n,i)}finally{ut=r,va.transition=s}}function fm(t,e,n,i){if(Tf){var r=xp(t,e,n,i);if(r===null)Md(t,e,i,wf,n),ev(t,i);else if(GM(r,t,e,n,i))i.stopPropagation();else if(ev(t,i),e&4&&-1<UM.indexOf(t)){for(;r!==null;){var s=nc(r);if(s!==null&&Uw(s),s=xp(t,e,n,i),s===null&&Md(t,e,i,wf,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Md(t,e,i,null,n)}}var wf=null;function xp(t,e,n,i){if(wf=null,t=lm(i),t=Hs(t),t!==null)if(e=ho(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Bw(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return wf=t,null}function Hw(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MM()){case Am:return 1;case Fw:return 4;case yf:case BM:return 16;case Dw:return 536870912;default:return 16}default:return 16}}var $r=null,hm=null,Wu=null;function Ww(){if(Wu)return Wu;var t,e=hm,n=e.length,i,r="value"in $r?$r.value:$r.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Wu=r.slice(t,1<i?1-i:void 0)}function Qu(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Jc(){return!0}function nv(){return!1}function oi(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Jc:nv,this.isPropagationStopped=nv,this}return Mt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Jc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Jc)},persist:function(){},isPersistent:Jc}),e}var Ha={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dm=oi(Ha),tc=Mt({},Ha,{view:0,detail:0}),HM=oi(tc),Ed,Td,Tl,dh=Mt({},tc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pm,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Tl&&(Tl&&t.type==="mousemove"?(Ed=t.screenX-Tl.screenX,Td=t.screenY-Tl.screenY):Td=Ed=0,Tl=t),Ed)},movementY:function(t){return"movementY"in t?t.movementY:Td}}),iv=oi(dh),WM=Mt({},dh,{dataTransfer:0}),QM=oi(WM),XM=Mt({},tc,{relatedTarget:0}),wd=oi(XM),JM=Mt({},Ha,{animationName:0,elapsedTime:0,pseudoElement:0}),YM=oi(JM),KM=Mt({},Ha,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ZM=oi(KM),qM=Mt({},Ha,{data:0}),rv=oi(qM),$M={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nB(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=tB[t])?!!e[t]:!1}function pm(){return nB}var iB=Mt({},tc,{key:function(t){if(t.key){var e=$M[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Qu(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?eB[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pm,charCode:function(t){return t.type==="keypress"?Qu(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Qu(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),rB=oi(iB),sB=Mt({},dh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sv=oi(sB),oB=Mt({},tc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pm}),aB=oi(oB),lB=Mt({},Ha,{propertyName:0,elapsedTime:0,pseudoElement:0}),AB=oi(lB),cB=Mt({},dh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),uB=oi(cB),fB=[9,13,27,32],gm=Er&&"CompositionEvent"in window,ql=null;Er&&"documentMode"in document&&(ql=document.documentMode);var hB=Er&&"TextEvent"in window&&!ql,Qw=Er&&(!gm||ql&&8<ql&&11>=ql),ov=String.fromCharCode(32),av=!1;function Xw(t,e){switch(t){case"keyup":return fB.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jw(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ko=!1;function dB(t,e){switch(t){case"compositionend":return Jw(e);case"keypress":return e.which!==32?null:(av=!0,ov);case"textInput":return t=e.data,t===ov&&av?null:t;default:return null}}function pB(t,e){if(Ko)return t==="compositionend"||!gm&&Xw(t,e)?(t=Ww(),Wu=hm=$r=null,Ko=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Qw&&e.locale!=="ko"?null:e.data;default:return null}}var gB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!gB[t.type]:e==="textarea"}function Yw(t,e,n,i){Cw(i),e=bf(e,"onChange"),0<e.length&&(n=new dm("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var $l=null,EA=null;function mB(t){ob(t,0)}function ph(t){var e=$o(t);if(vw(e))return t}function _B(t,e){if(t==="change")return e}var Kw=!1;if(Er){var bd;if(Er){var xd="oninput"in document;if(!xd){var Av=document.createElement("div");Av.setAttribute("oninput","return;"),xd=typeof Av.oninput=="function"}bd=xd}else bd=!1;Kw=bd&&(!document.documentMode||9<document.documentMode)}function cv(){$l&&($l.detachEvent("onpropertychange",Zw),EA=$l=null)}function Zw(t){if(t.propertyName==="value"&&ph(EA)){var e=[];Yw(e,EA,t,lm(t)),Mw(mB,e)}}function vB(t,e,n){t==="focusin"?(cv(),$l=e,EA=n,$l.attachEvent("onpropertychange",Zw)):t==="focusout"&&cv()}function yB(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ph(EA)}function EB(t,e){if(t==="click")return ph(e)}function TB(t,e){if(t==="input"||t==="change")return ph(e)}function wB(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vi=typeof Object.is=="function"?Object.is:wB;function TA(t,e){if(Vi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!ap.call(e,r)||!Vi(t[r],e[r]))return!1}return!0}function uv(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function fv(t,e){var n=uv(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uv(n)}}function qw(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?qw(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function $w(){for(var t=window,e=mf();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=mf(t.document)}return e}function mm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function bB(t){var e=$w(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&qw(n.ownerDocument.documentElement,n)){if(i!==null&&mm(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=fv(n,s);var o=fv(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var xB=Er&&"documentMode"in document&&11>=document.documentMode,Zo=null,Cp=null,eA=null,Sp=!1;function hv(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Sp||Zo==null||Zo!==mf(i)||(i=Zo,"selectionStart"in i&&mm(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),eA&&TA(eA,i)||(eA=i,i=bf(Cp,"onSelect"),0<i.length&&(e=new dm("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Zo)))}function Yc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var qo={animationend:Yc("Animation","AnimationEnd"),animationiteration:Yc("Animation","AnimationIteration"),animationstart:Yc("Animation","AnimationStart"),transitionend:Yc("Transition","TransitionEnd")},Cd={},eb={};Er&&(eb=document.createElement("div").style,"AnimationEvent"in window||(delete qo.animationend.animation,delete qo.animationiteration.animation,delete qo.animationstart.animation),"TransitionEvent"in window||delete qo.transitionend.transition);function gh(t){if(Cd[t])return Cd[t];if(!qo[t])return t;var e=qo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in eb)return Cd[t]=e[n];return t}var tb=gh("animationend"),nb=gh("animationiteration"),ib=gh("animationstart"),rb=gh("transitionend"),sb=new Map,dv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _s(t,e){sb.set(t,e),fo(e,[t])}for(var Sd=0;Sd<dv.length;Sd++){var Pd=dv[Sd],CB=Pd.toLowerCase(),SB=Pd[0].toUpperCase()+Pd.slice(1);_s(CB,"on"+SB)}_s(tb,"onAnimationEnd");_s(nb,"onAnimationIteration");_s(ib,"onAnimationStart");_s("dblclick","onDoubleClick");_s("focusin","onFocus");_s("focusout","onBlur");_s(rb,"onTransitionEnd");Pa("onMouseEnter",["mouseout","mouseover"]);Pa("onMouseLeave",["mouseout","mouseover"]);Pa("onPointerEnter",["pointerout","pointerover"]);Pa("onPointerLeave",["pointerout","pointerover"]);fo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fo("onBeforeInput",["compositionend","keypress","textInput","paste"]);fo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),PB=new Set("cancel close invalid load scroll toggle".split(" ").concat(jl));function pv(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,CM(i,e,void 0,t),t.currentTarget=null}function ob(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],A=a.instance,h=a.currentTarget;if(a=a.listener,A!==s&&r.isPropagationStopped())break e;pv(r,a,h),s=A}else for(o=0;o<i.length;o++){if(a=i[o],A=a.instance,h=a.currentTarget,a=a.listener,A!==s&&r.isPropagationStopped())break e;pv(r,a,h),s=A}}}if(vf)throw t=Tp,vf=!1,Tp=null,t}function Et(t,e){var n=e[Lp];n===void 0&&(n=e[Lp]=new Set);var i=t+"__bubble";n.has(i)||(ab(e,t,2,!1),n.add(i))}function Id(t,e,n){var i=0;e&&(i|=4),ab(n,t,i,e)}var Kc="_reactListening"+Math.random().toString(36).slice(2);function wA(t){if(!t[Kc]){t[Kc]=!0,dw.forEach(function(n){n!=="selectionchange"&&(PB.has(n)||Id(n,!1,t),Id(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Kc]||(e[Kc]=!0,Id("selectionchange",!1,e))}}function ab(t,e,n,i){switch(Hw(e)){case 1:var r=VM;break;case 4:r=jM;break;default:r=fm}n=r.bind(null,e,n,t),r=void 0,!Ep||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Md(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var A=o.tag;if((A===3||A===4)&&(A=o.stateNode.containerInfo,A===r||A.nodeType===8&&A.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Hs(a),o===null)return;if(A=o.tag,A===5||A===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Mw(function(){var h=s,p=lm(n),m=[];e:{var y=sb.get(t);if(y!==void 0){var T=dm,b=t;switch(t){case"keypress":if(Qu(n)===0)break e;case"keydown":case"keyup":T=rB;break;case"focusin":b="focus",T=wd;break;case"focusout":b="blur",T=wd;break;case"beforeblur":case"afterblur":T=wd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=iv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=QM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=aB;break;case tb:case nb:case ib:T=YM;break;case rb:T=AB;break;case"scroll":T=HM;break;case"wheel":T=uB;break;case"copy":case"cut":case"paste":T=ZM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=sv}var C=(e&4)!==0,R=!C&&t==="scroll",S=C?y!==null?y+"Capture":null:y;C=[];for(var P=h,I;P!==null;){I=P;var F=I.stateNode;if(I.tag===5&&F!==null&&(I=F,S!==null&&(F=mA(P,S),F!=null&&C.push(bA(P,F,I)))),R)break;P=P.return}0<C.length&&(y=new T(y,b,null,n,p),m.push({event:y,listeners:C}))}}if(!(e&7)){e:{if(y=t==="mouseover"||t==="pointerover",T=t==="mouseout"||t==="pointerout",y&&n!==vp&&(b=n.relatedTarget||n.fromElement)&&(Hs(b)||b[Tr]))break e;if((T||y)&&(y=p.window===p?p:(y=p.ownerDocument)?y.defaultView||y.parentWindow:window,T?(b=n.relatedTarget||n.toElement,T=h,b=b?Hs(b):null,b!==null&&(R=ho(b),b!==R||b.tag!==5&&b.tag!==6)&&(b=null)):(T=null,b=h),T!==b)){if(C=iv,F="onMouseLeave",S="onMouseEnter",P="mouse",(t==="pointerout"||t==="pointerover")&&(C=sv,F="onPointerLeave",S="onPointerEnter",P="pointer"),R=T==null?y:$o(T),I=b==null?y:$o(b),y=new C(F,P+"leave",T,n,p),y.target=R,y.relatedTarget=I,F=null,Hs(p)===h&&(C=new C(S,P+"enter",b,n,p),C.target=I,C.relatedTarget=R,F=C),R=F,T&&b)t:{for(C=T,S=b,P=0,I=C;I;I=Oo(I))P++;for(I=0,F=S;F;F=Oo(F))I++;for(;0<P-I;)C=Oo(C),P--;for(;0<I-P;)S=Oo(S),I--;for(;P--;){if(C===S||S!==null&&C===S.alternate)break t;C=Oo(C),S=Oo(S)}C=null}else C=null;T!==null&&gv(m,y,T,C,!1),b!==null&&R!==null&&gv(m,R,b,C,!0)}}e:{if(y=h?$o(h):window,T=y.nodeName&&y.nodeName.toLowerCase(),T==="select"||T==="input"&&y.type==="file")var j=_B;else if(lv(y))if(Kw)j=TB;else{j=yB;var X=vB}else(T=y.nodeName)&&T.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(j=EB);if(j&&(j=j(t,h))){Yw(m,j,n,p);break e}X&&X(t,y,h),t==="focusout"&&(X=y._wrapperState)&&X.controlled&&y.type==="number"&&dp(y,"number",y.value)}switch(X=h?$o(h):window,t){case"focusin":(lv(X)||X.contentEditable==="true")&&(Zo=X,Cp=h,eA=null);break;case"focusout":eA=Cp=Zo=null;break;case"mousedown":Sp=!0;break;case"contextmenu":case"mouseup":case"dragend":Sp=!1,hv(m,n,p);break;case"selectionchange":if(xB)break;case"keydown":case"keyup":hv(m,n,p)}var q;if(gm)e:{switch(t){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else Ko?Xw(t,n)&&(ee="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ee="onCompositionStart");ee&&(Qw&&n.locale!=="ko"&&(Ko||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&Ko&&(q=Ww()):($r=p,hm="value"in $r?$r.value:$r.textContent,Ko=!0)),X=bf(h,ee),0<X.length&&(ee=new rv(ee,t,null,n,p),m.push({event:ee,listeners:X}),q?ee.data=q:(q=Jw(n),q!==null&&(ee.data=q)))),(q=hB?dB(t,n):pB(t,n))&&(h=bf(h,"onBeforeInput"),0<h.length&&(p=new rv("onBeforeInput","beforeinput",null,n,p),m.push({event:p,listeners:h}),p.data=q))}ob(m,e)})}function bA(t,e,n){return{instance:t,listener:e,currentTarget:n}}function bf(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=mA(t,n),s!=null&&i.unshift(bA(t,s,r)),s=mA(t,e),s!=null&&i.push(bA(t,s,r))),t=t.return}return i}function Oo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function gv(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,A=a.alternate,h=a.stateNode;if(A!==null&&A===i)break;a.tag===5&&h!==null&&(a=h,r?(A=mA(n,s),A!=null&&o.unshift(bA(n,A,a))):r||(A=mA(n,s),A!=null&&o.push(bA(n,A,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var IB=/\r\n?/g,MB=/\u0000|\uFFFD/g;function mv(t){return(typeof t=="string"?t:""+t).replace(IB,`
`).replace(MB,"")}function Zc(t,e,n){if(e=mv(e),mv(t)!==e&&n)throw Error(Ae(425))}function xf(){}var Pp=null,Ip=null;function Mp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Bp=typeof setTimeout=="function"?setTimeout:void 0,BB=typeof clearTimeout=="function"?clearTimeout:void 0,_v=typeof Promise=="function"?Promise:void 0,LB=typeof queueMicrotask=="function"?queueMicrotask:typeof _v<"u"?function(t){return _v.resolve(null).then(t).catch(RB)}:Bp;function RB(t){setTimeout(function(){throw t})}function Bd(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),yA(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);yA(e)}function os(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function vv(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Wa=Math.random().toString(36).slice(2),nr="__reactFiber$"+Wa,xA="__reactProps$"+Wa,Tr="__reactContainer$"+Wa,Lp="__reactEvents$"+Wa,OB="__reactListeners$"+Wa,FB="__reactHandles$"+Wa;function Hs(t){var e=t[nr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Tr]||n[nr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=vv(t);t!==null;){if(n=t[nr])return n;t=vv(t)}return e}t=n,n=t.parentNode}return null}function nc(t){return t=t[nr]||t[Tr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function $o(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ae(33))}function mh(t){return t[xA]||null}var Rp=[],ea=-1;function vs(t){return{current:t}}function Tt(t){0>ea||(t.current=Rp[ea],Rp[ea]=null,ea--)}function mt(t,e){ea++,Rp[ea]=t.current,t.current=e}var hs={},En=vs(hs),Nn=vs(!1),eo=hs;function Ia(t,e){var n=t.type.contextTypes;if(!n)return hs;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Un(t){return t=t.childContextTypes,t!=null}function Cf(){Tt(Nn),Tt(En)}function yv(t,e,n){if(En.current!==hs)throw Error(Ae(168));mt(En,e),mt(Nn,n)}function lb(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Ae(108,vM(t)||"Unknown",r));return Mt({},n,i)}function Sf(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hs,eo=En.current,mt(En,t),mt(Nn,Nn.current),!0}function Ev(t,e,n){var i=t.stateNode;if(!i)throw Error(Ae(169));n?(t=lb(t,e,eo),i.__reactInternalMemoizedMergedChildContext=t,Tt(Nn),Tt(En),mt(En,t)):Tt(Nn),mt(Nn,n)}var pr=null,_h=!1,Ld=!1;function Ab(t){pr===null?pr=[t]:pr.push(t)}function DB(t){_h=!0,Ab(t)}function ys(){if(!Ld&&pr!==null){Ld=!0;var t=0,e=ut;try{var n=pr;for(ut=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}pr=null,_h=!1}catch(r){throw pr!==null&&(pr=pr.slice(t+1)),Ow(Am,ys),r}finally{ut=e,Ld=!1}}return null}var ta=[],na=0,Pf=null,If=0,hi=[],di=0,to=null,mr=1,_r="";function zs(t,e){ta[na++]=If,ta[na++]=Pf,Pf=t,If=e}function cb(t,e,n){hi[di++]=mr,hi[di++]=_r,hi[di++]=to,to=t;var i=mr;t=_r;var r=32-Ni(i)-1;i&=~(1<<r),n+=1;var s=32-Ni(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,mr=1<<32-Ni(e)+r|n<<r|i,_r=s+t}else mr=1<<s|n<<r|i,_r=t}function _m(t){t.return!==null&&(zs(t,1),cb(t,1,0))}function vm(t){for(;t===Pf;)Pf=ta[--na],ta[na]=null,If=ta[--na],ta[na]=null;for(;t===to;)to=hi[--di],hi[di]=null,_r=hi[--di],hi[di]=null,mr=hi[--di],hi[di]=null}var ei=null,Zn=null,bt=!1,Ri=null;function ub(t,e){var n=gi(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Tv(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ei=t,Zn=os(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ei=t,Zn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=to!==null?{id:mr,overflow:_r}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=gi(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ei=t,Zn=null,!0):!1;default:return!1}}function Op(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Fp(t){if(bt){var e=Zn;if(e){var n=e;if(!Tv(t,e)){if(Op(t))throw Error(Ae(418));e=os(n.nextSibling);var i=ei;e&&Tv(t,e)?ub(i,n):(t.flags=t.flags&-4097|2,bt=!1,ei=t)}}else{if(Op(t))throw Error(Ae(418));t.flags=t.flags&-4097|2,bt=!1,ei=t}}}function wv(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ei=t}function qc(t){if(t!==ei)return!1;if(!bt)return wv(t),bt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Mp(t.type,t.memoizedProps)),e&&(e=Zn)){if(Op(t))throw fb(),Error(Ae(418));for(;e;)ub(t,e),e=os(e.nextSibling)}if(wv(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Zn=os(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Zn=null}}else Zn=ei?os(t.stateNode.nextSibling):null;return!0}function fb(){for(var t=Zn;t;)t=os(t.nextSibling)}function Ma(){Zn=ei=null,bt=!1}function ym(t){Ri===null?Ri=[t]:Ri.push(t)}var kB=Ir.ReactCurrentBatchConfig;function Bi(t,e){if(t&&t.defaultProps){e=Mt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Mf=vs(null),Bf=null,ia=null,Em=null;function Tm(){Em=ia=Bf=null}function wm(t){var e=Mf.current;Tt(Mf),t._currentValue=e}function Dp(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function ya(t,e){Bf=t,Em=ia=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(kn=!0),t.firstContext=null)}function vi(t){var e=t._currentValue;if(Em!==t)if(t={context:t,memoizedValue:e,next:null},ia===null){if(Bf===null)throw Error(Ae(308));ia=t,Bf.dependencies={lanes:0,firstContext:t}}else ia=ia.next=t;return e}var Ws=null;function bm(t){Ws===null?Ws=[t]:Ws.push(t)}function hb(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,bm(e)):(n.next=r.next,r.next=n),e.interleaved=n,wr(t,i)}function wr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Yr=!1;function xm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function db(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function vr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function as(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,rt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,wr(t,n)}return r=i.interleaved,r===null?(e.next=e,bm(i)):(e.next=r.next,r.next=e),i.interleaved=e,wr(t,n)}function Xu(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,cm(t,n)}}function bv(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Lf(t,e,n,i){var r=t.updateQueue;Yr=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var A=a,h=A.next;A.next=null,o===null?s=h:o.next=h,o=A;var p=t.alternate;p!==null&&(p=p.updateQueue,a=p.lastBaseUpdate,a!==o&&(a===null?p.firstBaseUpdate=h:a.next=h,p.lastBaseUpdate=A))}if(s!==null){var m=r.baseState;o=0,p=h=A=null,a=s;do{var y=a.lane,T=a.eventTime;if((i&y)===y){p!==null&&(p=p.next={eventTime:T,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var b=t,C=a;switch(y=e,T=n,C.tag){case 1:if(b=C.payload,typeof b=="function"){m=b.call(T,m,y);break e}m=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=C.payload,y=typeof b=="function"?b.call(T,m,y):b,y==null)break e;m=Mt({},m,y);break e;case 2:Yr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,y=r.effects,y===null?r.effects=[a]:y.push(a))}else T={eventTime:T,lane:y,tag:a.tag,payload:a.payload,callback:a.callback,next:null},p===null?(h=p=T,A=m):p=p.next=T,o|=y;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;y=a,a=y.next,y.next=null,r.lastBaseUpdate=y,r.shared.pending=null}}while(1);if(p===null&&(A=m),r.baseState=A,r.firstBaseUpdate=h,r.lastBaseUpdate=p,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);io|=o,t.lanes=o,t.memoizedState=m}}function xv(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(Ae(191,r));r.call(i)}}}var pb=new hw.Component().refs;function kp(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Mt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var vh={isMounted:function(t){return(t=t._reactInternals)?ho(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Cn(),r=As(t),s=vr(i,r);s.payload=e,n!=null&&(s.callback=n),e=as(t,s,r),e!==null&&(Ui(e,t,r,i),Xu(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Cn(),r=As(t),s=vr(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=as(t,s,r),e!==null&&(Ui(e,t,r,i),Xu(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Cn(),i=As(t),r=vr(n,i);r.tag=2,e!=null&&(r.callback=e),e=as(t,r,i),e!==null&&(Ui(e,t,i,n),Xu(e,t,i))}};function Cv(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!TA(n,i)||!TA(r,s):!0}function gb(t,e,n){var i=!1,r=hs,s=e.contextType;return typeof s=="object"&&s!==null?s=vi(s):(r=Un(e)?eo:En.current,i=e.contextTypes,s=(i=i!=null)?Ia(t,r):hs),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vh,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Sv(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&vh.enqueueReplaceState(e,e.state,null)}function Np(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=pb,xm(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=vi(s):(s=Un(e)?eo:En.current,r.context=Ia(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(kp(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&vh.enqueueReplaceState(r,r.state,null),Lf(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function wl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ae(309));var i=n.stateNode}if(!i)throw Error(Ae(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===pb&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(Ae(284));if(!n._owner)throw Error(Ae(290,t))}return t}function $c(t,e){throw t=Object.prototype.toString.call(e),Error(Ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Pv(t){var e=t._init;return e(t._payload)}function mb(t){function e(S,P){if(t){var I=S.deletions;I===null?(S.deletions=[P],S.flags|=16):I.push(P)}}function n(S,P){if(!t)return null;for(;P!==null;)e(S,P),P=P.sibling;return null}function i(S,P){for(S=new Map;P!==null;)P.key!==null?S.set(P.key,P):S.set(P.index,P),P=P.sibling;return S}function r(S,P){return S=cs(S,P),S.index=0,S.sibling=null,S}function s(S,P,I){return S.index=I,t?(I=S.alternate,I!==null?(I=I.index,I<P?(S.flags|=2,P):I):(S.flags|=2,P)):(S.flags|=1048576,P)}function o(S){return t&&S.alternate===null&&(S.flags|=2),S}function a(S,P,I,F){return P===null||P.tag!==6?(P=Ud(I,S.mode,F),P.return=S,P):(P=r(P,I),P.return=S,P)}function A(S,P,I,F){var j=I.type;return j===Yo?p(S,P,I.props.children,F,I.key):P!==null&&(P.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Jr&&Pv(j)===P.type)?(F=r(P,I.props),F.ref=wl(S,P,I),F.return=S,F):(F=$u(I.type,I.key,I.props,null,S.mode,F),F.ref=wl(S,P,I),F.return=S,F)}function h(S,P,I,F){return P===null||P.tag!==4||P.stateNode.containerInfo!==I.containerInfo||P.stateNode.implementation!==I.implementation?(P=Gd(I,S.mode,F),P.return=S,P):(P=r(P,I.children||[]),P.return=S,P)}function p(S,P,I,F,j){return P===null||P.tag!==7?(P=Ks(I,S.mode,F,j),P.return=S,P):(P=r(P,I),P.return=S,P)}function m(S,P,I){if(typeof P=="string"&&P!==""||typeof P=="number")return P=Ud(""+P,S.mode,I),P.return=S,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Vc:return I=$u(P.type,P.key,P.props,null,S.mode,I),I.ref=wl(S,null,P),I.return=S,I;case Jo:return P=Gd(P,S.mode,I),P.return=S,P;case Jr:var F=P._init;return m(S,F(P._payload),I)}if(zl(P)||_l(P))return P=Ks(P,S.mode,I,null),P.return=S,P;$c(S,P)}return null}function y(S,P,I,F){var j=P!==null?P.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return j!==null?null:a(S,P,""+I,F);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Vc:return I.key===j?A(S,P,I,F):null;case Jo:return I.key===j?h(S,P,I,F):null;case Jr:return j=I._init,y(S,P,j(I._payload),F)}if(zl(I)||_l(I))return j!==null?null:p(S,P,I,F,null);$c(S,I)}return null}function T(S,P,I,F,j){if(typeof F=="string"&&F!==""||typeof F=="number")return S=S.get(I)||null,a(P,S,""+F,j);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case Vc:return S=S.get(F.key===null?I:F.key)||null,A(P,S,F,j);case Jo:return S=S.get(F.key===null?I:F.key)||null,h(P,S,F,j);case Jr:var X=F._init;return T(S,P,I,X(F._payload),j)}if(zl(F)||_l(F))return S=S.get(I)||null,p(P,S,F,j,null);$c(P,F)}return null}function b(S,P,I,F){for(var j=null,X=null,q=P,ee=P=0,Q=null;q!==null&&ee<I.length;ee++){q.index>ee?(Q=q,q=null):Q=q.sibling;var V=y(S,q,I[ee],F);if(V===null){q===null&&(q=Q);break}t&&q&&V.alternate===null&&e(S,q),P=s(V,P,ee),X===null?j=V:X.sibling=V,X=V,q=Q}if(ee===I.length)return n(S,q),bt&&zs(S,ee),j;if(q===null){for(;ee<I.length;ee++)q=m(S,I[ee],F),q!==null&&(P=s(q,P,ee),X===null?j=q:X.sibling=q,X=q);return bt&&zs(S,ee),j}for(q=i(S,q);ee<I.length;ee++)Q=T(q,S,ee,I[ee],F),Q!==null&&(t&&Q.alternate!==null&&q.delete(Q.key===null?ee:Q.key),P=s(Q,P,ee),X===null?j=Q:X.sibling=Q,X=Q);return t&&q.forEach(function(D){return e(S,D)}),bt&&zs(S,ee),j}function C(S,P,I,F){var j=_l(I);if(typeof j!="function")throw Error(Ae(150));if(I=j.call(I),I==null)throw Error(Ae(151));for(var X=j=null,q=P,ee=P=0,Q=null,V=I.next();q!==null&&!V.done;ee++,V=I.next()){q.index>ee?(Q=q,q=null):Q=q.sibling;var D=y(S,q,V.value,F);if(D===null){q===null&&(q=Q);break}t&&q&&D.alternate===null&&e(S,q),P=s(D,P,ee),X===null?j=D:X.sibling=D,X=D,q=Q}if(V.done)return n(S,q),bt&&zs(S,ee),j;if(q===null){for(;!V.done;ee++,V=I.next())V=m(S,V.value,F),V!==null&&(P=s(V,P,ee),X===null?j=V:X.sibling=V,X=V);return bt&&zs(S,ee),j}for(q=i(S,q);!V.done;ee++,V=I.next())V=T(q,S,ee,V.value,F),V!==null&&(t&&V.alternate!==null&&q.delete(V.key===null?ee:V.key),P=s(V,P,ee),X===null?j=V:X.sibling=V,X=V);return t&&q.forEach(function(re){return e(S,re)}),bt&&zs(S,ee),j}function R(S,P,I,F){if(typeof I=="object"&&I!==null&&I.type===Yo&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case Vc:e:{for(var j=I.key,X=P;X!==null;){if(X.key===j){if(j=I.type,j===Yo){if(X.tag===7){n(S,X.sibling),P=r(X,I.props.children),P.return=S,S=P;break e}}else if(X.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Jr&&Pv(j)===X.type){n(S,X.sibling),P=r(X,I.props),P.ref=wl(S,X,I),P.return=S,S=P;break e}n(S,X);break}else e(S,X);X=X.sibling}I.type===Yo?(P=Ks(I.props.children,S.mode,F,I.key),P.return=S,S=P):(F=$u(I.type,I.key,I.props,null,S.mode,F),F.ref=wl(S,P,I),F.return=S,S=F)}return o(S);case Jo:e:{for(X=I.key;P!==null;){if(P.key===X)if(P.tag===4&&P.stateNode.containerInfo===I.containerInfo&&P.stateNode.implementation===I.implementation){n(S,P.sibling),P=r(P,I.children||[]),P.return=S,S=P;break e}else{n(S,P);break}else e(S,P);P=P.sibling}P=Gd(I,S.mode,F),P.return=S,S=P}return o(S);case Jr:return X=I._init,R(S,P,X(I._payload),F)}if(zl(I))return b(S,P,I,F);if(_l(I))return C(S,P,I,F);$c(S,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,P!==null&&P.tag===6?(n(S,P.sibling),P=r(P,I),P.return=S,S=P):(n(S,P),P=Ud(I,S.mode,F),P.return=S,S=P),o(S)):n(S,P)}return R}var Ba=mb(!0),_b=mb(!1),ic={},ar=vs(ic),CA=vs(ic),SA=vs(ic);function Qs(t){if(t===ic)throw Error(Ae(174));return t}function Cm(t,e){switch(mt(SA,e),mt(CA,t),mt(ar,ic),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:gp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=gp(e,t)}Tt(ar),mt(ar,e)}function La(){Tt(ar),Tt(CA),Tt(SA)}function vb(t){Qs(SA.current);var e=Qs(ar.current),n=gp(e,t.type);e!==n&&(mt(CA,t),mt(ar,n))}function Sm(t){CA.current===t&&(Tt(ar),Tt(CA))}var Ct=vs(0);function Rf(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Rd=[];function Pm(){for(var t=0;t<Rd.length;t++)Rd[t]._workInProgressVersionPrimary=null;Rd.length=0}var Ju=Ir.ReactCurrentDispatcher,Od=Ir.ReactCurrentBatchConfig,no=0,It=null,Yt=null,nn=null,Of=!1,tA=!1,PA=0,NB=0;function hn(){throw Error(Ae(321))}function Im(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Vi(t[n],e[n]))return!1;return!0}function Mm(t,e,n,i,r,s){if(no=s,It=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ju.current=t===null||t.memoizedState===null?VB:jB,t=n(i,r),tA){s=0;do{if(tA=!1,PA=0,25<=s)throw Error(Ae(301));s+=1,nn=Yt=null,e.updateQueue=null,Ju.current=HB,t=n(i,r)}while(tA)}if(Ju.current=Ff,e=Yt!==null&&Yt.next!==null,no=0,nn=Yt=It=null,Of=!1,e)throw Error(Ae(300));return t}function Bm(){var t=PA!==0;return PA=0,t}function er(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?It.memoizedState=nn=t:nn=nn.next=t,nn}function yi(){if(Yt===null){var t=It.alternate;t=t!==null?t.memoizedState:null}else t=Yt.next;var e=nn===null?It.memoizedState:nn.next;if(e!==null)nn=e,Yt=t;else{if(t===null)throw Error(Ae(310));Yt=t,t={memoizedState:Yt.memoizedState,baseState:Yt.baseState,baseQueue:Yt.baseQueue,queue:Yt.queue,next:null},nn===null?It.memoizedState=nn=t:nn=nn.next=t}return nn}function IA(t,e){return typeof e=="function"?e(t):e}function Fd(t){var e=yi(),n=e.queue;if(n===null)throw Error(Ae(311));n.lastRenderedReducer=t;var i=Yt,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,A=null,h=s;do{var p=h.lane;if((no&p)===p)A!==null&&(A=A.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),i=h.hasEagerState?h.eagerState:t(i,h.action);else{var m={lane:p,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};A===null?(a=A=m,o=i):A=A.next=m,It.lanes|=p,io|=p}h=h.next}while(h!==null&&h!==s);A===null?o=i:A.next=a,Vi(i,e.memoizedState)||(kn=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=A,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,It.lanes|=s,io|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Dd(t){var e=yi(),n=e.queue;if(n===null)throw Error(Ae(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Vi(s,e.memoizedState)||(kn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function yb(){}function Eb(t,e){var n=It,i=yi(),r=e(),s=!Vi(i.memoizedState,r);if(s&&(i.memoizedState=r,kn=!0),i=i.queue,Lm(bb.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||nn!==null&&nn.memoizedState.tag&1){if(n.flags|=2048,MA(9,wb.bind(null,n,i,r,e),void 0,null),sn===null)throw Error(Ae(349));no&30||Tb(n,e,r)}return r}function Tb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=It.updateQueue,e===null?(e={lastEffect:null,stores:null},It.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wb(t,e,n,i){e.value=n,e.getSnapshot=i,xb(e)&&Cb(t)}function bb(t,e,n){return n(function(){xb(e)&&Cb(t)})}function xb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Vi(t,n)}catch{return!0}}function Cb(t){var e=wr(t,1);e!==null&&Ui(e,t,1,-1)}function Iv(t){var e=er();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:IA,lastRenderedState:t},e.queue=t,t=t.dispatch=zB.bind(null,It,t),[e.memoizedState,t]}function MA(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=It.updateQueue,e===null?(e={lastEffect:null,stores:null},It.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Sb(){return yi().memoizedState}function Yu(t,e,n,i){var r=er();It.flags|=t,r.memoizedState=MA(1|e,n,void 0,i===void 0?null:i)}function yh(t,e,n,i){var r=yi();i=i===void 0?null:i;var s=void 0;if(Yt!==null){var o=Yt.memoizedState;if(s=o.destroy,i!==null&&Im(i,o.deps)){r.memoizedState=MA(e,n,s,i);return}}It.flags|=t,r.memoizedState=MA(1|e,n,s,i)}function Mv(t,e){return Yu(8390656,8,t,e)}function Lm(t,e){return yh(2048,8,t,e)}function Pb(t,e){return yh(4,2,t,e)}function Ib(t,e){return yh(4,4,t,e)}function Mb(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Bb(t,e,n){return n=n!=null?n.concat([t]):null,yh(4,4,Mb.bind(null,e,t),n)}function Rm(){}function Lb(t,e){var n=yi();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Im(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Rb(t,e){var n=yi();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Im(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Ob(t,e,n){return no&21?(Vi(n,e)||(n=kw(),It.lanes|=n,io|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,kn=!0),t.memoizedState=n)}function UB(t,e){var n=ut;ut=n!==0&&4>n?n:4,t(!0);var i=Od.transition;Od.transition={};try{t(!1),e()}finally{ut=n,Od.transition=i}}function Fb(){return yi().memoizedState}function GB(t,e,n){var i=As(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Db(t))kb(e,n);else if(n=hb(t,e,n,i),n!==null){var r=Cn();Ui(n,t,i,r),Nb(n,e,i)}}function zB(t,e,n){var i=As(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Db(t))kb(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Vi(a,o)){var A=e.interleaved;A===null?(r.next=r,bm(e)):(r.next=A.next,A.next=r),e.interleaved=r;return}}catch{}finally{}n=hb(t,e,r,i),n!==null&&(r=Cn(),Ui(n,t,i,r),Nb(n,e,i))}}function Db(t){var e=t.alternate;return t===It||e!==null&&e===It}function kb(t,e){tA=Of=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Nb(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,cm(t,n)}}var Ff={readContext:vi,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useInsertionEffect:hn,useLayoutEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useMutableSource:hn,useSyncExternalStore:hn,useId:hn,unstable_isNewReconciler:!1},VB={readContext:vi,useCallback:function(t,e){return er().memoizedState=[t,e===void 0?null:e],t},useContext:vi,useEffect:Mv,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Yu(4194308,4,Mb.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Yu(4194308,4,t,e)},useInsertionEffect:function(t,e){return Yu(4,2,t,e)},useMemo:function(t,e){var n=er();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=er();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=GB.bind(null,It,t),[i.memoizedState,t]},useRef:function(t){var e=er();return t={current:t},e.memoizedState=t},useState:Iv,useDebugValue:Rm,useDeferredValue:function(t){return er().memoizedState=t},useTransition:function(){var t=Iv(!1),e=t[0];return t=UB.bind(null,t[1]),er().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=It,r=er();if(bt){if(n===void 0)throw Error(Ae(407));n=n()}else{if(n=e(),sn===null)throw Error(Ae(349));no&30||Tb(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Mv(bb.bind(null,i,s,t),[t]),i.flags|=2048,MA(9,wb.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=er(),e=sn.identifierPrefix;if(bt){var n=_r,i=mr;n=(i&~(1<<32-Ni(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=PA++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=NB++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},jB={readContext:vi,useCallback:Lb,useContext:vi,useEffect:Lm,useImperativeHandle:Bb,useInsertionEffect:Pb,useLayoutEffect:Ib,useMemo:Rb,useReducer:Fd,useRef:Sb,useState:function(){return Fd(IA)},useDebugValue:Rm,useDeferredValue:function(t){var e=yi();return Ob(e,Yt.memoizedState,t)},useTransition:function(){var t=Fd(IA)[0],e=yi().memoizedState;return[t,e]},useMutableSource:yb,useSyncExternalStore:Eb,useId:Fb,unstable_isNewReconciler:!1},HB={readContext:vi,useCallback:Lb,useContext:vi,useEffect:Lm,useImperativeHandle:Bb,useInsertionEffect:Pb,useLayoutEffect:Ib,useMemo:Rb,useReducer:Dd,useRef:Sb,useState:function(){return Dd(IA)},useDebugValue:Rm,useDeferredValue:function(t){var e=yi();return Yt===null?e.memoizedState=t:Ob(e,Yt.memoizedState,t)},useTransition:function(){var t=Dd(IA)[0],e=yi().memoizedState;return[t,e]},useMutableSource:yb,useSyncExternalStore:Eb,useId:Fb,unstable_isNewReconciler:!1};function Ra(t,e){try{var n="",i=e;do n+=_M(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function kd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Up(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var WB=typeof WeakMap=="function"?WeakMap:Map;function Ub(t,e,n){n=vr(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){kf||(kf=!0,Yp=i),Up(t,e)},n}function Gb(t,e,n){n=vr(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Up(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Up(t,e),typeof i!="function"&&(ls===null?ls=new Set([this]):ls.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Bv(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new WB;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=sL.bind(null,t,e,n),e.then(t,t))}function Lv(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Rv(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=vr(-1,1),e.tag=2,as(n,e,1))),n.lanes|=1),t)}var QB=Ir.ReactCurrentOwner,kn=!1;function bn(t,e,n,i){e.child=t===null?_b(e,null,n,i):Ba(e,t.child,n,i)}function Ov(t,e,n,i,r){n=n.render;var s=e.ref;return ya(e,r),i=Mm(t,e,n,i,s,r),n=Bm(),t!==null&&!kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,br(t,e,r)):(bt&&n&&_m(e),e.flags|=1,bn(t,e,i,r),e.child)}function Fv(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!zm(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,zb(t,e,s,i,r)):(t=$u(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:TA,n(o,i)&&t.ref===e.ref)return br(t,e,r)}return e.flags|=1,t=cs(s,i),t.ref=e.ref,t.return=e,e.child=t}function zb(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(TA(s,i)&&t.ref===e.ref)if(kn=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(kn=!0);else return e.lanes=t.lanes,br(t,e,r)}return Gp(t,e,n,i,r)}function Vb(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},mt(sa,Kn),Kn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,mt(sa,Kn),Kn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,mt(sa,Kn),Kn|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,mt(sa,Kn),Kn|=i;return bn(t,e,r,n),e.child}function jb(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Gp(t,e,n,i,r){var s=Un(n)?eo:En.current;return s=Ia(e,s),ya(e,r),n=Mm(t,e,n,i,s,r),i=Bm(),t!==null&&!kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,br(t,e,r)):(bt&&i&&_m(e),e.flags|=1,bn(t,e,n,r),e.child)}function Dv(t,e,n,i,r){if(Un(n)){var s=!0;Sf(e)}else s=!1;if(ya(e,r),e.stateNode===null)Ku(t,e),gb(e,n,i),Np(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var A=o.context,h=n.contextType;typeof h=="object"&&h!==null?h=vi(h):(h=Un(n)?eo:En.current,h=Ia(e,h));var p=n.getDerivedStateFromProps,m=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||A!==h)&&Sv(e,o,i,h),Yr=!1;var y=e.memoizedState;o.state=y,Lf(e,i,o,r),A=e.memoizedState,a!==i||y!==A||Nn.current||Yr?(typeof p=="function"&&(kp(e,n,p,i),A=e.memoizedState),(a=Yr||Cv(e,n,a,i,y,A,h))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=A),o.props=i,o.state=A,o.context=h,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,db(t,e),a=e.memoizedProps,h=e.type===e.elementType?a:Bi(e.type,a),o.props=h,m=e.pendingProps,y=o.context,A=n.contextType,typeof A=="object"&&A!==null?A=vi(A):(A=Un(n)?eo:En.current,A=Ia(e,A));var T=n.getDerivedStateFromProps;(p=typeof T=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==m||y!==A)&&Sv(e,o,i,A),Yr=!1,y=e.memoizedState,o.state=y,Lf(e,i,o,r);var b=e.memoizedState;a!==m||y!==b||Nn.current||Yr?(typeof T=="function"&&(kp(e,n,T,i),b=e.memoizedState),(h=Yr||Cv(e,n,h,i,y,b,A)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,b,A),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,b,A)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=b),o.props=i,o.state=b,o.context=A,i=h):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),i=!1)}return zp(t,e,n,i,s,r)}function zp(t,e,n,i,r,s){jb(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Ev(e,n,!1),br(t,e,s);i=e.stateNode,QB.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Ba(e,t.child,null,s),e.child=Ba(e,null,a,s)):bn(t,e,a,s),e.memoizedState=i.state,r&&Ev(e,n,!0),e.child}function Hb(t){var e=t.stateNode;e.pendingContext?yv(t,e.pendingContext,e.pendingContext!==e.context):e.context&&yv(t,e.context,!1),Cm(t,e.containerInfo)}function kv(t,e,n,i,r){return Ma(),ym(r),e.flags|=256,bn(t,e,n,i),e.child}var Vp={dehydrated:null,treeContext:null,retryLane:0};function jp(t){return{baseLanes:t,cachePool:null,transitions:null}}function Wb(t,e,n){var i=e.pendingProps,r=Ct.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),mt(Ct,r&1),t===null)return Fp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=wh(o,i,0,null),t=Ks(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=jp(n),e.memoizedState=Vp,t):Om(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return XB(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var A={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=A,e.deletions=null):(i=cs(r,A),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=cs(a,s):(s=Ks(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?jp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Vp,i}return s=t.child,t=s.sibling,i=cs(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Om(t,e){return e=wh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function eu(t,e,n,i){return i!==null&&ym(i),Ba(e,t.child,null,n),t=Om(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function XB(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=kd(Error(Ae(422))),eu(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=wh({mode:"visible",children:i.children},r,0,null),s=Ks(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Ba(e,t.child,null,o),e.child.memoizedState=jp(o),e.memoizedState=Vp,s);if(!(e.mode&1))return eu(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(Ae(419)),i=kd(s,i,void 0),eu(t,e,o,i)}if(a=(o&t.childLanes)!==0,kn||a){if(i=sn,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,wr(t,r),Ui(i,t,r,-1))}return Gm(),i=kd(Error(Ae(421))),eu(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=oL.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,Zn=os(r.nextSibling),ei=e,bt=!0,Ri=null,t!==null&&(hi[di++]=mr,hi[di++]=_r,hi[di++]=to,mr=t.id,_r=t.overflow,to=e),e=Om(e,i.children),e.flags|=4096,e)}function Nv(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Dp(t.return,e,n)}function Nd(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Qb(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(bn(t,e,i.children,n),i=Ct.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Nv(t,n,e);else if(t.tag===19)Nv(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(mt(Ct,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Rf(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Nd(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Rf(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Nd(e,!0,n,null,s);break;case"together":Nd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ku(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function br(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),io|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ae(153));if(e.child!==null){for(t=e.child,n=cs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=cs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function JB(t,e,n){switch(e.tag){case 3:Hb(e),Ma();break;case 5:vb(e);break;case 1:Un(e.type)&&Sf(e);break;case 4:Cm(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;mt(Mf,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(mt(Ct,Ct.current&1),e.flags|=128,null):n&e.child.childLanes?Wb(t,e,n):(mt(Ct,Ct.current&1),t=br(t,e,n),t!==null?t.sibling:null);mt(Ct,Ct.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Qb(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),mt(Ct,Ct.current),i)break;return null;case 22:case 23:return e.lanes=0,Vb(t,e,n)}return br(t,e,n)}var Xb,Hp,Jb,Yb;Xb=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Hp=function(){};Jb=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Qs(ar.current);var s=null;switch(n){case"input":r=fp(t,r),i=fp(t,i),s=[];break;case"select":r=Mt({},r,{value:void 0}),i=Mt({},i,{value:void 0}),s=[];break;case"textarea":r=pp(t,r),i=pp(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=xf)}mp(n,i);var o;n=null;for(h in r)if(!i.hasOwnProperty(h)&&r.hasOwnProperty(h)&&r[h]!=null)if(h==="style"){var a=r[h];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(pA.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in i){var A=i[h];if(a=r!=null?r[h]:void 0,i.hasOwnProperty(h)&&A!==a&&(A!=null||a!=null))if(h==="style")if(a){for(o in a)!a.hasOwnProperty(o)||A&&A.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in A)A.hasOwnProperty(o)&&a[o]!==A[o]&&(n||(n={}),n[o]=A[o])}else n||(s||(s=[]),s.push(h,n)),n=A;else h==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,a=a?a.__html:void 0,A!=null&&a!==A&&(s=s||[]).push(h,A)):h==="children"?typeof A!="string"&&typeof A!="number"||(s=s||[]).push(h,""+A):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(pA.hasOwnProperty(h)?(A!=null&&h==="onScroll"&&Et("scroll",t),s||a===A||(s=[])):(s=s||[]).push(h,A))}n&&(s=s||[]).push("style",n);var h=s;(e.updateQueue=h)&&(e.flags|=4)}};Yb=function(t,e,n,i){n!==i&&(e.flags|=4)};function bl(t,e){if(!bt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function dn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function YB(t,e,n){var i=e.pendingProps;switch(vm(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dn(e),null;case 1:return Un(e.type)&&Cf(),dn(e),null;case 3:return i=e.stateNode,La(),Tt(Nn),Tt(En),Pm(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(qc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ri!==null&&(qp(Ri),Ri=null))),Hp(t,e),dn(e),null;case 5:Sm(e);var r=Qs(SA.current);if(n=e.type,t!==null&&e.stateNode!=null)Jb(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ae(166));return dn(e),null}if(t=Qs(ar.current),qc(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[nr]=e,i[xA]=s,t=(e.mode&1)!==0,n){case"dialog":Et("cancel",i),Et("close",i);break;case"iframe":case"object":case"embed":Et("load",i);break;case"video":case"audio":for(r=0;r<jl.length;r++)Et(jl[r],i);break;case"source":Et("error",i);break;case"img":case"image":case"link":Et("error",i),Et("load",i);break;case"details":Et("toggle",i);break;case"input":X1(i,s),Et("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Et("invalid",i);break;case"textarea":Y1(i,s),Et("invalid",i)}mp(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Zc(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Zc(i.textContent,a,t),r=["children",""+a]):pA.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Et("scroll",i)}switch(n){case"input":jc(i),J1(i,s,!0);break;case"textarea":jc(i),K1(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=xf)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Tw(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[nr]=e,t[xA]=i,Xb(t,e,!1,!1),e.stateNode=t;e:{switch(o=_p(n,i),n){case"dialog":Et("cancel",t),Et("close",t),r=i;break;case"iframe":case"object":case"embed":Et("load",t),r=i;break;case"video":case"audio":for(r=0;r<jl.length;r++)Et(jl[r],t);r=i;break;case"source":Et("error",t),r=i;break;case"img":case"image":case"link":Et("error",t),Et("load",t),r=i;break;case"details":Et("toggle",t),r=i;break;case"input":X1(t,i),r=fp(t,i),Et("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Mt({},i,{value:void 0}),Et("invalid",t);break;case"textarea":Y1(t,i),r=pp(t,i),Et("invalid",t);break;default:r=i}mp(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var A=a[s];s==="style"?xw(t,A):s==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&ww(t,A)):s==="children"?typeof A=="string"?(n!=="textarea"||A!=="")&&gA(t,A):typeof A=="number"&&gA(t,""+A):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(pA.hasOwnProperty(s)?A!=null&&s==="onScroll"&&Et("scroll",t):A!=null&&rm(t,s,A,o))}switch(n){case"input":jc(t),J1(t,i,!1);break;case"textarea":jc(t),K1(t);break;case"option":i.value!=null&&t.setAttribute("value",""+fs(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ga(t,!!i.multiple,s,!1):i.defaultValue!=null&&ga(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=xf)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return dn(e),null;case 6:if(t&&e.stateNode!=null)Yb(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ae(166));if(n=Qs(SA.current),Qs(ar.current),qc(e)){if(i=e.stateNode,n=e.memoizedProps,i[nr]=e,(s=i.nodeValue!==n)&&(t=ei,t!==null))switch(t.tag){case 3:Zc(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Zc(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[nr]=e,e.stateNode=i}return dn(e),null;case 13:if(Tt(Ct),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(bt&&Zn!==null&&e.mode&1&&!(e.flags&128))fb(),Ma(),e.flags|=98560,s=!1;else if(s=qc(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(Ae(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ae(317));s[nr]=e}else Ma(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;dn(e),s=!1}else Ri!==null&&(qp(Ri),Ri=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Ct.current&1?Kt===0&&(Kt=3):Gm())),e.updateQueue!==null&&(e.flags|=4),dn(e),null);case 4:return La(),Hp(t,e),t===null&&wA(e.stateNode.containerInfo),dn(e),null;case 10:return wm(e.type._context),dn(e),null;case 17:return Un(e.type)&&Cf(),dn(e),null;case 19:if(Tt(Ct),s=e.memoizedState,s===null)return dn(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)bl(s,!1);else{if(Kt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Rf(t),o!==null){for(e.flags|=128,bl(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return mt(Ct,Ct.current&1|2),e.child}t=t.sibling}s.tail!==null&&Nt()>Oa&&(e.flags|=128,i=!0,bl(s,!1),e.lanes=4194304)}else{if(!i)if(t=Rf(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),bl(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!bt)return dn(e),null}else 2*Nt()-s.renderingStartTime>Oa&&n!==1073741824&&(e.flags|=128,i=!0,bl(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Nt(),e.sibling=null,n=Ct.current,mt(Ct,i?n&1|2:n&1),e):(dn(e),null);case 22:case 23:return Um(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Kn&1073741824&&(dn(e),e.subtreeFlags&6&&(e.flags|=8192)):dn(e),null;case 24:return null;case 25:return null}throw Error(Ae(156,e.tag))}function KB(t,e){switch(vm(e),e.tag){case 1:return Un(e.type)&&Cf(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return La(),Tt(Nn),Tt(En),Pm(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sm(e),null;case 13:if(Tt(Ct),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ae(340));Ma()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Tt(Ct),null;case 4:return La(),null;case 10:return wm(e.type._context),null;case 22:case 23:return Um(),null;case 24:return null;default:return null}}var tu=!1,vn=!1,ZB=typeof WeakSet=="function"?WeakSet:Set,be=null;function ra(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Dt(t,e,i)}else n.current=null}function Wp(t,e,n){try{n()}catch(i){Dt(t,e,i)}}var Uv=!1;function qB(t,e){if(Pp=Tf,t=$w(),mm(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,A=-1,h=0,p=0,m=t,y=null;t:for(;;){for(var T;m!==n||r!==0&&m.nodeType!==3||(a=o+r),m!==s||i!==0&&m.nodeType!==3||(A=o+i),m.nodeType===3&&(o+=m.nodeValue.length),(T=m.firstChild)!==null;)y=m,m=T;for(;;){if(m===t)break t;if(y===n&&++h===r&&(a=o),y===s&&++p===i&&(A=o),(T=m.nextSibling)!==null)break;m=y,y=m.parentNode}m=T}n=a===-1||A===-1?null:{start:a,end:A}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ip={focusedElem:t,selectionRange:n},Tf=!1,be=e;be!==null;)if(e=be,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,be=t;else for(;be!==null;){e=be;try{var b=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var C=b.memoizedProps,R=b.memoizedState,S=e.stateNode,P=S.getSnapshotBeforeUpdate(e.elementType===e.type?C:Bi(e.type,C),R);S.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ae(163))}}catch(F){Dt(e,e.return,F)}if(t=e.sibling,t!==null){t.return=e.return,be=t;break}be=e.return}return b=Uv,Uv=!1,b}function nA(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Wp(e,n,s)}r=r.next}while(r!==i)}}function Eh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Qp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Kb(t){var e=t.alternate;e!==null&&(t.alternate=null,Kb(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[nr],delete e[xA],delete e[Lp],delete e[OB],delete e[FB])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Zb(t){return t.tag===5||t.tag===3||t.tag===4}function Gv(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Zb(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Xp(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=xf));else if(i!==4&&(t=t.child,t!==null))for(Xp(t,e,n),t=t.sibling;t!==null;)Xp(t,e,n),t=t.sibling}function Jp(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Jp(t,e,n),t=t.sibling;t!==null;)Jp(t,e,n),t=t.sibling}var an=null,Li=!1;function Gr(t,e,n){for(n=n.child;n!==null;)qb(t,e,n),n=n.sibling}function qb(t,e,n){if(or&&typeof or.onCommitFiberUnmount=="function")try{or.onCommitFiberUnmount(hh,n)}catch{}switch(n.tag){case 5:vn||ra(n,e);case 6:var i=an,r=Li;an=null,Gr(t,e,n),an=i,Li=r,an!==null&&(Li?(t=an,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):an.removeChild(n.stateNode));break;case 18:an!==null&&(Li?(t=an,n=n.stateNode,t.nodeType===8?Bd(t.parentNode,n):t.nodeType===1&&Bd(t,n),yA(t)):Bd(an,n.stateNode));break;case 4:i=an,r=Li,an=n.stateNode.containerInfo,Li=!0,Gr(t,e,n),an=i,Li=r;break;case 0:case 11:case 14:case 15:if(!vn&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Wp(n,e,o),r=r.next}while(r!==i)}Gr(t,e,n);break;case 1:if(!vn&&(ra(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Dt(n,e,a)}Gr(t,e,n);break;case 21:Gr(t,e,n);break;case 22:n.mode&1?(vn=(i=vn)||n.memoizedState!==null,Gr(t,e,n),vn=i):Gr(t,e,n);break;default:Gr(t,e,n)}}function zv(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ZB),e.forEach(function(i){var r=aL.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Ii(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:an=a.stateNode,Li=!1;break e;case 3:an=a.stateNode.containerInfo,Li=!0;break e;case 4:an=a.stateNode.containerInfo,Li=!0;break e}a=a.return}if(an===null)throw Error(Ae(160));qb(s,o,r),an=null,Li=!1;var A=r.alternate;A!==null&&(A.return=null),r.return=null}catch(h){Dt(r,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)$b(e,t),e=e.sibling}function $b(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ii(e,t),Yi(t),i&4){try{nA(3,t,t.return),Eh(3,t)}catch(C){Dt(t,t.return,C)}try{nA(5,t,t.return)}catch(C){Dt(t,t.return,C)}}break;case 1:Ii(e,t),Yi(t),i&512&&n!==null&&ra(n,n.return);break;case 5:if(Ii(e,t),Yi(t),i&512&&n!==null&&ra(n,n.return),t.flags&32){var r=t.stateNode;try{gA(r,"")}catch(C){Dt(t,t.return,C)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,A=t.updateQueue;if(t.updateQueue=null,A!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&yw(r,s),_p(a,o);var h=_p(a,s);for(o=0;o<A.length;o+=2){var p=A[o],m=A[o+1];p==="style"?xw(r,m):p==="dangerouslySetInnerHTML"?ww(r,m):p==="children"?gA(r,m):rm(r,p,m,h)}switch(a){case"input":hp(r,s);break;case"textarea":Ew(r,s);break;case"select":var y=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var T=s.value;T!=null?ga(r,!!s.multiple,T,!1):y!==!!s.multiple&&(s.defaultValue!=null?ga(r,!!s.multiple,s.defaultValue,!0):ga(r,!!s.multiple,s.multiple?[]:"",!1))}r[xA]=s}catch(C){Dt(t,t.return,C)}}break;case 6:if(Ii(e,t),Yi(t),i&4){if(t.stateNode===null)throw Error(Ae(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(C){Dt(t,t.return,C)}}break;case 3:if(Ii(e,t),Yi(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{yA(e.containerInfo)}catch(C){Dt(t,t.return,C)}break;case 4:Ii(e,t),Yi(t);break;case 13:Ii(e,t),Yi(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(km=Nt())),i&4&&zv(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(vn=(h=vn)||p,Ii(e,t),vn=h):Ii(e,t),Yi(t),i&8192){if(h=t.memoizedState!==null,(t.stateNode.isHidden=h)&&!p&&t.mode&1)for(be=t,p=t.child;p!==null;){for(m=be=p;be!==null;){switch(y=be,T=y.child,y.tag){case 0:case 11:case 14:case 15:nA(4,y,y.return);break;case 1:ra(y,y.return);var b=y.stateNode;if(typeof b.componentWillUnmount=="function"){i=y,n=y.return;try{e=i,b.props=e.memoizedProps,b.state=e.memoizedState,b.componentWillUnmount()}catch(C){Dt(i,n,C)}}break;case 5:ra(y,y.return);break;case 22:if(y.memoizedState!==null){jv(m);continue}}T!==null?(T.return=y,be=T):jv(m)}p=p.sibling}e:for(p=null,m=t;;){if(m.tag===5){if(p===null){p=m;try{r=m.stateNode,h?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=m.stateNode,A=m.memoizedProps.style,o=A!=null&&A.hasOwnProperty("display")?A.display:null,a.style.display=bw("display",o))}catch(C){Dt(t,t.return,C)}}}else if(m.tag===6){if(p===null)try{m.stateNode.nodeValue=h?"":m.memoizedProps}catch(C){Dt(t,t.return,C)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;p===m&&(p=null),m=m.return}p===m&&(p=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Ii(e,t),Yi(t),i&4&&zv(t);break;case 21:break;default:Ii(e,t),Yi(t)}}function Yi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Zb(n)){var i=n;break e}n=n.return}throw Error(Ae(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(gA(r,""),i.flags&=-33);var s=Gv(t);Jp(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Gv(t);Xp(t,a,o);break;default:throw Error(Ae(161))}}catch(A){Dt(t,t.return,A)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function $B(t,e,n){be=t,ex(t)}function ex(t,e,n){for(var i=(t.mode&1)!==0;be!==null;){var r=be,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||tu;if(!o){var a=r.alternate,A=a!==null&&a.memoizedState!==null||vn;a=tu;var h=vn;if(tu=o,(vn=A)&&!h)for(be=r;be!==null;)o=be,A=o.child,o.tag===22&&o.memoizedState!==null?Hv(r):A!==null?(A.return=o,be=A):Hv(r);for(;s!==null;)be=s,ex(s),s=s.sibling;be=r,tu=a,vn=h}Vv(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,be=s):Vv(t)}}function Vv(t){for(;be!==null;){var e=be;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:vn||Eh(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!vn)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Bi(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&xv(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}xv(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var A=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&n.focus();break;case"img":A.src&&(n.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var p=h.memoizedState;if(p!==null){var m=p.dehydrated;m!==null&&yA(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ae(163))}vn||e.flags&512&&Qp(e)}catch(y){Dt(e,e.return,y)}}if(e===t){be=null;break}if(n=e.sibling,n!==null){n.return=e.return,be=n;break}be=e.return}}function jv(t){for(;be!==null;){var e=be;if(e===t){be=null;break}var n=e.sibling;if(n!==null){n.return=e.return,be=n;break}be=e.return}}function Hv(t){for(;be!==null;){var e=be;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Eh(4,e)}catch(A){Dt(e,n,A)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(A){Dt(e,r,A)}}var s=e.return;try{Qp(e)}catch(A){Dt(e,s,A)}break;case 5:var o=e.return;try{Qp(e)}catch(A){Dt(e,o,A)}}}catch(A){Dt(e,e.return,A)}if(e===t){be=null;break}var a=e.sibling;if(a!==null){a.return=e.return,be=a;break}be=e.return}}var eL=Math.ceil,Df=Ir.ReactCurrentDispatcher,Fm=Ir.ReactCurrentOwner,mi=Ir.ReactCurrentBatchConfig,rt=0,sn=null,Ht=null,ln=0,Kn=0,sa=vs(0),Kt=0,BA=null,io=0,Th=0,Dm=0,iA=null,Fn=null,km=0,Oa=1/0,dr=null,kf=!1,Yp=null,ls=null,nu=!1,es=null,Nf=0,rA=0,Kp=null,Zu=-1,qu=0;function Cn(){return rt&6?Nt():Zu!==-1?Zu:Zu=Nt()}function As(t){return t.mode&1?rt&2&&ln!==0?ln&-ln:kB.transition!==null?(qu===0&&(qu=kw()),qu):(t=ut,t!==0||(t=window.event,t=t===void 0?16:Hw(t.type)),t):1}function Ui(t,e,n,i){if(50<rA)throw rA=0,Kp=null,Error(Ae(185));ec(t,n,i),(!(rt&2)||t!==sn)&&(t===sn&&(!(rt&2)&&(Th|=n),Kt===4&&Zr(t,ln)),Gn(t,i),n===1&&rt===0&&!(e.mode&1)&&(Oa=Nt()+500,_h&&ys()))}function Gn(t,e){var n=t.callbackNode;kM(t,e);var i=Ef(t,t===sn?ln:0);if(i===0)n!==null&&$1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&$1(n),e===1)t.tag===0?DB(Wv.bind(null,t)):Ab(Wv.bind(null,t)),LB(function(){!(rt&6)&&ys()}),n=null;else{switch(Nw(i)){case 1:n=Am;break;case 4:n=Fw;break;case 16:n=yf;break;case 536870912:n=Dw;break;default:n=yf}n=lx(n,tx.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function tx(t,e){if(Zu=-1,qu=0,rt&6)throw Error(Ae(327));var n=t.callbackNode;if(Ea()&&t.callbackNode!==n)return null;var i=Ef(t,t===sn?ln:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Uf(t,i);else{e=i;var r=rt;rt|=2;var s=ix();(sn!==t||ln!==e)&&(dr=null,Oa=Nt()+500,Ys(t,e));do try{iL();break}catch(a){nx(t,a)}while(1);Tm(),Df.current=s,rt=r,Ht!==null?e=0:(sn=null,ln=0,e=Kt)}if(e!==0){if(e===2&&(r=wp(t),r!==0&&(i=r,e=Zp(t,r))),e===1)throw n=BA,Ys(t,0),Zr(t,i),Gn(t,Nt()),n;if(e===6)Zr(t,i);else{if(r=t.current.alternate,!(i&30)&&!tL(r)&&(e=Uf(t,i),e===2&&(s=wp(t),s!==0&&(i=s,e=Zp(t,s))),e===1))throw n=BA,Ys(t,0),Zr(t,i),Gn(t,Nt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(Ae(345));case 2:Vs(t,Fn,dr);break;case 3:if(Zr(t,i),(i&130023424)===i&&(e=km+500-Nt(),10<e)){if(Ef(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Cn(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Bp(Vs.bind(null,t,Fn,dr),e);break}Vs(t,Fn,dr);break;case 4:if(Zr(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Ni(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Nt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*eL(i/1960))-i,10<i){t.timeoutHandle=Bp(Vs.bind(null,t,Fn,dr),i);break}Vs(t,Fn,dr);break;case 5:Vs(t,Fn,dr);break;default:throw Error(Ae(329))}}}return Gn(t,Nt()),t.callbackNode===n?tx.bind(null,t):null}function Zp(t,e){var n=iA;return t.current.memoizedState.isDehydrated&&(Ys(t,e).flags|=256),t=Uf(t,e),t!==2&&(e=Fn,Fn=n,e!==null&&qp(e)),t}function qp(t){Fn===null?Fn=t:Fn.push.apply(Fn,t)}function tL(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Vi(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Zr(t,e){for(e&=~Dm,e&=~Th,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ni(e),i=1<<n;t[n]=-1,e&=~i}}function Wv(t){if(rt&6)throw Error(Ae(327));Ea();var e=Ef(t,0);if(!(e&1))return Gn(t,Nt()),null;var n=Uf(t,e);if(t.tag!==0&&n===2){var i=wp(t);i!==0&&(e=i,n=Zp(t,i))}if(n===1)throw n=BA,Ys(t,0),Zr(t,e),Gn(t,Nt()),n;if(n===6)throw Error(Ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Vs(t,Fn,dr),Gn(t,Nt()),null}function Nm(t,e){var n=rt;rt|=1;try{return t(e)}finally{rt=n,rt===0&&(Oa=Nt()+500,_h&&ys())}}function ro(t){es!==null&&es.tag===0&&!(rt&6)&&Ea();var e=rt;rt|=1;var n=mi.transition,i=ut;try{if(mi.transition=null,ut=1,t)return t()}finally{ut=i,mi.transition=n,rt=e,!(rt&6)&&ys()}}function Um(){Kn=sa.current,Tt(sa)}function Ys(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,BB(n)),Ht!==null)for(n=Ht.return;n!==null;){var i=n;switch(vm(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Cf();break;case 3:La(),Tt(Nn),Tt(En),Pm();break;case 5:Sm(i);break;case 4:La();break;case 13:Tt(Ct);break;case 19:Tt(Ct);break;case 10:wm(i.type._context);break;case 22:case 23:Um()}n=n.return}if(sn=t,Ht=t=cs(t.current,null),ln=Kn=e,Kt=0,BA=null,Dm=Th=io=0,Fn=iA=null,Ws!==null){for(e=0;e<Ws.length;e++)if(n=Ws[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ws=null}return t}function nx(t,e){do{var n=Ht;try{if(Tm(),Ju.current=Ff,Of){for(var i=It.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Of=!1}if(no=0,nn=Yt=It=null,tA=!1,PA=0,Fm.current=null,n===null||n.return===null){Kt=1,BA=e,Ht=null;break}e:{var s=t,o=n.return,a=n,A=e;if(e=ln,a.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var h=A,p=a,m=p.tag;if(!(p.mode&1)&&(m===0||m===11||m===15)){var y=p.alternate;y?(p.updateQueue=y.updateQueue,p.memoizedState=y.memoizedState,p.lanes=y.lanes):(p.updateQueue=null,p.memoizedState=null)}var T=Lv(o);if(T!==null){T.flags&=-257,Rv(T,o,a,s,e),T.mode&1&&Bv(s,h,e),e=T,A=h;var b=e.updateQueue;if(b===null){var C=new Set;C.add(A),e.updateQueue=C}else b.add(A);break e}else{if(!(e&1)){Bv(s,h,e),Gm();break e}A=Error(Ae(426))}}else if(bt&&a.mode&1){var R=Lv(o);if(R!==null){!(R.flags&65536)&&(R.flags|=256),Rv(R,o,a,s,e),ym(Ra(A,a));break e}}s=A=Ra(A,a),Kt!==4&&(Kt=2),iA===null?iA=[s]:iA.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var S=Ub(s,A,e);bv(s,S);break e;case 1:a=A;var P=s.type,I=s.stateNode;if(!(s.flags&128)&&(typeof P.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(ls===null||!ls.has(I)))){s.flags|=65536,e&=-e,s.lanes|=e;var F=Gb(s,a,e);bv(s,F);break e}}s=s.return}while(s!==null)}sx(n)}catch(j){e=j,Ht===n&&n!==null&&(Ht=n=n.return);continue}break}while(1)}function ix(){var t=Df.current;return Df.current=Ff,t===null?Ff:t}function Gm(){(Kt===0||Kt===3||Kt===2)&&(Kt=4),sn===null||!(io&268435455)&&!(Th&268435455)||Zr(sn,ln)}function Uf(t,e){var n=rt;rt|=2;var i=ix();(sn!==t||ln!==e)&&(dr=null,Ys(t,e));do try{nL();break}catch(r){nx(t,r)}while(1);if(Tm(),rt=n,Df.current=i,Ht!==null)throw Error(Ae(261));return sn=null,ln=0,Kt}function nL(){for(;Ht!==null;)rx(Ht)}function iL(){for(;Ht!==null&&!PM();)rx(Ht)}function rx(t){var e=ax(t.alternate,t,Kn);t.memoizedProps=t.pendingProps,e===null?sx(t):Ht=e,Fm.current=null}function sx(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=KB(n,e),n!==null){n.flags&=32767,Ht=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Kt=6,Ht=null;return}}else if(n=YB(n,e,Kn),n!==null){Ht=n;return}if(e=e.sibling,e!==null){Ht=e;return}Ht=e=t}while(e!==null);Kt===0&&(Kt=5)}function Vs(t,e,n){var i=ut,r=mi.transition;try{mi.transition=null,ut=1,rL(t,e,n,i)}finally{mi.transition=r,ut=i}return null}function rL(t,e,n,i){do Ea();while(es!==null);if(rt&6)throw Error(Ae(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ae(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(NM(t,s),t===sn&&(Ht=sn=null,ln=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||nu||(nu=!0,lx(yf,function(){return Ea(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=mi.transition,mi.transition=null;var o=ut;ut=1;var a=rt;rt|=4,Fm.current=null,qB(t,n),$b(n,t),bB(Ip),Tf=!!Pp,Ip=Pp=null,t.current=n,$B(n),IM(),rt=a,ut=o,mi.transition=s}else t.current=n;if(nu&&(nu=!1,es=t,Nf=r),s=t.pendingLanes,s===0&&(ls=null),LM(n.stateNode),Gn(t,Nt()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(kf)throw kf=!1,t=Yp,Yp=null,t;return Nf&1&&t.tag!==0&&Ea(),s=t.pendingLanes,s&1?t===Kp?rA++:(rA=0,Kp=t):rA=0,ys(),null}function Ea(){if(es!==null){var t=Nw(Nf),e=mi.transition,n=ut;try{if(mi.transition=null,ut=16>t?16:t,es===null)var i=!1;else{if(t=es,es=null,Nf=0,rt&6)throw Error(Ae(331));var r=rt;for(rt|=4,be=t.current;be!==null;){var s=be,o=s.child;if(be.flags&16){var a=s.deletions;if(a!==null){for(var A=0;A<a.length;A++){var h=a[A];for(be=h;be!==null;){var p=be;switch(p.tag){case 0:case 11:case 15:nA(8,p,s)}var m=p.child;if(m!==null)m.return=p,be=m;else for(;be!==null;){p=be;var y=p.sibling,T=p.return;if(Kb(p),p===h){be=null;break}if(y!==null){y.return=T,be=y;break}be=T}}}var b=s.alternate;if(b!==null){var C=b.child;if(C!==null){b.child=null;do{var R=C.sibling;C.sibling=null,C=R}while(C!==null)}}be=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,be=o;else e:for(;be!==null;){if(s=be,s.flags&2048)switch(s.tag){case 0:case 11:case 15:nA(9,s,s.return)}var S=s.sibling;if(S!==null){S.return=s.return,be=S;break e}be=s.return}}var P=t.current;for(be=P;be!==null;){o=be;var I=o.child;if(o.subtreeFlags&2064&&I!==null)I.return=o,be=I;else e:for(o=P;be!==null;){if(a=be,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Eh(9,a)}}catch(j){Dt(a,a.return,j)}if(a===o){be=null;break e}var F=a.sibling;if(F!==null){F.return=a.return,be=F;break e}be=a.return}}if(rt=r,ys(),or&&typeof or.onPostCommitFiberRoot=="function")try{or.onPostCommitFiberRoot(hh,t)}catch{}i=!0}return i}finally{ut=n,mi.transition=e}}return!1}function Qv(t,e,n){e=Ra(n,e),e=Ub(t,e,1),t=as(t,e,1),e=Cn(),t!==null&&(ec(t,1,e),Gn(t,e))}function Dt(t,e,n){if(t.tag===3)Qv(t,t,n);else for(;e!==null;){if(e.tag===3){Qv(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ls===null||!ls.has(i))){t=Ra(n,t),t=Gb(e,t,1),e=as(e,t,1),t=Cn(),e!==null&&(ec(e,1,t),Gn(e,t));break}}e=e.return}}function sL(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Cn(),t.pingedLanes|=t.suspendedLanes&n,sn===t&&(ln&n)===n&&(Kt===4||Kt===3&&(ln&130023424)===ln&&500>Nt()-km?Ys(t,0):Dm|=n),Gn(t,e)}function ox(t,e){e===0&&(t.mode&1?(e=Qc,Qc<<=1,!(Qc&130023424)&&(Qc=4194304)):e=1);var n=Cn();t=wr(t,e),t!==null&&(ec(t,e,n),Gn(t,n))}function oL(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ox(t,n)}function aL(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ae(314))}i!==null&&i.delete(e),ox(t,n)}var ax;ax=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Nn.current)kn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return kn=!1,JB(t,e,n);kn=!!(t.flags&131072)}else kn=!1,bt&&e.flags&1048576&&cb(e,If,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ku(t,e),t=e.pendingProps;var r=Ia(e,En.current);ya(e,n),r=Mm(null,e,i,t,r,n);var s=Bm();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Un(i)?(s=!0,Sf(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,xm(e),r.updater=vh,e.stateNode=r,r._reactInternals=e,Np(e,i,t,n),e=zp(null,e,i,!0,s,n)):(e.tag=0,bt&&s&&_m(e),bn(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ku(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=AL(i),t=Bi(i,t),r){case 0:e=Gp(null,e,i,t,n);break e;case 1:e=Dv(null,e,i,t,n);break e;case 11:e=Ov(null,e,i,t,n);break e;case 14:e=Fv(null,e,i,Bi(i.type,t),n);break e}throw Error(Ae(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Bi(i,r),Gp(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Bi(i,r),Dv(t,e,i,r,n);case 3:e:{if(Hb(e),t===null)throw Error(Ae(387));i=e.pendingProps,s=e.memoizedState,r=s.element,db(t,e),Lf(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Ra(Error(Ae(423)),e),e=kv(t,e,i,n,r);break e}else if(i!==r){r=Ra(Error(Ae(424)),e),e=kv(t,e,i,n,r);break e}else for(Zn=os(e.stateNode.containerInfo.firstChild),ei=e,bt=!0,Ri=null,n=_b(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ma(),i===r){e=br(t,e,n);break e}bn(t,e,i,n)}e=e.child}return e;case 5:return vb(e),t===null&&Fp(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Mp(i,r)?o=null:s!==null&&Mp(i,s)&&(e.flags|=32),jb(t,e),bn(t,e,o,n),e.child;case 6:return t===null&&Fp(e),null;case 13:return Wb(t,e,n);case 4:return Cm(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Ba(e,null,i,n):bn(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Bi(i,r),Ov(t,e,i,r,n);case 7:return bn(t,e,e.pendingProps,n),e.child;case 8:return bn(t,e,e.pendingProps.children,n),e.child;case 12:return bn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,mt(Mf,i._currentValue),i._currentValue=o,s!==null)if(Vi(s.value,o)){if(s.children===r.children&&!Nn.current){e=br(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var A=a.firstContext;A!==null;){if(A.context===i){if(s.tag===1){A=vr(-1,n&-n),A.tag=2;var h=s.updateQueue;if(h!==null){h=h.shared;var p=h.pending;p===null?A.next=A:(A.next=p.next,p.next=A),h.pending=A}}s.lanes|=n,A=s.alternate,A!==null&&(A.lanes|=n),Dp(s.return,n,e),a.lanes|=n;break}A=A.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Ae(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Dp(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}bn(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,ya(e,n),r=vi(r),i=i(r),e.flags|=1,bn(t,e,i,n),e.child;case 14:return i=e.type,r=Bi(i,e.pendingProps),r=Bi(i.type,r),Fv(t,e,i,r,n);case 15:return zb(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Bi(i,r),Ku(t,e),e.tag=1,Un(i)?(t=!0,Sf(e)):t=!1,ya(e,n),gb(e,i,r),Np(e,i,r,n),zp(null,e,i,!0,t,n);case 19:return Qb(t,e,n);case 22:return Vb(t,e,n)}throw Error(Ae(156,e.tag))};function lx(t,e){return Ow(t,e)}function lL(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(t,e,n,i){return new lL(t,e,n,i)}function zm(t){return t=t.prototype,!(!t||!t.isReactComponent)}function AL(t){if(typeof t=="function")return zm(t)?1:0;if(t!=null){if(t=t.$$typeof,t===om)return 11;if(t===am)return 14}return 2}function cs(t,e){var n=t.alternate;return n===null?(n=gi(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function $u(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")zm(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Yo:return Ks(n.children,r,s,e);case sm:o=8,r|=8;break;case lp:return t=gi(12,n,e,r|2),t.elementType=lp,t.lanes=s,t;case Ap:return t=gi(13,n,e,r),t.elementType=Ap,t.lanes=s,t;case cp:return t=gi(19,n,e,r),t.elementType=cp,t.lanes=s,t;case mw:return wh(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case pw:o=10;break e;case gw:o=9;break e;case om:o=11;break e;case am:o=14;break e;case Jr:o=16,i=null;break e}throw Error(Ae(130,t==null?t:typeof t,""))}return e=gi(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Ks(t,e,n,i){return t=gi(7,t,i,e),t.lanes=n,t}function wh(t,e,n,i){return t=gi(22,t,i,e),t.elementType=mw,t.lanes=n,t.stateNode={isHidden:!1},t}function Ud(t,e,n){return t=gi(6,t,null,e),t.lanes=n,t}function Gd(t,e,n){return e=gi(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function cL(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yd(0),this.expirationTimes=yd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yd(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Vm(t,e,n,i,r,s,o,a,A){return t=new cL(t,e,n,a,A),e===1?(e=1,s===!0&&(e|=8)):e=0,s=gi(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},xm(s),t}function uL(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Jo,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Ax(t){if(!t)return hs;t=t._reactInternals;e:{if(ho(t)!==t||t.tag!==1)throw Error(Ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Un(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ae(171))}if(t.tag===1){var n=t.type;if(Un(n))return lb(t,n,e)}return e}function cx(t,e,n,i,r,s,o,a,A){return t=Vm(n,i,!0,t,r,s,o,a,A),t.context=Ax(null),n=t.current,i=Cn(),r=As(n),s=vr(i,r),s.callback=e??null,as(n,s,r),t.current.lanes=r,ec(t,r,i),Gn(t,i),t}function bh(t,e,n,i){var r=e.current,s=Cn(),o=As(r);return n=Ax(n),e.context===null?e.context=n:e.pendingContext=n,e=vr(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=as(r,e,o),t!==null&&(Ui(t,r,o,s),Xu(t,r,o)),o}function Gf(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Xv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function jm(t,e){Xv(t,e),(t=t.alternate)&&Xv(t,e)}function fL(){return null}var ux=typeof reportError=="function"?reportError:function(t){console.error(t)};function Hm(t){this._internalRoot=t}xh.prototype.render=Hm.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ae(409));bh(t,e,null,null)};xh.prototype.unmount=Hm.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ro(function(){bh(null,t,null,null)}),e[Tr]=null}};function xh(t){this._internalRoot=t}xh.prototype.unstable_scheduleHydration=function(t){if(t){var e=zw();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Kr.length&&e!==0&&e<Kr[n].priority;n++);Kr.splice(n,0,t),n===0&&jw(t)}};function Wm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ch(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Jv(){}function hL(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var h=Gf(o);s.call(h)}}var o=cx(e,i,t,0,null,!1,!1,"",Jv);return t._reactRootContainer=o,t[Tr]=o.current,wA(t.nodeType===8?t.parentNode:t),ro(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var h=Gf(A);a.call(h)}}var A=Vm(t,0,!1,null,null,!1,!1,"",Jv);return t._reactRootContainer=A,t[Tr]=A.current,wA(t.nodeType===8?t.parentNode:t),ro(function(){bh(e,A,n,i)}),A}function Sh(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var A=Gf(o);a.call(A)}}bh(e,o,t,r)}else o=hL(n,e,t,r,i);return Gf(o)}Uw=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Vl(e.pendingLanes);n!==0&&(cm(e,n|1),Gn(e,Nt()),!(rt&6)&&(Oa=Nt()+500,ys()))}break;case 13:ro(function(){var i=wr(t,1);if(i!==null){var r=Cn();Ui(i,t,1,r)}}),jm(t,1)}};um=function(t){if(t.tag===13){var e=wr(t,134217728);if(e!==null){var n=Cn();Ui(e,t,134217728,n)}jm(t,134217728)}};Gw=function(t){if(t.tag===13){var e=As(t),n=wr(t,e);if(n!==null){var i=Cn();Ui(n,t,e,i)}jm(t,e)}};zw=function(){return ut};Vw=function(t,e){var n=ut;try{return ut=t,e()}finally{ut=n}};yp=function(t,e,n){switch(e){case"input":if(hp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=mh(i);if(!r)throw Error(Ae(90));vw(i),hp(i,r)}}}break;case"textarea":Ew(t,n);break;case"select":e=n.value,e!=null&&ga(t,!!n.multiple,e,!1)}};Pw=Nm;Iw=ro;var dL={usingClientEntryPoint:!1,Events:[nc,$o,mh,Cw,Sw,Nm]},xl={findFiberByHostInstance:Hs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},pL={bundleType:xl.bundleType,version:xl.version,rendererPackageName:xl.rendererPackageName,rendererConfig:xl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ir.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Lw(t),t===null?null:t.stateNode},findFiberByHostInstance:xl.findFiberByHostInstance||fL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{hh=iu.inject(pL),or=iu}catch{}}si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dL;si.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wm(e))throw Error(Ae(200));return uL(t,e,null,n)};si.createRoot=function(t,e){if(!Wm(t))throw Error(Ae(299));var n=!1,i="",r=ux;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Vm(t,1,!1,null,null,n,!1,i,r),t[Tr]=e.current,wA(t.nodeType===8?t.parentNode:t),new Hm(e)};si.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ae(188)):(t=Object.keys(t).join(","),Error(Ae(268,t)));return t=Lw(e),t=t===null?null:t.stateNode,t};si.flushSync=function(t){return ro(t)};si.hydrate=function(t,e,n){if(!Ch(e))throw Error(Ae(200));return Sh(null,t,e,!0,n)};si.hydrateRoot=function(t,e,n){if(!Wm(t))throw Error(Ae(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=ux;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=cx(e,null,t,1,n??null,r,!1,s,o),t[Tr]=e.current,wA(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new xh(e)};si.render=function(t,e,n){if(!Ch(e))throw Error(Ae(200));return Sh(null,t,e,!1,n)};si.unmountComponentAtNode=function(t){if(!Ch(t))throw Error(Ae(40));return t._reactRootContainer?(ro(function(){Sh(null,null,t,!1,function(){t._reactRootContainer=null,t[Tr]=null})}),!0):!1};si.unstable_batchedUpdates=Nm;si.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Ch(n))throw Error(Ae(200));if(t==null||t._reactInternals===void 0)throw Error(Ae(38));return Sh(t,e,n,!1,i)};si.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=si})(fM);var Yv=dA;sp.createRoot=Yv.createRoot,sp.hydrateRoot=Yv.hydrateRoot;function LA(t){return LA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},LA(t)}function gL(t,e){if(LA(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(LA(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mL(t){var e=gL(t,"string");return LA(e)==="symbol"?e:String(e)}function w(t,e,n){return e=mL(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function At(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Fa=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),Kv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Kv&&parseFloat(Kv[1]);const _L="3.2.13";function lr(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const zd={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},vL=zd.global||zd.self||zd.window||{},Zs=typeof process!="object"||String(process)!=="[object process]"||process.browser,Qm=typeof importScripts=="function",yL=typeof window<"u"&&typeof window.orientation<"u",Zv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Zv&&parseFloat(Zv[1]);class EL{constructor(e,n){w(this,"name",void 0),w(this,"workerThread",void 0),w(this,"isRunning",!0),w(this,"result",void 0),w(this,"_resolve",()=>{}),w(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){lr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){lr(this.isRunning),this.isRunning=!1,this._reject(e)}}let Vd=class{};const jd=new Map;function TL(t){lr(t.source&&!t.url||!t.source&&t.url);let e=jd.get(t.source||t.url);return e||(t.url&&(e=wL(t.url),jd.set(t.url,e)),t.source&&(e=fx(t.source),jd.set(t.source,e))),lr(e),e}function wL(t){if(!t.startsWith("http"))return t;const e=bL(t);return fx(e)}function fx(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function bL(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function hx(t,e=!0,n){const i=n||new Set;if(t){if(qv(t))i.add(t);else if(qv(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)hx(t[r],e,i)}}return n===void 0?Array.from(i):[]}function qv(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Hd=()=>{};class $p{static isSupported(){return typeof Worker<"u"&&Zs||typeof Vd<"u"&&!Zs}constructor(e){w(this,"name",void 0),w(this,"source",void 0),w(this,"url",void 0),w(this,"terminated",!1),w(this,"worker",void 0),w(this,"onMessage",void 0),w(this,"onError",void 0),w(this,"_loadableURL","");const{name:n,source:i,url:r}=e;lr(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Hd,this.onError=s=>console.log(s),this.worker=Zs?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Hd,this.onError=Hd,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||hx(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=TL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Vd(i,{eval:!1})}else if(this.source)e=new Vd(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class xL{static isSupported(){return $p.isSupported()}constructor(e){w(this,"name","unnamed"),w(this,"source",void 0),w(this,"url",void 0),w(this,"maxConcurrency",1),w(this,"maxMobileConcurrency",1),w(this,"onDebug",()=>{}),w(this,"reuseWorkers",!0),w(this,"props",{}),w(this,"jobQueue",[]),w(this,"idleQueue",[]),w(this,"count",0),w(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new EL(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new $p({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return yL?this.maxMobileConcurrency:this.maxConcurrency}}const CL={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class gr{static isSupported(){return $p.isSupported()}static getWorkerFarm(e={}){return gr._workerFarm=gr._workerFarm||new gr({}),gr._workerFarm.setProps(e),gr._workerFarm}constructor(e){w(this,"props",void 0),w(this,"workerPools",new Map),this.props={...CL},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new xL({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}w(gr,"_workerFarm",void 0);const SL="latest";function PL(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=SL);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return lr(r),r}function IL(t,e=_L){lr(t,"no worker provided");const n=t.version;return!(!e||!n)}const ML={},BL=Object.freeze(Object.defineProperty({__proto__:null,default:ML},Symbol.toStringTag,{value:"Module"})),LL="3.2.13",Wd={};async function qs(t,e=null,n={}){return e&&(t=RL(t,e,n)),Wd[t]=Wd[t]||OL(t),await Wd[t]}function RL(t,e,n){if(t.startsWith("http"))return t;const i=n.modules||{};return i[t]?i[t]:Zs?n.CDN?(lr(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(LL,"/dist/libs/").concat(t)):Qm?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function OL(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!Zs)try{return BL&&void 0}catch{return null}if(Qm)return importScripts(t);const n=await(await fetch(t)).text();return FL(n,t)}function FL(t,e){if(!Zs)return;if(Qm)return eval.call(vL,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function DL(t,e){return!gr.isSupported()||!Zs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function kL(t,e,n,i,r){const s=t.id,o=PL(t,n),A=gr.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const h=await A.startJob("process-on-worker",NL.bind(null,r));return h.postMessage("process",{input:e,options:n,context:i}),await(await h.result).result}async function NL(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const A=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:A})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function UL(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?$v(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?$v(t,0,e):""}function $v(t,e,n){if(t.byteLength<=e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}function zL(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(UL(t),'"'))}}function dx(t){return t&&typeof t=="object"&&t.isBuffer}function VL(t){return dx(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function px(t){if(dx(t))return VL(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function jL(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function HL(...t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}function Qd(...t){const e=t,n=e&&e.length>1&&e[0].constructor||null;if(!n)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');const i=e.reduce((o,a)=>o+a.length,0),r=new n(i);let s=0;for(const o of e)r.set(o,s),s+=o.length;return r}function Xm(t,e,n){const i=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function rc(t,e){return At(t>=0),At(e>0),t+(e-1)&~(e-1)}function WL(t,e,n){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const r=t.byteOffset,s=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,r,s)}return e.set(i,n),n+rc(i.byteLength,4)}async function QL(t){const e=[];for await(const n of t)e.push(n);return HL(...e)}function ey(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class ty{constructor(e,n){w(this,"name",void 0),w(this,"type",void 0),w(this,"sampleSize",1),w(this,"time",void 0),w(this,"count",void 0),w(this,"samples",void 0),w(this,"lastTiming",void 0),w(this,"lastSampleTime",void 0),w(this,"lastSampleCount",void 0),w(this,"_count",0),w(this,"_time",0),w(this,"_samples",0),w(this,"_startTime",0),w(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ey(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ey()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class sc{constructor(e){w(this,"id",void 0),w(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof ty?this.stats[n]=e:this.stats[n]=new ty(n,i)),this.stats[n]}}const XL="Queued Requests",JL="Active Requests",YL="Cancelled Requests",KL="Queued Requests Ever",ZL="Active Requests Ever",qL={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class gx{constructor(e={}){w(this,"props",void 0),w(this,"stats",void 0),w(this,"activeRequestCount",0),w(this,"requestQueue",[]),w(this,"requestMap",new Map),w(this,"deferredUpdate",null),this.props={...qL,...e},this.stats=new sc({id:this.props.id}),this.stats.get(XL),this.stats.get(JL),this.stats.get(YL),this.stats.get(KL),this.stats.get(ZL)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let $L="";const ny={};function eR(t){for(const e in ny)if(t.startsWith(e)){const n=ny[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat($L).concat(t)),t}function tR(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}function mx(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const nR=t=>typeof t=="boolean",sA=t=>typeof t=="function",oc=t=>t!==null&&typeof t=="object",iy=t=>oc(t)&&t.constructor==={}.constructor,iR=t=>t&&typeof t[Symbol.iterator]=="function",rR=t=>t&&typeof t[Symbol.asyncIterator]=="function",Qa=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Xa=t=>typeof Blob<"u"&&t instanceof Blob,sR=t=>t&&typeof t=="object"&&t.isBuffer,oR=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||oc(t)&&sA(t.tee)&&sA(t.cancel)&&sA(t.getReader),aR=t=>oc(t)&&sA(t.read)&&sA(t.pipe)&&nR(t.readable),_x=t=>oR(t)||aR(t),lR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,AR=/^([-\w.]+\/[-\w.+]+)/;function cR(t){const e=AR.exec(t);return e?e[1]:t}function ry(t){const e=lR.exec(t);return e?e[1]:""}const uR=/\?.*/;function Ph(t){if(Qa(t)){const e=Xd(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:cR(n)||ry(e)}}return Xa(t)?{url:Xd(t.name||""),type:t.type||""}:typeof t=="string"?{url:Xd(t),type:ry(t)}:{url:"",type:""}}function fR(t){return Qa(t)?t.headers["content-length"]||-1:Xa(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Xd(t){return t.replace(uR,"")}async function vx(t){if(Qa(t))return t;const e={},n=fR(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=Ph(t);r&&(e["content-type"]=r);const s=await pR(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function hR(t){if(!t.ok){const e=await dR(t);throw new Error(e)}}async function dR(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function pR(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=gR(n);return"data:base64,".concat(i)}return null}function gR(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function eg(t,e){if(typeof t=="string"){t=eR(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await vx(t)}function yx(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Mr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||yx()}const ef={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},ru=ef.window||ef.self||ef.global,Cl=ef.process||{},Ex=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Mr();const Jd=globalThis;function Tx(t){if(!t&&!Mr())return"Node";if(yx(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":Jd.chrome?"Chrome":Jd.safari?"Safari":Jd.mozInnerScreenX?"Firefox":"Unknown"}function mR(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class _R{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";w(this,"storage",void 0),w(this,"id",void 0),w(this,"config",void 0),this.storage=mR(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function vR(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function yR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Yd(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let zf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zf||(zf={}));function sy(t){return typeof t=="string"?zf[t.toUpperCase()]||zf.WHITE:t}function ER(t,e,n){return!Mr&&typeof t=="string"&&(e&&(e=sy(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=sy(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function TR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function Vf(t,e){if(!t)throw new Error(e||"Assertion failed")}function Fo(){let t;if(Mr&&"performance"in ru){var e,n;t=ru==null||(e=ru.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Cl){var i;const r=Cl==null||(i=Cl.hrtime)===null||i===void 0?void 0:i.call(Cl);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const Do={debug:Mr&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},wR={enabled:!0,level:0};function fi(){}const oy={},ay={once:!0};class ac{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};w(this,"id",void 0),w(this,"VERSION",Ex),w(this,"_startTs",Fo()),w(this,"_deltaTs",Fo()),w(this,"_storage",void 0),w(this,"userData",{}),w(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new _R("__probe-".concat(this.id,"__"),wR),this.timeStamp("".concat(this.id," started")),TR(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Fo()-this._startTs).toPrecision(10))}getDelta(){return Number((Fo()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Vf(e,n)}warn(e){return this._getLogFunction(0,e,Do.warn,arguments,ay)}error(e){return this._getLogFunction(0,e,Do.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Do.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Do.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,Do.debug||Do.info,arguments,ay)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||fi,i&&[i],{tag:SR(n)}):fi}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?Mr?CR({image:r,message:s,scale:o}):xR():fi}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||fi)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=ly({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||fi)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=wx(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=ly({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,Vf(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Fo();const o=s.tag||s.message;if(s.once)if(!oy[o])oy[o]=Fo();else return fi;return n=bR(this.id,s.message,s),i.bind(console,n,...s.args)}return fi}}w(ac,"VERSION",Ex);function wx(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Vf(Number.isFinite(e)&&e>=0),e}function ly(t){const{logLevel:e,message:n}=t;t.logLevel=wx(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Vf(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function bR(t,e,n){if(typeof e=="string"){const i=n.time?yR(vR(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=ER(e,n.color,n.background)}return e}function xR(t){return console.warn("removed"),fi}function CR(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Yd(s,n,i);console.log(...o)},s.src=e,fi}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Yd(e,n,i)),fi;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Yd(s,n,i)),s.src=e.toDataURL(),fi}return fi}function SR(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Ay=new ac({id:"loaders.gl"});class PR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class IR{constructor(){w(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const bx={fetch:null,mimeType:void 0,nothrow:!1,log:new IR,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Fa,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},MR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xx(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Cx=()=>{const t=xx();return t.globalOptions=t.globalOptions||{...bx},t.globalOptions};function BR(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],LR(t,n),OR(e,t,i)}function Sx(t,e){const n=Cx(),i=t||n;return typeof i.fetch=="function"?i.fetch:oc(i.fetch)?r=>eg(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:eg}function LR(t,e){cy(t,null,bx,MR,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};cy(i,n.id,r,s,e)}}function cy(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const A=!e&&oc(t[a]),h=a==="baseUri"&&!e,p=a==="workerUrl"&&e;if(!(a in n)&&!h&&!p){if(a in i)Ay.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!A){const m=RR(a,r);Ay.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(m))()}}}}function RR(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function OR(t,e,n){const r={...t.options||{}};return FR(r,n),r.log===null&&(r.log=new PR),uy(r,Cx()),uy(r,e),r}function uy(t,e){for(const n in e)if(n in e){const i=e[n];iy(i)&&iy(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function FR(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Jm(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Ym(t){var e,n;At(t,"null loader"),At(Jm(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Px=()=>{const t=xx();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function DR(t){const e=Px();t=Array.isArray(t)?t:[t];for(const n of t){const i=Ym(n);e.find(r=>i===r)||e.unshift(i)}}function kR(){return Px()}const NR=new ac({id:"loaders.gl"}),UR=/\.([^.]+)$/;async function GR(t,e=[],n,i){if(!Ix(t))return null;let r=fy(t,e,{...n,nothrow:!0},i);if(r)return r;if(Xa(t)&&(t=await t.slice(0,10).arrayBuffer(),r=fy(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(Mx(t));return r}function fy(t,e=[],n,i){if(!Ix(t))return null;if(e&&!Array.isArray(e))return Ym(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...kR()),VR(r);const s=zR(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(Mx(t));return s}function zR(t,e,n,i){const{url:r,type:s}=Ph(t),o=r||(i==null?void 0:i.url);let a=null,A="";if(n!=null&&n.mimeType&&(a=Kd(e,n==null?void 0:n.mimeType),A="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||jR(e,o),A=A||(a?"matched url ".concat(o):""),a=a||Kd(e,s),A=A||(a?"matched MIME type ".concat(s):""),a=a||WR(e,t),A=A||(a?"matched initial data ".concat(Bx(t)):""),a=a||Kd(e,n==null?void 0:n.fallbackMimeType),A=A||(a?"matched fallback MIME type ".concat(s):""),A){var h;NR.log(1,"selectLoader selected ".concat((h=a)===null||h===void 0?void 0:h.name,": ").concat(A,"."))}return a}function Ix(t){return!(t instanceof Response&&t.status===204)}function Mx(t){const{url:e,type:n}=Ph(t);let i="No valid loader found (";i+=e?"".concat(tR(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Bx(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function VR(t){for(const e of t)Ym(e)}function jR(t,e){const n=e&&UR.exec(e),i=n&&n[1];return i?HR(t,i):null}function HR(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Kd(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function WR(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(QR(e,n))return n}else if(ArrayBuffer.isView(e)){if(hy(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&hy(e,0,n))return n;return null}function QR(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function hy(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>XR(t,e,n,r))}function XR(t,e,n,i){if(i instanceof ArrayBuffer)return jL(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=tg(t,e,i.length);return i===r;default:return!1}}function Bx(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?tg(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?tg(t,0,e):""}function tg(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const JR=256*1024;function*YR(t,e){const n=(e==null?void 0:e.chunkSize)||JR;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const KR=256*1024;function*ZR(t,e={}){const{chunkSize:n=KR}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const qR=1024*1024;async function*$R(t,e){const n=(e==null?void 0:e.chunkSize)||qR;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function dy(t,e){return Fa?e4(t,e):t4(t)}async function*e4(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield px(o)}}catch{n.releaseLock()}}async function*t4(t,e){for await(const n of t)yield px(n)}function n4(t,e){if(typeof t=="string")return YR(t,e);if(t instanceof ArrayBuffer)return ZR(t,e);if(Xa(t))return $R(t,e);if(_x(t))return dy(t,e);if(Qa(t))return dy(t.body,e);throw new Error("makeIterator")}const Lx="Cannot convert supplied data type";function i4(t,e,n){if(e.text&&typeof t=="string")return t;if(sR(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(Lx)}async function r4(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return i4(t,e);if(Xa(t)&&(t=await vx(t)),Qa(t)){const r=t;return await hR(r),e.binary?await r.arrayBuffer():await r.text()}if(_x(t)&&(t=n4(t,n)),iR(t)||rR(t))return QL(t);throw new Error(Lx)}function s4(t,e,n=null){if(n)return n;const i={fetch:Sx(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function o4(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Km(t,e,n,i){lr(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Jm(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=Ph(t),o=o4(e,i),a=await GR(t,o,n);return a?(n=BR(n,a,o,r),i=s4({url:r,parse:Km,loaders:o},n,i),await a4(a,t,n,i)):null}async function a4(t,e,n,i){if(IL(t),Qa(e)){const r=e,{ok:s,redirected:o,status:a,statusText:A,type:h,url:p}=r,m=Object.fromEntries(r.headers.entries());i.response={headers:m,ok:s,redirected:o,status:a,statusText:A,type:h,url:p}}if(e=await r4(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(DL(t,n))return await kL(t,e,n,i,Km);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw lr(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function xr(t,e,n,i){!Array.isArray(e)&&!Jm(e)&&(n=e,e=void 0);const r=Sx(n);let s=t;return typeof t=="string"&&(s=await r(t)),Xa(t)&&(s=await r(t)),await Km(s,e,n)}const l4="3.2.13",{_parseImageNode:A4}=globalThis,ng=typeof Image<"u",ig=typeof ImageBitmap<"u",c4=Boolean(A4),rg=Fa?!0:c4;function u4(t){switch(t){case"auto":return ig||ng||rg;case"imagebitmap":return ig;case"image":return ng;case"data":return rg;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function f4(){if(ig)return"imagebitmap";if(ng)return"image";if(rg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function h4(t){const e=p4(t);if(!e)throw new Error("Not an image");return e}function d4(t){switch(h4(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function p4(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const g4=/^data:image\/svg\+xml/,m4=/\.svg((\?|#).*)?$/;function Zm(t){return t&&(g4.test(t)||m4.test(t))}function _4(t,e){if(Zm(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Rx(t,e)}function Rx(t,e){if(Zm(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Ox(t,e,n){const i=_4(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await v4(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function v4(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const y4={};let py=!0;async function E4(t,e,n){let i;Zm(n)?i=await Ox(t,e,n):i=Rx(t,n);const r=e&&e.imagebitmap;return await T4(i,r)}async function T4(t,e=null){if((w4(e)||!py)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),py=!1}return await createImageBitmap(t)}function w4(t){for(const e in t||y4)return!1;return!0}const ir=!1,oA=!0;function qm(t){const e=lc(t);return b4(e)||S4(e)||x4(e)||C4(e)}function b4(t){const e=lc(t);return e.byteLength>=24&&e.getUint32(0,ir)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ir),height:e.getUint32(20,ir)}:null}function x4(t){const e=lc(t);return e.byteLength>=10&&e.getUint32(0,ir)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,oA),height:e.getUint16(8,oA)}:null}function C4(t){const e=lc(t);return e.byteLength>=14&&e.getUint16(0,ir)===16973&&e.getUint32(2,oA)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,oA),height:e.getUint32(22,oA)}:null}function S4(t){const e=lc(t);if(!(e.byteLength>=3&&e.getUint16(0,ir)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=P4();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,ir);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,ir),width:e.getUint16(s+7,ir)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,ir)}return null}function P4(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function lc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function I4(t,e){const{mimeType:n}=qm(t)||{},i=globalThis._parseImageNode;return At(i),await i(t,n)}async function M4(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=B4(r);let a;switch(o){case"imagebitmap":a=await E4(t,e,s);break;case"image":a=await Ox(t,e,s);break;case"data":a=await I4(t);break;default:At(!1)}return r==="data"&&(a=d4(a)),a}function B4(t){switch(t){case"auto":case"data":return f4();default:return u4(t),t}}const L4=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],R4=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],O4={image:{type:"auto",decode:!0}},$m={id:"image",module:"images",name:"Images",version:l4,mimeTypes:R4,extensions:L4,parse:M4,tests:[t=>Boolean(qm(new DataView(t)))],options:O4},F4=["image/png","image/jpeg","image/gif"],Zd={};function D4(t){return Zd[t]===void 0&&(Zd[t]=k4(t)),Zd[t]}function k4(t){switch(t){case"image/webp":return N4();case"image/svg":return Fa;default:if(!Fa){const{_parseImageNode:e}=globalThis;return Boolean(e)&&F4.includes(t)}return!0}}function N4(){if(!Fa)return!1;try{return document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}}const Re=new ac({id:"deck"});let sg={};function U4(t){sg=t}function mn(t,e,n,i){Re.level>0&&sg[t]&&sg[t].call(null,e,n,i)}function G4(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const z4={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:G4,parseTextSync:JSON.parse},aA="8.8.24",tf=globalThis.deck&&globalThis.deck.VERSION;if(tf&&tf!==aA)throw new Error("deck.gl - multiple versions detected: ".concat(tf," vs ").concat(aA));tf||(Re.log(1,"deck.gl ".concat(aA))(),globalThis.deck={...globalThis.deck,VERSION:aA,version:aA,log:Re,_registerLoggers:U4},DR([z4,[$m,{imagebitmap:{premultiplyAlpha:"none"}}]]));const V4=globalThis.deck,xe=new ac({id:"luma.gl"});function xn(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const j4="Invalid WebGLRenderingContext",H4="Requires WebGL2";function Ih(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function He(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function W4(t){return He(t)?t:null}function Mh(t){return xn(Ih(t),j4),t}function yn(t){return xn(He(t),H4),t}const Hl={};function Q4(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function X4(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function J4(t,e){Hl[t]=!0,e!==void 0&&Q4(e)}function Y4(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Hl[i]=!0);while(i!==0);for(i in Hl)if(Hl[i])return delete Hl[i],parseInt(i,10);return 0}}const Ac=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};Ac.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Ac.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const po=function(e){const n=this;this.gl=e,Y4(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const A=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return A.buffer;case 34338:return A.enabled;case 34339:return A.size;case 34340:return A.stride;case 34341:return A.type;case 34922:return A.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,A,h,p){const m=n.currentVertexArrayObject;m.maxAttrib=Math.max(m.maxAttrib,s);const y=m.attribs[s];return y.buffer=n.currentArrayBuffer,y.size=o,y.type=a,y.normalized=A,y.stride=h,y.offset=p,y.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{X4("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};po.prototype.VERTEX_ARRAY_BINDING_OES=34229;po.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Ac(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};po.prototype.createVertexArrayOES=function(){const e=new Ac(this);return this.vertexArrayObjects.push(e),e};po.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};po.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Ac&&e.hasBeenBound&&e.ext===this)};po.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){J4(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let A=0;A<=a;A++){const h=s.attribs[A],p=r?r.attribs[A]:null;if((!r||h.enabled!==p.enabled)&&(h.enabled?i.enableVertexAttribArray.call(n,A):i.disableVertexAttribArray.call(n,A)),h.enabled){let m=!1;(!r||h.buffer!==p.buffer)&&(o!==h.buffer&&(i.bindBuffer.call(n,34962,h.buffer),o=h.buffer),m=!0),(m||h.cached!==p.cached)&&i.vertexAttribPointer.call(n,A,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function K4(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new po(this)),this.__OESVertexArrayObject))}}const gy="OES_element_index",my="WEBGL_draw_buffers",Z4="EXT_disjoint_timer_query",q4="EXT_disjoint_timer_query_webgl2",$4="EXT_texture_filter_anisotropic",_y="WEBGL_debug_renderer_info",eO=35723,tO=4352,nO=36795,iO=34047,rO=37445,sO=37446,gt=t=>He(t)?void 0:0,oO={[3074]:t=>He(t)?void 0:36064,[eO]:t=>He(t)?void 0:tO,[35977]:gt,[32937]:gt,[nO]:(t,e)=>{const n=He(t)?t.getExtension(q4):t.getExtension(Z4);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[rO]:(t,e)=>{const n=t.getExtension(_y);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[sO]:(t,e)=>{const n=t.getExtension(_y);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[iO]:(t,e)=>{const n=t.luma.extensions[$4];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:gt,[35071]:gt,[37447]:gt,[36063]:(t,e)=>{if(!He(t)){const n=t.getExtension(my);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:gt,[35374]:gt,[35377]:gt,[34852]:t=>{if(!He(t)){const e=t.getExtension(my);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(gy)?2147483647:65535,[33001]:t=>t.getExtension(gy)?16777216:65535,[33e3]:t=>16777216,[37157]:gt,[35373]:gt,[35657]:gt,[36183]:gt,[37137]:gt,[34045]:gt,[35978]:gt,[35979]:gt,[35968]:gt,[35376]:gt,[35375]:gt,[35659]:gt,[37154]:gt,[35371]:gt,[35658]:gt,[35076]:gt,[35077]:gt,[35380]:gt};function aO(t,e,n){const i=oO[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const lO="OES_vertex_array_object",Fx="ANGLE_instanced_arrays",AO="WEBGL_draw_buffers",cO="EXT_disjoint_timer_query",uO="EXT_texture_filter_anisotropic",fO="VertexArray requires WebGL2 or OES_vertex_array_object extension";function hO(t,e){return{webgl2:He(t),ext:t.getExtension(e)}}const Dx={[lO]:{meta:{suffix:"OES"},createVertexArray:()=>{xn(!1,fO)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Fx]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){xn(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[AO]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{xn(!1)}},[cO]:{meta:{suffix:"EXT"},createQuery:()=>{xn(!1)},deleteQuery:()=>{xn(!1)},beginQuery:()=>{xn(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},qd={readBuffer:(t,e,n)=>{He(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=hO(t,Fx);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!He(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!He(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[uO];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:aO,hint(t,e,n,i){return e(n,i)}};function dO(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(K4(t),pO(t),mO(t,Dx),gO(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=dO;function pO(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function gO(t,e){let{target:n,target2:i}=e;Object.keys(qd).forEach(r=>{if(typeof qd[r]=="function"){const s=t[r]?t[r].bind(t):()=>{},o=qd[r].bind(null,t,s);n[r]=o,i[r]=o}})}function mO(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&_O(t,{extension:n,target:t.luma,target2:t})}function _O(t,e){let{extension:n,target:i,target2:r}=e;const s=Dx[n];xn(s);const{meta:o={}}=s,{suffix:a=""}=o,A=t.getExtension(n);for(const h of Object.keys(s)){const p="".concat(h).concat(a);let m=null;h==="meta"||typeof t[h]=="function"||(A&&typeof A[p]=="function"?m=function(){return A[p](...arguments)}:typeof s[h]=="function"&&(m=s[h].bind(i))),m&&(i[h]=m,r[h]=m)}}const e_={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},zr=(t,e,n)=>e?t.enable(n):t.disable(n),vy=(t,e,n)=>t.hint(n,e),Wn=(t,e,n)=>t.pixelStorei(n,e),vO=(t,e)=>{const n=He(t)?36009:36160;return t.bindFramebuffer(n,e)},yO=(t,e)=>t.bindFramebuffer(36008,e);function Sl(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const EO={[3042]:zr,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:zr,[2885]:(t,e)=>t.cullFace(e),[2929]:zr,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:zr,[35723]:vy,[36006]:vO,[2886]:(t,e)=>t.frontFace(e),[33170]:vy,[2849]:(t,e)=>t.lineWidth(e),[32823]:zr,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:zr,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:zr,[3088]:(t,e)=>t.scissor(...e),[2960]:zr,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Wn,[3317]:Wn,[37440]:Wn,[37441]:Wn,[37443]:Wn,[3330]:Wn,[3332]:Wn,[3331]:Wn,[36010]:yO,[3314]:Wn,[32878]:Wn,[3316]:Wn,[3315]:Wn,[32877]:Wn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Sl(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Sl(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Sl(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Sl(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Sl(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Ft(t,e,n){return e[t]!==void 0?e[t]:n[t]}const TO={blendEquation:(t,e,n)=>t.blendEquationSeparate(Ft(32777,e,n),Ft(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Ft(32969,e,n),Ft(32968,e,n),Ft(32971,e,n),Ft(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Ft(32824,e,n),Ft(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Ft(32938,e,n),Ft(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Ft(2962,e,n),Ft(2967,e,n),Ft(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Ft(34816,e,n),Ft(36003,e,n),Ft(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Ft(2964,e,n),Ft(2965,e,n),Ft(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Ft(34817,e,n),Ft(34818,e,n),Ft(34819,e,n))},yy={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},Ki=(t,e)=>t.isEnabled(e),Ey={[3042]:Ki,[2884]:Ki,[2929]:Ki,[3024]:Ki,[32823]:Ki,[32926]:Ki,[32928]:Ki,[3089]:Ki,[2960]:Ki,[35977]:Ki};function kx(t){for(const e in t)return!1;return!0}function wO(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Ty(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function bO(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:A,oldValue:h}=n(t.state._updateCache,...o);return A&&i(...o),h},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function xO(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class CO{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?PO(e):Object.assign({},e_),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){xn(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Cr(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){xn(s!==void 0);const o=e[s],a=this.cache[s];wO(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function Nx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(xn(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new CO(t,{copyState:i}),xO(t);for(const s in yy){const o=yy[s];bO(t,s,o)}Ty(t,"getParameter"),Ty(t,"isEnabled")}return t.state.enable=n,t}function SO(t){t.state||Nx(t,{copyState:!1}),t.state.push()}function wy(t){xn(t.state),t.state.pop()}function Cr(t,e){if(xn(Ih(t),"setParameters requires a WebGL context"),kx(e))return;const n={};for(const r in e){const s=Number(r),o=EO[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=TO[r];s(t,e,i)}}function PO(t,e){if(e=e||e_,typeof e=="number"){const r=e,s=Ey[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=Ey[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function IO(t){Cr(t,e_)}function _i(t,e,n){if(kx(e))return n(t);const{nocatch:i=!0}=e;SO(t),Cr(t,e);let r;if(i)r=n(t),wy(t);else try{r=n(t)}finally{wy(t)}return r}function Da(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function $d(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Da(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return BO(e,i,r,s,n)}function MO(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function BO(t,e,n,i,r){const s=by(t[0],e,n);let o=xy(t[1],e,i,r),a=by(t[0]+1,e,n);const A=a===n-1?a:a-1;a=xy(t[1]+1,e,i,r);let h;return r?(a=a===0?a:a+1,h=o,o=a):h=a===i-1?a:a-1,{x:s,y:o,width:Math.max(A-s+1,1),height:Math.max(h-o+1,1)}}function by(t,e,n){return Math.min(Math.round(t*e),n-1)}function xy(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const t_=Mr(),LO=t_&&typeof document<"u",Ux={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Gx(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};xn(t_,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Ux,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=DO({canvas:s,width:e,height:n,onError:i});return r=FO(o,t),r?(r=n_(r,t),kO(r),r):null}function n_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||NO(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Ux,e);const{manageState:n,debug:i}=e;return n&&Nx(t,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return xe.log(1,...s)()}}),t_&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),xe.level=Math.max(xe.level,1)):xe.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function RO(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function OO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=MO(e.useDevicePixels);UO(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function FO(t,e){const{onError:n}=e;let i=null;const r=A=>i=A.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function DO(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,s;return typeof e=="string"?(LO&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function kO(t){const e=He(t)?"WebGL2":"WebGL1",n=RO(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";xe.info(1,"".concat(e).concat(r," context ").concat(i))()}function NO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function UO(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(xe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),A=Math.floor(r*o);t.canvas.width=a,t.canvas.height=A,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==A)&&(xe.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const lA="8.5.18",GO="set luma.log.level=1 (or higher) to trace rendering";class zO{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new sc({id:e})),this.stats.get(e)}}const Xs=new zO;if(globalThis.luma&&globalThis.luma.VERSION!==lA)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(lA));globalThis.luma||(Mr()&&xe.log(1,"luma.gl ".concat(lA," - ").concat(GO))(),globalThis.luma=globalThis.luma||{VERSION:lA,version:lA,log:xe,stats:Xs,globals:{modules:{},nodeIO:{}}});function VO(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function jO(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ge(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function e0(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ge(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function us(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const t0={};function ji(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";t0[t]=t0[t]||1;const e=t0[t]++;return"".concat(t,"-").concat(e)}function Cy(t){return ge(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function ka(t){let e=!0;for(const n in t){e=!1;break}return e}function zx(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw xe.removed("Calling removed method ".concat(e,".").concat(o,": "),r)(),new Error(o)})})}const ko="Resource subclass must define virtual methods";let Br=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Mh(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||ji(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=e0(this.gl,e),ge(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=He(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,A="webgl2"in r?r.webgl2:r.webgl1;return s?A:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=He(this.gl),o={},a=n||Object.keys(r);for(const A of a){const h=r[A];if(h&&(!("webgl2"in h)||s)&&(!("extension"in h)||this.gl.getExtension(h.extension))){const m=i?us(this.gl,A):A;o[m]=this.getParameter(A,e),i&&h.type==="GLenum"&&(o[m]=us(this.gl,o[m]))}}return o}setParameter(e,n){e=e0(this.gl,e),ge(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=He(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=e0(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return zx(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(ko)}_deleteHandle(){throw new Error(ko)}_bindHandle(e){throw new Error(ko)}_getOptsFromHandle(){throw new Error(ko)}_getParameter(e,n){throw new Error(ko)}_setParameter(e,n){throw new Error(ko)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Xs.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Xs.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=Xs.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(e),r.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Xs.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const HO="Failed to deduce GL constant from typed array";function og(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(HO)}}function RA(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function WO(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const A=a*o,h=(i-a-1)*o;s.set(e.subarray(A,A+o)),e.copyWithin(A,h,h+o),e.set(s,h)}}function QO(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let A=0;A<r;A++)for(let h=0;h<4;h++)o[(a*r+A)*4+h]=e[(a*2*n+A*2)*4+h];return{data:o,width:r,height:s}}function ag(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const h=i[a]?"".concat(t,".").concat(i[a]):"N/A";xe.removed("".concat(t,".").concat(a),h)()}for(const a in r)if(a in e){const A=r[a];xe.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(A))()}let o=null;for(const a in s)if(a in e){const A=s[a];xe.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(A))(),o=o||Object.assign({},e),o[A]=e[a],delete o[a]}return o||e}const XO={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},JO={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Dn{static getBytesPerElement(e){return RA(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ge(e.size),RA(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Dn(XO,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Dn.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Dn.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=ag("Accessor",e,JO),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Sy=10,Vx={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},YO={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Vx},KO={removedProps:Vx};class ct extends Br{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Dn.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Dn.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=ag("Buffer",e,YO),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=ag("Buffer",e,KO),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Dn(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;ge(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(yn(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:o}=this;return yn(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};yn(this.gl);const s=RA(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let A,h;e?(h=e.length,A=h-a):(A=Math.min(o,r||o),h=a+A);const p=Math.min(o,A);return r=r||p,ge(r<=p),e=e||new s(h),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(ge(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Sy,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ge(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,Sy),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=og(e);return ge(s),this.setAccessor(new Dn(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ge(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=RA(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Dn(this.accessor,{type:og(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return xe.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return xe.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return xe.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return xe.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Dn(this.accessor,e),this}}const i_={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},jx={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},Hx={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function ZO(t,e){const n=i_[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=He(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function qO(t,e){const n=i_[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const $O=[9729,9728],Py=globalThis.WebGLBuffer||function(){};class so extends Br{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&ZO(e,i),s=s&&(!r||qO(e,i))),s}constructor(e,n){const{id:i=ji("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(P=>this.initialize(Object.assign({},e,{pixels:P,data:P}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:A={},pixelStore:h={},textureUnit:p=void 0}=e;n||(n=r);let{width:m,height:y,dataFormat:T,type:b,compressed:C=!1,mipmaps:R=!0}=e;const{depth:S=0}=e;return{width:m,height:y,compressed:C,dataFormat:T,type:b}=this._deduceParameters({format:s,type:b,dataFormat:T,compressed:C,data:n,width:m,height:y}),this.width=m,this.height=y,this.depth=S,this.format=s,this.type=b,this.dataFormat=T,this.border=o,this.textureUnit=p,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),R&&this._isNPOT()&&(xe.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),R=!1,this._updateForNPOT(A)),this.mipmaps=R,this.setImageData({data:n,width:m,height:y,depth:S,format:s,type:b,dataFormat:T,border:o,mipmaps:R,parameters:h,compressed:C}),R&&this.generateMipmap(),this.setParameters(A),a&&(this.data=n),i&&(this._video={video:n,parameters:A,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(xe.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),_i(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:A={}}=e;let{data:h=null,type:p=this.type,width:m=this.width,height:y=this.height,dataFormat:T=this.dataFormat,compressed:b=!1}=e;h||(h=i),{type:p,dataFormat:T,compressed:b,width:m,height:y}=this._deduceParameters({format:s,type:p,dataFormat:T,compressed:b,data:h,width:m,height:y});const{gl:C}=this;C.bindTexture(this.target,this.handle);let R=null;({data:h,dataType:R}=this._getDataType({data:h,compressed:b}));let S,P=0;if(_i(this.gl,A,()=>{switch(R){case"null":C.texImage2D(n,r,s,m,y,o,T,p,h);break;case"typed-array":C.texImage2D(n,r,s,m,y,o,T,p,h,a);break;case"buffer":S=yn(C),S.bindBuffer(35052,h.handle||h),S.texImage2D(n,r,s,m,y,o,T,p,a),S.bindBuffer(35052,null);break;case"browser-object":He(C)?C.texImage2D(n,r,s,m,y,o,T,p,h):C.texImage2D(n,r,s,T,p,h);break;case"compressed":for(const[I,F]of h.entries())C.compressedTexImage2D(n,I,F.format,F.width,F.height,o,F.data),P+=F.levelSize;break;default:ge(!1,"Unknown image data type")}}),R==="compressed")this._trackAllocatedMemory(P,"Texture");else if(h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const I=jx[this.dataFormat]||4,F=Hx[this.type]||1;this._trackAllocatedMemory(this.width*this.height*I*F,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:A=this.height,level:h=0,format:p=this.format,type:m=this.type,dataFormat:y=this.dataFormat,compressed:T=!1,offset:b=0,border:C=this.border,parameters:R={}}=e;if({type:m,dataFormat:y,compressed:T,width:a,height:A}=this._deduceParameters({format:p,type:m,dataFormat:y,compressed:T,data:r,width:a,height:A}),ge(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const S=r;r=S.data,a=S.shape[0],A=S.shape[1]}r instanceof ct&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),_i(this.gl,R,()=>{if(T)this.gl.compressedTexSubImage2D(n,h,s,o,a,A,p,r);else if(r===null)this.gl.texSubImage2D(n,h,s,o,a,A,y,m,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,h,s,o,a,A,y,m,r,b);else if(r instanceof Py){const S=yn(this.gl);S.bindBuffer(35052,r),S.texSubImage2D(n,h,s,o,a,A,y,m,b),S.bindBuffer(35052,null)}else He(this.gl)?yn(this.gl).texSubImage2D(n,h,s,o,a,A,y,m,r):this.gl.texSubImage2D(n,h,s,o,y,m,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return xe.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ct?{data:n.handle,dataType:"buffer"}:n instanceof Py?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:A}=e;const h=i_[n];return o=o||h&&h.dataFormat,a=a||h&&h.types[0],A=A||h&&h.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:A,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},ge(r,"Could not deduced texture size"),ge(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),ge(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ge(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return He(this.gl)||!this.width||!this.height?!1:!Cy(this.width)||!Cy(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:$O.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let eF="";function tF(t,e){return ge(typeof t=="string"),t=eF+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class Gt extends so{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return so.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Mh(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:tF(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const lg=[34069,34070,34071,34072,34073,34074];class Wx extends so{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Mh(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:A=5121}=e;const{gl:h}=this,p=r||s,m=await Promise.all(lg.map(y=>{const T=p[y];return Promise.all(Array.isArray(T)?T:[T])}));this.bind(),lg.forEach((y,T)=>{m[T].length>1&&this.opts.mipmaps!==!1&&xe.warn("".concat(this.id," has mipmap and multiple LODs."))(),m[T].forEach((b,C)=>{n&&i?h.texImage2D(y,C,a,n,i,o,a,A,b):h.texImage2D(y,C,a,a,A,b)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:A=6408,type:h=5121}=e,{gl:p}=this,m=s||o;return this.bind(),m instanceof Promise?m.then(y=>this.setImageDataForFace(Object.assign({},e,{face:n,data:y,pixels:y}))):this.width||this.height?p.texImage2D(n,0,A,i,r,a,A,h,m):p.texImage2D(n,0,A,A,h,m),this}}Wx.FACES=lg;class nF extends so{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return He(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};yn(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:A,type:h=5121,offset:p=0,data:m,parameters:y={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),_i(this.gl,y,()=>{ArrayBuffer.isView(m)&&this.gl.texImage3D(this.target,n,i,r,s,o,a,A,h,m),m instanceof ct&&(this.gl.bindBuffer(35052,m.handle),this.gl.texImage3D(this.target,n,i,r,s,o,a,A,h,p))}),m&&m.byteLength)this._trackAllocatedMemory(m.byteLength,"Texture");else{const T=jx[this.dataFormat]||4,b=Hx[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*T*b,"Texture")}return this.loaded=!0,this}}const Fs="EXT_color_buffer_float",Iy={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Fs,bpp:2},[33327]:{gl2:Fs,bpp:4},[34842]:{gl2:Fs,bpp:8},[33326]:{gl2:Fs,bpp:4},[33328]:{gl2:Fs,bpp:8},[34836]:{gl2:Fs,bpp:16},[35898]:{gl2:Fs,bpp:4}};function iF(t,e,n){const i=n[e];if(!i)return!1;const r=He(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class oa extends Br{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||iF(e,n,Iy)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:s=0}=e;return ge(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&He(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Iy[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const rF=256,sF=1024,oF=16384,My=6144,By=6145,Ly=6146,Ry=34041,Qx="clear: bad arguments";function Bh(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=oF,n!==!0&&(s.clearColor=n)),i&&(o|=rF,i!==!0&&(s.clearDepth=i)),r&&(o|=sF,i!==!0&&(s.clearStencil=i)),ge(o!==0,Qx),_i(t,s,()=>{t.clear(o)})}function aF(t){let{framebuffer:e=null,buffer:n=My,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};yn(t),_i(t,{framebuffer:e},()=>{switch(n){case My:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case By:t.clearBufferfv(By,0,[r]);break;case Ly:t.clearBufferiv(Ly,0,[r]);break;case Ry:const[s,o]=r;t.clearBufferfi(Ry,0,s,o);break;default:ge(!1,Qx)}})}function lF(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ge(!1),0}}function cc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:A,sourceType:h}=e;const{framebuffer:p,deleteFramebuffer:m}=Xx(t);ge(p);const{gl:y,handle:T,attachments:b}=p;a=a||p.width,A=A||p.height,s===36064&&T===null&&(s=1028),ge(b[s]),h=h||b[s].type,o=cF(o,h,r,a,A),h=h||og(o);const C=y.bindFramebuffer(36160,T);return y.readPixels(n,i,a,A,r,h,o),y.bindFramebuffer(36160,C||null),m&&p.delete(),o}function Oy(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=cc(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=QO({data:i,width:r,height:s}));WO({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),A=a.createImageData(r,s);return A.data.set(i),a.putImageData(A,0,0),o.toDataURL()}function AF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:A,targetZ:h,width:p,height:m}=n;const{framebuffer:y,deleteFramebuffer:T}=Xx(t);ge(y);const{gl:b,handle:C}=y,R=typeof a<"u"||typeof A<"u"||typeof h<"u";a=a||0,A=A||0,h=h||0;const S=b.bindFramebuffer(36160,C);ge(e);let P=null;if(e instanceof so&&(P=e,p=Number.isFinite(p)?p:P.width,m=Number.isFinite(m)?m:P.height,P.bind(0),e=P.target),!R)b.copyTexImage2D(e,s,o,i,r,p,m,0);else switch(e){case 3553:case 34067:b.copyTexSubImage2D(e,s,a,A,i,r,p,m);break;case 35866:case 32879:yn(b).copyTexSubImage3D(e,s,a,A,h,i,r,p,m);break}return P&&P.unbind(),b.bindFramebuffer(36160,S||null),T&&y.delete(),P}function Xx(t){return t instanceof kt?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:vF(t),deleteFramebuffer:!0}}function cF(t,e,n,i,r){if(t)return t;e=e||5121;const s=RA(e,{clamped:!1}),o=lF(n);return new s(i*r*o)}const ht={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function uF(t){const e=new Gt(t,{format:6408,type:5126,dataFormat:6408}),n=new kt(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const Jx={[ht.WEBGL2]:[!1,!0],[ht.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ht.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ht.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ht.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ht.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ht.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ht.FLOAT_BLEND]:["EXT_float_blend"],[ht.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ht.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ht.TEXTURE_FLOAT]:["OES_texture_float",!0],[ht.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ht.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ht.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ht.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ht.COLOR_ATTACHMENT_RGBA32F]:[uF,"EXT_color_buffer_float"],[ht.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ht.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ht.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ht.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ht.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ht.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},fF=2;function Lh(t,e){return r_(t,e)}function r_(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>Yx(t,n))}function hF(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in Jx)t.luma.caps[e]===void 0&&(t.luma.caps[e]=Yx(t,e));return t.luma.caps}function Yx(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=dF(t,e)),t.luma.caps[e]||xe.log(fF,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function dF(t,e){const n=Jx[e];ge(n,e);let i;const r=He(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(t.getExtension(s))}else typeof r=="string"?i=Boolean(t.getExtension(r)):typeof r=="boolean"?i=r:ge(!1);return i}const Fy="Multiple render targets not supported";class kt extends Br{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new kt(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=yn(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=yn(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:A=!0,readBuffer:h=void 0,drawBuffers:p=void 0}=e;if(ge(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const m in r){const y=r[m];(Array.isArray(y)?y[0]:y).resize({width:n,height:i})}else r=this._createDefaultAttachments(s,o,a,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:h,drawBuffers:p}),r&&A&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,A=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,A||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ge(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&xe.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){ge(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),A=r[a];let h=A;if(!h)this._unattach(a);else if(h instanceof oa)this._attachRenderbuffer({attachment:a,renderbuffer:h});else if(Array.isArray(A)){const[p,m=0,y=0]=A;h=p,this._attachTexture({attachment:a,texture:p,layer:m,level:y})}else this._attachTexture({attachment:a,texture:h,layer:0,level:0});i&&h&&h.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(gF(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&Bh(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,A)=>{aF(this.gl,{drawBuffer:A,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return xe.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return xe.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return xe.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return xe.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return xe.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return xe.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:s,height:o}=e;const a=yn(this.gl),A=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,i,r,s,o),a.bindFramebuffer(36008,A),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=us(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=n?us(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?us(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window<"u"&&window.open(Oy(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>xe.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Oy(this,{targetMaxHeight:100});return xe.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new Gt(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new oa(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new oa(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&ge(!1),o}_unattach(e){const n=this.attachments[e];n&&(n instanceof oa?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:s}=e;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:yn(o).framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const A=pF(r);o.framebufferTexture2D(36160,n,A,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:ge(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=W4(this.gl);n?n.readBuffer(e):ge(e===36064||e===1029,Fy),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=yn(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):ge(e.length===1&&(e[0]===36064||e[0]===1029),Fy)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=hF(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function pF(t){return t<34069?t+34069:t}function gF(t){return(kt.STATUS||{})[t]||"Framebuffer error ".concat(t)}const mF=[36049,36048,33296,33298,33299,33300,33301,33302,33303];kt.ATTACHMENT_PARAMETERS=mF;function _F(t,e){ge(t instanceof Gt||t instanceof Wx||t instanceof nF);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:A,border:h,mipmaps:p}=t,m=Object.assign({width:r,height:s,format:o,type:a,dataFormat:A,border:h,mipmaps:p},e);return new n(i,m)}function vF(t,e){const{gl:n,width:i,height:r,id:s}=t;return new kt(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{[36064]:t}}))}function nf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const yF=35632,EF=35633;function TF(t){switch(t){case yF:return"fragment";case EF:return"vertex";default:return"unknown type"}}function wF(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||nf(e)||"(unnamed)",A="".concat(TF(n)," shader ").concat(a);for(let p=0;p<r.length;p++){const m=r[p];if(m.length<=1)continue;const y=m.split(":"),T=y[0],b=parseInt(y[2],10);if(isNaN(b))throw new Error("GLSL compilation error in ".concat(A,": ").concat(t));T!=="WARNING"?s[b]=m:o[b]=m}const h=bF(e);return{shaderName:A,errors:Dy(s,h),warnings:Dy(o,h)}}function Dy(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],A=parseInt(o[1],10)||0,h=s.substring(o.join(":").length+1).trim();n+=Kx("^^^ ".concat(a,": ").concat(h,`

`),A)}}return n}function bF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),A=a.length;return Kx(a,r-A)+n+s})}function Kx(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function Zx(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const xF="Shader: GLSL source code must be a JavaScript string";class OA extends Br{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ge(!1),"unknown"}}constructor(e,n){Mh(e),ge(typeof n.source=="string",xF);const i=nf(n.source,null)||n.id||ji("unnamed ".concat(OA.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=nf(n,null);i&&(this.id=ji(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(OA.getTypeName(this.shaderType),":").concat(this.id)}getName(){return nf(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=wF(i,this.source,this.shaderType,this.id);throw xe.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),xe.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class n0 extends OA{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class i0 extends OA{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const CF={[5126]:yt.bind(null,"uniform1fv",Qn,1,pn),[35664]:yt.bind(null,"uniform2fv",Qn,2,pn),[35665]:yt.bind(null,"uniform3fv",Qn,3,pn),[35666]:yt.bind(null,"uniform4fv",Qn,4,pn),[5124]:yt.bind(null,"uniform1iv",Vr,1,pn),[35667]:yt.bind(null,"uniform2iv",Vr,2,pn),[35668]:yt.bind(null,"uniform3iv",Vr,3,pn),[35669]:yt.bind(null,"uniform4iv",Vr,4,pn),[35670]:yt.bind(null,"uniform1iv",Vr,1,pn),[35671]:yt.bind(null,"uniform2iv",Vr,2,pn),[35672]:yt.bind(null,"uniform3iv",Vr,3,pn),[35673]:yt.bind(null,"uniform4iv",Vr,4,pn),[35674]:yt.bind(null,"uniformMatrix2fv",Qn,4,ur),[35675]:yt.bind(null,"uniformMatrix3fv",Qn,9,ur),[35676]:yt.bind(null,"uniformMatrix4fv",Qn,16,ur),[35678]:on,[35680]:on,[5125]:yt.bind(null,"uniform1uiv",su,1,pn),[36294]:yt.bind(null,"uniform2uiv",su,2,pn),[36295]:yt.bind(null,"uniform3uiv",su,3,pn),[36296]:yt.bind(null,"uniform4uiv",su,4,pn),[35685]:yt.bind(null,"uniformMatrix2x3fv",Qn,6,ur),[35686]:yt.bind(null,"uniformMatrix2x4fv",Qn,8,ur),[35687]:yt.bind(null,"uniformMatrix3x2fv",Qn,6,ur),[35688]:yt.bind(null,"uniformMatrix3x4fv",Qn,12,ur),[35689]:yt.bind(null,"uniformMatrix4x2fv",Qn,8,ur),[35690]:yt.bind(null,"uniformMatrix4x3fv",Qn,12,ur),[35678]:on,[35680]:on,[35679]:on,[35682]:on,[36289]:on,[36292]:on,[36293]:on,[36298]:on,[36299]:on,[36300]:on,[36303]:on,[36306]:on,[36307]:on,[36308]:on,[36311]:on},SF={},PF={},IF={},ky=[0];function s_(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(ky[0]=t,t=ky);const r=t.length;if(r%e&&xe.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function Qn(t,e){return s_(t,e,Float32Array,SF)}function Vr(t,e){return s_(t,e,Int32Array,PF)}function su(t,e){return s_(t,e,Uint32Array,IF)}function Ny(t,e,n){const i=CF[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function MF(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function BF(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!LF(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function LF(t){return Array.isArray(t)||ArrayBuffer.isView(t)?OF(t):isFinite(t)||t===!0||t===!1||t instanceof so||t instanceof oa?!0:t instanceof kt?Boolean(t.texture):!1}function RF(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function OF(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function on(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function yt(t,e,n,i){let r=null,s=null;return(o,a,A)=>{const h=e(A,n),p=h.length;let m=!1;if(r===null)r=new Float32Array(p),s=p,m=!0;else{ge(s===p,"Uniform length cannot change.");for(let y=0;y<p;++y)if(h[y]!==r[y]){m=!0;break}}return m&&(i(o,t,a,h),r.set(h)),m}}function pn(t,e,n,i){t[e](n,i)}function ur(t,e,n,i){t[e](n,!1,i)}const FF=5120,DF=5121,kF=5122,NF=5123,Uy=0,ou=1,UF=2,GF=3,au=4,zF=5,VF=6,Jt=5126,jF=35664,HF=35665,WF=35666,Pl=5124,QF=35667,XF=35668,JF=35669,Il=5125,YF=36294,KF=36295,ZF=36296,qF=35670,$F=35671,eD=35672,tD=35673,nD=35674,iD=35675,rD=35676,sD=35685,oD=35686,aD=35687,lD=35688,AD=35689,cD=35690,Ag={[Jt]:[Jt,1,"float"],[jF]:[Jt,2,"vec2"],[HF]:[Jt,3,"vec3"],[WF]:[Jt,4,"vec4"],[Pl]:[Pl,1,"int"],[QF]:[Pl,2,"ivec2"],[XF]:[Pl,3,"ivec3"],[JF]:[Pl,4,"ivec4"],[Il]:[Il,1,"uint"],[YF]:[Il,2,"uvec2"],[KF]:[Il,3,"uvec3"],[ZF]:[Il,4,"uvec4"],[qF]:[Jt,1,"bool"],[$F]:[Jt,2,"bvec2"],[eD]:[Jt,3,"bvec3"],[tD]:[Jt,4,"bvec4"],[nD]:[Jt,8,"mat2"],[sD]:[Jt,8,"mat2x3"],[oD]:[Jt,8,"mat2x4"],[iD]:[Jt,12,"mat3"],[aD]:[Jt,12,"mat3x2"],[lD]:[Jt,12,"mat3x4"],[rD]:[Jt,16,"mat4"],[AD]:[Jt,16,"mat4x2"],[cD]:[Jt,16,"mat4x3"]};function uD(t){switch(t){case Uy:return Uy;case ou:return ou;case GF:return ou;case UF:return ou;case au:return au;case zF:return au;case VF:return au;default:return ge(!1),0}}function Gy(t){const e=Ag[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function qx(t,e){switch(t){case FF:case DF:case kF:case NF:t=Jt;break}for(const n in Ag){const[i,r,s]=Ag[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class fD{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),A=n.getAttribLocation(e.handle,s);A>=0&&this._addAttribute(A,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!He(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=Gy(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const A={location:e,name:n,accessor:new Dn(a)};this.attributeInfos.push(A),this.attributeInfosByLocation[e]=A,this.attributeInfosByName[A.name]=A}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=Gy(i),a=new Dn({type:s,size:r*o}),A={location:e,name:n,accessor:a};this.varyingInfos.push(A),this.varyingInfosByName[A.name]=A}}const zy=4,hD=35981,dD=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class $x extends Br{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",dD),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=hD}=e;return this.hash=n||"",this.vs=typeof i=="string"?new n0(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new i0(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,ge(this.vs instanceof n0),ge(this.fs instanceof i0),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(yn(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new fD(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:A=!1,indexType:h=5123,instanceCount:p=0,isInstanced:m=p>0,vertexArray:y=null,transformFeedback:T,framebuffer:b,parameters:C={},uniforms:R,samplers:S}=e;if((R||S)&&(xe.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(R||{})),xe.priority>=n){const P=b?b.id:"default",I="mode=".concat(us(this.gl,i)," verts=").concat(r," ")+"instances=".concat(p," indexType=").concat(us(this.gl,h)," ")+"isInstanced=".concat(m," isIndexed=").concat(A," ")+"Framebuffer=".concat(P);xe.log(n,I)()}return ge(y),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||m&&p===0?!1:(y.bindForDraw(r,p,()=>{if(b!==void 0&&(C=Object.assign({},C,{framebuffer:b})),T){const P=uD(i);T.begin(P)}this._bindTextures(),_i(this.gl,C,()=>{A&&m?this.gl2.drawElementsInstanced(i,r,h,s,p):A&&He(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,h,s):A?this.gl.drawElements(i,r,h,s):m?this.gl2.drawArraysInstanced(i,s,r,p):this.gl.drawArrays(i,s,r)}),T&&T.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};xe.priority>=2&&BF(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof kt&&(s=s.texture),s instanceof so)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:A}=r;a.bind(A),s=A,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&RF(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new n0({handle:r});break;case 35632:i.fs=new i0({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=ji(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),xe.time(zy,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),xe.timeEnd(zy,"linkProgram for ".concat(this._getName()))(),e.debug||xe.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=MF(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=Ny(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=Ny(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const pD=34918,gD=34919,mD=35007,_D=36795,vD=35976,yD=35887,ED=36202;class jf extends Br{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=He(e),r=r_(e,ht.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:ge(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(mD)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?ED:yD)}beginTransformFeedbackQuery(){return this.begin(vD)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,gD);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(_D)}getResult(){return this.gl2.getQueryParameter(this.handle,pD)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return jf.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class eC extends Br{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return He(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};yn(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,ka(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,xe.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof ct?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let lu=null;function TD(t){return(!lu||lu.byteLength<t)&&(lu=new ArrayBuffer(t)),lu}function wD(t,e){const n=TD(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function bD(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let A=i;a<s;a++)e[A++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}const xD="elements must be GL.ELEMENT_ARRAY_BUFFER";class Yn extends Br{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?He(e)||Tx()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Yn(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Yn.MAX_ATTRIBUTES=Yn.MAX_ATTRIBUTES||e.getParameter(34921),Yn.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Yn._setConstantFloatArray(e,n,i);break;case Int32Array:Yn._setConstantIntArray(e,n,i);break;case Uint32Array:Yn._setConstantUintArray(e,n,i);break;default:ge(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Yn.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ge(!e||e.target===34963,xD),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:A,integer:h,divisor:p}=i,{gl:m,gl2:y}=this;return e=Number(e),this.bind(()=>{m.bindBuffer(34962,n.handle),h?(ge(He(m)),y.vertexAttribIPointer(e,r,s,o,a)):m.vertexAttribPointer(e,r,s,A,o,a),m.enableVertexAttribArray(e),y.vertexAttribDivisor(e,p||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Yn.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new ct(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=wD(n.constructor,s);bD({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ge(!1)}}static _setConstantIntArray(e,n,i){switch(ge(He(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ge(!1)}}static _setConstantUintArray(e,n,i){switch(ge(He(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ge(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ge(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const CD="VertexArray: attributes must be Buffers or constants (i.e. typed array)",SD=/^(.+)__LOCATION_([0-9]+)$/,PD=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class ID{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Yn(e),zx(this,"VertexArray","v6.0",PD),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ct(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ct&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof ct&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,xe.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const A=this._getAttributeInfo(a||o);if(!A)return s;const h=this.accessors[o]||{},p=Dn.resolve(A.accessor,h,i,r),{size:m,type:y}=p;return ge(Number.isFinite(m)&&Number.isFinite(y)),{location:o,accessor:p}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=SD.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof ct)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof ct){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof ct){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(CD)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(Yn.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Yn.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof ct){const a=i;if(o){const A=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,A)}else{const A=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,A)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return xe.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function MD(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=FA(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function FA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return MD(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function Vy(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;ge(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,A={},h=Object.keys(a).sort();let p=0;for(const T of h)!T.match(s)&&!T.match(o)&&r0({table:A,header:e,uniforms:i,uniformName:T,undefinedOnly:r})&&p++;for(const T of h)T.match(o)&&r0({table:A,header:e,uniforms:i,uniformName:T,undefinedOnly:r})&&p++;for(const T of h)A[T]||r0({table:A,header:e,uniforms:i,uniformName:T,undefinedOnly:r})&&p++;let m=0;const y={};if(!r)for(const T in i){const b=i[T];A[T]||(m++,y[T]={Type:"NOT USED: ".concat(b),[e]:FA(b)})}return{table:A,count:p,unusedTable:y,unusedCount:m}}function r0(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=BD(o);return!s||!a?(e[r]={[n]:a?FA(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function BD(t){return t!=null}function LD(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=jy(e,e.elements,null,n));const r=e.values;for(const s in r){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const A=e.accessors[o.location];A&&(a="".concat(s,": ").concat(RD(o.name,A))),i[a]=jy(e,r[s],A,n)}}return i}function jy(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,A=0,h,p,m;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),h=s.indexOf("nt")!==-1),e instanceof ct){const y=e,{data:T,changed:b}=y.getDebugData();p=b?"*":"",m=T,A=y.byteLength,a=A/T.BYTES_PER_ELEMENT/o;let C;if(n){const R=n.divisor>0;C="".concat(R?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(A," bytes ").concat(us(r,s),")")}else h=!0,C="".concat(A," bytes");return{[i]:"".concat(p).concat(FA(m,{size:o,isInteger:h})),"Format ":C}}return m=e,o=e.length,s=String(e.constructor.name).replace("Array",""),h=s.indexOf("nt")!==-1,{[i]:"".concat(FA(m,{size:o,isInteger:h})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function RD(t,e){const{type:n,size:i}=e,r=qx(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function OD(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=Hy(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=Hy(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function Hy(t){const{type:e,size:n}=t.accessor,i=qx(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const Wy=Mr()&&typeof document<"u";let FD=0;class DD{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=R=>Gx(R),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:A=null,glOptions:h={},debug:p=!1,createFramebuffer:m=!1,autoResizeViewport:y=!0,autoResizeDrawingBuffer:T=!0,stats:b=Xs.get("animation-loop-".concat(FD++))}=e;let{useDevicePixels:C=!0}=e;"useDevicePixelRatio"in e&&(xe.deprecated("useDevicePixelRatio","useDevicePixels")(),C=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:A,glOptions:h,debug:p,createFramebuffer:m},this.gl=A,this.needsRedraw=null,this.timeline=null,this.stats=b,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:y,autoResizeDrawingBuffer:T,useDevicePixels:C}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ge(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=jf.isSupported(this.gl,["timers"])?new jf(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return xe.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Wy?new Promise((e,n)=>{if(Wy&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):jO(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):VO(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?n_(this.props.gl,e):this.onCreateContext(e),!Ih(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");IO(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&OO(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new kt(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const uc="vs",o_="fs";function ti(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const s0={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function kD(t){const e={};for(const n in t){const i=t[n],r=ND(i);e[n]=r}return e}function ND(t){let e=Qy(t);return e==="object"?t?"type"in t?Object.assign({},t,s0[t.type]):"value"in t?(e=Qy(t.value),Object.assign({type:e},t,s0[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},s0[e])}function Qy(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const UD="vs",GD="fs";class Xy{constructor(e){let{name:n,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:A=[],defines:h={},inject:p={},vertexShader:m,fragmentShader:y}=e;ti(typeof n=="string"),this.name=n,this.vs=i||m,this.fs=r||y,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(A),this.defines=h,this.injections=zD(p),o&&(this.uniforms=kD(o))}getModuleSource(e){let n;switch(e){case UD:n=this.vs||"";break;case GD:n=this.fs||"";break;default:ti(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&ti(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=s.value}return n}}function zD(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function VD(t){return jD(nC(t))}function jD(t){const e={},n={};return tC({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function tC(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&tC({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function nC(t,e){return t.map(n=>(n instanceof Xy||(ti(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ti(n.name,"shader module has no name"),n=new Xy(n),n.dependencies=nC(n.dependencies)),n))}function HD(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const WD=7936,QD=7937,XD=7938,JD=35724,a_={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},js={};Object.keys(a_).forEach(t=>{js[t]=t});function YD(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function KD(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||WD),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||QD);return{gpuVendor:ZD(n,i),vendor:n,renderer:i,version:t.getParameter(XD),shadingLanguageVersion:t.getParameter(JD)}}function ZD(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const o0={};function Jy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=a_[e];if(ti(i,e),!HD(n))return!0;if(e in o0)return o0[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const A=t.getShaderParameter(a,35713);return t.deleteShader(a),o0[e]=A,A}function qD(t,e){const n=a_[e];ti(n,e);const i=YD(t)&&n[1]||n[0],r=typeof i=="string"?Boolean(t.getExtension(i)):i;return ti(r===!1||r===!0),r}function Au(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>qD(t,n))}function $D(t){switch(KD(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function e6(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Au(t,js.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Au(t,js.GLSL_DERIVATIVES)&&Jy(t,js.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Au(t,js.GLSL_FRAG_DATA)&&Jy(t,js.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Au(t,js.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const t6=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,n6=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,i6={[uc]:t6,[o_]:n6},rf="__LUMA_INJECT_DECLARATIONS__",Yy=/void\s+main\s*\([^)]*\)\s*\{\n?/,Ky=/}\n?[^{}]*$/,a0=[];function Zy(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===uc;for(const s in n){const o=n[s];o.sort((A,h)=>A.order-h.order),a0.length=o.length;for(let A=0,h=o.length;A<h;++A)a0[A]=o[A].injection;const a="".concat(a0.join(`
`),`
`);switch(s){case"vs:#decl":r&&(t=t.replace(rf,a));break;case"vs:#main-start":r&&(t=t.replace(Yy,A=>A+a));break;case"vs:#main-end":r&&(t=t.replace(Ky,A=>a+A));break;case"fs:#decl":r||(t=t.replace(rf,a));break;case"fs:#main-start":r||(t=t.replace(Yy,A=>A+a));break;case"fs:#main-end":r||(t=t.replace(Ky,A=>a+A));break;default:t=t.replace(s,A=>A+a)}}return t=t.replace(rf,""),i&&(t=t.replace(/\}\s*$/,s=>s+i6[e])),t}function cg(t){const e={};return ti(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Na(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const iC=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],r6=[...iC,[Na("attribute"),"in $1"],[Na("varying"),"out $1"]],s6=[...iC,[Na("varying"),"in $1"]],rC=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],o6=[...rC,[Na("in"),"attribute $1"],[Na("out"),"varying $1"]],a6=[...rC,[Na("in"),"varying $1"]],ug="gl_FragColor",fg=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,l6=/void\s+main\s*\([^)]*\)\s*\{\n?/;function A6(t,e,n){switch(e){case 300:return n?Hf(t,r6):c6(t);case 100:return n?Hf(t,o6):u6(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Hf(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function c6(t){t=Hf(t,s6);const e=t.match(fg);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(ug,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(l6,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(ug,"\\b"),"g"),n)}return t}function u6(t){t=Hf(t,a6);const e=t.match(fg);if(e){const n=e[1];t=t.replace(fg,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),ug)}return t}const f6=`

`.concat(rf,`

`),sC={[uc]:"vertex",[o_]:"fragment"},h6=`precision highp float;

`;function d6(t,e){const{vs:n,fs:i}=e,r=VD(e.modules||[]);return{gl:t,vs:qy(t,Object.assign({},e,{source:n,type:uc,modules:r})),fs:qy(t,Object.assign({},e,{source:i,type:o_,modules:r})),getUniforms:p6(r)}}function qy(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:A={},transpileToGLSL100:h=!1,prologue:p=!0,log:m}=e;ti(typeof i=="string","shader source must be a string");const y=r===uc,T=i.split(`
`);let b=100,C="",R=i;T[0].indexOf("#version ")===0?(b=300,C=T[0],R=T.slice(1).join(`
`)):C="#version ".concat(b);const S={};s.forEach(q=>{Object.assign(S,q.getDefines())}),Object.assign(S,o);let P=p?"".concat(C,`
`).concat(m6({id:n,source:i,type:r}),`
`).concat(g6({type:r}),`
`).concat($D(t),`
`).concat(e6(t),`
`).concat(_6(S),`
`).concat(y?"":h6,`
`):"".concat(C,`
`);const I=y6(a),F={},j={},X={};for(const q in A){const ee=typeof A[q]=="string"?{injection:A[q],order:0}:A[q],Q=q.match(/^(v|f)s:(#)?([\w-]+)$/);if(Q){const V=Q[2],D=Q[3];V?D==="decl"?j[q]=[ee]:X[q]=[ee]:F[q]=[ee]}else X[q]=[ee]}for(const q of s){m&&q.checkDeprecations(R,m);const ee=q.getModuleSource(r,b);P+=ee;const Q=q.injections[r];for(const V in Q){const D=V.match(/^(v|f)s:#([\w-]+)$/);if(D){const le=D[2]==="decl"?j:X;le[V]=le[V]||[],le[V].push(Q[V])}else F[V]=F[V]||[],F[V].push(Q[V])}}return P+=f6,P=Zy(P,r,j),P+=v6(I[r],F),P+=R,P=Zy(P,r,X),P=A6(P,h?100:b,y),P}function p6(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function g6(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(sC[e].toUpperCase(),`
`)}function m6(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(sC[i],`

`):""}function _6(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function v6(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function y6(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const E6="void main() {gl_FragColor = vec4(0);}",oC=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,T6=`#version 300 es
`.concat(oC);function aC(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function lC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?T6:e>300?"#version ".concat(e,`
`).concat(oC):E6;const s=x6(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function w6(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ti(!1),null}}function b6(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ti(!1),null}}function x6(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ti(!1),null}}const C6=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,S6={name:"fp32",vs:C6,fs:null};function l_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}function AC(t){return t-Math.fround(t)}function cC(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=n*4+i;l_(t[i*4+n],e,r*2)}return e}const P6=`uniform float ONE;
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * ONE - (t - a);
  float a_lo = a * ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * ONE;
  float err = b - (sum - a) * ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,I6=`const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);
const vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);
const vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);
const vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);
const vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);
const vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);
const vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);
const vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);
const vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);
const vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);

const vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);
const vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);
const vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);
const vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);

const vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);
const vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);
const vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);
const vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);

const vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);
const vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);
const vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);
const vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);
const vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);
const vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);
const vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);
const vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);

float nint(float d) {
    if (d == floor(d)) return d;
    return floor(d + 0.5);
}

vec2 nint_fp64(vec2 a) {
    float hi = nint(a.x);
    float lo;
    vec2 tmp;
    if (hi == a.x) {
        lo = nint(a.y);
        tmp = quickTwoSum(hi, lo);
    } else {
        lo = 0.0;
        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {
            hi -= 1.0;
        }
        tmp = vec2(hi, lo);
    }
    return tmp;
}

vec2 exp_fp64(vec2 a) {

  const int k_power = 4;
  const float k = 16.0;

  const float inv_k = 1.0 / k;

  if (a.x <= -88.0) return vec2(0.0, 0.0);
  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);
  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);
  if (a.x == 1.0 && a.y == 0.0) return E_FP64;

  float m = floor(a.x / LOG2_FP64.x + 0.5);
  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;
  vec2 s, t, p;

  p = mul_fp64(r, r);
  s = sum_fp64(r, p * 0.5);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);






  s = sum_fp64(s, t);
  for (int i = 0; i < k_power; i++) {
    s = sum_fp64(s * 2.0, mul_fp64(s, s));
  }

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = sum_fp64(s, vec2(ONE, 0.0));
#else
  s = sum_fp64(s, vec2(1.0, 0.0));
#endif

  return s * pow(2.0, m);
}

vec2 log_fp64(vec2 a)
{
  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
  vec2 x = vec2(log(a.x), 0.0);
  vec2 s;
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = vec2(ONE, 0.0);
#else
  s = vec2(1.0, 0.0);
#endif

  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);
  return x;
}

vec2 sin_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(0.0, 0.0);
  }

  x = -mul_fp64(a, a);
  s = a;
  r = a;

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);
  s = sum_fp64(s, t);






  return s;
}

vec2 cos_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(1.0, 0.0);
  }

  x = -mul_fp64(a, a);
  r = x;
  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);
  s = sum_fp64(s, t);






  return s;
}

void sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {
  if (a.x == 0.0 && a.y == 0.0) {
    sin_t = vec2(0.0, 0.0);
    cos_t = vec2(1.0, 0.0);
  }

  sin_t = sin_taylor_fp64(a);
  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));
}

vec2 sin_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return sin_taylor_fp64(t);
        } else if (j == 1) {
            return cos_taylor_fp64(t);
        } else if (j == -1) {
            return -cos_taylor_fp64(t);
        } else {
            return -sin_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);



    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        }
    } else {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    }

    return result;
}

vec2 cos_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(1.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return cos_taylor_fp64(t);
        } else if (j == 1) {
            return -sin_taylor_fp64(t);
        } else if (j == -1) {
            return sin_taylor_fp64(t);
        } else {
            return -cos_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);

    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    return result;
}

vec2 tan_fp64(vec2 a) {
    vec2 sin_a;
    vec2 cos_a;

    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);


    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }


    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

    vec2 sin_t, cos_t;
    vec2 s, c;
    sincos_taylor_fp64(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#else
        if (abs_k == 1) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs_k == 2) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs_k == 3) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs_k == 4) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#endif
        if (k > 0) {
            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return div_fp64(sin_a, cos_a);
}

vec2 radians_fp64(vec2 degree) {
  return mul_fp64(degree, PI_180_FP64);
}

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sum_fp64(a[0], b[0]);
    out_val[1] = sum_fp64(a[1], b[1]);
}

void vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sub_fp64(a[0], b[0]);
    out_val[1] = sub_fp64(a[1], b[1]);
}

void vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = mul_fp64(a[0], b[0]);
    out_val[1] = mul_fp64(a[1], b[1]);
}

void vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = div_fp64(a[0], b[0]);
    out_val[1] = div_fp64(a[1], b[1]);
}

void vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {
  vec2 range[2];
  vec2_sub_fp64(y, x, range);
  vec2 portion[2];
  portion[0] = range[0] * a;
  portion[1] = range[1] * a;
  vec2_sum_fp64(x, portion, out_val);
}

vec2 vec2_length_fp64(vec2 x[2]) {
  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));
}

void vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {
  vec2 length = vec2_length_fp64(x);
  vec2 length_vec2[2];
  length_vec2[0] = length;
  length_vec2[1] = length;

  vec2_div_fp64(x, length_vec2, out_val);
}

vec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {
  vec2 diff[2];
  vec2_sub_fp64(x, y, diff);
  return vec2_length_fp64(diff);
}

vec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {
  vec2 v[2];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);

  return sum_fp64(v[0], v[1]);
}
void vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

vec2 vec3_length_fp64(vec2 x[3]) {
  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),
    mul_fp64(x[2], x[2])));
}

vec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {
  vec2 diff[3];
  vec3_sub_fp64(x, y, diff);
  return vec3_length_fp64(diff);
}
void vec4_fp64(vec4 a, out vec2 out_val[4]) {
  out_val[0].x = a[0];
  out_val[0].y = 0.0;

  out_val[1].x = a[1];
  out_val[1].y = 0.0;

  out_val[2].x = a[2];
  out_val[2].y = 0.0;

  out_val[3].x = a[3];
  out_val[3].y = 0.0;
}

void vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {
  out_val[0] = mul_fp64(a[0], b);
  out_val[1] = mul_fp64(a[1], b);
  out_val[2] = mul_fp64(a[2], b);
  out_val[3] = mul_fp64(a[3], b);
}

void vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {
  for (int i = 0; i < 4; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {
  vec2 v[4];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);
  v[2] = mul_fp64(a[2], b[2]);
  v[3] = mul_fp64(a[3], b[3]);

  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));
}

void mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {
  vec2 tmp[4];

  for (int i = 0; i < 4; i++)
  {
    for (int j = 0; j < 4; j++)
    {
      tmp[j] = b[j + i * 4];
    }
    vec4_dot_fp64(a, tmp, out_val[i]);
  }
}
`,M6={ONE:1};function B6(){return M6}const L6={name:"fp64-arithmetic",vs:P6,fs:null,getUniforms:B6,fp64ify:l_,fp64LowPart:AC,fp64ifyMatrix4:cC},uC={name:"fp64",vs:I6,fs:null,dependencies:[L6],fp64ify:l_,fp64LowPart:AC,fp64ifyMatrix4:cC};function Oi(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const R6=1/Math.PI*180,O6=1/180*Math.PI,Zt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function F6(t,{precision:e=Zt.precision}={}){return t=U6(t),"".concat(parseFloat(t.toPrecision(e)))}function ds(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function D6(t){return N6(t)}function k6(t){return Wl(t)}function N6(t,e){return A_(t,n=>n*O6,e)}function Wl(t,e){return A_(t,n=>n*R6,e)}function rn(t,e,n){return A_(t,i=>Math.max(e,Math.min(n,i)))}function Gi(t,e,n){return ds(t)?t.map((i,r)=>Gi(i,e[r],n)):n*e+(1-n)*t}function ni(t,e,n){const i=Zt.EPSILON;n&&(Zt.EPSILON=n);try{if(t===e)return!0;if(ds(t)&&ds(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!ni(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Zt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Zt.EPSILON=i}}function U6(t){return Math.round(t/Zt.EPSILON)*Zt.EPSILON}function G6(t){return t.clone?t.clone():new Array(t.length)}function A_(t,e,n){if(ds(t)){const i=t;n=n||G6(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function z6(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class c_ extends z6(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ds(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Zt)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+F6(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!ni(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Zt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function V6(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function at(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function AA(t,e,n=""){if(Zt.debug&&!V6(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class u_ extends c_{get x(){return this[0]}set x(e){this[0]=at(e)}get y(){return this[1]}set y(e){this[1]=at(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return at(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return at(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Oi(e>=0&&e<this.ELEMENTS,"index is out of range"),at(this[e])}setComponent(e,n){return Oi(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var cA=1e-6,Hi=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function j6(){var t=new Hi(2);return Hi!=Float32Array&&(t[0]=0,t[1]=0),t}function Wf(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function fC(t,e){return t[0]=-e[0],t[1]=-e[1],t}function hC(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function H6(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function W6(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function dC(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function pC(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=j6();return function(e,n,i,r,s,o){var a,A;for(n||(n=2),i||(i=0),r?A=Math.min(r*n+i,e.length):A=e.length,a=i;a<A;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function gC(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function mC(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function Q6(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function X6(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function _C(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*s,t[1]=n[1]*i+n[4]*r+n[7]*s,t[2]=n[2]*i+n[5]*r+n[8]*s,t[3]=e[3],t}class f_ extends u_{constructor(e=0,n=0){super(2),ds(e)&&arguments.length===1?this.copy(e):(Zt.debug&&(at(e),at(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Zt.debug&&(at(e.x),at(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return pC(this,this,e),this.check()}transformAsVector(e){return gC(this,this,e),this.check()}transformByMatrix3(e){return dC(this,this,e),this.check()}transformByMatrix2x3(e){return W6(this,this,e),this.check()}transformByMatrix2(e){return H6(this,this,e),this.check()}}function vC(){var t=new Hi(3);return Hi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yC(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function $y(t,e,n){var i=new Hi(3);return i[0]=t,i[1]=e,i[2]=n,i}function J6(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Y6(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.hypot(n,i,r)}function K6(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function Z6(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function q6(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function h_(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function sf(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],A=n[2];return t[0]=r*A-s*a,t[1]=s*o-i*A,t[2]=i*a-r*o,t}function $6(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function d_(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function EC(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function TC(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],A=e[1],h=e[2],p=r*h-s*A,m=s*a-i*h,y=i*A-r*a,T=r*y-s*m,b=s*p-i*y,C=i*m-r*p,R=o*2;return p*=R,m*=R,y*=R,T*=2,b*=2,C*=2,t[0]=a+p+T,t[1]=A+m+b,t[2]=h+y+C,t}function ek(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function tk(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function nk(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function ik(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],A=Math.sqrt(n*n+i*i+r*r),h=Math.sqrt(s*s+o*o+a*a),p=A*h,m=p&&h_(t,e)/p;return Math.acos(Math.min(Math.max(m,-1),1))}var wC=J6,rk=Y6,bC=yC,l0=K6;(function(){var t=vC();return function(e,n,i,r,s,o){var a,A;for(n||(n=3),i||(i=0),r?A=Math.min(r*n+i,e.length):A=e.length,a=i;a<A;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const A0=[0,0,0];let cu;class Z extends u_{static get ZERO(){return cu||(cu=new Z(0,0,0),Object.freeze(cu)),cu}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&ds(e)?this.copy(e):(Zt.debug&&(at(e),at(n),at(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Zt.debug&&(at(e.x),at(e.y),at(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=at(e)}angle(e){return ik(this,e)}cross(e){return sf(this,this,e),this.check()}rotateX({radians:e,origin:n=A0}){return ek(this,this,n,e),this.check()}rotateY({radians:e,origin:n=A0}){return tk(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=A0}){return nk(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return d_(this,this,e),this.check()}transformAsVector(e){return mC(this,this,e),this.check()}transformByMatrix3(e){return EC(this,this,e),this.check()}transformByMatrix2(e){return Q6(this,this,e),this.check()}transformByQuaternion(e){return TC(this,this,e),this.check()}}let uu;class p_ extends u_{static get ZERO(){return uu||(uu=new p_(0,0,0,0),Object.freeze(uu)),uu}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),ds(e)&&arguments.length===1?this.copy(e):(Zt.debug&&(at(e),at(n),at(i),at(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Zt.debug&&(at(e.x),at(e.y),at(e.z),at(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=at(e)}get w(){return this[3]}set w(e){this[3]=at(e)}transform(e){return d_(this,this,e),this.check()}transformByMatrix3(e){return _C(this,this,e),this.check()}transformByMatrix2(e){return X6(this,this,e),this.check()}transformByQuaternion(e){return TC(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class xC extends c_{toString(){let e="[";if(Zt.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=at(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function sk(){var t=new Hi(9);return Hi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ok(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function ak(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],A=e[6],h=e[7],p=e[8],m=p*o-a*h,y=-p*s+a*A,T=h*s-o*A,b=n*m+i*y+r*T;return b?(b=1/b,t[0]=m*b,t[1]=(-p*i+r*h)*b,t[2]=(a*i-r*o)*b,t[3]=y*b,t[4]=(p*n-r*A)*b,t[5]=(-a*n+r*s)*b,t[6]=T*b,t[7]=(-h*n+i*A)*b,t[8]=(o*n-i*s)*b,t):null}function lk(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],A=t[7],h=t[8];return e*(h*s-o*A)+n*(-h*r+o*a)+i*(A*r-s*a)}function e2(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],p=e[7],m=e[8],y=n[0],T=n[1],b=n[2],C=n[3],R=n[4],S=n[5],P=n[6],I=n[7],F=n[8];return t[0]=y*i+T*o+b*h,t[1]=y*r+T*a+b*p,t[2]=y*s+T*A+b*m,t[3]=C*i+R*o+S*h,t[4]=C*r+R*a+S*p,t[5]=C*s+R*A+S*m,t[6]=P*i+I*o+F*h,t[7]=P*r+I*a+F*p,t[8]=P*s+I*A+F*m,t}function Ak(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],p=e[7],m=e[8],y=n[0],T=n[1];return t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=A,t[6]=y*i+T*o+h,t[7]=y*r+T*a+p,t[8]=y*s+T*A+m,t}function ck(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],p=e[7],m=e[8],y=Math.sin(n),T=Math.cos(n);return t[0]=T*i+y*o,t[1]=T*r+y*a,t[2]=T*s+y*A,t[3]=T*o-y*i,t[4]=T*a-y*r,t[5]=T*A-y*s,t[6]=h,t[7]=p,t[8]=m,t}function t2(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function uk(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,A=r+r,h=n*o,p=i*o,m=i*a,y=r*o,T=r*a,b=r*A,C=s*o,R=s*a,S=s*A;return t[0]=1-m-b,t[3]=p-S,t[6]=y+R,t[1]=p+S,t[4]=1-h-b,t[7]=T-C,t[2]=y-R,t[5]=T+C,t[8]=1-h-m,t}var hg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(hg||(hg={}));const fk=Object.freeze([1,0,0,0,1,0,0,0,1]);class qt extends xC{static get IDENTITY(){return dk()}static get ZERO(){return hk()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return hg}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(fk)}fromObject(e){return this.check()}fromQuaternion(e){return uk(this,e),this.check()}set(e,n,i,r,s,o,a,A,h){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=A,this[8]=h,this.check()}setRowMajor(e,n,i,r,s,o,a,A,h){return this[0]=e,this[1]=r,this[2]=a,this[3]=n,this[4]=s,this[5]=A,this[6]=i,this[7]=o,this[8]=h,this.check()}determinant(){return lk(this)}transpose(){return ok(this,this),this.check()}invert(){return ak(this,this),this.check()}multiplyLeft(e){return e2(this,e,this),this.check()}multiplyRight(e){return e2(this,this,e),this.check()}rotate(e){return ck(this,this,e),this.check()}scale(e){return Array.isArray(e)?t2(this,this,e):t2(this,this,[e,e]),this.check()}translate(e){return Ak(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=dC(n||[-0,-0],e,this);break;case 3:i=EC(n||[-0,-0,-0],e,this);break;case 4:i=_C(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return AA(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let fu,hu;function hk(){return fu||(fu=new qt([0,0,0,0,0,0,0,0,0]),Object.freeze(fu)),fu}function dk(){return hu||(hu=new qt,Object.freeze(hu)),hu}function pk(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gk(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function dg(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],A=e[6],h=e[7],p=e[8],m=e[9],y=e[10],T=e[11],b=e[12],C=e[13],R=e[14],S=e[15],P=n*a-i*o,I=n*A-r*o,F=n*h-s*o,j=i*A-r*a,X=i*h-s*a,q=r*h-s*A,ee=p*C-m*b,Q=p*R-y*b,V=p*S-T*b,D=m*R-y*C,re=m*S-T*C,le=y*S-T*R,pe=P*le-I*re+F*D+j*V-X*Q+q*ee;return pe?(pe=1/pe,t[0]=(a*le-A*re+h*D)*pe,t[1]=(r*re-i*le-s*D)*pe,t[2]=(C*q-R*X+S*j)*pe,t[3]=(y*X-m*q-T*j)*pe,t[4]=(A*V-o*le-h*Q)*pe,t[5]=(n*le-r*V+s*Q)*pe,t[6]=(R*F-b*q-S*I)*pe,t[7]=(p*q-y*F+T*I)*pe,t[8]=(o*re-a*V+h*ee)*pe,t[9]=(i*V-n*re-s*ee)*pe,t[10]=(b*X-C*F+S*P)*pe,t[11]=(m*F-p*X-T*P)*pe,t[12]=(a*Q-o*D-A*ee)*pe,t[13]=(n*D-i*Q+r*ee)*pe,t[14]=(C*I-b*j-R*P)*pe,t[15]=(p*j-m*I+y*P)*pe,t):null}function mk(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],A=t[7],h=t[8],p=t[9],m=t[10],y=t[11],T=t[12],b=t[13],C=t[14],R=t[15],S=e*o-n*s,P=e*a-i*s,I=e*A-r*s,F=n*a-i*o,j=n*A-r*o,X=i*A-r*a,q=h*b-p*T,ee=h*C-m*T,Q=h*R-y*T,V=p*C-m*b,D=p*R-y*b,re=m*R-y*C;return S*re-P*D+I*V+F*Q-j*ee+X*q}function $s(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],p=e[7],m=e[8],y=e[9],T=e[10],b=e[11],C=e[12],R=e[13],S=e[14],P=e[15],I=n[0],F=n[1],j=n[2],X=n[3];return t[0]=I*i+F*a+j*m+X*C,t[1]=I*r+F*A+j*y+X*R,t[2]=I*s+F*h+j*T+X*S,t[3]=I*o+F*p+j*b+X*P,I=n[4],F=n[5],j=n[6],X=n[7],t[4]=I*i+F*a+j*m+X*C,t[5]=I*r+F*A+j*y+X*R,t[6]=I*s+F*h+j*T+X*S,t[7]=I*o+F*p+j*b+X*P,I=n[8],F=n[9],j=n[10],X=n[11],t[8]=I*i+F*a+j*m+X*C,t[9]=I*r+F*A+j*y+X*R,t[10]=I*s+F*h+j*T+X*S,t[11]=I*o+F*p+j*b+X*P,I=n[12],F=n[13],j=n[14],X=n[15],t[12]=I*i+F*a+j*m+X*C,t[13]=I*r+F*A+j*y+X*R,t[14]=I*s+F*h+j*T+X*S,t[15]=I*o+F*p+j*b+X*P,t}function Qf(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,A,h,p,m,y,T,b,C,R,S;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],A=e[2],h=e[3],p=e[4],m=e[5],y=e[6],T=e[7],b=e[8],C=e[9],R=e[10],S=e[11],t[0]=o,t[1]=a,t[2]=A,t[3]=h,t[4]=p,t[5]=m,t[6]=y,t[7]=T,t[8]=b,t[9]=C,t[10]=R,t[11]=S,t[12]=o*i+p*r+b*s+e[12],t[13]=a*i+m*r+C*s+e[13],t[14]=A*i+y*r+R*s+e[14],t[15]=h*i+T*r+S*s+e[15]),t}function g_(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _k(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),A,h,p,m,y,T,b,C,R,S,P,I,F,j,X,q,ee,Q,V,D,re,le,pe,Be;return a<cA?null:(a=1/a,r*=a,s*=a,o*=a,A=Math.sin(n),h=Math.cos(n),p=1-h,m=e[0],y=e[1],T=e[2],b=e[3],C=e[4],R=e[5],S=e[6],P=e[7],I=e[8],F=e[9],j=e[10],X=e[11],q=r*r*p+h,ee=s*r*p+o*A,Q=o*r*p-s*A,V=r*s*p-o*A,D=s*s*p+h,re=o*s*p+r*A,le=r*o*p+s*A,pe=s*o*p-r*A,Be=o*o*p+h,t[0]=m*q+C*ee+I*Q,t[1]=y*q+R*ee+F*Q,t[2]=T*q+S*ee+j*Q,t[3]=b*q+P*ee+X*Q,t[4]=m*V+C*D+I*re,t[5]=y*V+R*D+F*re,t[6]=T*V+S*D+j*re,t[7]=b*V+P*D+X*re,t[8]=m*le+C*pe+I*Be,t[9]=y*le+R*pe+F*Be,t[10]=T*le+S*pe+j*Be,t[11]=b*le+P*pe+X*Be,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function CC(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],A=e[7],h=e[8],p=e[9],m=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+h*i,t[5]=o*r+p*i,t[6]=a*r+m*i,t[7]=A*r+y*i,t[8]=h*r-s*i,t[9]=p*r-o*i,t[10]=m*r-a*i,t[11]=y*r-A*i,t}function vk(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],A=e[3],h=e[8],p=e[9],m=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-h*i,t[1]=o*r-p*i,t[2]=a*r-m*i,t[3]=A*r-y*i,t[8]=s*i+h*r,t[9]=o*i+p*r,t[10]=a*i+m*r,t[11]=A*i+y*r,t}function SC(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],A=e[3],h=e[4],p=e[5],m=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+h*i,t[1]=o*r+p*i,t[2]=a*r+m*i,t[3]=A*r+y*i,t[4]=h*r-s*i,t[5]=p*r-o*i,t[6]=m*r-a*i,t[7]=y*r-A*i,t}function yk(t,e){var n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],A=e[8],h=e[9],p=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(A,h,p),t}function Ek(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,A=r+r,h=n*o,p=i*o,m=i*a,y=r*o,T=r*a,b=r*A,C=s*o,R=s*a,S=s*A;return t[0]=1-m-b,t[1]=p+S,t[2]=y-R,t[3]=0,t[4]=p-S,t[5]=1-h-b,t[6]=T+C,t[7]=0,t[8]=y+R,t[9]=T-C,t[10]=1-h-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tk(t,e,n,i,r,s,o){var a=1/(n-e),A=1/(r-i),h=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*A,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*A,t[10]=(o+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*h,t[15]=0,t}function wk(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var bk=wk;function xk(t,e,n,i,r,s,o){var a=1/(e-n),A=1/(i-r),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*A,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*A,t[14]=(o+s)*h,t[15]=1,t}var Ck=xk;function Sk(t,e,n,i){var r,s,o,a,A,h,p,m,y,T,b=e[0],C=e[1],R=e[2],S=i[0],P=i[1],I=i[2],F=n[0],j=n[1],X=n[2];return Math.abs(b-F)<cA&&Math.abs(C-j)<cA&&Math.abs(R-X)<cA?pk(t):(p=b-F,m=C-j,y=R-X,T=1/Math.hypot(p,m,y),p*=T,m*=T,y*=T,r=P*y-I*m,s=I*p-S*y,o=S*m-P*p,T=Math.hypot(r,s,o),T?(T=1/T,r*=T,s*=T,o*=T):(r=0,s=0,o=0),a=m*o-y*s,A=y*r-p*o,h=p*s-m*r,T=Math.hypot(a,A,h),T?(T=1/T,a*=T,A*=T,h*=T):(a=0,A=0,h=0),t[0]=r,t[1]=a,t[2]=p,t[3]=0,t[4]=s,t[5]=A,t[6]=m,t[7]=0,t[8]=o,t[9]=h,t[10]=y,t[11]=0,t[12]=-(r*b+s*C+o*R),t[13]=-(a*b+A*C+h*R),t[14]=-(p*b+m*C+y*R),t[15]=1,t)}function Pk(){var t=new Hi(4);return Hi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ik(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function m_(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Mk(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function Bk(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function Lk(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t}function Rk(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ok(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t}function Ja(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function Fk(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],A=n[2],h=n[3],p=h*i+a*s-A*r,m=h*r+A*i-o*s,y=h*s+o*r-a*i,T=-o*i-a*r-A*s;return t[0]=p*h+T*-o+m*-A-y*-a,t[1]=m*h+T*-a+y*-o-p*-A,t[2]=y*h+T*-A+p*-a-m*-o,t[3]=e[3],t}(function(){var t=Pk();return function(e,n,i,r,s,o){var a,A;for(n||(n=4),i||(i=0),r?A=Math.min(r*n+i,e.length):A=e.length,a=i;a<A;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var pg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(pg||(pg={}));const Dk=45*Math.PI/180,kk=1,c0=.1,u0=500,Nk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ue extends xC{static get IDENTITY(){return Gk()}static get ZERO(){return Uk()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return pg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,A,h,p,m,y,T,b,C,R){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=A,this[8]=h,this[9]=p,this[10]=m,this[11]=y,this[12]=T,this[13]=b,this[14]=C,this[15]=R,this.check()}setRowMajor(e,n,i,r,s,o,a,A,h,p,m,y,T,b,C,R){return this[0]=e,this[1]=s,this[2]=h,this[3]=T,this[4]=n,this[5]=o,this[6]=p,this[7]=b,this[8]=i,this[9]=a,this[10]=m,this[11]=C,this[12]=r,this[13]=A,this[14]=y,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Nk)}fromObject(e){return this.check()}fromQuaternion(e){return Ek(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=c0,far:a=u0}=e;return a===1/0?zk(this,n,i,r,s,o):Tk(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return Sk(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=c0,far:a=u0}=e;return Ck(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=Dk,aspect:i=kk,focalDistance:r=1,near:s=c0,far:o=u0}=e;n2(n);const a=n/2,A=r*Math.tan(a),h=A*i;return this.ortho({left:-h,right:h,bottom:-A,top:A,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return n2(n),bk(this,n,i,r,s),this.check()}determinant(){return mk(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return gk(this,this),this.check()}invert(){return dg(this,this),this.check()}multiplyLeft(e){return $s(this,e,this),this.check()}multiplyRight(e){return $s(this,this,e),this.check()}rotateX(e){return CC(this,this,e),this.check()}rotateY(e){return vk(this,this,e),this.check()}rotateZ(e){return SC(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return _k(this,this,e,n),this.check()}scale(e){return g_(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Qf(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Ja(n||[-0,-0,-0,-0],e,this),AA(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=pC(n||[-0,-0],e,this);break;case 3:r=d_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return AA(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=gC(n||[-0,-0],e,this);break;case 3:i=mC(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return AA(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let du,pu;function Uk(){return du||(du=new Ue([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(du)),du}function Gk(){return pu||(pu=new Ue,Object.freeze(pu)),pu}function n2(t){if(t>Math.PI*2)throw Error("expected radians")}function zk(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),A=(n+e)/(n-e),h=(r+i)/(r-i),p=-1,m=-1,y=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=A,t[9]=h,t[10]=p,t[11]=m,t[12]=0,t[13]=0,t[14]=y,t[15]=0,t}function i2(){var t=new Hi(4);return Hi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Vk(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function PC(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function r2(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],A=n[1],h=n[2],p=n[3];return t[0]=i*p+o*a+r*h-s*A,t[1]=r*p+o*A+s*a-i*h,t[2]=s*p+o*h+i*A-r*a,t[3]=o*p-i*a-r*A-s*h,t}function jk(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),A=Math.cos(n);return t[0]=i*A+o*a,t[1]=r*A+s*a,t[2]=s*A-r*a,t[3]=o*A-i*a,t}function Hk(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),A=Math.cos(n);return t[0]=i*A-s*a,t[1]=r*A+o*a,t[2]=s*A+i*a,t[3]=o*A-r*a,t}function Wk(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),A=Math.cos(n);return t[0]=i*A+r*a,t[1]=r*A-i*a,t[2]=s*A+o*a,t[3]=o*A-s*a,t}function Qk(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function of(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3],A=n[0],h=n[1],p=n[2],m=n[3],y,T,b,C,R;return T=r*A+s*h+o*p+a*m,T<0&&(T=-T,A=-A,h=-h,p=-p,m=-m),1-T>cA?(y=Math.acos(T),b=Math.sin(y),C=Math.sin((1-i)*y)/b,R=Math.sin(i*y)/b):(C=1-i,R=i),t[0]=C*r+R*A,t[1]=C*s+R*h,t[2]=C*o+R*p,t[3]=C*a+R*m,t}function Xk(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t}function Jk(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function IC(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[s*3+s]-e[o*3+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+r]+e[r*3+s])*i,t[o]=(e[o*3+r]+e[r*3+o])*i}return t}var Yk=Ik,Kk=m_,Zk=Rk,qk=Ok,$k=Mk,eN=Bk,MC=Lk,tN=function(){var t=vC(),e=$y(1,0,0),n=$y(0,1,0);return function(i,r,s){var o=h_(r,s);return o<-.999999?(sf(t,e,r),bC(t)<1e-6&&sf(t,n,r),q6(t,t),PC(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(sf(t,r,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,MC(i,i))}}();(function(){var t=i2(),e=i2();return function(n,i,r,s,o,a){return of(t,i,o,a),of(e,r,s,a),of(n,t,e,2*a*(1-a)),n}})();(function(){var t=sk();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],MC(e,IC(e,t))}})();const nN=[0,0,0,1];class DA extends c_{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return IC(this,e),this.check()}fromAxisRotation(e,n){return PC(this,e,n),this.check()}identity(){return Vk(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=at(e)}get y(){return this[1]}set y(e){this[1]=at(e)}get z(){return this[2]}set z(e){this[2]=at(e)}get w(){return this[3]}set w(e){this[3]=at(e)}len(){return $k(this)}lengthSquared(){return eN(this)}dot(e){return Zk(this,e)}rotationTo(e,n){return tN(this,e,n),this.check()}add(e){return Yk(this,this,e),this.check()}calculateW(){return Qk(this,this),this.check()}conjugate(){return Jk(this,this),this.check()}invert(){return Xk(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(qk(this,e,n,i),this.check())}multiplyRight(e){return r2(this,this,e),this.check()}multiplyLeft(e){return r2(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return jk(this,this,e),this.check()}rotateY(e){return Hk(this,this,e),this.check()}rotateZ(e){return Wk(this,this,e),this.check()}scale(e){return Kk(this,this,e),this.check()}slerp(e,n,i){let r,s,o;switch(arguments.length){case 1:({start:r=nN,target:s,ratio:o}=e);break;case 2:r=this,s=e,o=n;break;default:r=e,s=n,o=i}return of(this,r,s,o),this.check()}transformVector4(e,n=new p_){return Fk(n,e,this),AA(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const kA={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},s2=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,iN={lightSources:{}};function f0(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function rN(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=f0(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{r["lighting_uPointLight[".concat(o,"].color")]=f0(s),r["lighting_uPointLight[".concat(o,"].position")]=s.position,r["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((s,o)=>{r["lighting_uDirectionalLight[".concat(o,"].color")]=f0(s),r["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function BC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:iN;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},rN({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return BC({lightSources:e})}return{}}const __={name:"lights",vs:s2,fs:s2,getUniforms:BC,defines:{MAX_LIGHTS:3}},sN=new Uint8Array([0,255,255,255]),oN={pickingSelectedColor:null,pickingHighlightColor:sN,pickingActive:!1,pickingAttribute:!1};function aN(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oN;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const lN=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,AN=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,cN={name:"picking",vs:lN,fs:AN,getUniforms:aN},LC=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,uN={};function fN(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function RC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uN;if(!("material"in t))return{};const{material:e}=t;return e?fN(e):{lighting_uEnabled:!1}}const v_={name:"gouraud-lighting",dependencies:[__],vs:LC,defines:{LIGHTING_VERTEX:1},getUniforms:RC},OC={name:"phong-lighting",dependencies:[__],fs:LC,defines:{LIGHTING_FRAGMENT:1},getUniforms:RC},hN=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,dN=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,y_={name:"pbr",vs:hN,fs:dN,defines:{LIGHTING_FRAGMENT:1},dependencies:[__]},pN=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,gN={name:"transform",vs:pN,fs:null};class fc{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new fc(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:A=!1}=e,h=this._getModuleList(e.modules),p=this._getHash(n),m=this._getHash(i),y=h.map(I=>this._getHash(I.name)).sort(),T=o.map(I=>this._getHash(I)),b=Object.keys(r).sort(),C=Object.keys(s).sort(),R=[],S=[];for(const I of b)R.push(this._getHash(I)),R.push(this._getHash(r[I]));for(const I of C)S.push(this._getHash(I)),S.push(this._getHash(s[I]));const P="".concat(p,"/").concat(m,"D").concat(R.join("/"),"M").concat(y.join("/"),"I").concat(S.join("/"),"V").concat(T.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(A?"T":"");if(!this._programCache[P]){const I=d6(this.gl,{vs:n,fs:i,modules:h,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:A});this._programCache[P]=new $x(this.gl,{hash:P,vs:I.vs,fs:I.fs,varyings:o,bufferMode:a}),this._getUniforms[P]=I.getUniforms||(F=>{}),this._useCounts[P]=0}return this._useCounts[P]++,this._programCache[P]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],A=a.name;n[r++]=a,i[A]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],A=a.name;i[A]||(n[r++]=a,i[A]=!0)}return n.length=r,n}}const mN={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function _N(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=vN(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const A=o.value,h={...o};delete h.value,i[a]=[new ct(t,A),h],yN(s,h)}}if(r){const s=r.value||r;ge(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new ct(t,{data:s,target:34963}),o]}return i}function vN(t,e){const{attributeMap:n=mN}=e||{};return n&&n[t]||t}function yN(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ge(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const No=2,EN=1e4,TN="Model needs drawMode and vertexCount",o2=()=>{},wN={};class cn{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=ji("model")}=n;ge(Ih(e)),this.id=i,this.gl=e,this.id=n.id||ji("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||fc.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:A,bufferMode:h,transpileToGLSL100:p}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:A,bufferMode:h,transpileToGLSL100:p},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ge(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),TN)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:A,bufferMode:h,transpileToGLSL100:p}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:A,bufferMode:h,transpileToGLSL100:p},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ge(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ge(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=_N(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ka(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Bh(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:A=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let h;xe.priority>=No&&(h=this._logDrawCallStart(No));const p=this.vertexArray.getDrawParams(),{isIndexed:m=p.isIndexed,indexType:y=p.indexType,indexOffset:T=p.indexOffset,vertexArrayInstanced:b=p.isInstanced}=this.props;b&&!this.isInstanced&&xe.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:C,instanceCount:R}=this,{onBeforeRender:S=o2,onAfterRender:P=o2}=this.props;S(),this.program.setUniforms(this.uniforms);const I=this.program.draw(Object.assign(wN,e,{logPriority:h,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:A,transformFeedback:o,isIndexed:m,indexType:y,isInstanced:C,instanceCount:R,offset:m?T:0}));return P(),xe.priority>=No&&this._logDrawCallEnd(h,A,i),I}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return xe.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:A,bufferMode:h,transpileToGLSL100:p}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:A,bufferMode:h,transpileToGLSL100:p}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ge(n instanceof $x,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new ID(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof ct&&n.delete()}}_setAnimationProps(e){this.animated&&ge(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ka(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new eC(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:EN;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),xe.group(No,">>> DRAWING MODEL ".concat(this.id),{collapsed:xe.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=LD({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:A}=Vy({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:h,count:p}=Vy({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});p>0&&xe.log("MISSING UNIFORMS",Object.keys(h))(),A>0&&xe.log("UNUSED UNIFORMS",Object.keys(a))();const m=OD(this.vertexArray.configuration);xe.table(e,s)(),xe.table(e,o)(),xe.table(e+1,m)(),r&&r.log({logLevel:No,message:"Rendered to ".concat(r.id)}),xe.groupEnd(No)()}}class bN{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof ct?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ge(He(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:A,accessor:h}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:A,accessor:h})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new eC(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],ge(i[s]instanceof ct)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new ct(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const xN="transform_uSampler_",Xf="transform_uSize_",a2="transform_position";function CN(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,o=Object.keys(n).length,a=null;const A={};let h=e,p={};if(o>0||i){const m=h.split(`
`),y=m.slice();if(m.forEach((T,b,C)=>{if(o>0){const R=BN(T,n);if(R){const{updatedLine:S,inject:P}=R;y[b]=S,p=cg([p,P]),Object.assign(A,R.samplerTextureMap),o--}}i&&!a&&(a=MN(T,i))}),i){ge(r);const T="".concat(Xf).concat(i),b="uniform vec2 ".concat(T,`;
`),C="     vec2 ".concat(a2," = transform_getPos(").concat(T,`);
     gl_Position = vec4(`).concat(a2,`, 0, 1.);
`);p=cg([p,{"vs:#decl":b,"vs:#main-start":C}])}h=y.join(`
`)}return{vs:h,targetTextureType:a,inject:p,samplerTextureMap:A}}function SN(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&({width:s,height:o}=i,r["".concat(Xf).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(Xf).concat(a)]=[s,o];return r}function PN(t){return aC(t,["attribute","in"])}function IN(t){const e="".concat(xN).concat(t),n="".concat(Xf).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function MN(t,e){const n=aC(t,["varying","out"]);return n&&n.name===e?n.type:null}function BN(t,e){const n={},i=PN(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:A,uniformDeclerations:h}=IN(s),p=w6(r),m="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(A,").").concat(p,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":h,"vs:#main-start":m},samplerTextureMap:n}}return null}const LN={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},RN="transform_output";class ON{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),A=Object.assign({},e.parameters);let h=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const m in this.samplerTextureMap){const y=this.samplerTextureMap[m];a[m]=i[y]}this._setSourceTextureParameters();const p=SN({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,p)}return this.hasTargetTexture&&(h=!1,A.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:h,parameters:A}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=cc(n);if(!e)return i;const r=i.constructor,s=b6(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let A=0;A<i.length;A+=4)for(let h=0;h<s;h++)o[a++]=i[A+h];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof Gt)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new ct(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:A}=e;A?(A.update({attachments:{[36064]:s},resizeAttachments:!1}),A.resize({width:o,height:a})):e.framebuffer=new kt(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(LN)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=_F(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:A}=CN({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),h=cg([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=A;const p=e._fs||lC({version:Zx(r),input:this.targetTextureVarying,inputType:o,output:RN}),m=this.hasSourceTextures||this.targetTextureVarying?[gN].concat(e.modules||[]):e.modules;return{vs:r,fs:p,modules:m,uniforms:s,inject:h}}}class E_{static isSupported(e){return He(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ge(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new cn(n,Object.assign({},e,{fs:e.fs||lC({version:Zx(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){FN(n)&&(this.bufferTransform=new bN(e,n)),DN(n)&&(this.textureTransform=new ON(e,n)),ge(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function FN(t){return!!(!ka(t.feedbackBuffers)||!ka(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function DN(t){return!!(!ka(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const l2={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Sn{static get DRAW_MODE(){return l2}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=ji("geometry"),drawMode:i=l2.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,ge(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(ge(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:A}=s;!A&&o&&a>=1&&(i=Math.min(i,o.length/a))}return ge(Number.isFinite(i)),i}}const kN=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),NN=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),UN=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),GN=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),zN={POSITION:{size:3,value:new Float32Array(NN)},NORMAL:{size:3,value:new Float32Array(UN)},TEXCOORD_0:{size:2,value:new Float32Array(GN)}};class VN extends Sn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=ji("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(kN)},attributes:{...zN,...e.attributes}})}}let jN=1,HN=1;class FC{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=jN++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=HN++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const DC="#define SMOOTH_EDGE_RADIUS 0.5",WN=`
`.concat(DC,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),QN=`
`.concat(DC,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),XN={name:"geometry",vs:WN,fs:QN},De={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(De,"IDENTITY",{get:()=>(Re.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Fi={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ri={common:0,meters:1,pixels:2},A2={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},hc={DRAW:"draw",MASK:"mask"},JN=Object.keys(De).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(De[t],";")).join(""),YN=Object.keys(Fi).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Fi[t],";")).join(""),KN=Object.keys(ri).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ri[t],";")).join(""),ZN="".concat(JN,`
`).concat(YN,`
`).concat(KN,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function qN(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Ya(t){let e={},n;return i=>{for(const r in i)if(!qN(i[r],e[r])){n=t(i),e=i;break}return n}}const c2=[0,0,0,0],$N=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],kC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e8=[0,0,0],NC=[0,0,0],t8=Ya(r8);function UC(t,e,n=NC){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===De.LNGLAT_OFFSETS||e===De.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Fi.WEB_MERCATOR:(e===De.LNGLAT||e===De.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Fi.WEB_MERCATOR_AUTO_OFFSET:e===De.LNGLAT?i=r:e===De.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case Fi.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Fi.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function n8(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=c2,A=c2,h=t.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:m,offsetMode:y}=UC(t,e,n);return y&&(A=t.projectPosition(p||m),h=[h[0]-A[0],h[1]-A[1],h[2]-A[2]],A[3]=1,a=Ja([],A,o),s=i||s,o=$s([],r,s),o=$s([],o,$N)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:A,cameraPosCommon:h,shaderCoordinateOrigin:m,geospatialOrigin:p}}function i8({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=De.DEFAULT,coordinateOrigin:r=NC,autoWrapLongitude:s=!1}){i===De.DEFAULT&&(i=t.isGeospatial?De.LNGLAT:De.CARTESIAN);const o=t8({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||kC,o}function r8({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:A,geospatialOrigin:h}=n8(t,n,i),p=t.getDistanceScales(),m=[t.width*e,t.height*e],y=Ja([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,T={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:A,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:m,project_uDevicePixelRatio:e,project_uFocalDistance:y,project_uCommonUnitsPerMeter:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:e8,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:kC,project_uCameraPosition:a};if(h){const b=t.getDistanceScales(h);switch(n){case De.METER_OFFSETS:T.project_uCommonUnitsPerWorldUnit=b.unitsPerMeter,T.project_uCommonUnitsPerWorldUnit2=b.unitsPerMeter2;break;case De.LNGLAT:case De.LNGLAT_OFFSETS:t._pseudoMeters||(T.project_uCommonUnitsPerMeter=b.unitsPerMeter),T.project_uCommonUnitsPerWorldUnit=b.unitsPerDegree,T.project_uCommonUnitsPerWorldUnit2=b.unitsPerDegree2;break;case De.CARTESIAN:T.project_uCommonUnitsPerWorldUnit=[1,1,b.unitsPerMeter[2]],T.project_uCommonUnitsPerWorldUnit2=[0,0,b.unitsPerMeter2[2]];break}}return T}const s8={};function o8(t=s8){return"viewport"in t?i8(t):{}}const go={name:"project",dependencies:[S6,XN],vs:ZN,getUniforms:o8},a8=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ei={name:"project32",dependencies:[go],vs:a8};function l8(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ta(t,e){const n=Ja([],e,t);return m_(n,n,1/n[3]),n}function u2(t,e){const n=t%e;return n<0?e+n:n}function gg(t,e,n){return t<e?e:t>n?n:t}function A8(t){return Math.log(t)*Math.LOG2E}const T_=Math.log2||A8;function Sr(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Di=Math.PI,GC=Di/4,zi=Di/180,mg=180/Di,NA=512,_g=4003e4,gu=85.051129,c8=1.5;function u8(t){return T_(t)}function ps(t){const[e,n]=t;Sr(Number.isFinite(e)),Sr(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*zi,r=n*zi,s=NA*(i+Di)/(2*Di),o=NA*(Di+Math.log(Math.tan(GC+r*.5)))/(2*Di);return[s,o]}function gs(t){const[e,n]=t,i=e/NA*(2*Di)-Di,r=2*(Math.atan(Math.exp(n/NA*(2*Di)-Di))-GC);return[i*mg,r*mg]}function f8(t){const{latitude:e}=t;Sr(Number.isFinite(e));const n=Math.cos(e*zi);return u8(_g*n)-9}function vg(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Sr(Number.isFinite(e)&&Number.isFinite(n));const r=NA,s=Math.cos(e*zi),o=r/360,a=o/s,A=r/_g/s,h={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[o,a,A],degreesPerUnit:[1/o,1/a,1/A]};if(i){const p=zi*Math.tan(e*zi)/s,m=o*p/2,y=r/_g*p,T=y/a*A;h.unitsPerDegree2=[0,m,y],h.unitsPerMeter2=[T,0,T]}return h}function zC(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:A,unitsPerMeter2:h}=vg({longitude:n,latitude:i,highPrecision:!0}),p=ps(t);p[0]+=s*(A[0]+h[0]*o),p[1]+=o*(A[1]+h[1]*o);const m=gs(p),y=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[m[0],m[1],y]:m}function h8(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=l8();Qf(a,a,[0,0,-r]),CC(a,a,-n*zi),SC(a,a,i*zi);const A=s/e;return g_(a,a,[A,A,A]),o&&Qf(a,a,Z6([],o)),a}function d8(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:A=1,farZMultiplier:h=1}=t;let{fovy:p=Jf(c8)}=t;i!==void 0&&(p=Jf(i));const m=p*zi,y=r*zi,T=VC(p);let b=T;o&&(b+=o[2]*a/Math.cos(y)/n);const C=m*(.5+(s?s[1]:0)/n),R=Math.sin(C)*b/Math.sin(gg(Math.PI/2-y-C,.01,Math.PI-.01)),S=Math.sin(y)*R+b,P=b*10,I=Math.min(S*h,P);return{fov:m,aspect:e/n,focalDistance:T,near:A,far:I}}function Jf(t){return 2*Math.atan(.5/t)*mg}function VC(t){return .5/Math.tan(.5*t*zi)}function jC(t,e){const[n,i,r=0]=t;return Sr(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Ta(e,[n,i,r,1])}function Rh(t,e,n=0){const[i,r,s]=t;if(Sr(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return Ta(e,[i,r,s,1]);const o=Ta(e,[i,r,0,1]),a=Ta(e,[i,r,1,1]),A=o[2],h=a[2],p=A===h?0:((n||0)-A)/(h-A);return hC([],o,a,p)}function HC(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,A],[h,p]]=i,m=p8(t.padding),y=ps([a,gg(p,-gu,gu)]),T=ps([h,gg(A,-gu,gu)]),b=[Math.max(Math.abs(T[0]-y[0]),r),Math.max(Math.abs(T[1]-y[1]),r)],C=[e-m.left-m.right-Math.abs(o[0])*2,n-m.top-m.bottom-Math.abs(o[1])*2];Sr(C[0]>0&&C[1]>0);const R=C[0]/b[0],S=C[1]/b[1],P=(m.right-m.left)/2/R,I=(m.top-m.bottom)/2/S,F=[(T[0]+y[0])/2+P,(T[1]+y[1])/2+I],j=gs(F),X=Math.min(s,T_(Math.abs(Math.min(R,S))));return Sr(Number.isFinite(X)),{longitude:j[0],latitude:j[1],zoom:X}}function p8(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Sr(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const f2=Math.PI/180;function g8(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let A,h;const p=t.fovy?.5*t.fovy*f2:Math.atan(.5/t.altitude),m=(90-t.pitch)*f2;return p>m-.01?(A=h2(t,0,e),h=h2(t,n,e)):(A=r([0,0],s),h=r([n,0],s)),[o,a,h,A]}function h2(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Ta(i,[e,0,1,1]),s=Ta(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),A=hC([],r,s,a),h=gs(A);return h.push(n),h}const d2=512;function m8(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=u2(r+180,360)-180),(a<-180||a>180)&&(a=u2(a+180,360)-180);const A=T_(n/d2);if(o<=A)o=A,s=0;else{const h=n/2/Math.pow(2,o),p=gs([0,h])[1];if(s<p)s=p;else{const m=gs([0,d2-h])[1];s>m&&(s=m)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const _8=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,v8=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,y8=Ya(x8),E8=Ya(C8),T8=[0,0,0,1],w8=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function b8(t,e){const[n,i,r]=t,s=Rh([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function x8({viewport:t,center:e}){return new Ue(t.viewProjectionMatrix).invert().transform(e)}function C8({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>b8(o,i));for(const o of e){const a=o.clone().translate(new Z(t.center).negate()),A=s.map(p=>a.transform(p)),h=new Ue().ortho({left:Math.min(...A.map(p=>p[0])),right:Math.max(...A.map(p=>p[0])),bottom:Math.min(...A.map(p=>p[1])),top:Math.max(...A.map(p=>p[1])),near:Math.min(...A.map(p=>-p[2])),far:Math.max(...A.map(p=>-p[2]))});n.push(h.multiplyRight(o))}return n}function S8(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||T8,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=y8({viewport:t.viewport,center:e.project_uCenter}),s=[],o=E8({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const A=o[a],h=A.clone().translate(new Z(t.viewport.center).negate());e.project_uCoordinateSystem===De.LNGLAT&&e.project_uProjectionMode===Fi.WEB_MERCATOR?(o[a]=h,s[a]=r):(o[a]=A.clone().multiplyRight(w8),s[a]=h.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}const h0={name:"shadow",dependencies:[go],vs:_8,fs:v8,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?S8(t,e):{}},Ti={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...cN},P8=[go],I8=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function M8(t){const e=fc.getDefaultProgramManager(t);for(const n of P8)e.addDefaultModule(n);for(const n of I8)e.addShaderHook(n);return e}const B8=[255,255,255],L8=1;let R8=0;class O8{constructor(e={}){w(this,"id",void 0),w(this,"color",void 0),w(this,"intensity",void 0),w(this,"type","ambient");const{color:n=B8}=e,{intensity:i=L8}=e;this.id=e.id||"ambient-".concat(R8++),this.color=n,this.intensity=i}}const F8=[255,255,255],D8=1,k8=[0,0,-1];let N8=0;class p2{constructor(e={}){w(this,"id",void 0),w(this,"color",void 0),w(this,"intensity",void 0),w(this,"type","directional"),w(this,"direction",void 0),w(this,"shadow",void 0);const{color:n=F8}=e,{intensity:i=D8}=e,{direction:r=k8}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(N8++),this.color=n,this.intensity=i,this.type="directional",this.direction=new Z(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class U8{constructor(e,n={id:"pass"}){w(this,"id",void 0),w(this,"gl",void 0),w(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Oh extends U8{constructor(...e){super(...e),w(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Cr(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:A=!0}=e;e.pass=e.pass||"unknown";const h=this.gl;A&&z8(h),a&&(this._lastRenderIndex=-1);const p=[];for(const m of r){const y=s&&s[m.id];o(m);const T=this._getDrawLayerParams(m,e),b=m.subViewports||[m];for(const C of b){const R=this._drawLayersInViewport(h,{target:n,moduleParameters:i,viewport:C,view:y,pass:e.pass,layers:e.layers},T);p.push(R)}}return p}_getDrawLayerParams(e,{layers:n,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}){const A=[],h=WC(this._lastRenderIndex+1),p={layer:n[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},m={};for(let y=0;y<n.length;y++){const T=n[y],b=this._shouldDrawLayer(T,p,r,m),C={shouldDrawLayer:b};b&&(C.layerRenderIndex=h(T,b),C.moduleParameters=this._getModuleParameters(T,o,i,a),C.layerParameters=this.getLayerParameters(T,y,e)),A[y]=C}return A}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},A){const h=G8(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const m=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;_i(e,{scissorTest:!0,scissor:h},()=>Bh(e,m))}const p={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Cr(e,{viewport:h});for(let m=0;m<n.length;m++){const y=n[m],{shouldDrawLayer:T,layerRenderIndex:b,moduleParameters:C,layerParameters:R}=A[m];if(T&&y.props.pickable&&p.pickableCount++,y.isComposite)p.compositeCount++;else if(T){p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,b),C.viewport=o;try{y._drawLayer({moduleParameters:C,uniforms:{layerIndex:b},parameters:R})}catch(S){y.raiseError(S,"drawing ".concat(y," to ").concat(r))}}}return p}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Da(this.gl)});if(n)for(const A of n){var a;Object.assign(o,(a=A.getModuleParameters)===null||a===void 0?void 0:a.call(A,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function WC(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,A=r.parent&&r.parent.id;let h;if(A&&!(A in e)&&i(r.parent,!1),A in n){const p=n[A]=n[A]||WC(e[A],e);h=p(r,s),n[a]=p}else Number.isFinite(o)?(h=o+(e[A]||0),n[a]=null):h=t;return s&&h>=t&&(t=h+1),e[a]=h,h};return i}function G8(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||Da(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function z8(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;Cr(t,{viewport:[0,0,e,n]}),t.clear(16640)}class V8 extends Oh{constructor(e,n){super(e,n),w(this,"shadowMap",void 0),w(this,"depthBuffer",void 0),w(this,"fbo",void 0),this.shadowMap=new Gt(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new oa(e,{format:33189,width:1,height:1}),this.fbo=new kt(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;_i(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=Da(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const j8={color:[255,255,255],intensity:1},g2=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],H8=[0,0,0,200/255];class QC{constructor(e={}){w(this,"id","lighting-effect"),w(this,"props",null),w(this,"shadowColor",H8),w(this,"shadow",void 0),w(this,"ambientLight",null),w(this,"directionalLights",[]),w(this,"pointLights",[]),w(this,"shadowPasses",[]),w(this,"shadowMaps",[]),w(this,"dummyShadowMap",null),w(this,"programManager",void 0),w(this,"shadowMatrices",void 0);for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=fc.getDefaultProgramManager(e),h0&&this.programManager.addDefaultModule(h0)),this.dummyShadowMap||(this.dummyShadowMap=new Gt(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(h0),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Ue().lookAt({eye:new Z(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new V8(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new O8(j8),this.directionalLights.push(new p2(g2[0]),new p2(g2[1])))}}class W8{constructor(e={}){w(this,"_pool",[]),w(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:A}){const h=r||e&&e.constructor||Float32Array,p=n*i+s;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,p)}let m=1/0;A&&(m=A*i+s);const y=this._allocate(h,p,a,m);return e&&o?y.set(e):a||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,A=o.findIndex(h=>h.byteLength>=a);if(A>=0){const h=new e(o.splice(A,1)[0],0,s);return i&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const Ua=new W8;function Ql(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Q8(t,e){const n=t%e;return n<0?e+n:n}function X8(t){return[t[12],t[13],t[14]]}function J8(t){return{left:Uo(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Uo(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Uo(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Uo(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Uo(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Uo(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const m2=new Z;function Uo(t,e,n,i){m2.set(t,e,n);const r=m2.len();return{distance:i/r,normal:new Z(-t/r,-e/r,-n/r)}}function yg(t){return t-Math.fround(t)}let Ml;function d0(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;Ml=Ua.allocate(Ml,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let A=0;A<n;A++){const h=t[o++];Ml[a+A]=h,Ml[a+A+n]=yg(h)}a+=n*2}return Ml.subarray(0,s*n*2)}const Y8=Math.PI/180,K8=Ql(),_2=[0,0,0],Z8={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function q8({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const A=t/e,h=n?new Ue().orthographic({fovy:i,aspect:A,focalDistance:r,near:o,far:a}):new Ue().perspective({fovy:i,aspect:A,near:o,far:a});if(s){const{left:p=0,right:m=0,top:y=0,bottom:T=0}=s,b=rn((p+t-m)/2,0,t)-t/2,C=rn((y+e-T)/2,0,e)-e/2;h[8]-=b*2/t,h[9]+=C*2/e}return h}class Es{constructor(e={}){w(this,"id",void 0),w(this,"x",void 0),w(this,"y",void 0),w(this,"width",void 0),w(this,"height",void 0),w(this,"padding",void 0),w(this,"isGeospatial",void 0),w(this,"zoom",void 0),w(this,"focalDistance",void 0),w(this,"position",void 0),w(this,"modelMatrix",void 0),w(this,"distanceScales",void 0),w(this,"scale",void 0),w(this,"center",void 0),w(this,"cameraPosition",void 0),w(this,"projectionMatrix",void 0),w(this,"viewMatrix",void 0),w(this,"viewMatrixUncentered",void 0),w(this,"viewMatrixInverse",void 0),w(this,"viewProjectionMatrix",void 0),w(this,"pixelProjectionMatrix",void 0),w(this,"pixelUnprojectionMatrix",void 0),w(this,"resolution",void 0),w(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Z8,this.focalDistance=e.focalDistance||1,this.position=e.position||_2,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Fi.WEB_MERCATOR:Fi.WEB_MERCATOR_AUTO_OFFSET:Fi.IDENTITY}equals(e){return e instanceof Es?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ni(e.projectionMatrix,this.projectionMatrix)&&ni(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=jC(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,A=i&&i*this.distanceScales.unitsPerMeter[2],h=Rh([r,a,o],this.pixelUnprojectionMatrix,A),[p,m,y]=this.unprojectPosition(h);return Number.isFinite(o)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=ps(e);return n[1]=rn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?gs(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?vg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,J8(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=f8({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||vg({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=_2;if(s&&(a=o?new Ue(o).transformAsVector(s,[]):s),this.isGeospatial){const A=this.projectPosition([n,i,0]);this.center=new Z(a).scale(this.distanceScales.unitsPerMeter).add(A)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=K8,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:A=1e3,padding:h=null,focalDistance:p=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Ue().multiplyRight(n).translate(new Z(this.center).negate()),this.projectionMatrix=i||q8({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*Y8,focalDistance:p,padding:h,near:a,far:A});const m=Ql();$s(m,m,this.projectionMatrix),$s(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=dg([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=X8(this.viewMatrixInverse);const y=Ql(),T=Ql();g_(y,y,[this.width/2,-this.height/2,1]),Qf(y,y,[1,-1,0]),$s(T,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=dg(Ql(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Re.warn("Pixel project matrix not invertible")()}}w(Es,"displayName","Viewport");const $8=512,eU=4003e4,tU=Math.PI/180;function v2(t){const e=Math.cos(t*tU);return $8/eU/e}class Wi extends Es{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:A=1.01,orthographic:h=!1,projectionMatrix:p,repeat:m=!1,worldOffset:y=0,legacyMeterSizes:T=!1}=e;let{width:b,height:C,altitude:R=1.5}=e;const S=Math.pow(2,r);b=b||1,C=C||1;let P,I=null;p?(R=p[5]/2,P=Jf(R)):(e.fovy?(P=e.fovy,R=VC(P)):P=Jf(R),I=d8({width:b,height:C,pitch:s,fovy:P,nearZMultiplier:a,farZMultiplier:A}));let F=h8({height:C,pitch:s,bearing:o,scale:S,altitude:R});y&&(F=new Ue().translate([512*y,0,0]).multiplyLeft(F)),super({...e,width:b,height:C,viewMatrix:F,longitude:i,latitude:n,zoom:r,...I,fovy:P,focalDistance:R}),w(this,"longitude",void 0),w(this,"latitude",void 0),w(this,"pitch",void 0),w(this,"bearing",void 0),w(this,"altitude",void 0),w(this,"fovy",void 0),w(this,"orthographic",void 0),w(this,"_subViewports",void 0),w(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=R,this.fovy=P,this.orthographic=h,this._subViewports=m?[]:null,this._pseudoMeters=T,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new Wi({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*v2(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/v2(i);return[n,i,r]}addMetersToLngLat(e,n){return zC(e,n)}panByPosition(e,n){const i=Rh(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=Wf([],r,fC([],i)),o=Wf([],this.center,s),[a,A]=this.unprojectFlat(o);return{longitude:a,latitude:A}}getBounds(e={}){const n=g8(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=HC({width:i,height:r,bounds:e,...n});return new Wi({width:i,height:r,longitude:s,latitude:o,zoom:a})}}w(Wi,"displayName","WebMercatorViewport");function p0(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Wi){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function nU(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===De.DEFAULT&&(r=e.isGeospatial?De.LNGLAT:De.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function XC(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,A=0]=t;switch(n&&([o,a,A]=Ja([],[o,a,A,1],n)),i){case De.LNGLAT:return p0([o,a,A],e,s);case De.LNGLAT_OFFSETS:return p0([o+r[0],a+r[1],A+(r[2]||0)],e,s);case De.METER_OFFSETS:return p0(zC(r,[o,a,A]),e,s);case De.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],A+r[2]]:e.projectPosition([o,a,A])}}function iU(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=nU(e),{geospatialOrigin:A,shaderCoordinateOrigin:h,offsetMode:p}=UC(n,i,r),m=XC(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:p});if(p){const y=n.projectPosition(A||h);wC(m,m,y)}return m}const Qo={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Yf=Symbol.for("component"),wa=Symbol.for("asyncPropDefaults"),oo=Symbol.for("asyncPropOriginal"),ts=Symbol.for("asyncPropResolved");function ao(t,e=()=>!0){return Array.isArray(t)?JC(t,e,[]):e(t)?[t]:[]}function JC(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?JC(r,e,n):e(r)&&n.push(r)}return n}function rU({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class sU{constructor(e,n,i){w(this,"id",void 0),w(this,"context",void 0),w(this,"isLoaded",void 0),w(this,"persistent",void 0),w(this,"_loadCount",0),w(this,"_subscribers",new Set),w(this,"_data",void 0),w(this,"_loader",void 0),w(this,"_error",void 0),w(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=xr(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class oU{constructor({gl:e,protocol:n}){w(this,"protocol",void 0),w(this,"_context",void 0),w(this,"_resources",void 0),w(this,"_consumers",void 0),w(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new sU(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},A=a.resourceId&&this._resources[a.resourceId];A&&(A.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const aU="layerManager.setLayers",lU="layerManager.activateViewport";class AU{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){w(this,"layers",void 0),w(this,"context",void 0),w(this,"resourceManager",void 0),w(this,"_lastRenderedLayers",[]),w(this,"_needsRedraw",!1),w(this,"_needsUpdate",!1),w(this,"_nextLayers",null),w(this,"_debug",!1),w(this,"activateViewport",o=>{mn(lU,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new oU({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&M8(e),stats:i||new sc({id:"deck.gl"}),viewport:r||new Es({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new FC,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){mn(aU,this,n,e),this._lastRenderedLayers=e;const i=ao(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?Re.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&Re.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Qo.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Qo.MATCHED,n!==e&&(e.lifecycle=Qo.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Qo.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Qo.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function mo(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],r=e[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&mo(i,r)))return!1}return!0}class cU{constructor(e){w(this,"width",void 0),w(this,"height",void 0),w(this,"views",void 0),w(this,"viewState",void 0),w(this,"controllers",void 0),w(this,"timeline",void 0),w(this,"_viewports",void 0),w(this,"_viewportMap",void 0),w(this,"_isUpdating",void 0),w(this,"_needsRedraw",void 0),w(this,"_needsUpdate",void 0),w(this,"_eventManager",void 0),w(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=ao(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!mo(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Re.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let A=n[s.id];const h=Boolean(s.controller);h&&!A&&(i=!0),(i||!h)&&A&&(A.finalize(),A=null),this.controllers[s.id]=this._updateController(s,o,a,A),this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const uU=/([0-9]+\.?[0-9]*)(%|px)/;function jr(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=uU.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Hr(t,e){return t.relative?Math.round(t.position*e):t.position}function Ut(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class YC{constructor(e){w(this,"id",void 0),w(this,"viewportInstance",void 0),w(this,"_x",void 0),w(this,"_y",void 0),w(this,"_width",void 0),w(this,"_height",void 0),w(this,"_padding",void 0),w(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:A}=e||{};Ut(!A||A instanceof Es),this.viewportInstance=A,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=jr(i),this._y=jr(r),this._width=jr(s),this._height=jr(o),this._padding=a&&{left:jr(a.left||0),right:jr(a.right||0),top:jr(a.top||0),bottom:jr(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&mo(this.props,e.props)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Hr(this._x,e),y:Hr(this._y,n),width:Hr(this._width,e),height:Hr(this._height,n)};return this._padding&&(i.padding={left:Hr(this._padding.left,e),top:Hr(this._padding.top,n),right:Hr(this._padding.right,e),bottom:Hr(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class dc{constructor(e){w(this,"_inProgress",void 0),w(this,"_handle",void 0),w(this,"_timeline",void 0),w(this,"time",void 0),w(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const y2=()=>{},Eg={BREAK:1,SNAP_TO_END:2,IGNORE:3},fU=t=>t,hU=Eg.BREAK;class dU{constructor(e){w(this,"getControllerState",void 0),w(this,"props",void 0),w(this,"propsInTransition",void 0),w(this,"transition",void 0),w(this,"onViewStateChange",void 0),w(this,"onStateChange",void 0),w(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:A}}=n,h=A(i/a),p=r.interpolateProps(s,o,h);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new dc(e.timeline),this.onViewStateChange=e.onViewStateChange||y2,this.onStateChange=e.onStateChange||y2}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===Eg.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Eg.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const A={duration:o,easing:n.transitionEasing||fU,interpolator:s,interruption:n.transitionInterruption||hU,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(A),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class pU{constructor(e){w(this,"_propsToCompare",void 0),w(this,"_propsToExtract",void 0),w(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!ni(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Ut(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const gU=["longitude","latitude","zoom","bearing","pitch"],mU=["longitude","latitude","zoom"];class w_ extends pU{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:gU,required:mU},super(i.transitionProps),w(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),A=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(A),aroundPosition:A,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=Gi(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,Gi(e.around,n.around,i)))}return r}}const Wr={transitionDuration:0},_U=300,mu=t=>1-(1-t)*(1-t),Go={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Ds={};class KC{constructor(e){w(this,"props",void 0),w(this,"state",{}),w(this,"transitionManager",void 0),w(this,"eventManager",void 0),w(this,"onViewStateChange",void 0),w(this,"onStateChange",void 0),w(this,"makeViewport",void 0),w(this,"_controllerState",void 0),w(this,"_events",{}),w(this,"_interactionState",{isDragging:!1}),w(this,"_customEvents",[]),w(this,"_eventStartBlocked",null),w(this,"_panMove",!1),w(this,"invertPan",!1),w(this,"dragMode","rotate"),w(this,"inertia",0),w(this,"scrollZoom",!0),w(this,"dragPan",!0),w(this,"dragRotate",!0),w(this,"doubleClickZoom",!0),w(this,"touchZoom",!0),w(this,"touchRotate",!1),w(this,"keyboard",!0),this.transitionManager=new dU({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?_U:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:A=!1,keyboard:h=!0}=e,p=Boolean(this.onViewStateChange);this.toggleEvents(Go.WHEEL,p&&i),this.toggleEvents(Go.PAN,p&&(r||s)),this.toggleEvents(Go.PINCH,p&&(a||A)),this.toggleEvents(Go.TRIPLE_PAN,p&&A),this.toggleEvents(Go.DOUBLE_TAP,p&&o),this.toggleEvents(Go.KEYBOARD,p&&h),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=A,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Wr,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Wr,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:mu},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Wr,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:mu},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Wr,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Wr,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:mu},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Ds._startPinchRotation=e.rotation,Ds._lastPinchEvent=e,this.updateViewport(i,Wr,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Ds._startPinchRotation-i})}return this.updateViewport(n,Wr,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ds._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Ds;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),A=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:A}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:mu},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ds._startPinchRotation=null,Ds._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let A;const h={};switch(e.srcEvent.code){case"Minus":A=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),h.isZooming=!0;break;case"Equal":A=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),h.isZooming=!0;break;case"ArrowLeft":n?(A=a.rotateLeft(s),h.isRotating=!0):(A=a.moveLeft(r),h.isPanning=!0);break;case"ArrowRight":n?(A=a.rotateRight(s),h.isRotating=!0):(A=a.moveRight(r),h.isPanning=!0);break;case"ArrowUp":n?(A=a.rotateUp(o),h.isRotating=!0):(A=a.moveUp(r),h.isPanning=!0);break;case"ArrowDown":n?(A=a.rotateDown(o),h.isRotating=!0):(A=a.moveDown(r),h.isPanning=!0);break;default:return!1}return this.updateViewport(A,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Wr:e?{...n,transitionInterpolator:new w_({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class ZC{constructor(e,n){w(this,"_viewportProps",void 0),w(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const E2=5,vU=1.2;class yU extends ZC{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:A=0,altitude:h=1.5,position:p=[0,0,0],maxZoom:m=20,minZoom:y=0,maxPitch:T=60,minPitch:b=0,startPanLngLat:C,startZoomLngLat:R,startRotatePos:S,startBearing:P,startPitch:I,startZoom:F,normalize:j=!0}=e;Ut(Number.isFinite(s)),Ut(Number.isFinite(r)),Ut(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:A,altitude:h,maxZoom:m,minZoom:y,maxPitch:T,minPitch:b,normalize:j,position:p},{startPanLngLat:C,startZoomLngLat:R,startRotatePos:S,startBearing:P,startPitch:I,startZoom:F}),w(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let A=r+Math.log2(i);A=rn(A,a,o);const h=this.makeViewport({...this.getViewportProps(),zoom:A});return this._getUpdatedState({zoom:A,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=rn(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=rn(a,o,s);const{normalize:A=!0}=e;return A&&Object.assign(e,m8(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],A=n[1],{width:h,height:p}=this.getViewportProps(),m=s/h;let y=0;o>0?Math.abs(p-A)>E2&&(y=o/(A-p)*vU):o<0&&A>E2&&(y=1-a/A),y=rn(y,-1,1);const{minPitch:T,maxPitch:b}=this.getViewportProps(),C=r+180*m;let R=i;return y>0?R=i+y*(b-i):y<0&&(R=i-y*(T-i)),{pitch:R,bearing:C}}}class EU extends KC{constructor(...e){super(...e),w(this,"ControllerState",yU),w(this,"transition",{transitionDuration:300,transitionInterpolator:new w_({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),w(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class b_ extends YC{get ViewportType(){return Wi}get ControllerType(){return EU}}w(b_,"displayName","MapView");class TU extends Oh{constructor(e,n){super(e,n),w(this,"maskMap",void 0),w(this,"fbo",void 0);const{mapSize:i=2048}=n;this.maskMap=new Gt(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new kt(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,_i(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===hc.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const wU=new Ue().lookAt({eye:[0,0,1]});function bU({width:t,height:e,near:n,far:i,padding:r}){let s=-t/2,o=t/2,a=-e/2,A=e/2;if(r){const{left:h=0,right:p=0,top:m=0,bottom:y=0}=r,T=rn((h+t-p)/2,0,t)-t/2,b=rn((m+e-y)/2,0,e)-e/2;s-=T,o-=T,a+=b,A+=b}return new Ue().ortho({left:s,right:o,bottom:a,top:A,near:n,far:i})}class xU extends Es{constructor(e){const{width:n,height:i,near:r=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:A=null,flipY:h=!0}=e,p=Array.isArray(o)?o[0]:o,m=Array.isArray(o)?o[1]:o,y=Math.min(p,m),T=Math.pow(2,y);let b;if(p!==m){const C=Math.pow(2,p),R=Math.pow(2,m);b={unitsPerMeter:[C/T,R/T,1],metersPerUnit:[T/C,T/R,1]}}super({...e,longitude:void 0,position:a,viewMatrix:wU.clone().scale([T,T*(h?-1:1),T]),projectionMatrix:bU({width:n||1,height:i||1,padding:A,near:r,far:s}),zoom:y,distanceScales:b})}projectFlat([e,n]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat([e,n]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(e,n){const i=Rh(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=Wf([],r,fC([],i)),o=Wf([],this.center,s);return{target:this.unprojectFlat(o)}}}class CU extends ZC{constructor(e){const{width:n,height:i,rotationX:r=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:A=-90,maxRotationX:h=90,minZoom:p=-1/0,maxZoom:m=1/0,startPanPosition:y,startRotatePos:T,startRotationX:b,startRotationOrbit:C,startZoomPosition:R,startZoom:S}=e;super({width:n,height:i,rotationX:r,rotationOrbit:s,target:o,zoom:a,minRotationX:A,maxRotationX:h,minZoom:p,maxZoom:m},{startPanPosition:y,startRotatePos:T,startRotationX:b,startRotationOrbit:C,startZoomPosition:R,startZoom:S}),w(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const i=this.getState().startPanPosition||n;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:A}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let h;if(e){let p=(e[0]-r[0])/a;const m=(e[1]-r[1])/A;(s<-90||s>90)&&(p*=-1),h={rotationX:s+m*180,rotationOrbit:o+p*180}}else h={rotationX:s+i,rotationOrbit:o+n};return this._getUpdatedState(h)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-n.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return rn(s,r,i)}_panFromCenter(e){const{width:n,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(r)?[rn(r[0],i,n),rn(r[1],i,n)]:rn(r,i,n),e.rotationX=rn(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=Q8(a+180,360)-180),e}}class SU extends CU{constructor(e){super(e),w(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(n)){let[o,a]=n;switch(this.zoomAxis){case"X":o=rn(o+s,r,i);break;case"Y":a=rn(a+s,r,i);break;default:let A=Math.min(o+s,a+s);A<r&&(s+=r-A),A=Math.max(o+s,a+s),A>i&&(s+=i-A),o+=s,a+=s}return[o,a]}return rn(n+s,r,i)}}class PU extends KC{constructor(...e){super(...e),w(this,"ControllerState",SU),w(this,"transition",{transitionDuration:300,transitionInterpolator:new w_(["target","zoom"])}),w(this,"dragMode","pan")}_onPanRotate(){return!1}}class qC extends YC{get ViewportType(){return xU}get ControllerType(){return PU}}w(qC,"displayName","OrthographicView");function IU({layers:t,viewport:e}){let n=null;for(const s of t){const o=s.getBounds();o&&(n?(n[0]=Math.min(n[0],o[0][0]),n[1]=Math.min(n[1],o[0][1]),n[2]=Math.max(n[2],o[1][0]),n[3]=Math.max(n[3],o[1][1])):n=[o[0][0],o[0][1],o[1][0],o[1][1]])}const i=e.getBounds();if(!n)return i;const r=BU(i);return n[2]-n[0]<r[2]-r[0]||n[3]-n[1]<r[3]-r[1]||(n[0]=Math.max(n[0],r[0]),n[1]=Math.max(n[1],r[1]),n[2]=Math.min(n[2],r[2]),n[3]=Math.min(n[3],r[3])),n}function MU({bounds:t,viewport:e,width:n,height:i}){if(t[2]<=t[0]||t[3]<=t[1])return null;const r=1;if(n-=r*2,i-=r*2,e instanceof Wi){const{longitude:a,latitude:A,zoom:h}=HC({width:n,height:i,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new Wi({longitude:a,latitude:A,zoom:h,x:r,y:r,width:n,height:i})}const s=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],o=Math.min(20,n/(t[2]-t[0]),i/(t[3]-t[1]));return new qC({x:r,y:r}).makeViewport({width:n,height:i,viewState:{target:s,zoom:Math.log2(o)}})}function BU(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class LU{constructor(){w(this,"id","mask-effect"),w(this,"props",null),w(this,"useInPicking",!0),w(this,"dummyMaskMap",void 0),w(this,"channels",[]),w(this,"masks",null),w(this,"maskPass",void 0),w(this,"maskMap",void 0),w(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){this.dummyMaskMap||(this.dummyMaskMap=new Gt(e,{width:1,height:1}));const a=n.filter(m=>m.props.visible&&m.props.operation===hc.MASK);if(a.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new TU(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const A=this._sortMaskChannels(a),h=r[0],p=!this.lastViewport||!this.lastViewport.equals(h);for(const m in A)this._renderChannel(A[m],{layerFilter:i,onViewportActive:s,views:o,viewport:h,viewportChanged:p})}_renderChannel(e,{layerFilter:n,onViewportActive:i,views:r,viewport:s,viewportChanged:o}){const a=this.channels[e.index];if(!a)return;const A=e===a||a.layers.length!==e.layers.length||e.layerBounds.some((h,p)=>h!==a.layerBounds[p]);if(e.bounds=a.bounds,e.maskBounds=a.maskBounds,this.channels[e.index]=e,(A||o)&&(this.lastViewport=s,e.bounds=IU({layers:e.layers,viewport:s}),A||!ni(e.bounds,a.bounds))){const{maskPass:h,maskMap:p}=this,m=MU({bounds:e.bounds,viewport:s,width:p.width,height:p.height});e.maskBounds=m?m.getBounds():[0,0,1,1],h.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:m?[m]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let i=0;for(const r of e){const{id:s}=r.root;let o=n[s];if(!o){if(++i>4){Re.warn("Too many mask layers. The max supported is 4")();continue}o={id:s,index:this.channels.findIndex(a=>(a==null?void 0:a.id)===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},n[s]=o}o.layers.push(r),o.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in n))&&(this.channels[r]=null)}for(const r in n){const s=n[r];s.index<0&&(s.index=this.channels.findIndex(o=>!o),this.channels[s.index]=s)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const RU=new QC;class OU{constructor(){w(this,"effects",void 0),w(this,"_internalEffects",void 0),w(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!mo(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new LU),e.some(n=>n instanceof QC)||this._internalEffects.push(RU)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class FU extends Oh{shouldDrawLayer(e){return e.props.operation===hc.DRAW}}const T2={blendFunc:[1,0,32771,0],blendEquation:32774};class $C extends Oh{constructor(...e){super(...e),w(this,"pickZ",void 0),w(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:A,width:h,height:p},cullRect:m,effects:y,pass:T="picking",pickZ:b}){const C=this.gl;this.pickZ=b;const R=b?null:{byLayer:new Map,byAlpha:[]};this._colors=R;const S=_i(C,{scissorTest:!0,scissor:[a,A,h,p],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...T2,blend:!b},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:m,effects:y==null?void 0:y.filter(I=>I.useInPicking),pass:T}));return this._colors=null,{decodePickingColor:R&&kU.bind(null,R),stats:S}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===hc.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters};return this._colors?(Object.assign(r,T2),r.blend=!0,r.blendColor=DU(this._colors,e,i)):r.blend=!1,r}}function DU(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(Re.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function kU(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const NU="deckRenderer.renderLayers";class UU{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new FU(e),this.pickLayersPass=new $C(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||kt.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,mn(NU,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const r of e)r.preRender(this.gl,n),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new kt(this.gl),new kt(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const GU={pickedColor:null,pickedObjectIndex:-1};function zU({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:A,height:h}=s;let p=r*r,m=-1,y=0;for(let T=0;T<h;T++){const b=T+a-i,C=b*b;if(C>p)y+=4*A;else for(let R=0;R<A;R++){if(t[y+3]-1>=0){const P=R+o-n,I=P*P+C;I<=p&&(p=I,m=y)}y+=4}}if(m>=0){const T=t.slice(m,m+4),b=e(T);if(b){const C=Math.floor(m/4/A),R=m/4-C*A;return{...b,pickedColor:T,pickedX:o+R,pickedY:a+C}}Re.error("Picked non-existent layer. Is picking buffer corrupt?")()}return GU}function VU({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):Re.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function eS({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=HU((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const A=[i-o.x,r-o.y];s!==void 0&&(A[2]=s),a=o.unproject(A)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function jU(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,A=o?[o]:[];if(i==="hover"){const m=n.index,y=n.layerId,T=o?o.props.id:null;if(T!==y||a!==m){if(T!==y){const b=r.find(C=>C.props.id===y);b&&A.unshift(b)}n.layerId=T,n.index=a,n.info=null}}const h=eS(t),p=new Map;return p.set(null,h),A.forEach(m=>{let y={...h};m===o&&(y.color=s,y.index=a,y.picked=!0),y=tS({layer:m,info:y,mode:i});const T=y.layer;m===o&&i==="hover"&&(n.info=y),p.set(T.id,y),i==="hover"&&T.updateAutoHighlight(y)}),p}function tS({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function HU(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class WU{constructor(e){w(this,"gl",void 0),w(this,"pickingFBO",void 0),w(this,"depthFBO",void 0),w(this,"pickLayersPass",void 0),w(this,"layerFilter",void 0),w(this,"lastPickedInfo",void 0),w(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new $C(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,A=o?i.find(y=>y.id===o):null,h=a&&r.find(y=>y.id===a)||r[0],p=h&&h.unproject([e-h.x,n-h.y]);return{...s,...{x:e,y:n,viewport:h,coordinate:p,layer:A}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new kt(i),kt.isSupported(i,{colorBufferFloat:!0}))){const r=new kt(i);r.attach({[36064]:new Gt(i,{format:He(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:A="query",unproject3D:h,onViewportActive:p,effects:m}){const y=this._getPickable(e),T=Da(this.gl);if(!y)return{result:[],emptyInfo:eS({viewports:i,x:r,y:s,pixelRatio:T})};this._resizeBuffer();const b=$d(this.gl,[r,s],!0),C=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],R=Math.round(o*T),{width:S,height:P}=this.pickingFBO,I=this._getPickingRect({deviceX:C[0],deviceY:C[1],deviceRadius:R,deviceWidth:S,deviceHeight:P}),F={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let j;const X=[],q=new Set;for(let ee=0;ee<a;ee++){let Q;if(I){const D=this._drawAndSample({layers:y,views:n,viewports:i,onViewportActive:p,deviceRect:I,cullRect:F,effects:m,pass:"picking:".concat(A)});Q=zU({...D,deviceX:C[0],deviceY:C[1],deviceRadius:R,deviceRect:I})}else Q={pickedColor:null,pickedObjectIndex:-1};let V;Q.pickedLayer&&h&&this.depthFBO&&(V=this._drawAndSample({layers:[Q.pickedLayer],views:n,viewports:i,onViewportActive:p,deviceRect:{x:Q.pickedX,y:Q.pickedY,width:1,height:1},cullRect:F,effects:m,pass:"picking:".concat(A,":z")},!0).pickedColors[0]),Q.pickedLayer&&ee+1<a&&(q.add(Q.pickedLayer),Q.pickedLayer.disablePickingIndex(Q.pickedObjectIndex)),j=jU({pickInfo:Q,lastPickedInfo:this.lastPickedInfo,mode:A,layers:y,viewports:i,x:r,y:s,z:V,pixelRatio:T});for(const D of j.values())D.layer&&X.push(D);if(!Q.pickedColor)break}for(const ee of q)ee.restorePickingColors();return{result:X,emptyInfo:j.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:A="query",maxObjects:h=null,onViewportActive:p,effects:m}){const y=this._getPickable(e);if(!y)return[];this._resizeBuffer();const T=Da(this.gl),b=$d(this.gl,[r,s],!0),C=b.x,R=b.y+b.height,S=$d(this.gl,[r+o,s+a],!0),P=S.x+S.width,I=S.y,F={x:C,y:I,width:P-C,height:R-I},j=this._drawAndSample({layers:y,views:n,viewports:i,onViewportActive:p,deviceRect:F,cullRect:{x:r,y:s,width:o,height:a},effects:m,pass:"picking:".concat(A)}),X=VU(j),q=new Map,ee=Number.isFinite(h);for(let Q=0;Q<X.length&&!(ee&&h&&q.size>=h);Q++){const V=X[Q];let D={color:V.pickedColor,layer:null,index:V.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:T};D=tS({layer:V.pickedLayer,info:D,mode:A}),q.has(D.object)||q.set(D.object,D)}return Array.from(q.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:A},h=!1){const p=h?this.depthFBO:this.pickingFBO,{decodePickingColor:m}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:p,deviceRect:s,cullRect:o,effects:a,pass:A,pickZ:h}),{x:y,y:T,width:b,height:C}=s,R=new(h?Float32Array:Uint8Array)(b*C*4);return cc(p,{sourceX:y,sourceY:T,sourceWidth:b,sourceHeight:C,target:R}),{pickedColors:R,decodePickingColor:m}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),A=Math.min(r,e+i+1)-o,h=Math.min(s,n+i+1)-a;return A<=0||h<=0?null:{x:o,y:a,width:A,height:h}}}const QU={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class XU{constructor(e){w(this,"el",null),w(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,QU),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var lo={},JU={get exports(){return lo},set exports(t){lo=t}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",A=Math.round,h=Math.abs,p=Date.now;function m(L,O,G){return setTimeout(I(L,G),O)}function y(L,O,G){return Array.isArray(L)?(T(L,G[O],G),!0):!1}function T(L,O,G){var K;if(L)if(L.forEach)L.forEach(O,G);else if(L.length!==r)for(K=0;K<L.length;)O.call(G,L[K],K,L),K++;else for(K in L)L.hasOwnProperty(K)&&O.call(G,L[K],K,L)}function b(L,O,G){var K="DEPRECATED METHOD: "+O+`
`+G+` AT 
`;return function(){var se=new Error("get-stack-trace"),Te=se&&se.stack?se.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Xe=e.console&&(e.console.warn||e.console.log);return Xe&&Xe.call(e.console,K,Te),L.apply(this,arguments)}}var C;typeof Object.assign!="function"?C=function(O){if(O===r||O===null)throw new TypeError("Cannot convert undefined or null to object");for(var G=Object(O),K=1;K<arguments.length;K++){var se=arguments[K];if(se!==r&&se!==null)for(var Te in se)se.hasOwnProperty(Te)&&(G[Te]=se[Te])}return G}:C=Object.assign;var R=b(function(O,G,K){for(var se=Object.keys(G),Te=0;Te<se.length;)(!K||K&&O[se[Te]]===r)&&(O[se[Te]]=G[se[Te]]),Te++;return O},"extend","Use `assign`."),S=b(function(O,G){return R(O,G,!0)},"merge","Use `assign`.");function P(L,O,G){var K=O.prototype,se;se=L.prototype=Object.create(K),se.constructor=L,se._super=K,G&&C(se,G)}function I(L,O){return function(){return L.apply(O,arguments)}}function F(L,O){return typeof L==a?L.apply(O&&O[0]||r,O):L}function j(L,O){return L===r?O:L}function X(L,O,G){T(V(O),function(K){L.addEventListener(K,G,!1)})}function q(L,O,G){T(V(O),function(K){L.removeEventListener(K,G,!1)})}function ee(L,O){for(;L;){if(L==O)return!0;L=L.parentNode}return!1}function Q(L,O){return L.indexOf(O)>-1}function V(L){return L.trim().split(/\s+/g)}function D(L,O,G){if(L.indexOf&&!G)return L.indexOf(O);for(var K=0;K<L.length;){if(G&&L[K][G]==O||!G&&L[K]===O)return K;K++}return-1}function re(L){return Array.prototype.slice.call(L,0)}function le(L,O,G){for(var K=[],se=[],Te=0;Te<L.length;){var Xe=O?L[Te][O]:L[Te];D(se,Xe)<0&&K.push(L[Te]),se[Te]=Xe,Te++}return G&&(O?K=K.sort(function(Ge,Qt){return Ge[O]>Qt[O]}):K=K.sort()),K}function pe(L,O){for(var G,K,se=O[0].toUpperCase()+O.slice(1),Te=0;Te<s.length;){if(G=s[Te],K=G?G+se:O,K in L)return K;Te++}return r}var Be=1;function Ye(){return Be++}function Qe(L){var O=L.ownerDocument||L;return O.defaultView||O.parentWindow||e}var oe=/mobile|tablet|ip(ad|hone|od)|android/i,ye="ontouchstart"in e,Ce=pe(e,"PointerEvent")!==r,Le=ye&&oe.test(navigator.userAgent),ke="touch",Wt="pen",zn="mouse",bs="kinect",ai=25,Bt=1,Ar=2,Lt=4,un=8,yo=1,xs=2,Cs=4,Ss=8,Ps=16,li=xs|Cs,Tn=Ss|Ps,Rr=li|Tn,yc=["x","y"],Eo=["clientX","clientY"];function Rt(L,O){var G=this;this.manager=L,this.callback=O,this.element=L.element,this.target=L.options.inputTarget,this.domHandler=function(K){F(L.options.enable,[L])&&G.handler(K)},this.init()}Rt.prototype={handler:function(){},init:function(){this.evEl&&X(this.element,this.evEl,this.domHandler),this.evTarget&&X(this.target,this.evTarget,this.domHandler),this.evWin&&X(Qe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&q(this.element,this.evEl,this.domHandler),this.evTarget&&q(this.target,this.evTarget,this.domHandler),this.evWin&&q(Qe(this.element),this.evWin,this.domHandler)}};function tl(L){var O,G=L.options.inputClass;return G?O=G:Ce?O=fe:Le?O=Is:ye?O=Y:O=bo,new O(L,Ec)}function Ec(L,O,G){var K=G.pointers.length,se=G.changedPointers.length,Te=O&Bt&&K-se===0,Xe=O&(Lt|un)&&K-se===0;G.isFirst=!!Te,G.isFinal=!!Xe,Te&&(L.session={}),G.eventType=O,Or(L,G),L.emit("hammer.input",G),L.recognize(G),L.session.prevInput=G}function Or(L,O){var G=L.session,K=O.pointers,se=K.length;G.firstInput||(G.firstInput=Tc(O)),se>1&&!G.firstMultiple?G.firstMultiple=Tc(O):se===1&&(G.firstMultiple=!1);var Te=G.firstInput,Xe=G.firstMultiple,zt=Xe?Xe.center:Te.center,Ge=O.center=il(K);O.timeStamp=p(),O.deltaTime=O.timeStamp-Te.timeStamp,O.angle=wo(zt,Ge),O.distance=To(zt,Ge),nl(G,O),O.offsetDirection=wc(O.deltaX,O.deltaY);var Qt=rl(O.deltaTime,O.deltaX,O.deltaY);O.overallVelocityX=Qt.x,O.overallVelocityY=Qt.y,O.overallVelocity=h(Qt.x)>h(Qt.y)?Qt.x:Qt.y,O.scale=Xe?Kh(Xe.pointers,K):1,O.rotation=Xe?Yh(Xe.pointers,K):0,O.maxPointers=G.prevInput?O.pointers.length>G.prevInput.maxPointers?O.pointers.length:G.prevInput.maxPointers:O.pointers.length,Jh(G,O);var Hn=L.element;ee(O.srcEvent.target,Hn)&&(Hn=O.srcEvent.target),O.target=Hn}function nl(L,O){var G=O.center,K=L.offsetDelta||{},se=L.prevDelta||{},Te=L.prevInput||{};(O.eventType===Bt||Te.eventType===Lt)&&(se=L.prevDelta={x:Te.deltaX||0,y:Te.deltaY||0},K=L.offsetDelta={x:G.x,y:G.y}),O.deltaX=se.x+(G.x-K.x),O.deltaY=se.y+(G.y-K.y)}function Jh(L,O){var G=L.lastInterval||O,K=O.timeStamp-G.timeStamp,se,Te,Xe,zt;if(O.eventType!=un&&(K>ai||G.velocity===r)){var Ge=O.deltaX-G.deltaX,Qt=O.deltaY-G.deltaY,Hn=rl(K,Ge,Qt);Te=Hn.x,Xe=Hn.y,se=h(Hn.x)>h(Hn.y)?Hn.x:Hn.y,zt=wc(Ge,Qt),L.lastInterval=O}else se=G.velocity,Te=G.velocityX,Xe=G.velocityY,zt=G.direction;O.velocity=se,O.velocityX=Te,O.velocityY=Xe,O.direction=zt}function Tc(L){for(var O=[],G=0;G<L.pointers.length;)O[G]={clientX:A(L.pointers[G].clientX),clientY:A(L.pointers[G].clientY)},G++;return{timeStamp:p(),pointers:O,center:il(O),deltaX:L.deltaX,deltaY:L.deltaY}}function il(L){var O=L.length;if(O===1)return{x:A(L[0].clientX),y:A(L[0].clientY)};for(var G=0,K=0,se=0;se<O;)G+=L[se].clientX,K+=L[se].clientY,se++;return{x:A(G/O),y:A(K/O)}}function rl(L,O,G){return{x:O/L||0,y:G/L||0}}function wc(L,O){return L===O?yo:h(L)>=h(O)?L<0?xs:Cs:O<0?Ss:Ps}function To(L,O,G){G||(G=yc);var K=O[G[0]]-L[G[0]],se=O[G[1]]-L[G[1]];return Math.sqrt(K*K+se*se)}function wo(L,O,G){G||(G=yc);var K=O[G[0]]-L[G[0]],se=O[G[1]]-L[G[1]];return Math.atan2(se,K)*180/Math.PI}function Yh(L,O){return wo(O[1],O[0],Eo)+wo(L[1],L[0],Eo)}function Kh(L,O){return To(O[0],O[1],Eo)/To(L[0],L[1],Eo)}var Zh={mousedown:Bt,mousemove:Ar,mouseup:Lt},bc="mousedown",qh="mousemove mouseup";function bo(){this.evEl=bc,this.evWin=qh,this.pressed=!1,Rt.apply(this,arguments)}P(bo,Rt,{handler:function(O){var G=Zh[O.type];G&Bt&&O.button===0&&(this.pressed=!0),G&Ar&&O.which!==1&&(G=Lt),this.pressed&&(G&Lt&&(this.pressed=!1),this.callback(this.manager,G,{pointers:[O],changedPointers:[O],pointerType:zn,srcEvent:O}))}});var $h={pointerdown:Bt,pointermove:Ar,pointerup:Lt,pointercancel:un,pointerout:un},sl={2:ke,3:Wt,4:zn,5:bs},xc="pointerdown",Cc="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(xc="MSPointerDown",Cc="MSPointerMove MSPointerUp MSPointerCancel");function fe(){this.evEl=xc,this.evWin=Cc,Rt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}P(fe,Rt,{handler:function(O){var G=this.store,K=!1,se=O.type.toLowerCase().replace("ms",""),Te=$h[se],Xe=sl[O.pointerType]||O.pointerType,zt=Xe==ke,Ge=D(G,O.pointerId,"pointerId");Te&Bt&&(O.button===0||zt)?Ge<0&&(G.push(O),Ge=G.length-1):Te&(Lt|un)&&(K=!0),!(Ge<0)&&(G[Ge]=O,this.callback(this.manager,Te,{pointers:G,changedPointers:[O],pointerType:Xe,srcEvent:O}),K&&G.splice(Ge,1))}});var ed={touchstart:Bt,touchmove:Ar,touchend:Lt,touchcancel:un},Sc="touchstart",td="touchstart touchmove touchend touchcancel";function Pc(){this.evTarget=Sc,this.evWin=td,this.started=!1,Rt.apply(this,arguments)}P(Pc,Rt,{handler:function(O){var G=ed[O.type];if(G===Bt&&(this.started=!0),!!this.started){var K=ol.call(this,O,G);G&(Lt|un)&&K[0].length-K[1].length===0&&(this.started=!1),this.callback(this.manager,G,{pointers:K[0],changedPointers:K[1],pointerType:ke,srcEvent:O})}}});function ol(L,O){var G=re(L.touches),K=re(L.changedTouches);return O&(Lt|un)&&(G=le(G.concat(K),"identifier",!0)),[G,K]}var Ic={touchstart:Bt,touchmove:Ar,touchend:Lt,touchcancel:un},Mc="touchstart touchmove touchend touchcancel";function Is(){this.evTarget=Mc,this.targetIds={},Rt.apply(this,arguments)}P(Is,Rt,{handler:function(O){var G=Ic[O.type],K=xo.call(this,O,G);K&&this.callback(this.manager,G,{pointers:K[0],changedPointers:K[1],pointerType:ke,srcEvent:O})}});function xo(L,O){var G=re(L.touches),K=this.targetIds;if(O&(Bt|Ar)&&G.length===1)return K[G[0].identifier]=!0,[G,G];var se,Te,Xe=re(L.changedTouches),zt=[],Ge=this.target;if(Te=G.filter(function(Qt){return ee(Qt.target,Ge)}),O===Bt)for(se=0;se<Te.length;)K[Te[se].identifier]=!0,se++;for(se=0;se<Xe.length;)K[Xe[se].identifier]&&zt.push(Xe[se]),O&(Lt|un)&&delete K[Xe[se].identifier],se++;if(zt.length)return[le(Te.concat(zt),"identifier",!0),zt]}var al=2500,Qi=25;function Y(){Rt.apply(this,arguments);var L=I(this.handler,this);this.touch=new Is(this.manager,L),this.mouse=new bo(this.manager,L),this.primaryTouch=null,this.lastTouches=[]}P(Y,Rt,{handler:function(O,G,K){var se=K.pointerType==ke,Te=K.pointerType==zn;if(!(Te&&K.sourceCapabilities&&K.sourceCapabilities.firesTouchEvents)){if(se)ie.call(this,G,K);else if(Te&&Me.call(this,K))return;this.callback(O,G,K)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ie(L,O){L&Bt?(this.primaryTouch=O.changedPointers[0].identifier,he.call(this,O)):L&(Lt|un)&&he.call(this,O)}function he(L){var O=L.changedPointers[0];if(O.identifier===this.primaryTouch){var G={x:O.clientX,y:O.clientY};this.lastTouches.push(G);var K=this.lastTouches,se=function(){var Te=K.indexOf(G);Te>-1&&K.splice(Te,1)};setTimeout(se,al)}}function Me(L){for(var O=L.srcEvent.clientX,G=L.srcEvent.clientY,K=0;K<this.lastTouches.length;K++){var se=this.lastTouches[K],Te=Math.abs(O-se.x),Xe=Math.abs(G-se.y);if(Te<=Qi&&Xe<=Qi)return!0}return!1}var u=pe(o.style,"touchAction"),N=u!==r,Ze="compute",et="auto",Ve="manipulation",We="none",_t="pan-x",qe="pan-y",Je=Co();function Ot(L,O){this.manager=L,this.set(O)}Ot.prototype={set:function(L){L==Ze&&(L=this.compute()),N&&this.manager.element.style&&Je[L]&&(this.manager.element.style[u]=L),this.actions=L.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var L=[];return T(this.manager.recognizers,function(O){F(O.options.enable,[O])&&(L=L.concat(O.getTouchAction()))}),Xi(L.join(" "))},preventDefaults:function(L){var O=L.srcEvent,G=L.offsetDirection;if(this.manager.session.prevented){O.preventDefault();return}var K=this.actions,se=Q(K,We)&&!Je[We],Te=Q(K,qe)&&!Je[qe],Xe=Q(K,_t)&&!Je[_t];if(se){var zt=L.pointers.length===1,Ge=L.distance<2,Qt=L.deltaTime<250;if(zt&&Ge&&Qt)return}if(!(Xe&&Te)&&(se||Te&&G&li||Xe&&G&Tn))return this.preventSrc(O)},preventSrc:function(L){this.manager.session.prevented=!0,L.preventDefault()}};function Xi(L){if(Q(L,We))return We;var O=Q(L,_t),G=Q(L,qe);return O&&G?We:O||G?O?_t:qe:Q(L,Ve)?Ve:et}function Co(){if(!N)return!1;var L={},O=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(G){L[G]=O?e.CSS.supports("touch-action",G):!0}),L}var Fr=1,vt=2,bi=4,tn=8,xi=tn,Vn=16,Pe=32;function z(L){this.options=C({},this.defaults,L||{}),this.id=Ye(),this.manager=null,this.options.enable=j(this.options.enable,!0),this.state=Fr,this.simultaneous={},this.requireFail=[]}z.prototype={defaults:{},set:function(L){return C(this.options,L),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(L){if(y(L,"recognizeWith",this))return this;var O=this.simultaneous;return L=So(L,this),O[L.id]||(O[L.id]=L,L.recognizeWith(this)),this},dropRecognizeWith:function(L){return y(L,"dropRecognizeWith",this)?this:(L=So(L,this),delete this.simultaneous[L.id],this)},requireFailure:function(L){if(y(L,"requireFailure",this))return this;var O=this.requireFail;return L=So(L,this),D(O,L)===-1&&(O.push(L),L.requireFailure(this)),this},dropRequireFailure:function(L){if(y(L,"dropRequireFailure",this))return this;L=So(L,this);var O=D(this.requireFail,L);return O>-1&&this.requireFail.splice(O,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(L){return!!this.simultaneous[L.id]},emit:function(L){var O=this,G=this.state;function K(se){O.manager.emit(se,L)}G<tn&&K(O.options.event+tt(G)),K(O.options.event),L.additionalEvent&&K(L.additionalEvent),G>=tn&&K(O.options.event+tt(G))},tryEmit:function(L){if(this.canEmit())return this.emit(L);this.state=Pe},canEmit:function(){for(var L=0;L<this.requireFail.length;){if(!(this.requireFail[L].state&(Pe|Fr)))return!1;L++}return!0},recognize:function(L){var O=C({},L);if(!F(this.options.enable,[this,O])){this.reset(),this.state=Pe;return}this.state&(xi|Vn|Pe)&&(this.state=Fr),this.state=this.process(O),this.state&(vt|bi|tn|Vn)&&this.tryEmit(O)},process:function(L){},getTouchAction:function(){},reset:function(){}};function tt(L){return L&Vn?"cancel":L&tn?"end":L&bi?"move":L&vt?"start":""}function ll(L){return L==Ps?"down":L==Ss?"up":L==xs?"left":L==Cs?"right":""}function So(L,O){var G=O.manager;return G?G.get(L):L}function jn(){z.apply(this,arguments)}P(jn,z,{defaults:{pointers:1},attrTest:function(L){var O=this.options.pointers;return O===0||L.pointers.length===O},process:function(L){var O=this.state,G=L.eventType,K=O&(vt|bi),se=this.attrTest(L);return K&&(G&un||!se)?O|Vn:K||se?G&Lt?O|tn:O&vt?O|bi:vt:Pe}});function Po(){jn.apply(this,arguments),this.pX=null,this.pY=null}P(Po,jn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Rr},getTouchAction:function(){var L=this.options.direction,O=[];return L&li&&O.push(qe),L&Tn&&O.push(_t),O},directionTest:function(L){var O=this.options,G=!0,K=L.distance,se=L.direction,Te=L.deltaX,Xe=L.deltaY;return se&O.direction||(O.direction&li?(se=Te===0?yo:Te<0?xs:Cs,G=Te!=this.pX,K=Math.abs(L.deltaX)):(se=Xe===0?yo:Xe<0?Ss:Ps,G=Xe!=this.pY,K=Math.abs(L.deltaY))),L.direction=se,G&&K>O.threshold&&se&O.direction},attrTest:function(L){return jn.prototype.attrTest.call(this,L)&&(this.state&vt||!(this.state&vt)&&this.directionTest(L))},emit:function(L){this.pX=L.deltaX,this.pY=L.deltaY;var O=ll(L.direction);O&&(L.additionalEvent=this.options.event+O),this._super.emit.call(this,L)}});function Al(){jn.apply(this,arguments)}P(Al,jn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[We]},attrTest:function(L){return this._super.attrTest.call(this,L)&&(Math.abs(L.scale-1)>this.options.threshold||this.state&vt)},emit:function(L){if(L.scale!==1){var O=L.scale<1?"in":"out";L.additionalEvent=this.options.event+O}this._super.emit.call(this,L)}});function k(){z.apply(this,arguments),this._timer=null,this._input=null}P(k,z,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[et]},process:function(L){var O=this.options,G=L.pointers.length===O.pointers,K=L.distance<O.threshold,se=L.deltaTime>O.time;if(this._input=L,!K||!G||L.eventType&(Lt|un)&&!se)this.reset();else if(L.eventType&Bt)this.reset(),this._timer=m(function(){this.state=xi,this.tryEmit()},O.time,this);else if(L.eventType&Lt)return xi;return Pe},reset:function(){clearTimeout(this._timer)},emit:function(L){this.state===xi&&(L&&L.eventType&Lt?this.manager.emit(this.options.event+"up",L):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}});function cl(){jn.apply(this,arguments)}P(cl,jn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[We]},attrTest:function(L){return this._super.attrTest.call(this,L)&&(Math.abs(L.rotation)>this.options.threshold||this.state&vt)}});function ul(){jn.apply(this,arguments)}P(ul,jn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:li|Tn,pointers:1},getTouchAction:function(){return Po.prototype.getTouchAction.call(this)},attrTest:function(L){var O=this.options.direction,G;return O&(li|Tn)?G=L.overallVelocity:O&li?G=L.overallVelocityX:O&Tn&&(G=L.overallVelocityY),this._super.attrTest.call(this,L)&&O&L.offsetDirection&&L.distance>this.options.threshold&&L.maxPointers==this.options.pointers&&h(G)>this.options.velocity&&L.eventType&Lt},emit:function(L){var O=ll(L.offsetDirection);O&&this.manager.emit(this.options.event+O,L),this.manager.emit(this.options.event,L)}});function Io(){z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}P(Io,z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ve]},process:function(L){var O=this.options,G=L.pointers.length===O.pointers,K=L.distance<O.threshold,se=L.deltaTime<O.time;if(this.reset(),L.eventType&Bt&&this.count===0)return this.failTimeout();if(K&&se&&G){if(L.eventType!=Lt)return this.failTimeout();var Te=this.pTime?L.timeStamp-this.pTime<O.interval:!0,Xe=!this.pCenter||To(this.pCenter,L.center)<O.posThreshold;this.pTime=L.timeStamp,this.pCenter=L.center,!Xe||!Te?this.count=1:this.count+=1,this._input=L;var zt=this.count%O.taps;if(zt===0)return this.hasRequireFailures()?(this._timer=m(function(){this.state=xi,this.tryEmit()},O.interval,this),vt):xi}return Pe},failTimeout:function(){return this._timer=m(function(){this.state=Pe},this.options.interval,this),Pe},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==xi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ci(L,O){return O=O||{},O.recognizers=j(O.recognizers,Ci.defaults.preset),new Mo(L,O)}Ci.VERSION="2.0.7",Ci.defaults={domEvents:!1,touchAction:Ze,enable:!0,inputTarget:null,inputClass:null,preset:[[cl,{enable:!1}],[Al,{enable:!1},["rotate"]],[ul,{direction:li}],[Po,{direction:li},["swipe"]],[Io],[Io,{event:"doubletap",taps:2},["tap"]],[k]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var nd=1,Bc=2;function Mo(L,O){this.options=C({},Ci.defaults,O||{}),this.options.inputTarget=this.options.inputTarget||L,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=L,this.input=tl(this),this.touchAction=new Ot(this,this.options.touchAction),Lc(this,!0),T(this.options.recognizers,function(G){var K=this.add(new G[0](G[1]));G[2]&&K.recognizeWith(G[2]),G[3]&&K.requireFailure(G[3])},this)}Mo.prototype={set:function(L){return C(this.options,L),L.touchAction&&this.touchAction.update(),L.inputTarget&&(this.input.destroy(),this.input.target=L.inputTarget,this.input.init()),this},stop:function(L){this.session.stopped=L?Bc:nd},recognize:function(L){var O=this.session;if(!O.stopped){this.touchAction.preventDefaults(L);var G,K=this.recognizers,se=O.curRecognizer;(!se||se&&se.state&xi)&&(se=O.curRecognizer=null);for(var Te=0;Te<K.length;)G=K[Te],O.stopped!==Bc&&(!se||G==se||G.canRecognizeWith(se))?G.recognize(L):G.reset(),!se&&G.state&(vt|bi|tn)&&(se=O.curRecognizer=G),Te++}},get:function(L){if(L instanceof z)return L;for(var O=this.recognizers,G=0;G<O.length;G++)if(O[G].options.event==L)return O[G];return null},add:function(L){if(y(L,"add",this))return this;var O=this.get(L.options.event);return O&&this.remove(O),this.recognizers.push(L),L.manager=this,this.touchAction.update(),L},remove:function(L){if(y(L,"remove",this))return this;if(L=this.get(L),L){var O=this.recognizers,G=D(O,L);G!==-1&&(O.splice(G,1),this.touchAction.update())}return this},on:function(L,O){if(L!==r&&O!==r){var G=this.handlers;return T(V(L),function(K){G[K]=G[K]||[],G[K].push(O)}),this}},off:function(L,O){if(L!==r){var G=this.handlers;return T(V(L),function(K){O?G[K]&&G[K].splice(D(G[K],O),1):delete G[K]}),this}},emit:function(L,O){this.options.domEvents&&fl(L,O);var G=this.handlers[L]&&this.handlers[L].slice();if(!(!G||!G.length)){O.type=L,O.preventDefault=function(){O.srcEvent.preventDefault()};for(var K=0;K<G.length;)G[K](O),K++}},destroy:function(){this.element&&Lc(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Lc(L,O){var G=L.element;if(G.style){var K;T(L.options.cssProps,function(se,Te){K=pe(G.style,Te),O?(L.oldCssProps[K]=G.style[K],G.style[K]=se):G.style[K]=L.oldCssProps[K]||""}),O||(L.oldCssProps={})}}function fl(L,O){var G=n.createEvent("Event");G.initEvent(L,!0,!0),G.gesture=O,O.target.dispatchEvent(G)}C(Ci,{INPUT_START:Bt,INPUT_MOVE:Ar,INPUT_END:Lt,INPUT_CANCEL:un,STATE_POSSIBLE:Fr,STATE_BEGAN:vt,STATE_CHANGED:bi,STATE_ENDED:tn,STATE_RECOGNIZED:xi,STATE_CANCELLED:Vn,STATE_FAILED:Pe,DIRECTION_NONE:yo,DIRECTION_LEFT:xs,DIRECTION_RIGHT:Cs,DIRECTION_UP:Ss,DIRECTION_DOWN:Ps,DIRECTION_HORIZONTAL:li,DIRECTION_VERTICAL:Tn,DIRECTION_ALL:Rr,Manager:Mo,Input:Rt,TouchAction:Ot,TouchInput:Is,MouseInput:bo,PointerEventInput:fe,TouchMouseInput:Y,SingleTouchInput:Pc,Recognizer:z,AttrRecognizer:jn,Tap:Io,Pan:Po,Swipe:ul,Pinch:Al,Rotate:cl,Press:k,on:X,off:q,each:T,merge:S,extend:R,assign:C,inherit:P,bindFn:I,prefixed:pe});var Ai=typeof e<"u"?e:typeof self<"u"?self:{};Ai.Hammer=Ci,typeof r=="function"&&r.amd?r(function(){return Ci}):t.exports?t.exports=Ci:e[i]=Ci})(window,document,"Hammer")})(JU);const YU=lo,Zi=GI({__proto__:null,default:YU},[lo]),nS=1,iS=2,Tg=4,KU={mousedown:nS,mousemove:iS,mouseup:Tg};function ZU(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function qU(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(ZU(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function $U(t){t.prototype.handler=function(n){let i=KU[n.type];i&nS&&n.button>=0&&(this.pressed=!0),i&iS&&n.which===0&&(i=Tg),this.pressed&&(i&Tg&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}qU(lo.PointerEventInput);$U(lo.MouseInput);const e5=lo.Manager;class Fh{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const t5=Zi?[[Zi.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Zi.Rotate,{enable:!1}],[Zi.Pinch,{enable:!1}],[Zi.Swipe,{enable:!1}],[Zi.Pan,{threshold:0,enable:!1}],[Zi.Press,{enable:!1}],[Zi.Tap,{event:"doubletap",taps:2,enable:!1}],[Zi.Tap,{event:"anytap",enable:!1}],[Zi.Tap,{enable:!1}]]:null,w2={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},n5={doubletap:["tap"]},i5={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},x_={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},r5={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},b2={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},s5=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",aa=typeof window<"u"?window:global;let wg=!1;try{const t={get passive(){return wg=!0,!0}};aa.addEventListener("test",null,t),aa.removeEventListener("test",null)}catch{wg=!1}const o5=s5.indexOf("firefox")!==-1,{WHEEL_EVENTS:a5}=x_,x2="wheel",C2=4.000244140625,l5=40,A5=.25;class c5 extends Fh{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;aa.WheelEvent&&(o5&&r.deltaMode===aa.WheelEvent.DOM_DELTA_PIXEL&&(s/=aa.devicePixelRatio),r.deltaMode===aa.WheelEvent.DOM_DELTA_LINE&&(s*=l5)),s!==0&&s%C2===0&&(s=Math.floor(s/C2)),r.shiftKey&&s&&(s=s*A5),this.callback({type:x2,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(a5),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,wg?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===x2&&(this.options.enable=n)}}const{MOUSE_EVENTS:u5}=x_,S2="pointermove",P2="pointerover",I2="pointerout",M2="pointerenter",B2="pointerleave";class f5 extends Fh{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(u5),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===S2&&(this.enableMoveEvent=n),e===P2&&(this.enableOverEvent=n),e===I2&&(this.enableOutEvent=n),e===M2&&(this.enableEnterEvent=n),e===B2&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(P2,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(I2,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(M2,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(B2,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(S2,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:h5}=x_,L2="keydown",R2="keyup";class d5 extends Fh{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:L2,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:R2,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(h5),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===L2&&(this.enableDownEvent=n),e===R2&&(this.enableUpEvent=n)}}const O2="contextmenu";class p5 extends Fh{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:O2,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===O2&&(this.options.enable=n)}}const bg=1,Kf=2,xg=4,g5={pointerdown:bg,pointermove:Kf,pointerup:xg,mousedown:bg,mousemove:Kf,mouseup:xg},m5=1,_5=2,v5=3,y5=0,E5=1,T5=2,w5=1,b5=2,x5=4;function C5(t){const e=g5[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===xg||e===Kf&&!Number.isFinite(n)?(s=r===m5,o=r===_5,a=r===v5):e===Kf?(s=Boolean(n&w5),o=Boolean(n&x5),a=Boolean(n&b5)):e===bg&&(s=i===y5,o=i===E5,a=i===T5),{leftButton:s,middleButton:o,rightButton:a}}function S5(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const g0={srcElement:"root",priority:0};class P5{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let A=g0;typeof i=="string"||i&&i.addEventListener?A={...g0,srcElement:i}:i&&(A={...g0,...i});let h=a.get(A.srcElement);h||(h=[],a.set(A.srcElement,h));const p={type:e,handler:n,srcElement:A.srcElement,priority:A.priority};r&&(p.once=!0),s&&(p.passive=!0),o.push(p),this._active=this._active||!p.passive;let m=h.length-1;for(;m>=0&&!(h[m].priority>=p.priority);)m--;h.splice(m+1,0,p)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let A=0;A<i.length;A++){const{type:h,handler:p,once:m}=i[A];if(p({...e,type:h,stopPropagation:s,stopImmediatePropagation:o}),m&&a.push(i[A]),r)break}for(let A=0;A<a.length;A++){const{type:h,handler:p}=a[A];this.remove(h,p)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...C5(e),...S5(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const I5={events:null,recognizers:null,recognizerOptions:{},Manager:e5,touchAction:"none",tabIndex:0};class M5{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=i5[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...I5,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||t5}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(w2).forEach(r=>{const s=this.manager.get(r);s&&w2[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new c5(e,this._onOtherEvent,{enable:!1}),this.moveInput=new f5(e,this._onOtherEvent,{enable:!1}),this.keyInput=new d5(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new p5(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=n5[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const p in e)this._addEventHandler(p,e[p],i,r,s);return}const{manager:o,events:a}=this,A=b2[e]||e;let h=a.get(A);h||(h=new P5(this),a.set(A,h),h.recognizerName=r5[A]||A,o&&o.on(A,h.handleEvent)),h.add(e,n,i,r,s),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=b2[e]||e,s=i.get(r);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const A of i.values())if(A.recognizerName===o&&!A.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function ks(){}const B5=({isDragging:t})=>t?"grabbing":"grab",rS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:ks,onResize:ks,onViewStateChange:ks,onInteractionStateChange:ks,onBeforeRender:ks,onAfterRender:ks,onLoad:ks,onError:t=>Re.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:B5,getTooltip:null,debug:!1,drawPickingColors:!1};class UA{constructor(e){w(this,"props",void 0),w(this,"width",0),w(this,"height",0),w(this,"userData",{}),w(this,"canvas",null),w(this,"viewManager",null),w(this,"layerManager",null),w(this,"effectManager",null),w(this,"deckRenderer",null),w(this,"deckPicker",null),w(this,"eventManager",null),w(this,"tooltip",null),w(this,"metrics",void 0),w(this,"animationLoop",void 0),w(this,"stats",void 0),w(this,"viewState",void 0),w(this,"cursorState",void 0),w(this,"_needsRedraw",void 0),w(this,"_pickRequest",void 0),w(this,"_lastPointerDownInfo",null),w(this,"_metricsCounter",void 0),w(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),w(this,"_onEvent",n=>{const i=A2[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,A=a&&(a[i.handler]||a.props[i.handler]),h=this.props[i.handler];let p=!1;A&&(p=A.call(a,o,n)),!p&&h&&h(o,n)}),w(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...rS,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Re.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Tx()==="IE"&&Re.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new sc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Ua.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var A;(A=this.canvas.parentElement)===null||A===void 0||A.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Re.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Re.removed("onLayerClick","onClick")(),e.initialViewState&&!mo(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ut(this.viewManager),this.viewManager.views}getViewports(e){return Ut(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){Ut(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ut(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var r;this.width=n,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:A,onAfterRender:h,useDevicePixels:p}=e;return new DD({width:n,height:i,useDevicePixels:p,autoResizeViewport:!1,gl:r,onCreateContext:m=>Gx({...s,...m,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:m=>this._setGLContext(m.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:A,onAfterRender:h,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new b_({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,n_(e,{enable:!0,copyState:!0})),this.tooltip=new XU(this.canvas),Cr(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new FC;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new M5(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in A2)this.eventManager.on(r,this._onEvent);this.viewManager=new cU({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new AU(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new OU,this.deckRenderer=new UU(e),this.deckPicker=new WU(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Cr(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Re.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Xs.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}w(UA,"defaultProps",rS);w(UA,"VERSION",V4.VERSION);class m0{constructor(e,n){w(this,"opts",void 0),w(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function L5(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function af(t){return t.stride||t.size*t.bytesPerElement}function sS(t,e){e.offset&&Re.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=af(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function R5(t,e){const n=sS(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class O5{constructor(e,n,i){w(this,"gl",void 0),w(this,"id",void 0),w(this,"size",void 0),w(this,"settings",void 0),w(this,"value",void 0),w(this,"doublePrecision",void 0),w(this,"_buffer",void 0),w(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&Lh(e,ht.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let A=L5(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(A=Float32Array),this.value=null,this.settings={...n,defaultType:A,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:A.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new ct(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*af(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ua.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=R5(this.getAccessor(),n||{});return i[e]=new m0(this,s.high),i["".concat(e,"64Low")]=r?new m0(this,s.low):new Float32Array(this.size),i}if(n){const i=sS(this.getAccessor(),n);return{[e]:new m0(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let A=0;A<s;)for(let h=0;h<r;h++){const p=n[A++];p<o[h]&&(o[h]=p),p>a[h]&&(a[h]=p)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ct?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=af(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=af(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=d0(s,r));const A=s.byteLength+a+r.stride*2;o.byteLength<A&&o.reallocate(A),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?d0(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=Ua.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?d0(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Re.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=r[0],n;switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const F2=[],D2=[];function Ts(t,e=0,n=1/0){let i=F2;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(D2.length=t.length,i=D2):i=F2,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function oS(t){return t&&t[Symbol.asyncIterator]}function aS(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,A=i?i/a:n,h=r?r/a:0,p=Math.floor((t.length-h)/A);return(m,{index:y,target:T})=>{if(!s){const S=y*A+h;for(let P=0;P<n;P++)T[P]=t[S+P];return T}const b=s[y],C=s[y+1]||p;let R;if(o){R=new Array(C-b);for(let S=b;S<C;S++){const P=S*A+h;T=new Array(n);for(let I=0;I<n;I++)T[I]=t[P+I];R[S-b]=T}}else if(A===n)R=t.subarray(b*n+h,C*n+h);else{R=new t.constructor((C-b)*n);let S=0;for(let P=b;P<C;P++){const I=P*A+h;for(let F=0;F<n;F++)R[S++]=t[I+F]}}return R}}const F5=[],lf=[[0,1/0]];function D5(t,e){if(t===lf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function _0(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,A=o-i;if(a>A){n.set(e.subarray(0,A),i);return}if(n.set(e,i),!s)return;let h=a;for(;h<A;){const p=s(h,e);for(let m=0;m<r;m++)n[i+h]=p[m]||0,h++}}function k5({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return _0({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const A=i&&((p,m)=>i(p+a,m)),h=Math.min(r.length,s.length);for(let p=1;p<h;p++){const m=r[p]*n,y=s[p]*n;_0({source:t.subarray(o,m),target:e,start:a,end:y,size:n,getData:A}),o=m,a=y}return a<e.length&&_0({source:[],target:e,start:a,size:n,getData:A}),e}const N5={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function lS(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...N5[n],...e,...t,type:n}}function AS(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function cS(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function uS(t){t.push(t.shift())}function C_(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function fS({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,A=n.byteOffset,h=n.startIndices,p=r&&h,m=C_(n,e),y=n.isConstant;if(!p&&i>=m)return;const T=y?n.value:n.getBuffer().getData({srcByteOffset:A});if(n.settings.normalized&&!y){const S=s;s=(P,I)=>n.normalizeConstant(S(P,I))}const b=y?(S,P)=>s(T,P):(S,P)=>s(T.subarray(S,S+a),P),C=t.getData({length:i}),R=new Float32Array(m);k5({source:C,target:R,sourceStartIndices:r,targetStartIndices:h,size:a,getData:b}),t.byteLength<R.byteLength+A&&t.reallocate(R.byteLength+A),t.subData({data:R,offset:A})}class S_ extends O5{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:lf}),w(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return lS(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=D5(this.state.updateRanges,[i,r])}else this.state.updateRanges=lf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=F5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==lf),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let A=!0;if(o){for(const[h,p]of s)o.call(r,this,{data:n,startRow:h,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,p]of s){const m=Number.isFinite(h)?this.getVertexOffset(h):0,y=Number.isFinite(p)?this.getVertexOffset(p):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:y})}this._checkAttributeArray()}else A=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),A}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ut(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=aS(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:A,value:h,size:p,startIndices:m}=e,{accessor:y,transform:T}=a,b=A.binaryAccessor||(typeof y=="function"?y:s[y]);Ut(typeof b=="function",'accessor "'.concat(y,'" is not a function'));let C=e.getVertexOffset(i);const{iterable:R,objectInfo:S}=Ts(n,i,r);for(const P of R){S.index++;let I=b(P,S);if(T&&(I=T.call(this,I)),m){const F=(S.index<m.length-1?m[S.index+1]:o)-m[S.index];if(I&&Array.isArray(I[0])){let j=C;for(const X of I)e._normalizeValue(X,h,j),j+=p}else I&&I.length>p?h.set(I,C):(e._normalizeValue(I,S.target,0),rU({target:h,source:S.target,start:C,count:F}));C+=F*p}else e._normalizeValue(I,h,C),C+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class U5{constructor({gl:e,attribute:n,timeline:i}){w(this,"gl",void 0),w(this,"type","interpolation"),w(this,"attributeInTransition",void 0),w(this,"settings",void 0),w(this,"attribute",void 0),w(this,"transition",void 0),w(this,"currentStartIndices",void 0),w(this,"currentLength",void 0),w(this,"transform",void 0),w(this,"buffers",void 0),this.gl=e,this.transition=new dc(i),this.attribute=n,this.attributeInTransition=new S_(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=z5(e,n);const r={byteLength:0,usage:35050};this.buffers=[new ct(e,r),new ct(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;uS(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)fS({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=C_(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:AS(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const G5=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function z5(t,e){const n=cS(e.size);return new E_(t,{vs:G5,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class V5{constructor({gl:e,attribute:n,timeline:i}){w(this,"gl",void 0),w(this,"type","spring"),w(this,"attributeInTransition",void 0),w(this,"settings",void 0),w(this,"attribute",void 0),w(this,"transition",void 0),w(this,"currentStartIndices",void 0),w(this,"currentLength",void 0),w(this,"texture",void 0),w(this,"framebuffer",void 0),w(this,"transform",void 0),w(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new dc(i),this.attribute=n,this.attributeInTransition=new S_(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=H5(e),this.framebuffer=W5(e,this.texture),this.transform=j5(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new ct(e,r),new ct(e,r),new ct(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)fS({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=C_(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:AS(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),uS(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),cc(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function j5(t,e,n){const i=cS(e.size);return new E_(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function H5(t){return new Gt(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function W5(t,e){return new kt(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const Q5={interpolation:U5,spring:V5};class X5{constructor(e,{id:n,timeline:i}){w(this,"id",void 0),w(this,"isSupported",void 0),w(this,"gl",void 0),w(this,"timeline",void 0),w(this,"transitions",void 0),w(this,"needsRedraw",void 0),w(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=E_.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);o&&this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){Re.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=Q5[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(Re.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const k2="attributeManager.invalidate",J5="attributeManager.updateStart",Y5="attributeManager.updateEnd",K5="attribute.updateStart",Z5="attribute.allocate",q5="attribute.updateEnd";class $5{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){w(this,"id",void 0),w(this,"gl",void 0),w(this,"attributes",void 0),w(this,"updateTriggers",void 0),w(this,"needsRedraw",void 0),w(this,"userData",void 0),w(this,"stats",void 0),w(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new X5(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);mn(k2,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);mn(k2,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let A=!1;mn(J5,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const p=this.attributes[h],m=p.settings.accessor;p.startIndices=i,p.numInstances=n,s[h]&&Re.removed("props.".concat(h),"data.attributes.".concat(h))(),p.setExternalBuffer(o[h])||p.setBinaryValue(typeof m=="string"?o[m]:void 0,e.startIndices)||typeof m=="string"&&!o[m]&&p.setConstantValue(s[m])||p.needsUpdate()&&(A=!0,this._updateAttribute({attribute:p,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}A&&mn(Y5,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new S_(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(mn(K5,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&mn(Z5,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,mn(q5,n,i))}}class eG extends dc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=Gi(n,i,o)}}const N2=1e-5;function U2(t,e,n,i,r){const s=e-t,a=(n-e)*r,A=-s*i;return a+A+s+e}function tG(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=U2(t[o],e[o],n[o],i,r);return s}return U2(t,e,n,i,r)}function G2(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class nG extends dc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=tG(s,o,n,i,r);const A=G2(a,n),h=G2(a,o);A<N2&&h<N2&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const iG={interpolation:eG,spring:nG};class rG{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const A=s.get(e),{value:h=A.settings.fromValue}=A;n=h,this.remove(e)}if(r=lS(r),!r)return;const o=iG[r.type];if(!o){Re.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function sG(t){const e=P_(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function oG(t,e){const n=hS({newProps:t,oldProps:e,propTypes:P_(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=lG(t,e);let r=!1;return i||(r=AG(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:cG(t,e),transitionsChanged:aG(t,e)}}function aG(t,e){if(!t.transitions)return!1;const n={},i=P_(t);let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Cg(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function hS({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=Cg(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=Cg(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function Cg(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function lG(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function AG(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&z2(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&z2(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function cG(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function z2(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},hS({oldProps:r,newProps:i,triggerName:n})}function P_(t){const e=t[Yf],n=e&&e.constructor;return n?n._propTypes:{}}const uG="count(): argument not an object",fG="count(): argument not a container";function hG(t){if(!pG(t))throw new Error(uG);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(dG(t))return Object.keys(t).length;throw new Error(fG)}function dG(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function pG(t){return t!==null&&typeof t=="object"}function Sg(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const gG={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Pg={};function mG(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof Gt)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const r=new Gt(n,{...e,parameters:{...gG,...i,...t.props.textureParameters}});return Pg[r.id]=!0,r}function _G(t){!t||!(t instanceof Gt)||Pg[t.id]&&(t.delete(),delete Pg[t.id])}const vG={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||GA(t)&&(t.length===3||t.length===4)},equal(t,e,n){return v0(t,e)}},accessor:{validate(t,e){const n=Zf(t);return n==="function"||n===Zf(e.value)},equal(t,e,n){return typeof e=="function"?!0:v0(t,e)}},array:{validate(t,e){return e.optional&&!t||GA(t)},equal(t,e,n){return n.compare?v0(t,e):t===e}},object:{equal(t,e,n){return n.compare?mo(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>mG(n,t),release:t=>{_G(t)}}};function v0(t,e){if(t===e)return!0;if(!GA(t)||!GA(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function yG(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=EG(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function EG(t,e){switch(Zf(e)){case"object":return Bl(t,e);case"array":return Bl(t,{type:"array",value:e,compare:!1});case"boolean":return Bl(t,{type:"boolean",value:e});case"number":return Bl(t,{type:"number",value:e});case"function":return Bl(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Bl(t,e){return"type"in e?{name:t,...vG[e.type],...e}:"value"in e?{name:t,type:Zf(e.value),...e}:{name:t,type:"object",value:e}}function GA(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Zf(t){return GA(t)?"array":t===null?"null":typeof t}function TG(t,e){const n=dS(t.constructor),i=Object.create(n);i[Yf]=t,i[oo]={},i[ts]={};for(let r=0;r<e.length;++r){const s=e[r];for(const o in s)i[o]=s[o]}return Object.freeze(i),i}function dS(t){const e=qf(t,"_mergedDefaultProps");return e||(wG(t),t._mergedDefaultProps)}function wG(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=dS(n),r=qf(t,"defaultProps")||{},s=yG(r),o=bG(s.defaultProps,i,t),a={...n._propTypes,...s.propTypes};CG(o,a);const A={...n._deprecatedProps,...s.deprecatedProps};xG(o,A),t._mergedDefaultProps=o,t._propTypes=a,t._deprecatedProps=A}function bG(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=PG(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function xG(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])pS(this,s)||(this[s]=i);Re.deprecated(r,e[n].join("/"))()}})}function CG(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=SG(o))}t[wa]=n,t[oo]={},Object.defineProperties(t,i)}function SG(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||oS(e)?this[oo][t]=e:this[ts][t]=e},get(){if(this[ts]){if(t in this[ts])return this[ts][t]||this[wa][t];if(t in this[oo]){const e=this[Yf]&&this[Yf].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[wa][t]}}return this[wa][t]}}}function pS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function qf(t,e){return pS(t,e)&&t[e]}function PG(t){const e=qf(t,"layerName")||qf(t,"componentName");return e||Re.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let IG=0;class I_{constructor(...e){w(this,"id",void 0),w(this,"props",void 0),w(this,"count",void 0),this.props=TG(this,e),this.id=this.props.id,this.count=IG++}clone(e){const{props:n}=this,i={};for(const r in n[wa])r in n[ts]?i[r]=n[ts][r]:r in n[oo]&&(i[r]=n[oo][r]);return new this.constructor({...n,...i,...e})}}w(I_,"componentName","Component");w(I_,"defaultProps",{});const MG=Object.freeze({});class BG{constructor(e){w(this,"component",void 0),w(this,"onAsyncPropUpdated",void 0),w(this,"asyncProps",void 0),w(this,"oldProps",void 0),w(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||MG}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[ts]||{},i=e[oo]||e,r=e[wa]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(oS(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s)}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){const{dataTransform:A}=this.component.props;A?s=A(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class LG extends BG{constructor({attributeManager:e,layer:n}){super(n),w(this,"attributeManager",void 0),w(this,"needsRedraw",void 0),w(this,"needsUpdate",void 0),w(this,"subLayers",void 0),w(this,"usesPickingColorCache",void 0),w(this,"changeFlags",void 0),w(this,"viewport",void 0),w(this,"uniformTransitions",void 0),w(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const i=this.component.props.fetch;return i?i(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const i=this.component.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const RG="layer.changeFlag",OG="layer.initialize",FG="layer.update",DG="layer.finalize",kG="layer.matched",V2=2**24-1,NG=Object.freeze([]),UG=Ya(({oldViewport:t,viewport:e})=>t.equals(e));let qi=new Uint8ClampedArray(0);const GG={data:{type:"data",value:NG,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let A=o.contains(t);return!A&&!r&&(o.add({resourceId:t,data:xr(t,i),persistent:!1}),A=!0),A?o.subscribe({resourceId:t,onChange:h=>{var p;return(p=n.internalState)===null||p===void 0?void 0:p.reloadAsyncProp(e,h)},consumerId:n.id,requestId:e}):xr(t,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:hc.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:De.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Mn extends I_{constructor(...e){super(...e),w(this,"internalState",null),w(this,"lifecycle",Qo.NO_STATE),w(this,"context",void 0),w(this,"state",void 0),w(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ut(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=XC(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=jC(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Ut(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ut(this.internalState);const i=this.internalState.viewport||this.context.viewport;return iU(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===De.DEFAULT||e===De.LNGLAT||e===De.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ut(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:hG(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:i,instancePositions:r}=n.attributes;return(e=i||r)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=Sg(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const A of i)n.invalidateAll(A);else n.invalidateAll();const{props:r,oldProps:s}=e,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable,a=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(o!==a&&n){const{pickingColors:A,instancePickingColors:h}=n.attributes,p=A||h;p&&(a&&p.constant&&(p.constant=!1,n.invalidate(p.id)),!p.value&&!a&&(p.constant=!0,p.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!UG({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(qi.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>V2&&Re.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qi=Ua.allocate(qi,n,{size:3,copy:!0,maxCount:Math.max(n,V2)});const r=Math.floor(qi.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),qi[o*3+0]=s[0],qi[o*3+1]=s[1],qi[o*3+2]=s[2]}e.value=qi.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==qi.buffer&&(i.value=qi.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ut(!this.internalState),Ut(Number.isFinite(this.props.coordinateSystem)),mn(OG,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new LG({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Re.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new rG(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){mn(kG,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(mn(FG,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),A=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const p of this.props.extensions)p.updateState.call(this,a,p);const h=this.getModels()[0]!==A[0];this._postUpdate(a,h)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){mn(DG,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,A=a&&a(n)||[0,0];Cr(s.gl,{polygonOffset:A}),_i(s.gl,i,()=>{const h={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&mn(RG,this,r,e)}const i=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=oG(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){sG(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new $5(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:A}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==A){const h={};o||(h.pickingSelectedColor=null),Array.isArray(A)&&(h.pickingHighlightColor=A),(n||a!==r.highlightedObjectIndex)&&(h.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(h)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;return n=n||r,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}w(Mn,"defaultProps",GG);w(Mn,"layerName","Layer");const zG="compositeLayer.renderLayers";class Lr extends Mn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:A,autoHighlight:h,highlightColor:p,coordinateSystem:m,coordinateOrigin:y,wrapLongitude:T,positionFormat:b,modelMatrix:C,extensions:R,fetch:S,operation:P,_subLayerProps:I}=this.props,F={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:A,autoHighlight:h,highlightColor:p,coordinateSystem:m,coordinateOrigin:y,wrapLongitude:T,positionFormat:b,modelMatrix:C,extensions:R,fetch:S,operation:P},j=I&&e.id&&I[e.id],X=j&&j.updateTriggers,q=e.id||"sublayer";if(j){const ee=this.constructor._propTypes,Q=e.type?e.type._propTypes:{};for(const V in j){const D=Q[V]||ee[V];D&&D.type==="accessor"&&(j[V]=this.getSubLayerAccessor(j[V]))}}Object.assign(F,e,j),F.id="".concat(this.props.id,"-").concat(q),F.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...X};for(const ee of R){const Q=ee.getSubLayerProps.call(this,ee);Q&&Object.assign(F,Q,{updateTriggers:Object.assign(F.updateTriggers,Q.updateTriggers)})}return F}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=ao(s,Boolean),this.internalState.subLayers=i}mn(zG,this,r,i);for(const s of i)s.parent=this}}w(Lr,"layerName","CompositeLayer");const _u=Math.PI/180,j2=180/Math.PI,Af=6370972,la=256;function VG(){const t=la/Af,e=Math.PI/180*la;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class jG extends Es{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:A,altitude:h=1.5}=e;A=A||1,h=Math.max(.75,h);const p=new Ue().lookAt({eye:[0,-h,0],up:[0,0,1]}),m=Math.pow(2,r);p.rotateX(n*_u),p.rotateZ(-i*_u),p.scale(m/A);const y=Math.atan(.5/h),T=la*2*m/A;super({...e,height:A,viewMatrix:p,longitude:i,latitude:n,zoom:r,distanceScales:VG(),fovyRadians:y*2,focalDistance:h,near:s,far:Math.min(2,1/T+1)*h*o}),w(this,"longitude",void 0),w(this,"latitude",void 0),w(this,"resolution",void 0),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return Fi.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:A}=this;let h;if(Number.isFinite(o))h=y0(A,[r,a,o,1]);else{const T=y0(A,[r,a,-1,1]),b=y0(A,[r,a,1,1]),C=((i||0)/Af+1)*la,R=l0(wC([],T,b)),S=l0(T),P=l0(b),F=4*((4*S*P-(R-S-P)**2)/16)/R,j=Math.sqrt(S-F),X=Math.sqrt(Math.max(0,C*C-F)),q=(j-X)/Math.sqrt(R);h=$6([],T,b,q)}const[p,m,y]=this.unprojectPosition(h);return Number.isFinite(o)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[n,i,r=0]=e,s=n*_u,o=i*_u,a=Math.cos(o),A=(r/Af+1)*la;return[Math.sin(s)*a*A,-Math.cos(s)*a*A,Math.sin(o)*A]}unprojectPosition(e){const[n,i,r]=e,s=bC(e),o=Math.asin(r/s),A=Math.atan2(n,-i)*j2,h=o*j2,p=(s/la-1)*Af;return[A,h,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function y0(t,e){const n=Ja([],e,t);return m_(n,n,1/n[3]),n}class ws{constructor(e){w(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&mo(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,i={updateTriggers:{}};for(const r in n)if(r in this.props){const s=n[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(e,n){}updateState(e,n){}draw(e,n){}finalizeState(e,n){}}w(ws,"defaultProps",{});class gS{constructor(e){w(this,"opts",void 0),w(this,"typedArrayManager",void 0),w(this,"indexStarts",[0]),w(this,"vertexStarts",[0]),w(this,"vertexCount",0),w(this,"instanceCount",0),w(this,"attributes",void 0),w(this,"_attributeDefs",void 0),w(this,"data",void 0),w(this,"getGeometry",void 0),w(this,"geometryBuffer",void 0),w(this,"buffers",void 0),w(this,"positionSize",void 0),w(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Ua,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:A=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=A,s&&(Ut(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),A||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const h of a)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?aS(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const A=s[a];A.copy=n,i[a]=o.allocate(i[a],e,A)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=Ts(r,n,i);for(const A of o){a.index++;const h=s?s(A,a):null;e(h,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:A=1/0}=e||{},h={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((m,y)=>{const T=m&&this.normalizeGeometry(m);h[y]=T,i[y+1]=i[y]+(T?this.getGeometrySize(T):0)},a,A),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof ct){const m=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/m}else if(o.buffer){const m=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/m}else if(o.value){const m=o.value,y=o.stride/m.BYTES_PER_ELEMENT||this.positionSize;r=r||m.length/y}this._allocate(r,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const p={};this._forEachGeometry((m,y)=>{const T=h[y]||m;p.vertexStart=i[y],p.indexStart=n[y];const b=y<i.length-1?i[y+1]:r;p.geometrySize=b-i[y],p.geometryIndex=y,this.updateGeometryAttributes(T,p)},a,A),this.vertexCount=n[n.length-1]}}const HG=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
  // d: distance on the xy plane
  // r: ratio of the current point
  // p: ratio of the peak of the arc
  // h: height multiplier
  // z = f(r) = sqrt(r * (p * 2 - r)) * d * h
  // f(0) = 0
  // f(1) = dz

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;

  // sqrt does not deal with negative values, manually flip source and target if delta.z < 0
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}

/* Great circle interpolation
 * http://www.movable-type.co.uk/scripts/latlong.html
 */
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;

  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

/* END GREAT CIRCLE */

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));

  // if it's the first point, use next - current as direction
  // otherwise use current - prev
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      // split at the 180th meridian
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);

    // common x at longitude=-180
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }

  // Multiply out width and clamp to limits
  // mercator pixels are interpreted as screen pixels
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,WG=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,$f=[0,0,0,255],QG={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:$f},getTargetColor:{type:"accessor",value:$f},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class M_ extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){return super.getShaders({vs:HG,fs:WG,modules:[Ei,Ti]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:$f},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:$f},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:o,widthUnits:ri[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(e){let n=[];for(let s=0;s<50;s++)n=n.concat([s,1,0,s,-1,0]);const r=new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0});return r.setUniforms({numSegments:50}),r}}w(M_,"layerName","ArcLayer");w(M_,"defaultProps",QG);const XG=new Uint16Array([0,2,1,0,3,2]),JG=new Float32Array([0,1,0,0,1,0,1,1]);function YG(t,e){if(!e)return KG(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),r=Math.ceil(n/e)+1,s=Math.ceil(i/e)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),A=new Float32Array(r*s*2),h=new Float64Array(r*s*3);let p=0,m=0;for(let y=0;y<r;y++){const T=y/(r-1);for(let b=0;b<s;b++){const C=b/(s-1),R=ZG(t,T,C);h[p*3+0]=R[0],h[p*3+1]=R[1],h[p*3+2]=R[2]||0,A[p*2+0]=T,A[p*2+1]=1-C,y>0&&b>0&&(a[m++]=p-s,a[m++]=p-s-1,a[m++]=p-1,a[m++]=p-s,a[m++]=p-1,a[m++]=p),p++}}return{vertexCount:o,positions:h,indices:a,texCoords:A}}function KG(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:XG,texCoords:JG}}function ZG(t,e,n){return Gi(Gi(t[0],t[1],n),Gi(t[3],t[2],n),e)}const qG=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,$G=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,ez=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat($G,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`),tz={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:De.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class mS extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){return super.getShaders({vs:qG,fs:ez,modules:[Ei,Ti]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState({props:e,oldProps:n,changeFlags:i}){const r=this.getAttributeManager();if(i.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),r.invalidateAll()}if(e.bounds!==n.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const A in a)o&&o[A]!==a[A]&&r.invalidate(A);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:n}=this.props,i=e.info;if(!i.color||!n)return i.bitmap=null,i;const{width:r,height:s}=n;i.index=0;const o=nz(i.color),a=[Math.floor(o[0]*r),Math.floor(o[1]*s)];return i.bitmap={size:{width:r,height:s},uv:o,pixel:a},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return H2(e)&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),YG(n,this.context.viewport.resolution)}_getModel(e){return e?new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:r,coordinateConversion:s,bounds:o,disablePicking:a}=this.state,{image:A,desaturate:h,transparentColor:p,tintColor:m}=this.props;i.pickingActive&&a||A&&r&&r.setUniforms(n).setUniforms({bitmapTexture:A,desaturate:h,transparentColor:p.map(y=>y/255),tintColor:m.slice(0,3).map(y=>y/255),coordinateConversion:s,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=De;let{_imageCoordinateSystem:r}=this.props;if(r!==i){const{bounds:s}=this.props;if(!H2(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(r=r===e?e:n,r===e&&o===n)return{coordinateConversion:-1,bounds:s};if(r===n&&o===e){const a=ps([s[0],s[1]]),A=ps([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],A[0],A[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}w(mS,"layerName","BitmapLayer");w(mS,"defaultProps",tz);function nz(t){const[e,n,i]=t,r=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(n+r)/256]}function H2(t){return Number.isFinite(t[0])}const iz=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,rz=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,sz=1024,oz=4,W2=()=>{},Q2={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function az(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function lz(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function zA(t){return t&&(t.id||t.url)}function Az(t,e,n,i){const r=t.width,s=t.height,o=new Gt(t.gl,{width:e,height:n,parameters:i});return AF(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function X2(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=zA(r);t[o]={...r,x:s,y:n}}}function cz({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let A=0;A<t.length;A++){const h=t[A],p=zA(h);if(!n[p]){const{height:m,width:y}=h;i+y+e>o&&(X2(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:h,xOffset:i}),i=i+y+e,s=Math.max(s,m)}}return a.length>0&&X2(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:az(s+r+e)}}function uz(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Ts(t);for(const o of r){s.index++;const a=e(o,s),A=zA(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[A]&&(!n[A]||a.url!==n[A].url)&&(i[A]={...a,source:o,sourceIndex:s.index})}return i}class fz{constructor(e,{onUpdate:n=W2,onError:i=W2}){w(this,"gl",void 0),w(this,"onUpdate",void 0),w(this,"onError",void 0),w(this,"_loadOptions",null),w(this,"_texture",null),w(this,"_externalTexture",null),w(this,"_mapping",{}),w(this,"_textureParameters",null),w(this,"_pendingCount",0),w(this,"_autoPacking",!1),w(this,"_xOffset",0),w(this,"_yOffset",0),w(this,"_rowHeight",0),w(this,"_buffer",oz),w(this,"_canvasWidth",sz),w(this,"_canvasHeight",0),w(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?zA(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=i}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(uz(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:A}=cz({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=A,this._texture||(this._texture=new Gt(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Q2})),this._texture.height!==this._canvasHeight&&(this._texture=Az(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Q2)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,xr(i.url,$m,this._loadOptions).then(r=>{const s=zA(i),{x:o,y:a,width:A,height:h}=this._mapping[s],p=lz(n,r,A,h);this._texture.setSubImageData({data:p,x:o,y:a,width:A,height:h}),this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const _S=[0,0,0,255],hz={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:_S},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class Dh extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){return super.getShaders({vs:iz,fs:rz,modules:[Ei,Ti]})}initializeState(){this.state={iconManager:new fz(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:_S},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:A,getIcon:h,textureParameters:p}=n,{iconManager:m}=this.state,y=o||this.internalState.isAsyncPropLoading("iconAtlas");if(m.setProps({loadOptions:n.loadOptions,autoPacking:!y,iconAtlas:o,iconMapping:y?a:null,textureParameters:p}),y?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&m.packIcons(A,h),r.extensionsChanged){var T;const{gl:b}=this.context;(T=this.state.model)===null||T===void 0||T.delete(),this.state.model=this._getModel(b),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:A}=this.state,h=A.getTexture();h&&this.state.model.setUniforms(e).setUniforms({iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:ri[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):Re.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}w(Dh,"defaultProps",hz);w(Dh,"layerName","IconLayer");const dz=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      // Line is not split, abort
      gl_Position = vec4(0.);
      return;
    }
  }

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Multiply out width and clamp to limits
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pz=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,gz=[0,0,0,255],mz={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:gz},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class vS extends Mn{getShaders(){return super.getShaders({vs:dz,fs:pz,modules:[Ei,Ti]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:ri[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}w(vS,"layerName","LineLayer");w(vS,"defaultProps",mz);const _z=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  // Find the center of the point and add the current vertex
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply lighting
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vz=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,yS=[0,0,0,255],ES=[0,0,1],yz={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:ES},getColor:{type:"accessor",value:yS},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Ez(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class B_ extends Mn{getShaders(){return super.getShaders({vs:_z,fs:vz,modules:[Ei,v_,Ti]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ES},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:yS}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:s}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&Ez(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ri[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}w(B_,"layerName","PointCloudLayer");w(B_,"defaultProps",yz);const Tz=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,wz=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,J2=[0,0,0,255],bz={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:J2},getLineColor:{type:"accessor",value:J2},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class L_ extends Mn{getShaders(){return super.getShaders({vs:Tz,fs:wz,modules:[Ei,Ti]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:A,antialiasing:h,lineWidthUnits:p,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:T}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:A,antialiasing:h,radiusUnits:ri[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:ri[p],lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:T}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}w(L_,"defaultProps",bz);w(L_,"layerName","ScatterplotLayer");const R_={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function O_(t,e,n={}){return xz(t,n)!==e?(Cz(t,n),!0):!1}function xz(t,e={}){return Math.sign(eh(t,e))}function eh(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function Cz(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const A=n+a*r,h=n+(s-1-a)*r;for(let p=0;p<r;++p){const m=t[A+p];t[A+p]=t[h+p],t[h+p]=m}}}function Sz(t,e,n=2,i){const r=e&&e.length,s=r?e[0]*n:t.length;let o=TS(t,0,s,n,!0,i&&i[0]);const a=[];if(!o||o.next===o.prev)return a;let A,h,p,m,y,T,b;if(r&&(o=Lz(t,e,o,n,i)),t.length>80*n){m=h=t[0],y=p=t[1];for(let C=n;C<s;C+=n)T=t[C],b=t[C+1],T<m&&(m=T),b<y&&(y=b),T>h&&(h=T),b>p&&(p=b);A=Math.max(h-m,p-y),A=A!==0?1/A:0}return VA(o,a,n,m,y,A),a}function TS(t,e,n,i,r,s){let o,a;if(s===void 0&&(s=eh(t,{start:e,end:n,size:i})),r===s<0)for(o=e;o<n;o+=i)a=Y2(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=Y2(o,t[o],t[o+1],a);return a&&kh(a,a.next)&&(HA(a),a=a.next),a}function ms(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(kh(n,n.next)||St(n.prev,n,n.next)===0)){if(HA(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function VA(t,e,n,i,r,s,o){if(!t)return;!o&&s&&kz(t,i,r,s);let a=t,A,h;for(;t.prev!==t.next;){if(A=t.prev,h=t.next,s?Iz(t,i,r,s):Pz(t)){e.push(A.i/n),e.push(t.i/n),e.push(h.i/n),HA(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=Mz(ms(t),e,n),VA(t,e,n,i,r,s,2)):o===2&&Bz(t,e,n,i,r,s):VA(ms(t),e,n,i,r,s,1);break}}}function Pz(t){const e=t.prev,n=t,i=t.next;if(St(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Aa(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&St(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Iz(t,e,n,i){const r=t.prev,s=t,o=t.next;if(St(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,A=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,h=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,p=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,m=Ig(a,A,e,n,i),y=Ig(h,p,e,n,i);let T=t.prevZ,b=t.nextZ;for(;T&&T.z>=m&&b&&b.z<=y;){if(T!==t.prev&&T!==t.next&&Aa(r.x,r.y,s.x,s.y,o.x,o.y,T.x,T.y)&&St(T.prev,T,T.next)>=0||(T=T.prevZ,b!==t.prev&&b!==t.next&&Aa(r.x,r.y,s.x,s.y,o.x,o.y,b.x,b.y)&&St(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;T&&T.z>=m;){if(T!==t.prev&&T!==t.next&&Aa(r.x,r.y,s.x,s.y,o.x,o.y,T.x,T.y)&&St(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;b&&b.z<=y;){if(b!==t.prev&&b!==t.next&&Aa(r.x,r.y,s.x,s.y,o.x,o.y,b.x,b.y)&&St(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Mz(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!kh(r,s)&&wS(r,i,i.next,s)&&jA(r,s)&&jA(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),HA(i),HA(i.next),i=t=s),i=i.next}while(i!==t);return ms(i)}function Bz(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Gz(o,a)){let A=bS(o,a);o=ms(o,o.next),A=ms(A,A.next),VA(o,e,n,i,r,s),VA(A,e,n,i,r,s);return}a=a.next}o=o.next}while(o!==t)}function Lz(t,e,n,i,r){const s=[];let o,a,A,h,p;for(o=0,a=e.length;o<a;o++)A=e[o]*i,h=o<a-1?e[o+1]*i:t.length,p=TS(t,A,h,i,!1,r&&r[o+1]),p===p.next&&(p.steiner=!0),s.push(Uz(p));for(s.sort(Rz),o=0;o<s.length;o++)Oz(s[o],n),n=ms(n,n.next);return n}function Rz(t,e){return t.x-e.x}function Oz(t,e){if(e=Fz(t,e),e){const n=bS(e,t);ms(e,e.next),ms(n,n.next)}}function Fz(t,e){let n=e;const i=t.x,r=t.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const y=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(y<=i&&y>s){if(s=y,y===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===s)return o;const a=o,A=o.x,h=o.y;let p=1/0,m;n=o;do i>=n.x&&n.x>=A&&i!==n.x&&Aa(r<h?i:s,r,A,h,r<h?s:i,r,n.x,n.y)&&(m=Math.abs(r-n.y)/(i-n.x),jA(n,t)&&(m<p||m===p&&(n.x>o.x||n.x===o.x&&Dz(o,n)))&&(o=n,p=m)),n=n.next;while(n!==a);return o}function Dz(t,e){return St(t.prev,t,e.prev)<0&&St(e.next,t,t.next)<0}function kz(t,e,n,i){let r=t;do r.z===null&&(r.z=Ig(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Nz(r)}function Nz(t){let e,n,i=1,r,s,o,a,A,h;do{for(s=t,t=null,h=null,r=0;s;){for(r++,a=s,o=0,n=0;n<i&&(o++,a=a.nextZ,!!a);n++);for(A=i;o>0||A>0&&a;)o!==0&&(A===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,A--),h?h.nextZ=e:t=e,e.prevZ=h,h=e;s=a}h.nextZ=null,i*=2}while(r>1);return t}function Ig(t,e,n,i,r){return t=32767*(t-n)*r,e=32767*(e-i)*r,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Uz(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Aa(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function Gz(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!zz(t,e)&&(jA(t,e)&&jA(e,t)&&Vz(t,e)&&(St(t.prev,t,e.prev)||St(t,e.prev,e))||kh(t,e)&&St(t.prev,t,t.next)>0&&St(e.prev,e,e.next)>0)}function St(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function kh(t,e){return t.x===e.x&&t.y===e.y}function wS(t,e,n,i){const r=yu(St(t,e,n)),s=yu(St(t,e,i)),o=yu(St(n,i,t)),a=yu(St(n,i,e));return!!(r!==s&&o!==a||r===0&&vu(t,n,e)||s===0&&vu(t,i,e)||o===0&&vu(n,t,i)||a===0&&vu(n,e,i))}function vu(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function yu(t){return t>0?1:t<0?-1:0}function zz(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&wS(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function jA(t,e){return St(t.prev,t,t.next)<0?St(t,e,t.next)>=0&&St(t,t.prev,e)>=0:St(t,e,t.prev)<0||St(t,t.next,e)<0}function Vz(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function bS(t,e){const n=new Mg(t.i,t.x,t.y),i=new Mg(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Y2(t,e,n,i){const r=new Mg(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function HA(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Mg(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ki(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Bg(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function WA(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Lg(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function cf(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function xS(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},A=(a-o)/n;let h=[];const p=[h],m=WA(t,0,n,o);let y,T;const b=SS(m,r,s,[]),C=[];ki(h,m);for(let R=1;R<A;R++){for(y=WA(t,R,n,o,y),T=cf(y,b);T;){Lg(m,y,T,b,C);const S=cf(C,b);S&&(Lg(m,C,S,b,C),T=S),ki(h,C),Bg(m,C),Hz(b,r,T),i&&h.length>n&&(h=[],p.push(h),ki(h,m)),T=cf(y,b)}ki(h,y),Bg(m,y)}return i?p:p[0]}const K2=0,jz=1;function Eu(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function CS(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],A=[{pos:t,types:o?new Array(t.length/i).fill(jz):null,holes:e||[]}],h=[[],[]];let p=[];for(;A.length;){const{pos:m,types:y,holes:T}=A.shift();Wz(m,i,T[0]||m.length,h),p=SS(h[0],r,s,p);const b=cf(h[1],p);if(b){let C=Z2(m,y,i,0,T[0]||m.length,p,b);const R={pos:C[0].pos,types:C[0].types,holes:[]},S={pos:C[1].pos,types:C[1].types,holes:[]};A.push(R,S);for(let P=0;P<T.length;P++)C=Z2(m,y,i,T[P],T[P+1]||m.length,p,b),C[0]&&(R.holes.push(R.pos.length),R.pos=Eu(R.pos,C[0].pos),o&&(R.types=Eu(R.types,C[0].types))),C[1]&&(S.holes.push(S.pos.length),S.pos=Eu(S.pos,C[1].pos),o&&(S.types=Eu(S.types,C[1].types)))}else{const C={positions:m};o&&(C.edgeTypes=y),T.length&&(C.holeIndices=T),a.push(C)}}return a}function Z2(t,e,n,i,r,s,o){const a=(r-i)/n,A=[],h=[],p=[],m=[],y=[];let T,b,C;const R=WA(t,a-1,n,i);let S=Math.sign(o&8?R[1]-s[3]:R[0]-s[2]),P=e&&e[a-1],I=0,F=0;for(let j=0;j<a;j++)T=WA(t,j,n,i,T),b=Math.sign(o&8?T[1]-s[3]:T[0]-s[2]),C=e&&e[i/n+j],b&&S&&S!==b&&(Lg(R,T,o,s,y),ki(A,y)&&p.push(P),ki(h,y)&&m.push(P)),b<=0?(ki(A,T)&&p.push(C),I-=b):p.length&&(p[p.length-1]=K2),b>=0?(ki(h,T)&&m.push(C),F+=b):m.length&&(m[m.length-1]=K2),Bg(R,T),S=b,P=C;return[I?{pos:A,types:e&&p}:null,F?{pos:h,types:e&&m}:null]}function SS(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function Hz(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function Wz(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let A=0;A<n;A+=e){const h=t[A],p=t[A+1];r=h<r?h:r,s=h>s?h:s,o=p<o?p:o,a=p>a?p:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const Qz=85.051129;function Xz(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);PS(o,n,0,r-i);const a=xS(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const A of a)IS(A,n);return a}function Jz(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let A=0,h=0;for(let m=0;m<=e.length;m++){const y=e[m]||t.length,T=h,b=Yz(t,i,A,y);for(let C=b;C<y;C++)o[h++]=t[C];for(let C=A;C<b;C++)o[h++]=t[C];PS(o,i,T,h),Kz(o,i,T,h,n==null?void 0:n.maxLatitude),A=y,a[m]=h}a.pop();const p=CS(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const m of p)IS(m.positions,i);return p}function Yz(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function Kz(t,e,n,i,r=Qz){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=WA(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,ki(t,a),a[1]=Math.sign(a[1])*r,ki(t,a),a[0]=s,ki(t,a)}}function PS(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function IS(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}class Zz extends Sn{constructor(e){const{id:n=ji("column-geometry")}=e,{indices:i,attributes:r}=qz(e);super({...e,id:n,indices:i,attributes:r})}}function qz(t){const{radius:e,height:n=1,nradial:i=10}=t;let{vertices:r}=t;r&&(Re.assert(r.length>=i),r=r.flatMap(T=>[T[0],T[1]]),O_(r,R_.COUNTER_CLOCKWISE));const s=n>0,o=i+1,a=s?o*3+1:i,A=Math.PI*2/i,h=new Uint16Array(s?i*3*2:0),p=new Float32Array(a*3),m=new Float32Array(a*3);let y=0;if(s){for(let T=0;T<o;T++){const b=T*A,C=T%i,R=Math.sin(b),S=Math.cos(b);for(let P=0;P<2;P++)p[y+0]=r?r[C*2]:S*e,p[y+1]=r?r[C*2+1]:R*e,p[y+2]=(1/2-P)*n,m[y+0]=r?r[C*2]:S,m[y+1]=r?r[C*2+1]:R,y+=3}p[y+0]=p[y-3],p[y+1]=p[y-2],p[y+2]=p[y-1],y+=3}for(let T=s?0:1;T<o;T++){const b=Math.floor(T/2)*Math.sign(.5-T%2),C=b*A,R=(b+i)%i,S=Math.sin(C),P=Math.cos(C);p[y+0]=r?r[R*2]:P*e,p[y+1]=r?r[R*2+1]:S*e,p[y+2]=n/2,m[y+2]=1,y+=3}if(s){let T=0;for(let b=0;b<i;b++)h[T++]=b*2+0,h[T++]=b*2+2,h[T++]=b*2+0,h[T++]=b*2+1,h[T++]=b*2+1,h[T++]=b*2+3}return{indices:h,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:m}}}}const $z=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;

// Custom uniforms
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;

// Result
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  // rotate primitive position and normal
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));

  // calculate elevation, if 3d not enabled set to 0
  // cylindar gemoetry height are between -1.0 to 1.0, transform it to between 0, 1
  float elevation = 0.0;
  // calculate stroke offset
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }

  // if alpha == 0.0 or z < 0.0, do not render element
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;

  // project center of column
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Light calculations
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,e9=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,th=[0,0,0,255],t9={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:th},getLineColor:{type:"accessor",value:th},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Nh extends Mn{getShaders(){const{gl:e}=this.context,n=!He(e),i={},r=this.props.flatShading&&Lh(e,ht.GLSL_DERIVATIVES);return r&&(i.FLAT_SHADING=1),super.getShaders({vs:$z,fs:e9,defines:i,transpileToGLSL100:n,modules:[Ei,r?OC:v_,Ti]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:th},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:th},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=r.extensionsChanged||n.flatShading!==i.flatShading;if(s){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(s||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices||(n.extruded||n.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(n)}getGeometry(e,n,i){const r=new Zz({radius:1,height:i?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o],A=Math.sqrt(a[0]*a[0]+a[1]*a[1]);s+=A/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),r}_getModel(e){return new cn(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:i,stroked:r}){const s=this.getGeometry(e,n,i||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:A,filled:h,stroked:p,wireframe:m,offset:y,coverage:T,radius:b,angle:C}=this.props,{model:R,fillVertexCount:S,wireframeVertexCount:P,edgeDistance:I}=this.state;R.setUniforms(e).setUniforms({radius:b,angle:C/180*Math.PI,offset:y,extruded:A,stroked:p,coverage:T,elevationScale:a,edgeDistance:I,radiusUnits:ri[o],widthUnits:ri[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s}),A&&m&&(R.setProps({isIndexed:!0}),R.setVertexCount(P).setDrawMode(1).setUniforms({isStroke:!0}).draw()),h&&(R.setProps({isIndexed:!1}),R.setVertexCount(S).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!A&&p&&(R.setProps({isIndexed:!1}),R.setVertexCount(S*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}w(Nh,"layerName","ColumnLayer");w(Nh,"defaultProps",t9);const n9={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class MS extends Nh{getGeometry(e){return new VN}draw({uniforms:e}){const{elevationScale:n,extruded:i,offset:r,coverage:s,cellSize:o,angle:a,radiusUnits:A}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:ri[A],angle:a,offset:r,extruded:i,coverage:s,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}w(MS,"layerName","GridCellLayer");w(MS,"defaultProps",n9);function i9(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?xS(r,{size:e,gridResolution:n}):i?Xz(r,{size:e}):r}const r9=1,s9=2,E0=4;class o9 extends gS{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?i9(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(q2(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&q2(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=E0,i[s+o-2]=E0):(i[s]+=r9,i[s+o-2]+=s9),i[s+o-1]=E0}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,A=0;A<s;a++,A++)this.getPointOnPath(e,A,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function q2(t){return Array.isArray(t[0])}const a9=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,l9=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,BS=[0,0,0,255],A9={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:BS},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},T0={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class pc extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){return super.getShaders({vs:a9,fs:l9,modules:[Ei,Ti]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:T0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:T0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:T0,defaultValue:BS},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new o9({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,A=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:A.getPath,buffers:A,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:A,widthMaxPixels:h}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ri[o],widthScale:a,miterLimit:s,widthMinPixels:A,widthMaxPixels:h}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}w(pc,"defaultProps",A9);w(pc,"layerName","PathLayer");var nh={},c9={get exports(){return nh},set exports(t){nh=t}};c9.exports=Uh;nh.default=Uh;function Uh(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=LS(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,A,h,p,m,y,T;if(i&&(s=p9(t,e,s,n)),t.length>80*n){a=h=t[0],A=p=t[1];for(var b=n;b<r;b+=n)m=t[b],y=t[b+1],m<a&&(a=m),y<A&&(A=y),m>h&&(h=m),y>p&&(p=y);T=Math.max(h-a,p-A),T=T!==0?32767/T:0}return QA(s,o,n,a,A,T,0),o}function LS(t,e,n,i,r){var s,o;if(r===Fg(t,e,n,i)>0)for(s=e;s<n;s+=i)o=$2(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=$2(s,t[s],t[s+1],o);return o&&Gh(o,o.next)&&(JA(o),o=o.next),o}function Ao(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Gh(n,n.next)||Pt(n.prev,n,n.next)===0)){if(JA(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function QA(t,e,n,i,r,s,o){if(t){!o&&s&&y9(t,i,r,s);for(var a=t,A,h;t.prev!==t.next;){if(A=t.prev,h=t.next,s?f9(t,i,r,s):u9(t)){e.push(A.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),JA(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=h9(Ao(t),e,n),QA(t,e,n,i,r,s,2)):o===2&&d9(t,e,n,i,r,s):QA(Ao(t),e,n,i,r,s,1);break}}}}function u9(t){var e=t.prev,n=t,i=t.next;if(Pt(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,A=n.y,h=i.y,p=r<s?r<o?r:o:s<o?s:o,m=a<A?a<h?a:h:A<h?A:h,y=r>s?r>o?r:o:s>o?s:o,T=a>A?a>h?a:h:A>h?A:h,b=i.next;b!==e;){if(b.x>=p&&b.x<=y&&b.y>=m&&b.y<=T&&ca(r,a,s,A,o,h,b.x,b.y)&&Pt(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function f9(t,e,n,i){var r=t.prev,s=t,o=t.next;if(Pt(r,s,o)>=0)return!1;for(var a=r.x,A=s.x,h=o.x,p=r.y,m=s.y,y=o.y,T=a<A?a<h?a:h:A<h?A:h,b=p<m?p<y?p:y:m<y?m:y,C=a>A?a>h?a:h:A>h?A:h,R=p>m?p>y?p:y:m>y?m:y,S=Rg(T,b,e,n,i),P=Rg(C,R,e,n,i),I=t.prevZ,F=t.nextZ;I&&I.z>=S&&F&&F.z<=P;){if(I.x>=T&&I.x<=C&&I.y>=b&&I.y<=R&&I!==r&&I!==o&&ca(a,p,A,m,h,y,I.x,I.y)&&Pt(I.prev,I,I.next)>=0||(I=I.prevZ,F.x>=T&&F.x<=C&&F.y>=b&&F.y<=R&&F!==r&&F!==o&&ca(a,p,A,m,h,y,F.x,F.y)&&Pt(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;I&&I.z>=S;){if(I.x>=T&&I.x<=C&&I.y>=b&&I.y<=R&&I!==r&&I!==o&&ca(a,p,A,m,h,y,I.x,I.y)&&Pt(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;F&&F.z<=P;){if(F.x>=T&&F.x<=C&&F.y>=b&&F.y<=R&&F!==r&&F!==o&&ca(a,p,A,m,h,y,F.x,F.y)&&Pt(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function h9(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!Gh(r,s)&&RS(r,i,i.next,s)&&XA(r,s)&&XA(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),JA(i),JA(i.next),i=t=s),i=i.next}while(i!==t);return Ao(i)}function d9(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&w9(o,a)){var A=OS(o,a);o=Ao(o,o.next),A=Ao(A,A.next),QA(o,e,n,i,r,s,0),QA(A,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function p9(t,e,n,i){var r=[],s,o,a,A,h;for(s=0,o=e.length;s<o;s++)a=e[s]*i,A=s<o-1?e[s+1]*i:t.length,h=LS(t,a,A,i,!1),h===h.next&&(h.steiner=!0),r.push(T9(h));for(r.sort(g9),s=0;s<r.length;s++)n=m9(r[s],n);return n}function g9(t,e){return t.x-e.x}function m9(t,e){var n=_9(t,e);if(!n)return e;var i=OS(n,t);return Ao(i,i.next),Ao(n,n.next)}function _9(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var A=o,h=o.x,p=o.y,m=1/0,y;n=o;do i>=n.x&&n.x>=h&&i!==n.x&&ca(r<p?i:s,r,h,p,r<p?s:i,r,n.x,n.y)&&(y=Math.abs(r-n.y)/(i-n.x),XA(n,t)&&(y<m||y===m&&(n.x>o.x||n.x===o.x&&v9(o,n)))&&(o=n,m=y)),n=n.next;while(n!==A);return o}function v9(t,e){return Pt(t.prev,t,e.prev)<0&&Pt(e.next,t,t.next)<0}function y9(t,e,n,i){var r=t;do r.z===0&&(r.z=Rg(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,E9(r)}function E9(t){var e,n,i,r,s,o,a,A,h=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<h&&(a++,i=i.nextZ,!!i);e++);for(A=h;a>0||A>0&&i;)a!==0&&(A===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,A--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,h*=2}while(o>1);return t}function Rg(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function T9(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function ca(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function w9(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!b9(t,e)&&(XA(t,e)&&XA(e,t)&&x9(t,e)&&(Pt(t.prev,t,e.prev)||Pt(t,e.prev,e))||Gh(t,e)&&Pt(t.prev,t,t.next)>0&&Pt(e.prev,e,e.next)>0)}function Pt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Gh(t,e){return t.x===e.x&&t.y===e.y}function RS(t,e,n,i){var r=wu(Pt(t,e,n)),s=wu(Pt(t,e,i)),o=wu(Pt(n,i,t)),a=wu(Pt(n,i,e));return!!(r!==s&&o!==a||r===0&&Tu(t,n,e)||s===0&&Tu(t,i,e)||o===0&&Tu(n,t,i)||a===0&&Tu(n,e,i))}function Tu(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function wu(t){return t>0?1:t<0?-1:0}function b9(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&RS(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function XA(t,e){return Pt(t.prev,t,t.next)<0?Pt(t,e,t.next)>=0&&Pt(t,t.prev,e)>=0:Pt(t,e,t.prev)<0||Pt(t,t.next,e)<0}function x9(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function OS(t,e){var n=new Og(t.i,t.x,t.y),i=new Og(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function $2(t,e,n,i){var r=new Og(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function JA(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Og(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Uh.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(Fg(t,0,s,n));if(r)for(var a=0,A=e.length;a<A;a++){var h=e[a]*n,p=a<A-1?e[a+1]*n:t.length;o-=Math.abs(Fg(t,h,p,n))}var m=0;for(a=0;a<i.length;a+=3){var y=i[a]*n,T=i[a+1]*n,b=i[a+2]*n;m+=Math.abs((t[y]-t[b])*(t[T+1]-t[y+1])-(t[y]-t[T])*(t[b+1]-t[y+1]))}return o===0&&m===0?0:Math.abs((m-o)/o)};function Fg(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}Uh.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};const bu=R_.CLOCKWISE,eE=R_.COUNTER_CLOCKWISE,ns={isClosed:!0};function C9(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Xl(t){return"positions"in t?t.positions:t}function uf(t){return"holeIndices"in t?t.holeIndices:null}function S9(t){return Array.isArray(t[0])}function P9(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function I9(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function M9(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function tE(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let A=0;A<i;A++)t[s++]=n[a][A]||0;if(!I9(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return ns.start=e,ns.end=s,ns.size=i,O_(t,r,ns),s}function nE(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let A=e;for(let h=0;h<a;h++)t[A++]=n[r+h];if(!M9(n,i,r,s))for(let h=0;h<i;h++)t[A++]=n[r+h];return ns.start=e,ns.end=A,ns.size=i,O_(t,o,ns),A}function FS(t,e){C9(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=nE(n,o,r,e,s[a-1],s[a],a===0?bu:eE),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!S9(t))return nE(n,0,t,e,0,n.length,bu),n;if(!P9(t)){let r=0;for(const[s,o]of t.entries())r=tE(n,r,o,e,s===0?bu:eE),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return tE(n,0,t,e,bu),n}function B9(t,e,n){let i=uf(t);i&&(i=i.map(s=>s/e));let r=Xl(t);if(n){const s=r.length;r=r.slice();const o=[];for(let a=0;a<s;a+=e){o[0]=r[a],o[1]=r[a+1];const A=n(o);r[a]=A[0],r[a+1]=A[1]}}return nh(r,i,e)}class L9 extends gS{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=FS(e,this.positionSize);return this.opts.resolution?CS(Xl(n),uf(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Jz(Xl(n),uf(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(iE(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return Xl(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&iE(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let A=s.indices;if(!A||!e)return;let h=r;const p=B9(e,this.positionSize,this.opts.preproject);A=a.allocate(A,r+p.length,{copy:!0});for(let m=0;m<p.length;m++)A[h++]=p[m]+i;o[n+1]=r+p.length,s.indices=A}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=Xl(e);for(let a=n,A=0;A<i;a++,A++){const h=o[A*s],p=o[A*s+1],m=s>2?o[A*s+2]:0;r[a*3]=h,r[a*3+1]=p,r[a*3+2]=m}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&uf(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function iE(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const DS=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,R9=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(DS,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),O9=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(DS,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),F9=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ih=[0,0,0,255],D9={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ih},getLineColor:{type:"accessor",value:ih},material:!0},xu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class zh extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?R9:O9,fs:F9,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ei,v_,Ti]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===De.DEFAULT&&(i=De.LNGLAT),this.setState({numInstances:0,polygonTesselator:new L9({preproject:i===De.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!e||r_(e,ht.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:xu,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:xu,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:xu,accessor:"getFillColor",defaultValue:ih,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:xu,accessor:"getLineColor",defaultValue:ih,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,{index:a,target:A})=>this.encodePickingColor(o&&o.__source?o.__source.index:a,A),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:A}=this.state,h={...e,extruded:Boolean(n),elevationScale:s};a&&(a.setInstanceCount(A.instanceCount-1),a.setUniforms(h),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(A.vertexCount),o.setUniforms(h).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(A=>A.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new cn(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new cn(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Sn({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}w(zh,"defaultProps",D9);w(zh,"layerName","SolidPolygonLayer");function kS({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,A=o;for(let y=0;y<o;y++){const T=e(t[y]);if(a>y&&T>=r&&(a=y),T>=s){A=y;break}}let h=a;const m=A-a!==i.length?t.slice(A):void 0;for(let y=0;y<i.length;y++)t[h++]=i[y];if(m){for(let y=0;y<m.length;y++)t[h++]=m[y];t.length=h}return{startRow:a,endRow:a+i.length}}const NS=[0,0,0,255],k9=[0,0,0,255],N9={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:k9},getLineColor:{type:"accessor",value:NS},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Ka extends Lr{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&Re.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),r=e.dataChanged.map(s=>kS({data:i,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:r})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:i,positionFormat:r,_normalize:s}=this.props,o=[],a=r==="XY"?2:3,{startRow:A,endRow:h}=e,{iterable:p,objectInfo:m}=Ts(n,A,h);for(const y of p){m.index++;let T=i(y,m);s&&(T=FS(T,a));const{holeIndices:b}=T,C=T.positions||T;if(b)for(let R=0;R<=b.length;R++){const S=C.slice(b[R-1]||0,b[R]||C.length);o.push(this.getSubLayerRow({path:S},y,m.index))}else o.push(this.getSubLayerRow({path:C},y,m.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:r,extruded:s,wireframe:o,_normalize:a,_windingOrder:A,elevationScale:h,transitions:p,positionFormat:m}=this.props,{lineWidthUnits:y,lineWidthScale:T,lineWidthMinPixels:b,lineWidthMaxPixels:C,lineJointRounded:R,lineMiterLimit:S,lineDashJustified:P}=this.props,{getFillColor:I,getLineColor:F,getLineWidth:j,getLineDashArray:X,getElevation:q,getPolygon:ee,updateTriggers:Q,material:V}=this.props,{paths:D,pathsDiff:re}=this.state,le=this.getSubLayerClass("fill",zh),pe=this.getSubLayerClass("stroke",pc),Be=this.shouldRenderSubLayer("fill",D)&&new le({_dataDiff:n,extruded:s,elevationScale:h,filled:r,wireframe:o,_normalize:a,_windingOrder:A,getElevation:q,getFillColor:I,getLineColor:s&&o?F:NS,material:V,transitions:p},this.getSubLayerProps({id:"fill",updateTriggers:Q&&{getPolygon:Q.getPolygon,getElevation:Q.getElevation,getFillColor:Q.getFillColor,lineColors:s&&o,getLineColor:Q.getLineColor}}),{data:e,positionFormat:m,getPolygon:ee}),Ye=!s&&i&&this.shouldRenderSubLayer("stroke",D)&&new pe({_dataDiff:re&&(()=>re),widthUnits:y,widthScale:T,widthMinPixels:b,widthMaxPixels:C,jointRounded:R,miterLimit:S,dashJustified:P,_pathType:"loop",transitions:p&&{getWidth:p.getLineWidth,getColor:p.getLineColor,getPath:p.getPolygon},getColor:this.getSubLayerAccessor(F),getWidth:this.getSubLayerAccessor(j),getDashArray:this.getSubLayerAccessor(X)},this.getSubLayerProps({id:"stroke",updateTriggers:Q&&{getWidth:Q.getLineWidth,getColor:Q.getLineColor,getDashArray:Q.getLineDashArray}}),{data:D,positionFormat:m,getPath:Qe=>Qe.path});return[!s&&Be,Ye,s&&Be]}}w(Ka,"layerName","PolygonLayer");w(Ka,"defaultProps",N9);function U9(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?G9(t,i,n):null}function G9(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function z9(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}const V9=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,rE=192/256,sE=[],j9={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class F_ extends Dh{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:V9}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&Re.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state;e.uniforms={...e.uniforms,buffer:rE,outlineBuffer:r?Math.max(i,rE*(1-r)):-1,gamma:i,sdf:Boolean(n),outlineColor:s},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):sE}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):sE}}w(F_,"defaultProps",j9);w(F_,"layerName","MultiIconLayer");var rh={},H9={get exports(){return rh},set exports(t){rh=t}};H9.exports=gc;rh.default=gc;var ba=1e20;function gc(t,e,n,i,r,s){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,a=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function W9(t,e,n,i,r,s,o){s.fill(ba,0,e*n),o.fill(0,0,e*n);for(var a=(e-i)/2,A=0;A<r;A++)for(var h=0;h<i;h++){var p=(A+a)*e+h+a,m=t.data[4*(A*i+h)+3]/255;if(m===1)s[p]=0,o[p]=ba;else if(m===0)s[p]=ba,o[p]=0;else{var y=Math.max(0,.5-m),T=Math.max(0,m-.5);s[p]=y*y,o[p]=T*T}}}function Q9(t,e,n,i,r,s,o){for(var a=0;a<e*n;a++){var A=Math.sqrt(i[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(A/s+o))}}gc.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,r=2*this.buffer,s,o,a,A,h,p,m,y;e&&this.useMetrics?(h=Math.floor(n.actualBoundingBoxAscent),y=this.buffer+Math.ceil(n.actualBoundingBoxAscent),p=this.buffer,m=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),A=Math.min(this.size-p,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),s=o+r,a=A+r,this.ctx.textBaseline="alphabetic"):(s=o=this.size,a=A=this.size,h=19*this.fontSize/24,p=m=0,y=this.middle,this.ctx.textBaseline="middle");var T;o&&A&&(this.ctx.clearRect(m,p,o,A),this.ctx.fillText(t,this.buffer,y),T=this.ctx.getImageData(m,p,o,A));var b=new Uint8ClampedArray(s*a);return W9(T,s,a,o,A,this.gridOuter,this.gridInner),oE(this.gridOuter,s,a,this.f,this.v,this.z),oE(this.gridInner,s,a,this.f,this.v,this.z),Q9(b,s,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:b,metrics:{width:o,height:A,sdfWidth:s,sdfHeight:a,top:h,left:0,advance:i}}};gc.prototype.draw=function(t){return this._draw(t,!1).data};gc.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function oE(t,e,n,i,r,s){for(var o=0;o<e;o++)aE(t,o,e,n,i,r,s);for(var a=0;a<n;a++)aE(t,a*e,1,e,i,r,s)}function aE(t,e,n,i,r,s,o){var a,A,h,p;for(s[0]=0,o[0]=-ba,o[1]=ba,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,A=0,h=0;a<i;a++){do p=s[A],h=(r[a]-r[p]+a*a-p*p)/(a-p)/2;while(h<=o[A]&&--A>-1);A++,s[A]=a,o[A]=h,o[A+1]=ba}for(a=0,A=0;a<i;a++){for(;o[A+1]<a;)A++;p=s[A],t[e+a*n]=r[p]+(a-p)*(a-p)}}const X9=32,J9=[];function Y9(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function K9({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let A=0,h=o;for(const m of t)if(!s[m]){const y=e(m);h+y+i*2>r&&(h=0,A++),s[m]={x:h+i,y:a+A*(n+i*2)+i,width:y,height:n},h+=y+i*2}const p=n+i*2;return{mapping:s,xOffset:h,yOffset:a+A*p,canvasHeight:Y9(a+(A+1)*p)}}function US(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.width)||0}return r}function GS(t,e,n,i,r,s){let o=e,a=0;for(let A=e;A<n;A++){const h=US(t,A,A+1,r);a+h>i&&(o<A&&s.push(A),o=A,a=0),a+=h}return a}function Z9(t,e,n,i,r,s){let o=e,a=e,A=e,h=0;for(let p=e;p<n;p++)if((t[p]===" "||t[p+1]===" "||p+1===n)&&(A=p+1),A>a){let m=US(t,a,A,r);h+m>i&&(o<a&&(s.push(a),o=a,h=0),m>i&&(m=GS(t,a,A,i,r,s),o=s[s.length-1])),a=A,h+=m}return h}function q9(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?GS(t,r,s,n,i,o):Z9(t,r,s,n,i,o),o}function $9(t,e,n,i,r,s){let o=0,a=0;for(let A=e;A<n;A++){const h=t[A],p=i[h];p?(a||(a=p.height),r[A]=o+p.width/2,o+=p.width):(Re.warn("Missing character: ".concat(h," (").concat(h.codePointAt(0),")"))(),r[A]=o,o+=X9)}s[0]=o,s[1]=a}function lE(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),A=new Array(o),h=new Array(o),p=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,m=[0,0],y=[0,0];let T=0,b=0,C=0;for(let R=0;R<=o;R++){const S=s[R];if((S===`
`||R===o)&&(C=R),C>b){const P=p?q9(s,n,i,r,b,C):J9;for(let I=0;I<=P.length;I++){const F=I===0?b:P[I-1],j=I<P.length?P[I]:C;$9(s,F,j,r,a,y);for(let X=F;X<j;X++)A[X]=T+y[1]/2,h[X]=y[0];T=T+y[1]*e,m[0]=Math.max(m[0],y[0])}b=C}S===`
`&&(a[b]=0,A[b]=0,h[b]=0,b++)}return m[1]=T,{x:a,y:A,rowWidth:h,size:m}}function eV({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,A=i?i/o:0,h=r[e]||Math.ceil((t.length-A)/a),p=s&&new Set,m=new Array(e);let y=t;if(a>1||A>0){const T=t.constructor;y=new T(h);for(let b=0;b<h;b++)y[b]=t[b*a+A]}for(let T=0;T<e;T++){const b=r[T],C=r[T+1]||h,R=y.subarray(b,C);m[T]=String.fromCodePoint.apply(null,R),p&&R.forEach(p.add,p)}if(p)for(const T of p)s.add(String.fromCodePoint(T));return{texts:m,characterCount:h}}class zS{constructor(e=5){w(this,"limit",void 0),w(this,"_cache",{}),w(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function tV(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const uA={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:tV(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},AE=1024,nV=.9,cE=1.2,VS=3;let sh=new zS(VS);function iV(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=sh.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function rV(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function uE(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function sV(t){Re.assert(Number.isFinite(t)&&t>=VS,"Invalid cache limit"),sh=new zS(t)}class oV{constructor(){w(this,"props",{...uA}),w(this,"_key",void 0),w(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return cE}setProps(e={}){Object.assign(this.props,e);const n=this._key;this._key=this._getKey();const i=iV(this._key,this.props.characterSet),r=sh.get(this._key);if(r&&i.size===0){this._key!==n&&(this._atlas=r);return}const s=this._generateFontAtlas(this._key,i,r);this._atlas=s,sh.set(this._key,s)}_generateFontAtlas(e,n,i){const{fontFamily:r,fontWeight:s,fontSize:o,buffer:a,sdf:A,radius:h,cutoff:p}=this.props;let m=i&&i.data;m||(m=document.createElement("canvas"),m.width=AE);const y=m.getContext("2d");uE(y,r,o,s);const{mapping:T,canvasHeight:b,xOffset:C,yOffset:R}=K9({getFontWidth:S=>y.measureText(S).width,fontHeight:o*cE,buffer:a,characterSet:n,maxCanvasWidth:AE,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(m.height!==b){const S=y.getImageData(0,0,m.width,m.height);m.height=b,y.putImageData(S,0,0)}if(uE(y,r,o,s),A){const S=new rh(o,a,h,p,r,s),P=y.getImageData(0,0,S.size,S.size);for(const I of n)rV(S.draw(I),P),y.putImageData(P,T[I].x-a,T[I].y+a)}else for(const S of n)y.fillText(S,T[S].x,T[S].y+o*nV);return{xOffset:C,yOffset:R,mapping:T,data:m,width:m.width,height:m.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}const aV=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,lV=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,AV={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class D_ extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){return super.getShaders({vs:aV,fs:lV,modules:[Ei,Ti]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:A}=this.props;A.length<4&&(A=[A[0],A[1],A[0],A[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(a),padding:A,sizeUnits:ri[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new cn(e,{...this.getShaders(),id:this.props.id,geometry:new Sn({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}w(D_,"defaultProps",AV);w(D_,"layerName","TextBackgroundLayer");const fE={start:1,middle:0,end:-1},hE={top:1,center:0,bottom:-1},w0=[0,0,0,255],cV=1,uV={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:w0},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:uA.characterSet},fontFamily:uA.fontFamily,fontWeight:uA.fontWeight,lineHeight:cV,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:w0},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:w0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class k_ extends Lr{constructor(...e){super(...e),w(this,"state",void 0),w(this,"getBoundingRect",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:A,getTextAnchor:h,getAlignmentBaseline:p}=this.props,m=s(n,i)||"",{size:[y,T]}=lE(m,A,o,a,r),b=fE[typeof h=="function"?h(n,i):h],C=hE[typeof p=="function"?p(n,i):p];return[(b-1)*y/2,(C-1)*T/2,y,T]}),w(this,"getIconOffsets",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:A,getTextAnchor:h,getAlignmentBaseline:p}=this.props,m=s(n,i)||"",{x:y,y:T,rowWidth:b,size:[C,R]}=lE(m,A,o,a,r),S=fE[typeof h=="function"?h(n,i):h],P=hE[typeof p=="function"?p(n,i):p],I=y.length,F=new Array(I*2);let j=0;for(let X=0;X<I;X++){const q=(1-S)*(C-b[X])/2;F[j++]=(S-1)*C/2+q+y[X],F[j++]=(P-1)*R/2+T[X]}return F})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new oV}}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const A=i==="auto"&&new Set;if(r&&o){const{texts:h,characterCount:p}=eV({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:A});a=p,s=(m,{index:y})=>h[y]}else{const{iterable:h,objectInfo:p}=Ts(n);o=[0],a=0;for(const m of h){p.index++;const y=Array.from(s(m,p)||"");A&&y.forEach(A.add,A),a+=y.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:A||i})}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:A,_dataDiff:h,getPosition:p,getColor:m,getSize:y,getAngle:T,getPixelOffset:b,getBackgroundColor:C,getBorderColor:R,getBorderWidth:S,backgroundPadding:P,background:I,billboard:F,fontSettings:j,outlineWidth:X,outlineColor:q,sizeScale:ee,sizeUnits:Q,sizeMinPixels:V,sizeMaxPixels:D,transitions:re,updateTriggers:le}=this.props,pe=this.getSubLayerClass("characters",F_),Be=this.getSubLayerClass("background",D_);return[I&&new Be({getFillColor:C,getLineColor:R,getLineWidth:S,padding:P,getPosition:p,getSize:y,getAngle:T,getPixelOffset:b,billboard:F,sizeScale:ee/this.state.fontAtlasManager.props.fontSize,sizeUnits:Q,sizeMinPixels:V,sizeMaxPixels:D,transitions:re&&{getPosition:re.getPosition,getAngle:re.getAngle,getSize:re.getSize,getFillColor:re.getBackgroundColor,getLineColor:re.getBorderColor,getLineWidth:re.getBorderWidth,getPixelOffset:re.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:le.getPosition,getAngle:le.getAngle,getSize:le.getSize,getFillColor:le.getBackgroundColor,getLineColor:le.getBorderColor,getLineWidth:le.getBorderWidth,getPixelOffset:le.getPixelOffset,getBoundingRect:{getText:le.getText,getTextAnchor:le.getTextAnchor,getAlignmentBaseline:le.getAlignmentBaseline,styleVersion:a}}}),{data:A.attributes&&A.attributes.background?{length:A.length,attributes:A.attributes.background}:A,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new pe({sdf:j.sdf,smoothing:Number.isFinite(j.smoothing)?j.smoothing:uA.smoothing,outlineWidth:X,outlineColor:q,iconAtlas:s,iconMapping:o,getPosition:p,getColor:m,getSize:y,getAngle:T,getPixelOffset:b,billboard:F,sizeScale:ee*r,sizeUnits:Q,sizeMinPixels:V*r,sizeMaxPixels:D*r,transitions:re&&{getPosition:re.getPosition,getAngle:re.getAngle,getColor:re.getColor,getSize:re.getSize,getPixelOffset:re.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:le.getText,getPosition:le.getPosition,getAngle:le.getAngle,getColor:le.getColor,getSize:le.getSize,getPixelOffset:le.getPixelOffset,getIconOffsets:{getText:le.getText,getTextAnchor:le.getTextAnchor,getAlignmentBaseline:le.getAlignmentBaseline,styleVersion:a}}}),{data:A,_dataDiff:h,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){sV(e)}}w(k_,"defaultProps",uV);w(k_,"layerName","TextLayer");const ff={circle:{type:L_,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Dh,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:k_,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},hf={type:pc,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Dg={type:zh,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ll({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function b0(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function fV(t){if(Array.isArray(t))return t;switch(Re.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Re.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function dE(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o],{geometry:A}=a;if(A)if(A.type==="GeometryCollection"){Re.assert(Array.isArray(A.geometries),"GeoJSON does not have geometries array");const{geometries:h}=A;for(let p=0;p<h.length;p++){const m=h[p];pE(m,i,e,a,o)}}else pE(A,i,e,a,o)}return i}function pE(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:A,polygonFeatures:h,polygonOutlineFeatures:p}=e;if(!dV(s,o)){Re.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(m=>{a.push(n({geometry:{type:"Point",coordinates:m}},i,r))});break;case"LineString":A.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(m=>{A.push(n({geometry:{type:"LineString",coordinates:m}},i,r))});break;case"Polygon":h.push(n({geometry:t},i,r)),o.forEach(m=>{p.push(n({geometry:{type:"LineString",coordinates:m}},i,r))});break;case"MultiPolygon":o.forEach(m=>{h.push(n({geometry:{type:"Polygon",coordinates:m}},i,r)),m.forEach(y=>{p.push(n({geometry:{type:"LineString",coordinates:y}},i,r))})});break}}const hV={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function dV(t,e){let n=hV[t];for(Re.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function jS(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Cu(t){return t.geometry.coordinates}function pV(t,e){const n=jS(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=Cu,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=Cu,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=Cu,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=Cu,n}function gV(t,e){const n=jS(),{points:i,lines:r,polygons:s}=t,o=z9(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const mV=["points","linestrings","polygons"],_V={...Ll(ff.circle),...Ll(ff.icon),...Ll(ff.text),...Ll(hf),...Ll(Dg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Za extends Lr{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=gV(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=fV(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const A=this.state.features;for(const h in A)s[h]=A[h].slice(),o[h]=[];for(const h of n.dataChanged){const p=dE(i,r,h);for(const m in A)o[m].push(kS({data:s[m],getIndex:y=>y.__source.index,dataRange:h,replace:p[m]}))}}else s=dE(i,r);const a=pV(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=mV.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,Dg.type);if(s){const o=b0(this,Dg.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,hf.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,hf.type);if(o||a){const A=b0(this,hf.props);return[o&&new o(A,this.getSubLayerProps({id:r,updateTriggers:A.updateTriggers}),i.polygonsOutline),a&&new a(A,this.getSubLayerProps({id:s,updateTriggers:A.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const A="points-".concat(a),h=ff[a],p=h&&this.shouldRenderSubLayer(A,n.points.data)&&this.getSubLayerClass(A,h.type);if(p){const m=b0(this,h.props);let y=n.points;if(a==="text"&&i){const{instancePickingColors:T,...b}=y.data.attributes;y={...y,data:{...y.data,attributes:b}}}o.push(new p(m,this.getSubLayerProps({id:A,updateTriggers:m.updateTriggers,highlightedObjectIndex:r}),y))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=U9(s,o);return e(a,r)}}}w(Za,"layerName","GeoJsonLayer");w(Za,"defaultProps",_V);const vV={getHeight:{type:"accessor",value:0},greatCircle:!0};class HS extends M_{}w(HS,"layerName","GreatCircleLayer");w(HS,"defaultProps",vV);const yV={...Ka.defaultProps};class qa extends Lr{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:n,wireframe:i,filled:r,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:A,lineWidthMaxPixels:h,lineJointRounded:p,lineMiterLimit:m,lineDashJustified:y,getElevation:T,getFillColor:b,getLineColor:C,getLineWidth:R}=this.props,{updateTriggers:S,material:P,transitions:I}=this.props,F=this.getSubLayerClass("cell",Ka);return new F({filled:r,wireframe:i,extruded:n,elevationScale:e,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:A,lineWidthMaxPixels:h,lineJointRounded:p,lineMiterLimit:m,lineDashJustified:y,material:P,transitions:I,getElevation:T,getFillColor:b,getLineColor:C,getLineWidth:R},this.getSubLayerProps({id:"cell",updateTriggers:S&&{getElevation:S.getElevation,getFillColor:S.getFillColor,getLineColor:S.getLineColor,getLineWidth:S.getLineWidth}}),this.indexToBounds())}}w(qa,"layerName","GeoCellLayer");w(qa,"defaultProps",yV);function EV(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var kg={},TV={get exports(){return kg},set exports(t){kg=t}};(function(t){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,n){typeof EV=="function"&&t&&t.exports?t.exports=n():(e.dcodeIO=e.dcodeIO||{}).Long=n()})(zI,function(){function e(V,D,re){this.low=V|0,this.high=D|0,this.unsigned=!!re}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function n(V){return(V&&V.__isLong__)===!0}e.isLong=n;var i={},r={};function s(V,D){var re,le,pe;return D?(V>>>=0,(pe=0<=V&&V<256)&&(le=r[V],le)?le:(re=a(V,(V|0)<0?-1:0,!0),pe&&(r[V]=re),re)):(V|=0,(pe=-128<=V&&V<128)&&(le=i[V],le)?le:(re=a(V,V<0?-1:0,!1),pe&&(i[V]=re),re))}e.fromInt=s;function o(V,D){if(isNaN(V)||!isFinite(V))return D?P:S;if(D){if(V<0)return P;if(V>=b)return q}else{if(V<=-C)return ee;if(V+1>=C)return X}return V<0?o(-V,D).neg():a(V%T|0,V/T|0,D)}e.fromNumber=o;function a(V,D,re){return new e(V,D,re)}e.fromBits=a;var A=Math.pow;function h(V,D,re){if(V.length===0)throw Error("empty string");if(V==="NaN"||V==="Infinity"||V==="+Infinity"||V==="-Infinity")return S;if(typeof D=="number"?(re=D,D=!1):D=!!D,re=re||10,re<2||36<re)throw RangeError("radix");var le;if((le=V.indexOf("-"))>0)throw Error("interior hyphen");if(le===0)return h(V.substring(1),D,re).neg();for(var pe=o(A(re,8)),Be=S,Ye=0;Ye<V.length;Ye+=8){var Qe=Math.min(8,V.length-Ye),oe=parseInt(V.substring(Ye,Ye+Qe),re);if(Qe<8){var ye=o(A(re,Qe));Be=Be.mul(ye).add(o(oe))}else Be=Be.mul(pe),Be=Be.add(o(oe))}return Be.unsigned=D,Be}e.fromString=h;function p(V){return V instanceof e?V:typeof V=="number"?o(V):typeof V=="string"?h(V):a(V.low,V.high,V.unsigned)}e.fromValue=p;var m=1<<16,y=1<<24,T=m*m,b=T*T,C=b/2,R=s(y),S=s(0);e.ZERO=S;var P=s(0,!0);e.UZERO=P;var I=s(1);e.ONE=I;var F=s(1,!0);e.UONE=F;var j=s(-1);e.NEG_ONE=j;var X=a(-1,2147483647,!1);e.MAX_VALUE=X;var q=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=q;var ee=a(0,-2147483648,!1);e.MIN_VALUE=ee;var Q=e.prototype;return Q.toInt=function(){return this.unsigned?this.low>>>0:this.low},Q.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},Q.toString=function(D){if(D=D||10,D<2||36<D)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ee)){var re=o(D),le=this.div(re),pe=le.mul(re).sub(this);return le.toString(D)+pe.toInt().toString(D)}else return"-"+this.neg().toString(D);for(var Be=o(A(D,6),this.unsigned),Ye=this,Qe="";;){var oe=Ye.div(Be),ye=Ye.sub(oe.mul(Be)).toInt()>>>0,Ce=ye.toString(D);if(Ye=oe,Ye.isZero())return Ce+Qe;for(;Ce.length<6;)Ce="0"+Ce;Qe=""+Ce+Qe}},Q.getHighBits=function(){return this.high},Q.getHighBitsUnsigned=function(){return this.high>>>0},Q.getLowBits=function(){return this.low},Q.getLowBitsUnsigned=function(){return this.low>>>0},Q.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ee)?64:this.neg().getNumBitsAbs();for(var D=this.high!=0?this.high:this.low,re=31;re>0&&!(D&1<<re);re--);return this.high!=0?re+33:re+1},Q.isZero=function(){return this.high===0&&this.low===0},Q.isNegative=function(){return!this.unsigned&&this.high<0},Q.isPositive=function(){return this.unsigned||this.high>=0},Q.isOdd=function(){return(this.low&1)===1},Q.isEven=function(){return(this.low&1)===0},Q.equals=function(D){return n(D)||(D=p(D)),this.unsigned!==D.unsigned&&this.high>>>31===1&&D.high>>>31===1?!1:this.high===D.high&&this.low===D.low},Q.eq=Q.equals,Q.notEquals=function(D){return!this.eq(D)},Q.neq=Q.notEquals,Q.lessThan=function(D){return this.comp(D)<0},Q.lt=Q.lessThan,Q.lessThanOrEqual=function(D){return this.comp(D)<=0},Q.lte=Q.lessThanOrEqual,Q.greaterThan=function(D){return this.comp(D)>0},Q.gt=Q.greaterThan,Q.greaterThanOrEqual=function(D){return this.comp(D)>=0},Q.gte=Q.greaterThanOrEqual,Q.compare=function(D){if(n(D)||(D=p(D)),this.eq(D))return 0;var re=this.isNegative(),le=D.isNegative();return re&&!le?-1:!re&&le?1:this.unsigned?D.high>>>0>this.high>>>0||D.high===this.high&&D.low>>>0>this.low>>>0?-1:1:this.sub(D).isNegative()?-1:1},Q.comp=Q.compare,Q.negate=function(){return!this.unsigned&&this.eq(ee)?ee:this.not().add(I)},Q.neg=Q.negate,Q.add=function(D){n(D)||(D=p(D));var re=this.high>>>16,le=this.high&65535,pe=this.low>>>16,Be=this.low&65535,Ye=D.high>>>16,Qe=D.high&65535,oe=D.low>>>16,ye=D.low&65535,Ce=0,Le=0,ke=0,Wt=0;return Wt+=Be+ye,ke+=Wt>>>16,Wt&=65535,ke+=pe+oe,Le+=ke>>>16,ke&=65535,Le+=le+Qe,Ce+=Le>>>16,Le&=65535,Ce+=re+Ye,Ce&=65535,a(ke<<16|Wt,Ce<<16|Le,this.unsigned)},Q.subtract=function(D){return n(D)||(D=p(D)),this.add(D.neg())},Q.sub=Q.subtract,Q.multiply=function(D){if(this.isZero()||(n(D)||(D=p(D)),D.isZero()))return S;if(this.eq(ee))return D.isOdd()?ee:S;if(D.eq(ee))return this.isOdd()?ee:S;if(this.isNegative())return D.isNegative()?this.neg().mul(D.neg()):this.neg().mul(D).neg();if(D.isNegative())return this.mul(D.neg()).neg();if(this.lt(R)&&D.lt(R))return o(this.toNumber()*D.toNumber(),this.unsigned);var re=this.high>>>16,le=this.high&65535,pe=this.low>>>16,Be=this.low&65535,Ye=D.high>>>16,Qe=D.high&65535,oe=D.low>>>16,ye=D.low&65535,Ce=0,Le=0,ke=0,Wt=0;return Wt+=Be*ye,ke+=Wt>>>16,Wt&=65535,ke+=pe*ye,Le+=ke>>>16,ke&=65535,ke+=Be*oe,Le+=ke>>>16,ke&=65535,Le+=le*ye,Ce+=Le>>>16,Le&=65535,Le+=pe*oe,Ce+=Le>>>16,Le&=65535,Le+=Be*Qe,Ce+=Le>>>16,Le&=65535,Ce+=re*ye+le*oe+pe*Qe+Be*Ye,Ce&=65535,a(ke<<16|Wt,Ce<<16|Le,this.unsigned)},Q.mul=Q.multiply,Q.divide=function(D){if(n(D)||(D=p(D)),D.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?P:S;var re,le,pe;if(this.unsigned){if(D.unsigned||(D=D.toUnsigned()),D.gt(this))return P;if(D.gt(this.shru(1)))return F;pe=P}else{if(this.eq(ee)){if(D.eq(I)||D.eq(j))return ee;if(D.eq(ee))return I;var Be=this.shr(1);return re=Be.div(D).shl(1),re.eq(S)?D.isNegative()?I:j:(le=this.sub(D.mul(re)),pe=re.add(le.div(D)),pe)}else if(D.eq(ee))return this.unsigned?P:S;if(this.isNegative())return D.isNegative()?this.neg().div(D.neg()):this.neg().div(D).neg();if(D.isNegative())return this.div(D.neg()).neg();pe=S}for(le=this;le.gte(D);){re=Math.max(1,Math.floor(le.toNumber()/D.toNumber()));for(var Ye=Math.ceil(Math.log(re)/Math.LN2),Qe=Ye<=48?1:A(2,Ye-48),oe=o(re),ye=oe.mul(D);ye.isNegative()||ye.gt(le);)re-=Qe,oe=o(re,this.unsigned),ye=oe.mul(D);oe.isZero()&&(oe=I),pe=pe.add(oe),le=le.sub(ye)}return pe},Q.div=Q.divide,Q.modulo=function(D){return n(D)||(D=p(D)),this.sub(this.div(D).mul(D))},Q.mod=Q.modulo,Q.not=function(){return a(~this.low,~this.high,this.unsigned)},Q.and=function(D){return n(D)||(D=p(D)),a(this.low&D.low,this.high&D.high,this.unsigned)},Q.or=function(D){return n(D)||(D=p(D)),a(this.low|D.low,this.high|D.high,this.unsigned)},Q.xor=function(D){return n(D)||(D=p(D)),a(this.low^D.low,this.high^D.high,this.unsigned)},Q.shiftLeft=function(D){return n(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?a(this.low<<D,this.high<<D|this.low>>>32-D,this.unsigned):a(0,this.low<<D-32,this.unsigned)},Q.shl=Q.shiftLeft,Q.shiftRight=function(D){return n(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?a(this.low>>>D|this.high<<32-D,this.high>>D,this.unsigned):a(this.high>>D-32,this.high>=0?0:-1,this.unsigned)},Q.shr=Q.shiftRight,Q.shiftRightUnsigned=function(D){if(n(D)&&(D=D.toInt()),D&=63,D===0)return this;var re=this.high;if(D<32){var le=this.low;return a(le>>>D|re<<32-D,re>>>D,this.unsigned)}else return D===32?a(re,0,this.unsigned):a(re>>>D-32,0,this.unsigned)},Q.shru=Q.shiftRightUnsigned,Q.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},Q.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},Q.toBytes=function(V){return V?this.toBytesLE():this.toBytesBE()},Q.toBytesLE=function(){var V=this.high,D=this.low;return[D&255,D>>>8&255,D>>>16&255,D>>>24&255,V&255,V>>>8&255,V>>>16&255,V>>>24&255]},Q.toBytesBE=function(){var V=this.high,D=this.low;return[V>>>24&255,V>>>16&255,V>>>8&255,V&255,D>>>24&255,D>>>16&255,D>>>8&255,D&255]},e})})(TV);const df=kg,wV=3,bV=30,xV=2*bV+1,gE=180/Math.PI;function CV(t,e,n){const i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]}function mE(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function SV(t){return[mE(t[0]),mE(t[1])]}function PV(t,[e,n]){switch(t){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function IV([t,e,n]){const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*gE,i*gE]}function MV(t){let e=df.fromString(t,!0,10).toString(2);for(;e.length<wV+xV;)e="0"+e;const n=e.lastIndexOf("1"),i=e.substring(0,3),r=e.substring(3,n),s=r.length/2,o=df.fromString(i,!0,2).toString(10);let a=df.fromString(r,!0,2).toString(4);for(;a.length<s;)a="0"+a;return"".concat(o,"/").concat(a)}function BV(t,e,n,i){if(i===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function LV(t){const e=t.split("/"),n=parseInt(e[0],10),i=e[1],r=i.length,s=[0,0];let o;for(let a=r-1;a>=0;a--){o=r-a;const A=i[a];let h=0,p=0;A==="1"?p=1:A==="2"?(h=1,p=1):A==="3"&&(h=1);const m=Math.pow(2,o-1);BV(m,s,h,p),s[0]+=m*h,s[1]+=m*p}if(n%2===1){const a=s[0];s[0]=s[1],s[1]=a}return{face:n,ij:s,level:o}}function RV(t){const e=t.padEnd(16,"0");return df.fromString(e,16)}const OV=100;function FV({face:t,ij:e,level:n}){const i=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(OV*Math.pow(2,-n))),s=new Float64Array(4*r*2+2);let o=0,a=0;for(let A=0;A<4;A++){const h=i[A].slice(0),p=i[A+1],m=(p[0]-h[0])/r,y=(p[1]-h[1])/r;for(let T=0;T<r;T++){h[0]+=m,h[1]+=y;const b=CV(e,n,h),C=SV(b),R=PV(t,C),S=IV(R);Math.abs(S[1])>89.999&&(S[0]=a);const P=S[0]-a;S[0]+=P>180?-360:P<-180?360:0,s[o++]=S[0],s[o++]=S[1],a=S[0]}}return s[o++]=s[0],s[o++]=s[1],s}function DV(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=RV(t)}return MV(t.toString())}function kV(t){const e=DV(t),n=LV(e);return FV(n)}const NV={getS2Token:{type:"accessor",value:t=>t.token}};class WS extends qa{indexToBounds(){const{data:e,getS2Token:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,r)=>kV(n(i,r))}}}w(WS,"layerName","S2Layer");w(WS,"defaultProps",NV);const x0=512;function UV(t){let e=0,n=0,i=1<<t.length;const r=i/x0;for(let s=0;s<t.length;s++){i>>=1;const o=parseInt(t[s]);o%2&&(e|=i),o>1&&(n|=i)}return[[e/r,x0-n/r],[(e+.99)/r,x0-(n+.99)/r]]}function GV(t){const[e,n]=UV(t),[i,r]=gs(e),[s,o]=gs(n);return[s,r,s,o,i,o,i,r,s,r]}const zV={getQuadkey:{type:"accessor",value:t=>t.quadkey}};class QS extends qa{indexToBounds(){const{data:e,getQuadkey:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,r)=>GV(n(i,r))}}}w(QS,"layerName","QuadkeyLayer");w(QS,"defaultProps",zV);class VV{constructor(e){w(this,"index",void 0),w(this,"isVisible",void 0),w(this,"isSelected",void 0),w(this,"parent",void 0),w(this,"children",void 0),w(this,"content",void 0),w(this,"state",void 0),w(this,"layers",void 0),w(this,"id",void 0),w(this,"bbox",void 0),w(this,"zoom",void 0),w(this,"userData",void 0),w(this,"_abortController",void 0),w(this,"_loader",void 0),w(this,"_loaderId",void 0),w(this,"_isLoaded",void 0),w(this,"_isCancelled",void 0),w(this,"_needsReload",void 0),this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||Re.error("byteLength not defined in tile data")(),e}async _loadData({getData:e,requestScheduler:n,onLoad:i,onError:r}){const{index:s,id:o,bbox:a,userData:A,zoom:h}=this,p=this._loaderId;this._abortController=new AbortController;const{signal:m}=this._abortController,y=await n.scheduleRequest(this,C=>C.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let T=null,b;try{T=await e({index:s,id:o,bbox:a,userData:A,zoom:h,signal:m})}catch(C){b=C||!0}finally{y.done()}if(p===this._loaderId){if(this._loader=void 0,this.content=T,this._isCancelled&&!T){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,b?r(b,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}const _n={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},_E=new Z,jV=new Z;class N_{constructor(e=[0,0,0],n=[0,0,0],i){w(this,"center",void 0),w(this,"halfDiagonal",void 0),w(this,"minimum",void 0),w(this,"maximum",void 0),i=i||_E.copy(e).add(n).scale(.5),this.center=new Z(i),this.halfDiagonal=new Z(n).subtract(this.center),this.minimum=new Z(e),this.maximum=new Z(n)}clone(){return new N_(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=jV.from(e.normal),r=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-r>0?_n.INSIDE:s+r<0?_n.OUTSIDE:_n.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=_E.from(e).subtract(this.center),{halfDiagonal:i}=this;let r=0,s;return s=Math.abs(n.x)-i.x,s>0&&(r+=s*s),s=Math.abs(n.y)-i.y,s>0&&(r+=s*s),s=Math.abs(n.z)-i.z,s>0&&(r+=s*s),r}}const Rl=new Z,vE=new Z;class mc{constructor(e=[0,0,0],n=0){w(this,"center",void 0),w(this,"radius",void 0),this.radius=-0,this.center=new Z,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=Rl.from(n),this.center=new Z().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new mc(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,s=e.radius,o=Rl.copy(r).subtract(n),a=o.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return e.clone();const A=(i+a+s)*.5;return vE.copy(o).scale((-i+A)/a).add(n),this.center.copy(vE),this.radius=A,this}expand(e){const i=Rl.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=yk(Rl,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=Rl.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,s=e.normal.dot(n)+e.distance;return s<-i?_n.OUTSIDE:s<i?_n.INTERSECTING:_n.INSIDE}}const HV=new Z,WV=new Z,Su=new Z,Pu=new Z,Iu=new Z,QV=new Z,XV=new Z,fr={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class _c{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){w(this,"center",void 0),w(this,"halfAxes",void 0),this.center=new Z().from(e),this.halfAxes=new qt(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Z(e).len(),new Z(n).len(),new Z(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new Z(e).normalize(),s=new Z(n).normalize(),o=new Z(i).normalize();return new DA().fromMatrix3(new qt([...r,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new DA(i),s=new qt().fromQuaternion(r);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new Z().from(e),this.halfAxes=s,this}clone(){return new _c(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new mc){const n=this.halfAxes,i=n.getColumn(0,Su),r=n.getColumn(1,Pu),s=n.getColumn(2,Iu),o=HV.copy(i).add(r).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,s=i.x,o=i.y,a=i.z,A=Math.abs(s*r[fr.COLUMN0ROW0]+o*r[fr.COLUMN0ROW1]+a*r[fr.COLUMN0ROW2])+Math.abs(s*r[fr.COLUMN1ROW0]+o*r[fr.COLUMN1ROW1]+a*r[fr.COLUMN1ROW2])+Math.abs(s*r[fr.COLUMN2ROW0]+o*r[fr.COLUMN2ROW1]+a*r[fr.COLUMN2ROW2]),h=i.dot(n)+e.distance;return h<=-A?_n.OUTSIDE:h>=A?_n.INSIDE:_n.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=WV.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,Su),s=i.getColumn(1,Pu),o=i.getColumn(2,Iu),a=r.magnitude(),A=s.magnitude(),h=o.magnitude();r.normalize(),s.normalize(),o.normalize();let p=0,m;return m=Math.abs(n.dot(r))-a,m>0&&(p+=m*m),m=Math.abs(n.dot(s))-A,m>0&&(p+=m*m),m=Math.abs(n.dot(o))-h,m>0&&(p+=m*m),p}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,A=a.getColumn(0,Su),h=a.getColumn(1,Pu),p=a.getColumn(2,Iu),m=QV.copy(A).add(h).add(p).add(o),y=XV.copy(m).subtract(e);let T=n.dot(y);return r=Math.min(T,r),s=Math.max(T,s),m.copy(o).add(A).add(h).subtract(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),m.copy(o).add(A).subtract(h).add(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),m.copy(o).add(A).subtract(h).subtract(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),o.copy(m).subtract(A).add(h).add(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),o.copy(m).subtract(A).add(h).subtract(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),o.copy(m).subtract(A).subtract(h).add(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),o.copy(m).subtract(A).subtract(h).subtract(p),y.copy(m).subtract(e),T=n.dot(y),r=Math.min(T,r),s=Math.max(T,s),i[0]=r,i[1]=s,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,Su);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Pu);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Iu);return r.transformAsPoint(e),this.halfAxes=new qt([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const yE=new Z,EE=new Z;class pi{constructor(e=[0,0,1],n=0){w(this,"normal",void 0),w(this,"distance",void 0),this.normal=new Z,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Oi(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=yE.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),Oi(ni(this.normal.len(),1)),this.distance=r,this}clone(){return new pi(this.normal,this.distance)}equals(e){return ni(this.distance,e.distance)&&ni(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=EE.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=yE.from(e);const i=this.getPointDistance(e),r=EE.copy(this.normal).scale(i);return e.subtract(r).to(n)}}const TE=[new Z([1,0,0]),new Z([0,1,0]),new Z([0,0,1])],wE=new Z,JV=new Z;new pi(new Z(1,0,0),0);class qn{constructor(e=[]){w(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*TE.length;const n=e.center,i=e.radius;let r=0;for(const s of TE){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new pi),a||(a=this.planes[r+1]=new pi);const A=wE.copy(s).scale(-i).add(n);-s.dot(A),o.fromPointNormal(A,s);const h=wE.copy(s).scale(i).add(n),p=JV.copy(s).negate();-p.dot(h),a.fromPointNormal(h,p),r+=2}return this}computeVisibility(e){let n=_n.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case _n.OUTSIDE:return _n.OUTSIDE;case _n.INTERSECTING:n=_n.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Oi(Number.isFinite(n),"parentPlaneMask is required."),n===qn.MASK_OUTSIDE||n===qn.MASK_INSIDE)return n;let i=qn.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=r[s],A=e.intersectPlane(a);if(A===_n.OUTSIDE)return qn.MASK_OUTSIDE;A===_n.INTERSECTING&&(i|=o)}return i}}w(qn,"MASK_OUTSIDE",4294967295);w(qn,"MASK_INSIDE",0);w(qn,"MASK_INDETERMINATE",2147483647);new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;new Z;const $i=new qt,YV=new qt,KV=new qt,Mu=new qt,bE=new qt;function ZV(t,e={}){const n=kA.EPSILON20,i=10;let r=0,s=0;const o=YV,a=KV;o.identity(),a.copy(t);const A=n*qV(a);for(;s<i&&$V(a)>A;)ej(a,Mu),bE.copy(Mu).transpose(),a.multiplyRight(Mu),a.multiplyLeft(bE),o.multiplyRight(Mu),++r>2&&(++s,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function qV(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const Ng=[1,0,0],Ug=[2,2,1];function $V(t){let e=0;for(let n=0;n<3;++n){const i=t[$i.getElementIndex(Ug[n],Ng[n])];e+=2*i*i}return Math.sqrt(e)}function ej(t,e){const n=kA.EPSILON15;let i=0,r=1;for(let h=0;h<3;++h){const p=Math.abs(t[$i.getElementIndex(Ug[h],Ng[h])]);p>i&&(r=h,i=p)}const s=Ng[r],o=Ug[r];let a=1,A=0;if(Math.abs(t[$i.getElementIndex(o,s)])>n){const h=t[$i.getElementIndex(o,o)],p=t[$i.getElementIndex(s,s)],m=t[$i.getElementIndex(o,s)],y=(h-p)/2/m;let T;y<0?T=-1/(-y+Math.sqrt(1+y*y)):T=1/(y+Math.sqrt(1+y*y)),a=1/Math.sqrt(1+T*T),A=T*a}return qt.IDENTITY.to(e),e[$i.getElementIndex(s,s)]=e[$i.getElementIndex(o,o)]=a,e[$i.getElementIndex(o,s)]=A,e[$i.getElementIndex(s,o)]=-A,e}const Qr=new Z,tj=new Z,nj=new Z,ij=new Z,rj=new Z,sj=new qt,oj={diagonal:new qt,unitary:new qt};function aj(t,e=new _c){if(!t||t.length===0)return e.halfAxes=new qt([0,0,0,0,0,0,0,0,0]),e.center=new Z,e;const n=t.length,i=new Z(0,0,0);for(const Q of t)i.add(Q);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,A=0,h=0,p=0;for(const Q of t){const V=Qr.copy(Q).subtract(i);s+=V.x*V.x,o+=V.x*V.y,a+=V.x*V.z,A+=V.y*V.y,h+=V.y*V.z,p+=V.z*V.z}s*=r,o*=r,a*=r,A*=r,h*=r,p*=r;const m=sj;m[0]=s,m[1]=o,m[2]=a,m[3]=o,m[4]=A,m[5]=h,m[6]=a,m[7]=h,m[8]=p;const{unitary:y}=ZV(m,oj),T=e.halfAxes.copy(y);let b=T.getColumn(0,nj),C=T.getColumn(1,ij),R=T.getColumn(2,rj),S=-Number.MAX_VALUE,P=-Number.MAX_VALUE,I=-Number.MAX_VALUE,F=Number.MAX_VALUE,j=Number.MAX_VALUE,X=Number.MAX_VALUE;for(const Q of t)Qr.copy(Q),S=Math.max(Qr.dot(b),S),P=Math.max(Qr.dot(C),P),I=Math.max(Qr.dot(R),I),F=Math.min(Qr.dot(b),F),j=Math.min(Qr.dot(C),j),X=Math.min(Qr.dot(R),X);b=b.multiplyByScalar(.5*(F+S)),C=C.multiplyByScalar(.5*(j+P)),R=R.multiplyByScalar(.5*(X+I)),e.center.copy(b).add(C).add(R);const q=tj.set(S-F,P-j,I-X).multiplyByScalar(.5),ee=new qt([q[0],0,0,0,q[1],0,0,0,q[2]]);return e.halfAxes.multiplyRight(ee),e}const ua=512,xE=3,XS=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],JS=XS.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),lj=JS.concat([[.25,.5],[.75,.5]]);class fa{constructor(e,n,i){w(this,"x",void 0),w(this,"y",void 0),w(this,"z",void 0),w(this,"childVisible",void 0),w(this,"selected",void 0),w(this,"_children",void 0),this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new fa(e,n,i),new fa(e,n+1,i),new fa(e+1,n,i),new fa(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:r,minZ:s,maxZ:o,bounds:a,offset:A,project:h}=e,p=this.getBoundingVolume(r,A,h);if(a&&!this.insideBounds(a)||i.computeVisibility(p)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<o&&y>=s){const T=p.distanceTo(n.cameraPosition)*n.scale/n.height;y+=Math.floor(Math.log2(T))}if(y>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,i,r]){const s=Math.pow(2,this.z),o=ua/s;return this.x*o<i&&this.y*o<r&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,i){if(i){const A=this.z<1?lj:this.z<2?JS:XS,h=[];for(const p of A){const m=Vg(this.x+p[0],this.y+p[1],this.z);m[2]=e[0],h.push(i(m)),e[0]!==e[1]&&(m[2]=e[1],h.push(i(m)))}return aj(h)}const r=Math.pow(2,this.z),s=ua/r,o=this.x*s+n*ua,a=ua-(this.y+1)*s;return new N_([o,a,e[0]],[o+s,a+s,e[1]])}}function Aj(t,e,n,i){const r=t instanceof jG&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:T,distance:b})=>new pi(T.clone().negate(),b)),o=new qn(s),a=t.distanceScales.unitsPerMeter[2],A=n&&n[0]*a||0,h=n&&n[1]*a||0,p=t instanceof Wi&&t.pitch<=60?e:0;if(i){const[T,b,C,R]=i,S=ps([T,R]),P=ps([C,b]);i=[S[0],ua-S[1],P[0],ua-P[1]]}const m=new fa(0,0,0),y={viewport:t,project:r,cullingVolume:o,elevationBounds:[A,h],minZ:p,maxZ:e,bounds:i,offset:0};if(m.update(y),t instanceof Wi&&t.subViewports&&t.subViewports.length>1){for(y.offset=-1;m.update(y)&&!(--y.offset<-xE););for(y.offset=1;m.update(y)&&!(++y.offset>xE););}return m.getSelected()}const Pr=512,cj=[-1/0,-1/0,1/0,1/0],Gg={type:"url",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equals:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function YS(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(r=>r[0])),Math.min(...n.map(r=>r[1])),Math.max(...n.map(r=>r[0])),Math.max(...n.map(r=>r[1]))]}function uj(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function oh(t,e){if(!t||!t.length)return null;const{index:n,id:i}=e;if(Array.isArray(t)){const s=uj(i)%t.length;t=t[s]}let r=t;for(const s of Object.keys(n)){const o=new RegExp("{".concat(s,"}"),"g");r=r.replace(o,String(n[s]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),r}function fj(t,e,n){let i;if(e&&e.length===2){const[r,s]=e,o=t.getBounds({z:r}),a=t.getBounds({z:s});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function hj({viewport:t,z:e=0,cullRect:n}){return(t.subViewports||[t]).map(r=>zg(r,e,n))}function zg(t,e,n){if(!Array.isArray(e)){const s=n.x-t.x,o=n.y-t.y,{width:a,height:A}=n,h={targetZ:e},p=t.unproject([s,o],h),m=t.unproject([s+a,o],h),y=t.unproject([s,o+A],h),T=t.unproject([s+a,o+A],h);return[Math.min(p[0],m[0],y[0],T[0]),Math.min(p[1],m[1],y[1],T[1]),Math.max(p[0],m[0],y[0],T[0]),Math.max(p[1],m[1],y[1],T[1])]}const i=zg(t,e[0],n),r=zg(t,e[1],n);return[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[2],r[2]),Math.max(i[3],r[3])]}function dj(t,e,n){return n?YS(t,n).map(r=>r*e/Pr):t.map(i=>i*e/Pr)}function U_(t,e){return Math.pow(2,t)*Pr/e}function Vg(t,e,n){const i=U_(n,Pr),r=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function CE(t,e,n,i){const r=U_(n,i);return[t/r*Pr,e/r*Pr]}function pj(t,e,n,i,r=Pr){if(t.isGeospatial){const[h,p]=Vg(e,n,i),[m,y]=Vg(e+1,n+1,i);return{west:h,north:p,east:m,south:y}}const[s,o]=CE(e,n,i,r),[a,A]=CE(e+1,n+1,i,r);return{left:s,top:o,right:a,bottom:A}}function gj(t,e,n,i,r){const s=fj(t,null,i),o=U_(e,n),[a,A,h,p]=dj(s,o,r),m=[];for(let y=Math.floor(a);y<h;y++)for(let T=Math.floor(A);T<p;T++)m.push({x:y,y:T,z:e});return m}function mj({viewport:t,maxZoom:e,minZoom:n,zRange:i,extent:r,tileSize:s=Pr,modelMatrix:o,modelMatrixInverse:a,zoomOffset:A=0}){let h=t.isGeospatial?Math.round(t.zoom+Math.log2(Pr/s))+A:Math.ceil(t.zoom)+A;if(typeof n=="number"&&Number.isFinite(n)&&h<n){if(!r)return[];h=n}typeof e=="number"&&Number.isFinite(e)&&h>e&&(h=e);let p=r;return o&&a&&r&&!t.isGeospatial&&(p=YS(r,o)),t.isGeospatial?Aj(t,h,i,r):gj(t,h,s,p||cj,a)}function _j(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function vj(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}const SE=1,Vh=2,yj="never",Ej="no-overlap",G_="best-available",Tj=5,wj={[G_]:xj,[Ej]:Cj,[yj]:()=>{}};class bj{constructor(e){w(this,"opts",void 0),w(this,"_requestScheduler",void 0),w(this,"_cache",void 0),w(this,"_dirty",void 0),w(this,"_tiles",void 0),w(this,"_cacheByteSize",void 0),w(this,"_viewport",void 0),w(this,"_zRange",void 0),w(this,"_selectedTiles",void 0),w(this,"_frameNumber",void 0),w(this,"_modelMatrix",void 0),w(this,"_modelMatrixInverse",void 0),w(this,"_maxZoom",void 0),w(this,"_minZoom",void 0),w(this,"onTileLoad",void 0),w(this,"_getCullBounds",Ya(hj)),this.opts=e,this.onTileLoad=n=>{this.opts.onTileLoad(n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new gx({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Ue,this._modelMatrixInverse=new Ue,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:i}={}){const r=new Ue(i),s=!r.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!ni(this._zRange,n)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(A=>this._getTile(A,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:r}=e;for(const[s,o,a,A]of i){let h;if("west"in r)h=r.west<a&&r.east>s&&r.south<A&&r.north>o;else{const p=Math.min(r.top,r.bottom),m=Math.max(r.top,r.bottom);h=r.left<a&&r.right>s&&p<A&&m>o}if(h)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:i,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:A,zoomOffset:h}=this.opts;return mj({viewport:e,maxZoom:n,minZoom:i,zRange:r,tileSize:a,extent:A,modelMatrix:s,modelMatrixInverse:o,zoomOffset:h})}getTileId(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:pj(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),i=Math.floor(e.y/2),r=e.z-1;return{x:n,y:i,z:r}}updateTileStates(){const e=this.opts.refinementStrategy||G_,n=new Array(this._cache.size);let i=0;for(const r of this._cache.values())n[i++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof e=="function"?e:wj[e])(Array.from(this._cache.values())),i=0;for(const r of this._cache.values())if(n[i++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e}=this.opts,n=[];let i=0;for(const r of this._cache.values())r.isLoading&&(i++,!r.isSelected&&!r.isVisible&&n.push(r));for(;e>0&&i>e&&n.length>0;)n.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const i=this._getNearestAncestor(n);n.parent=i,i!=null&&i.children&&i.children.push(n)}}_resizeCache(){const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:Tj*this.selectedTiles.length),r=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>r){for(const[o,a]of e)if(!a.isVisible&&!a.isSelected&&(this._cacheByteSize-=n.maxCacheByteSize?a.byteLength:0,e.delete(o),this.opts.onTileUnload(a)),e.size<=i&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,a)=>o.zoom-a.zoom),this._dirty=!1)}_getTile(e,n){const i=this.getTileId(e);let r=this._cache.get(i),s=!1;return!r&&n?(r=new VV(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:i,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(i,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:n=0}=this;let i=e.index;for(;this.getTileZoom(i)>n;){i=this.getParentIndex(i);const r=this._getTile(i);if(r)return r}return null}}function xj(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!KS(e)&&z_(e);for(const e of t)e.isVisible=Boolean(e.state&Vh)}function Cj(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&KS(n);const e=Array.from(t).sort((n,i)=>n.zoom-i.zoom);for(const n of e)if(n.isVisible=Boolean(n.state&Vh),n.children&&(n.isVisible||n.state&SE))for(const i of n.children)i.state=SE;else n.isSelected&&z_(n)}function KS(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Vh,!0;e=e.parent}return!1}function z_(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Vh:z_(e)}const Sj={TilesetClass:bj,data:{type:"data",value:[]},dataComparator:Gg.equals,renderSubLayers:{type:"function",value:t=>new Za(t),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:t=>console.error(t),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:G_,zRange:null,maxRequests:6,zoomOffset:0};class vc extends Lr{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||n.finalize()}get isLoaded(){var e,n;return(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0?void 0:n.selectedTiles.every(i=>i.isLoaded&&i.layers&&i.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?i&&(n.setOptions(this._getTilesetOptions()),r?n.reloadAll():this.state.tileset.tiles.forEach(s=>{s.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:s,maxZoom:o,minZoom:a,maxRequests:A,zoomOffset:h}=this.props;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:r,extent:s,maxRequests:A,zoomOffset:h,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:i}=this.props,r=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==r;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:r}=this.props,{signal:s}=e;return e.url=typeof n=="string"||Array.isArray(n)?oh(n,e):null,i?i(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:n}){return e.picked&&(e.tile=n.props.tile),e}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.id),data:e.content,_offset:0,tile:e});e.layers=ao(i,Boolean).map(r=>r.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,n)}}w(vc,"defaultProps",Sj);w(vc,"layerName","TileLayer");const Pj={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class ZS extends pc{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:i,currentTime:r}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:i,currentTime:r},super.draw(e)}}w(ZS,"layerName","TripsLayer");w(ZS,"defaultProps",Pj);var xt=function(t){t=t||{};var e=typeof t<"u"?t:{},n={},i;for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);var r="";function s(Y){return e.locateFile?e.locateFile(Y,r):r+Y}var o;document.currentScript&&(r=document.currentScript.src),r.indexOf("blob:")!==0?r=r.substr(0,r.lastIndexOf("/")+1):r="",o=function(ie,he,Me){var u=new XMLHttpRequest;u.open("GET",ie,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status==200||u.status==0&&u.response){he(u.response);return}var Ze=sl(ie);if(Ze){he(Ze.buffer);return}Me()},u.onerror=Me,u.send(null)};var a=e.print||console.log.bind(console),A=e.printErr||console.warn.bind(console);for(i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);n=null,e.arguments&&e.arguments;var h=0,p=function(Y){h=Y},m=function(){return h},y=8;function T(Y,ie,he,Me){switch(he=he||"i8",he.charAt(he.length-1)==="*"&&(he="i32"),he){case"i1":re[Y>>0]=ie;break;case"i8":re[Y>>0]=ie;break;case"i16":pe[Y>>1]=ie;break;case"i32":Be[Y>>2]=ie;break;case"i64":nl=[ie>>>0,(Or=ie,+Cs(Or)>=1?Or>0?(li(+Ps(Or/4294967296),4294967295)|0)>>>0:~~+Ss((Or-+(~~Or>>>0))/4294967296)>>>0:0)],Be[Y>>2]=nl[0],Be[Y+4>>2]=nl[1];break;case"float":Ye[Y>>2]=ie;break;case"double":Qe[Y>>3]=ie;break;default:Qi("invalid type for setValue: "+he)}}function b(Y,ie,he){switch(ie=ie||"i8",ie.charAt(ie.length-1)==="*"&&(ie="i32"),ie){case"i1":return re[Y>>0];case"i8":return re[Y>>0];case"i16":return pe[Y>>1];case"i32":return Be[Y>>2];case"i64":return Be[Y>>2];case"float":return Ye[Y>>2];case"double":return Qe[Y>>3];default:Qi("invalid type for getValue: "+ie)}return null}var C=!1;function R(Y,ie){Y||Qi("Assertion failed: "+ie)}function S(Y){var ie=e["_"+Y];return R(ie,"Cannot call unknown function "+Y+", make sure it is exported"),ie}function P(Y,ie,he,Me,u){var N={string:function(Ot){var Xi=0;if(Ot!=null&&Ot!==0){var Co=(Ot.length<<2)+1;Xi=Sc(Co),ee(Ot,Xi,Co)}return Xi},array:function(Ot){var Xi=Sc(Ot.length);return Q(Ot,Xi),Xi}};function Ze(Ot){return ie==="string"?X(Ot):ie==="boolean"?Boolean(Ot):Ot}var et=S(Y),Ve=[],We=0;if(Me)for(var _t=0;_t<Me.length;_t++){var qe=N[he[_t]];qe?(We===0&&(We=Pc()),Ve[_t]=qe(Me[_t])):Ve[_t]=Me[_t]}var Je=et.apply(null,Ve);return Je=Ze(Je),We!==0&&td(We),Je}function I(Y,ie,he,Me){he=he||[];var u=he.every(function(Ze){return Ze==="number"}),N=ie!=="string";return N&&u&&!Me?S(Y):function(){return P(Y,ie,he,arguments)}}var F=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function j(Y,ie,he){for(var Me=ie+he,u=ie;Y[u]&&!(u>=Me);)++u;if(u-ie>16&&Y.subarray&&F)return F.decode(Y.subarray(ie,u));for(var N="";ie<u;){var Ze=Y[ie++];if(!(Ze&128)){N+=String.fromCharCode(Ze);continue}var et=Y[ie++]&63;if((Ze&224)==192){N+=String.fromCharCode((Ze&31)<<6|et);continue}var Ve=Y[ie++]&63;if((Ze&240)==224?Ze=(Ze&15)<<12|et<<6|Ve:Ze=(Ze&7)<<18|et<<12|Ve<<6|Y[ie++]&63,Ze<65536)N+=String.fromCharCode(Ze);else{var We=Ze-65536;N+=String.fromCharCode(55296|We>>10,56320|We&1023)}}return N}function X(Y,ie){return Y?j(le,Y,ie):""}function q(Y,ie,he,Me){if(!(Me>0))return 0;for(var u=he,N=he+Me-1,Ze=0;Ze<Y.length;++Ze){var et=Y.charCodeAt(Ze);if(et>=55296&&et<=57343){var Ve=Y.charCodeAt(++Ze);et=65536+((et&1023)<<10)|Ve&1023}if(et<=127){if(he>=N)break;ie[he++]=et}else if(et<=2047){if(he+1>=N)break;ie[he++]=192|et>>6,ie[he++]=128|et&63}else if(et<=65535){if(he+2>=N)break;ie[he++]=224|et>>12,ie[he++]=128|et>>6&63,ie[he++]=128|et&63}else{if(he+3>=N)break;ie[he++]=240|et>>18,ie[he++]=128|et>>12&63,ie[he++]=128|et>>6&63,ie[he++]=128|et&63}}return ie[he]=0,he-u}function ee(Y,ie,he){return q(Y,le,ie,he)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function Q(Y,ie){re.set(Y,ie)}function V(Y,ie){return Y%ie>0&&(Y+=ie-Y%ie),Y}var D,re,le,pe,Be,Ye,Qe;function oe(Y){D=Y,e.HEAP8=re=new Int8Array(Y),e.HEAP16=pe=new Int16Array(Y),e.HEAP32=Be=new Int32Array(Y),e.HEAPU8=le=new Uint8Array(Y),e.HEAPU16=new Uint16Array(Y),e.HEAPU32=new Uint32Array(Y),e.HEAPF32=Ye=new Float32Array(Y),e.HEAPF64=Qe=new Float64Array(Y)}var ye=5266928,Ce=24016,Le=e.TOTAL_MEMORY||33554432;e.buffer?D=e.buffer:D=new ArrayBuffer(Le),Le=D.byteLength,oe(D),Be[Ce>>2]=ye;function ke(Y){for(;Y.length>0;){var ie=Y.shift();if(typeof ie=="function"){ie();continue}var he=ie.func;typeof he=="number"?ie.arg===void 0?e.dynCall_v(he):e.dynCall_vi(he,ie.arg):he(ie.arg===void 0?null:ie.arg)}}var Wt=[],zn=[],bs=[],ai=[];function Bt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)yo(e.preRun.shift());ke(Wt)}function Ar(){ke(zn)}function Lt(){ke(bs)}function un(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)xs(e.postRun.shift());ke(ai)}function yo(Y){Wt.unshift(Y)}function xs(Y){ai.unshift(Y)}var Cs=Math.abs,Ss=Math.ceil,Ps=Math.floor,li=Math.min,Tn=0,Rr=null;function yc(Y){Tn++,e.monitorRunDependencies&&e.monitorRunDependencies(Tn)}function Eo(Y){if(Tn--,e.monitorRunDependencies&&e.monitorRunDependencies(Tn),Tn==0&&Rr){var ie=Rr;Rr=null,ie()}}e.preloadedImages={},e.preloadedAudios={};var Rt=null,tl="data:application/octet-stream;base64,";function Ec(Y){return String.prototype.startsWith?Y.startsWith(tl):Y.indexOf(tl)===0}var Or,nl;Rt="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var Jh=24032;function Tc(Y){return Y}function il(Y){var ie=/\b__Z[\w\d_]+/g;return Y.replace(ie,function(he){var Me=he;return he===Me?he:Me+" ["+he+"]"})}function rl(){var Y=new Error;if(!Y.stack){try{throw new Error(0)}catch(ie){Y=ie}if(!Y.stack)return"(no stack trace available)"}return Y.stack.toString()}function wc(){var Y=rl();return e.extraStackTrace&&(Y+=`
`+e.extraStackTrace()),il(Y)}function To(Y,ie,he,Me){Qi("Assertion failed: "+X(Y)+", at: "+[ie?X(ie):"unknown filename",he,Me?X(Me):"unknown function"])}function wo(){return re.length}function Yh(Y,ie,he){le.set(le.subarray(ie,ie+he),Y)}function Kh(Y){return e.___errno_location&&(Be[e.___errno_location()>>2]=Y),Y}function Zh(Y){Qi("OOM")}function bc(Y){try{var ie=new ArrayBuffer(Y);return ie.byteLength!=Y?void 0:(new Int8Array(ie).set(re),ed(ie),oe(ie),1)}catch{}}function qh(Y){var ie=wo(),he=16777216,Me=2147483648-he;if(Y>Me)return!1;for(var u=16777216,N=Math.max(ie,u);N<Y;)N<=536870912?N=V(2*N,he):N=Math.min(V((3*N+2147483648)/4,he),Me);var Ze=bc(N);return!!Ze}var bo=typeof atob=="function"?atob:function(Y){var ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",he="",Me,u,N,Ze,et,Ve,We,_t=0;Y=Y.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ze=ie.indexOf(Y.charAt(_t++)),et=ie.indexOf(Y.charAt(_t++)),Ve=ie.indexOf(Y.charAt(_t++)),We=ie.indexOf(Y.charAt(_t++)),Me=Ze<<2|et>>4,u=(et&15)<<4|Ve>>2,N=(Ve&3)<<6|We,he=he+String.fromCharCode(Me),Ve!==64&&(he=he+String.fromCharCode(u)),We!==64&&(he=he+String.fromCharCode(N));while(_t<Y.length);return he};function $h(Y){try{for(var ie=bo(Y),he=new Uint8Array(ie.length),Me=0;Me<ie.length;++Me)he[Me]=ie.charCodeAt(Me);return he}catch{throw new Error("Converting base64 string to bytes failed.")}}function sl(Y){if(Ec(Y))return $h(Y.slice(tl.length))}var xc={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Cc={a:Qi,b:p,c:m,d:To,e:Kh,f:wo,g:Yh,h:qh,i:Zh,j:Tc,k:il,l:bc,m:rl,n:wc,o:Jh,p:Ce},fe=function(Y,ie,he){var Me=new Y.Int8Array(he),u=new Y.Int32Array(he);new Y.Uint8Array(he),new Y.Float32Array(he);var N=new Y.Float64Array(he),Ze=ie.p|0,et=Y.Math.floor,Ve=Y.Math.abs,We=Y.Math.sqrt,_t=Y.Math.pow,qe=Y.Math.cos,Je=Y.Math.sin,Ot=Y.Math.tan,Xi=Y.Math.acos,Co=Y.Math.asin,Fr=Y.Math.atan,vt=Y.Math.atan2,bi=Y.Math.ceil,tn=Y.Math.imul,xi=Y.Math.min,Vn=Y.Math.clz32,Pe=ie.b,z=ie.c,tt=ie.d,ll=ie.e,So=ie.f,jn=ie.g,Po=ie.h,Al=ie.i,k=24048;function cl(l){return Me=new Int8Array(l),u=new Int32Array(l),N=new Float64Array(l),he=l,!0}function ul(l){l=l|0;var c=0;return c=k,k=k+l|0,k=k+15&-16,c|0}function Io(){return k|0}function Ci(l){l=l|0,k=l}function nd(l,c){l=l|0,k=l}function Bc(l){return l=l|0,(tn(l*3|0,l+1|0)|0)+1|0}function Mo(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0;fl(l,c,f,d,0)|0&&(v=(tn(f*3|0,f+1|0)|0)+1|0,Pi(d|0,0,v<<3|0)|0,g=Si(v,4)|0,g&&(Ai(l,c,f,d,g,v,0),ze(g)))}function Lc(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0;if(fl(l,c,f,d,g)|0){if(v=(tn(f*3|0,f+1|0)|0)+1|0,Pi(d|0,0,v<<3|0)|0,g|0){Pi(g|0,0,v<<2|0)|0,Ai(l,c,f,d,g,v,0);return}g=Si(v,4)|0,g&&(Ai(l,c,f,d,g,v,0),ze(g))}}function fl(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0;if(J=k,k=k+16|0,H=J,v=d,u[v>>2]=l,u[v+4>>2]=c,v=(g|0)!=0,v&&(u[g>>2]=0),Xt(l,c)|0)return H=1,k=J,H|0;u[H>>2]=0;e:do if((f|0)>=1)if(v)for(M=0,B=1,U=1,_=0,v=l;;){if(!(_|M)){if(v=L(v,c,4,H)|0,c=z()|0,(v|0)==0&(c|0)==0){v=2;break e}if(Xt(v,c)|0){v=1;break e}}if(v=L(v,c,u[16+(M<<2)>>2]|0,H)|0,c=z()|0,(v|0)==0&(c|0)==0){v=2;break e}if(l=d+(U<<3)|0,u[l>>2]=v,u[l+4>>2]=c,u[g+(U<<2)>>2]=B,_=_+1|0,l=(_|0)==(B|0),E=M+1|0,x=(E|0)==6,Xt(v,c)|0){v=1;break e}if(B=B+(x&l&1)|0,(B|0)>(f|0)){v=0;break}else M=l?x?0:E:M,U=U+1|0,_=l?0:_}else for(M=0,B=1,U=1,_=0,v=l;;){if(!(_|M)){if(v=L(v,c,4,H)|0,c=z()|0,(v|0)==0&(c|0)==0){v=2;break e}if(Xt(v,c)|0){v=1;break e}}if(v=L(v,c,u[16+(M<<2)>>2]|0,H)|0,c=z()|0,(v|0)==0&(c|0)==0){v=2;break e}if(l=d+(U<<3)|0,u[l>>2]=v,u[l+4>>2]=c,_=_+1|0,l=(_|0)==(B|0),E=M+1|0,x=(E|0)==6,Xt(v,c)|0){v=1;break e}if(B=B+(x&l&1)|0,(B|0)>(f|0)){v=0;break}else M=l?x?0:E:M,U=U+1|0,_=l?0:_}else v=0;while(0);return H=v,k=J,H|0}function Ai(l,c,f,d,g,v,_){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0,v=v|0,_=_|0;var E=0,x=0,M=0,B=0,U=0,H=0,J=0;if(U=k,k=k+16|0,B=U,(l|0)==0&(c|0)==0){k=U;return}if(E=Nr(l|0,c|0,v|0,((v|0)<0)<<31>>31|0)|0,z()|0,x=d+(E<<3)|0,H=x,J=u[H>>2]|0,H=u[H+4>>2]|0,M=(J|0)==(l|0)&(H|0)==(c|0),!((J|0)==0&(H|0)==0|M))do E=(E+1|0)%(v|0)|0,x=d+(E<<3)|0,J=x,H=u[J>>2]|0,J=u[J+4>>2]|0,M=(H|0)==(l|0)&(J|0)==(c|0);while(!((H|0)==0&(J|0)==0|M));if(E=g+(E<<2)|0,M&&(u[E>>2]|0)<=(_|0)){k=U;return}if(J=x,u[J>>2]=l,u[J+4>>2]=c,u[E>>2]=_,(_|0)>=(f|0)){k=U;return}J=_+1|0,u[B>>2]=0,H=L(l,c,2,B)|0,Ai(H,z()|0,f,d,g,v,J),u[B>>2]=0,H=L(l,c,3,B)|0,Ai(H,z()|0,f,d,g,v,J),u[B>>2]=0,H=L(l,c,1,B)|0,Ai(H,z()|0,f,d,g,v,J),u[B>>2]=0,H=L(l,c,5,B)|0,Ai(H,z()|0,f,d,g,v,J),u[B>>2]=0,H=L(l,c,4,B)|0,Ai(H,z()|0,f,d,g,v,J),u[B>>2]=0,H=L(l,c,6,B)|0,Ai(H,z()|0,f,d,g,v,J),k=U}function L(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0;if((u[d>>2]|0)>0){g=0;do f=Ls(f)|0,g=g+1|0;while((g|0)<(u[d>>2]|0))}E=ce(l|0,c|0,45)|0,z()|0,x=E&127,v=Ln(l,c)|0,g=ce(l|0,c|0,52)|0,z()|0,g=g&15;e:do if(!g)_=6;else for(;;){if(U=(15-g|0)*3|0,H=ce(l|0,c|0,U|0)|0,z()|0,H=H&7,J=(ci(g)|0)==0,g=g+-1|0,B=_e(7,0,U|0)|0,c=c&~(z()|0),U=_e(u[(J?464:48)+(H*28|0)+(f<<2)>>2]|0,0,U|0)|0,M=z()|0,f=u[(J?672:256)+(H*28|0)+(f<<2)>>2]|0,l=U|l&~B,c=M|c,!f){f=0;break e}if(!g){_=6;break}}while(0);(_|0)==6&&(J=u[880+(x*28|0)+(f<<2)>>2]|0,H=_e(J|0,0,45)|0,l=H|l,c=z()|0|c&-1040385,f=u[4304+(x*28|0)+(f<<2)>>2]|0,(J&127|0)==127&&(J=_e(u[880+(x*28|0)+20>>2]|0,0,45)|0,c=z()|0|c&-1040385,f=u[4304+(x*28|0)+20>>2]|0,l=kr(J|l,c)|0,c=z()|0,u[d>>2]=(u[d>>2]|0)+1)),_=ce(l|0,c|0,45)|0,z()|0,_=_&127;e:do if(Ge(_)|0){t:do if((Ln(l,c)|0)==1){if((x|0)!=(_|0))if(A1(_,u[7728+(x*28|0)>>2]|0)|0){l=ud(l,c)|0,v=1,c=z()|0;break}else{l=kr(l,c)|0,v=1,c=z()|0;break}switch(v|0){case 5:{l=ud(l,c)|0,c=z()|0,u[d>>2]=(u[d>>2]|0)+5,v=0;break t}case 3:{l=kr(l,c)|0,c=z()|0,u[d>>2]=(u[d>>2]|0)+1,v=0;break t}default:return H=0,J=0,Pe(H|0),J|0}}else v=0;while(0);if((f|0)>0){g=0;do l=cd(l,c)|0,c=z()|0,g=g+1|0;while((g|0)!=(f|0))}if((x|0)!=(_|0)){if(!(Qt(_)|0)){if((v|0)!=0|(Ln(l,c)|0)!=5)break;u[d>>2]=(u[d>>2]|0)+1;break}switch(E&127){case 8:case 118:break e}(Ln(l,c)|0)!=3&&(u[d>>2]=(u[d>>2]|0)+1)}}else if((f|0)>0){g=0;do l=kr(l,c)|0,c=z()|0,g=g+1|0;while((g|0)!=(f|0))}while(0);return u[d>>2]=((u[d>>2]|0)+f|0)%6|0,H=c,J=l,Pe(H|0),J|0}function O(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0;if(U=k,k=k+16|0,B=U,!f)return B=d,u[B>>2]=l,u[B+4>>2]=c,B=0,k=U,B|0;u[B>>2]=0;e:do if(Xt(l,c)|0)l=1;else{if(v=(f|0)>0,v){g=0,M=l;do{if(M=L(M,c,4,B)|0,c=z()|0,(M|0)==0&(c|0)==0){l=2;break e}if(g=g+1|0,Xt(M,c)|0){l=1;break e}}while((g|0)<(f|0));if(x=d,u[x>>2]=M,u[x+4>>2]=c,x=f+-1|0,v){v=0,_=1,g=M,l=c;do{if(g=L(g,l,2,B)|0,l=z()|0,(g|0)==0&(l|0)==0){l=2;break e}if(E=d+(_<<3)|0,u[E>>2]=g,u[E+4>>2]=l,_=_+1|0,Xt(g,l)|0){l=1;break e}v=v+1|0}while((v|0)<(f|0));E=0,v=_;do{if(g=L(g,l,3,B)|0,l=z()|0,(g|0)==0&(l|0)==0){l=2;break e}if(_=d+(v<<3)|0,u[_>>2]=g,u[_+4>>2]=l,v=v+1|0,Xt(g,l)|0){l=1;break e}E=E+1|0}while((E|0)<(f|0));_=0;do{if(g=L(g,l,1,B)|0,l=z()|0,(g|0)==0&(l|0)==0){l=2;break e}if(E=d+(v<<3)|0,u[E>>2]=g,u[E+4>>2]=l,v=v+1|0,Xt(g,l)|0){l=1;break e}_=_+1|0}while((_|0)<(f|0));_=0;do{if(g=L(g,l,5,B)|0,l=z()|0,(g|0)==0&(l|0)==0){l=2;break e}if(E=d+(v<<3)|0,u[E>>2]=g,u[E+4>>2]=l,v=v+1|0,Xt(g,l)|0){l=1;break e}_=_+1|0}while((_|0)<(f|0));_=0;do{if(g=L(g,l,4,B)|0,l=z()|0,(g|0)==0&(l|0)==0){l=2;break e}if(E=d+(v<<3)|0,u[E>>2]=g,u[E+4>>2]=l,v=v+1|0,Xt(g,l)|0){l=1;break e}_=_+1|0}while((_|0)<(f|0));for(_=0;;){if(g=L(g,l,6,B)|0,l=z()|0,(g|0)==0&(l|0)==0){l=2;break e}if((_|0)!=(x|0))if(E=d+(v<<3)|0,u[E>>2]=g,u[E+4>>2]=l,!(Xt(g,l)|0))v=v+1|0;else{l=1;break e}if(_=_+1|0,(_|0)>=(f|0)){_=M,v=c;break}}}else _=M,g=M,v=c,l=c}else _=d,u[_>>2]=l,u[_+4>>2]=c,_=l,g=l,v=c,l=c;l=((_|0)!=(g|0)|(v|0)!=(l|0))&1}while(0);return B=l,k=U,B|0}function G(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0;if(v=k,k=k+48|0,g=v+8|0,d=v,E=l,_=u[E+4>>2]|0,f=d,u[f>>2]=u[E>>2],u[f+4>>2]=_,dd(d,g),g=sd(g,c)|0,c=u[d>>2]|0,d=u[l+8>>2]|0,(d|0)<=0)return E=c,_=(g|0)<(E|0),E=_?E:g,E=E+12|0,k=v,E|0;f=u[l+12>>2]|0,l=0;do c=(u[f+(l<<3)>>2]|0)+c|0,l=l+1|0;while((l|0)<(d|0));return E=(g|0)<(c|0),E=E?c:g,E=E+12|0,k=v,E|0}function K(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0;if(E=k,k=k+48|0,d=E+8|0,g=E,!(se(l,c,f)|0)){k=E;return}if(x=l,v=u[x+4>>2]|0,_=g,u[_>>2]=u[x>>2],u[_+4>>2]=v,dd(g,d),_=sd(d,c)|0,c=u[g>>2]|0,v=u[l+8>>2]|0,(v|0)>0){g=u[l+12>>2]|0,d=0;do c=(u[g+(d<<3)>>2]|0)+c|0,d=d+1|0;while((d|0)!=(v|0))}if(c=(_|0)<(c|0)?c:_,(c|0)<=-12){k=E;return}x=c+11|0,Pi(f|0,0,(((x|0)>0?x:0)<<3)+8|0)|0,k=E}function se(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0,me=0,Ne=0,lt=0,st=0,ft=0,nt=0,dt=0,pt=0,Oe=0;if(Oe=k,k=k+112|0,ft=Oe+80|0,x=Oe+72|0,nt=Oe,dt=Oe+56|0,M=l+8|0,pt=Ji((u[M>>2]<<5)+32|0)|0,pt||tt(22848,22448,800,22456),yI(l,pt),v=l,d=u[v+4>>2]|0,E=x,u[E>>2]=u[v>>2],u[E+4>>2]=d,dd(x,ft),E=sd(ft,c)|0,d=u[x>>2]|0,v=u[M>>2]|0,(v|0)>0){_=u[l+12>>2]|0,g=0;do d=(u[_+(g<<3)>>2]|0)+d|0,g=g+1|0;while((g|0)!=(v|0))}if(E=(E|0)<(d|0)?d:E,st=E+12|0,g=Si(st,8)|0,B=Si(st,8)|0,u[ft>>2]=0,Ne=l,lt=u[Ne+4>>2]|0,d=x,u[d>>2]=u[Ne>>2],u[d+4>>2]=lt,d=Te(x,st,c,ft,g,B)|0,d|0)return ze(g),ze(B),ze(pt),pt=d,k=Oe,pt|0;e:do if((u[M>>2]|0)>0){for(v=l+12|0,d=0;_=Te((u[v>>2]|0)+(d<<3)|0,st,c,ft,g,B)|0,d=d+1|0,!(_|0);)if((d|0)>=(u[M>>2]|0))break e;return ze(g),ze(B),ze(pt),pt=_,k=Oe,pt|0}while(0);(E|0)>-12&&Pi(B|0,0,((st|0)>1?st:1)<<3|0)|0;e:do if((u[ft>>2]|0)>0){lt=((st|0)<0)<<31>>31,W=g,Ee=B,we=g,de=g,me=B,Ne=g,d=g,ue=g,ve=B,$=B,ae=B,g=B;t:for(;;){for(ne=u[ft>>2]|0,J=0,te=0,v=0;;){_=nt,E=_+56|0;do u[_>>2]=0,_=_+4|0;while((_|0)<(E|0));if(c=W+(J<<3)|0,x=u[c>>2]|0,c=u[c+4>>2]|0,fl(x,c,1,nt,0)|0){_=nt,E=_+56|0;do u[_>>2]=0,_=_+4|0;while((_|0)<(E|0));_=Si(7,4)|0,_|0&&(Ai(x,c,1,nt,_,7,0),ze(_))}H=0;do{U=nt+(H<<3)|0,B=u[U>>2]|0,U=u[U+4>>2]|0;n:do if(!((B|0)==0&(U|0)==0)){if(x=Nr(B|0,U|0,st|0,lt|0)|0,z()|0,_=f+(x<<3)|0,E=_,c=u[E>>2]|0,E=u[E+4>>2]|0,!((c|0)==0&(E|0)==0))for(M=0;;){if((M|0)>(st|0))break t;if((c|0)==(B|0)&(E|0)==(U|0))break n;if(x=(x+1|0)%(st|0)|0,_=f+(x<<3)|0,E=_,c=u[E>>2]|0,E=u[E+4>>2]|0,(c|0)==0&(E|0)==0)break;M=M+1|0}(B|0)==0&(U|0)==0||(Rs(B,U,dt),EI(l,pt,dt)|0&&(M=_,u[M>>2]=B,u[M+4>>2]=U,M=Ee+(v<<3)|0,u[M>>2]=B,u[M+4>>2]=U,v=v+1|0))}while(0);H=H+1|0}while(H>>>0<7);if(te=te+1|0,(te|0)>=(ne|0))break;J=J+1|0}if((ne|0)>0&&Pi(we|0,0,ne<<3|0)|0,u[ft>>2]=v,(v|0)>0)B=g,U=ae,H=Ne,J=$,te=ve,ne=Ee,g=ue,ae=d,$=de,ve=we,ue=B,d=U,Ne=me,me=H,de=J,we=te,Ee=W,W=ne;else break e}return ze(de),ze(me),ze(pt),pt=-1,k=Oe,pt|0}else d=B;while(0);return ze(pt),ze(g),ze(d),pt=0,k=Oe,pt|0}function Te(l,c,f,d,g,v){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0,v=v|0;var _=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0,me=0,Ne=0,lt=0,st=0,ft=0;if(lt=k,k=k+48|0,we=lt+32|0,de=lt+16|0,me=lt,_=u[l>>2]|0,(_|0)<=0)return Ne=0,k=lt,Ne|0;ve=l+4|0,$=we+8|0,ae=de+8|0,W=me+8|0,Ee=((c|0)<0)<<31>>31,ue=0;e:for(;;){E=u[ve>>2]|0,te=E+(ue<<4)|0,u[we>>2]=u[te>>2],u[we+4>>2]=u[te+4>>2],u[we+8>>2]=u[te+8>>2],u[we+12>>2]=u[te+12>>2],(ue|0)==(_+-1|0)?(u[de>>2]=u[E>>2],u[de+4>>2]=u[E+4>>2],u[de+8>>2]=u[E+8>>2],u[de+12>>2]=u[E+12>>2]):(te=E+(ue+1<<4)|0,u[de>>2]=u[te>>2],u[de+4>>2]=u[te+4>>2],u[de+8>>2]=u[te+8>>2],u[de+12>>2]=u[te+12>>2]),te=b3(we,de,f)|0;t:do if((te|0)>0){ne=+(te|0),J=0;n:for(;;){ft=+(te-J|0),st=+(J|0),N[me>>3]=+N[we>>3]*ft/ne+ +N[de>>3]*st/ne,N[W>>3]=+N[$>>3]*ft/ne+ +N[ae>>3]*st/ne,U=x1(me,f)|0,H=z()|0,E=Nr(U|0,H|0,c|0,Ee|0)|0,z()|0,_=v+(E<<3)|0,x=_,M=u[x>>2]|0,x=u[x+4>>2]|0;i:do if((M|0)==0&(x|0)==0)Ne=14;else for(B=0;;){if((B|0)>(c|0)){_=1;break i}if((M|0)==(U|0)&(x|0)==(H|0)){_=7;break i}if(E=(E+1|0)%(c|0)|0,_=v+(E<<3)|0,x=_,M=u[x>>2]|0,x=u[x+4>>2]|0,(M|0)==0&(x|0)==0){Ne=14;break}else B=B+1|0}while(0);switch((Ne|0)==14&&(Ne=0,(U|0)==0&(H|0)==0?_=7:(u[_>>2]=U,u[_+4>>2]=H,_=u[d>>2]|0,B=g+(_<<3)|0,u[B>>2]=U,u[B+4>>2]=H,u[d>>2]=_+1,_=0)),_&7){case 7:case 0:break;default:break n}if(J=J+1|0,(te|0)<=(J|0)){Ne=8;break t}}if(_|0){_=-1,Ne=20;break e}}else Ne=8;while(0);if((Ne|0)==8&&(Ne=0),ue=ue+1|0,_=u[l>>2]|0,(ue|0)>=(_|0)){_=0,Ne=20;break}}return(Ne|0)==20?(k=lt,_|0):0}function Xe(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0;if(M=k,k=k+176|0,x=M,(c|0)<1){O1(f,0,0),k=M;return}_=l,_=ce(u[_>>2]|0,u[_+4>>2]|0,52)|0,z()|0,O1(f,(c|0)>6?c:6,_&15),_=0;do{if(d=l+(_<<3)|0,Os(u[d>>2]|0,u[d+4>>2]|0,x),d=u[x>>2]|0,(d|0)>0){E=0;do v=x+8+(E<<4)|0,E=E+1|0,d=x+8+(((E|0)%(d|0)|0)<<4)|0,g=OI(f,d,v)|0,g?k1(f,g)|0:RI(f,v,d)|0,d=u[x>>2]|0;while((E|0)<(d|0))}_=_+1|0}while((_|0)!=(c|0));k=M}function zt(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0;if(v=k,k=k+32|0,d=v,g=v+16|0,Xe(l,c,g),u[f>>2]=0,u[f+4>>2]=0,u[f+8>>2]=0,l=D1(g)|0,!l){P1(f)|0,F1(g),k=v;return}do{c=fI(f)|0;do hI(c,l)|0,_=l+16|0,u[d>>2]=u[_>>2],u[d+4>>2]=u[_+4>>2],u[d+8>>2]=u[_+8>>2],u[d+12>>2]=u[_+12>>2],k1(g,l)|0,l=FI(g,d)|0;while(l|0);l=D1(g)|0}while(l|0);P1(f)|0,F1(g),k=v}function Ge(l){return l=l|0,u[7728+(l*28|0)+16>>2]|0}function Qt(l){return l=l|0,(l|0)==4|(l|0)==117|0}function Hn(l){return l=l|0,u[11152+((u[l>>2]|0)*216|0)+((u[l+4>>2]|0)*72|0)+((u[l+8>>2]|0)*24|0)+(u[l+12>>2]<<3)>>2]|0}function v3(l){return l=l|0,u[11152+((u[l>>2]|0)*216|0)+((u[l+4>>2]|0)*72|0)+((u[l+8>>2]|0)*24|0)+(u[l+12>>2]<<3)+4>>2]|0}function y3(l,c){l=l|0,c=c|0,l=7728+(l*28|0)|0,u[c>>2]=u[l>>2],u[c+4>>2]=u[l+4>>2],u[c+8>>2]=u[l+8>>2],u[c+12>>2]=u[l+12>>2]}function E3(l,c){l=l|0,c=c|0;var f=0,d=0;if(c>>>0>20)return c=-1,c|0;do if((u[11152+(c*216|0)>>2]|0)!=(l|0))if((u[11152+(c*216|0)+8>>2]|0)!=(l|0))if((u[11152+(c*216|0)+16>>2]|0)!=(l|0))if((u[11152+(c*216|0)+24>>2]|0)!=(l|0))if((u[11152+(c*216|0)+32>>2]|0)!=(l|0))if((u[11152+(c*216|0)+40>>2]|0)!=(l|0))if((u[11152+(c*216|0)+48>>2]|0)!=(l|0))if((u[11152+(c*216|0)+56>>2]|0)!=(l|0))if((u[11152+(c*216|0)+64>>2]|0)!=(l|0))if((u[11152+(c*216|0)+72>>2]|0)!=(l|0))if((u[11152+(c*216|0)+80>>2]|0)!=(l|0))if((u[11152+(c*216|0)+88>>2]|0)!=(l|0))if((u[11152+(c*216|0)+96>>2]|0)!=(l|0))if((u[11152+(c*216|0)+104>>2]|0)!=(l|0))if((u[11152+(c*216|0)+112>>2]|0)!=(l|0))if((u[11152+(c*216|0)+120>>2]|0)!=(l|0))if((u[11152+(c*216|0)+128>>2]|0)!=(l|0))if((u[11152+(c*216|0)+136>>2]|0)==(l|0))l=2,f=1,d=2;else{if((u[11152+(c*216|0)+144>>2]|0)==(l|0)){l=0,f=2,d=0;break}if((u[11152+(c*216|0)+152>>2]|0)==(l|0)){l=0,f=2,d=1;break}if((u[11152+(c*216|0)+160>>2]|0)==(l|0)){l=0,f=2,d=2;break}if((u[11152+(c*216|0)+168>>2]|0)==(l|0)){l=1,f=2,d=0;break}if((u[11152+(c*216|0)+176>>2]|0)==(l|0)){l=1,f=2,d=1;break}if((u[11152+(c*216|0)+184>>2]|0)==(l|0)){l=1,f=2,d=2;break}if((u[11152+(c*216|0)+192>>2]|0)==(l|0)){l=2,f=2,d=0;break}if((u[11152+(c*216|0)+200>>2]|0)==(l|0)){l=2,f=2,d=1;break}if((u[11152+(c*216|0)+208>>2]|0)==(l|0)){l=2,f=2,d=2;break}else l=-1;return l|0}else l=2,f=1,d=1;else l=2,f=1,d=0;else l=1,f=1,d=2;else l=1,f=1,d=1;else l=1,f=1,d=0;else l=0,f=1,d=2;else l=0,f=1,d=1;else l=0,f=1,d=0;else l=2,f=0,d=2;else l=2,f=0,d=1;else l=2,f=0,d=0;else l=1,f=0,d=2;else l=1,f=0,d=1;else l=1,f=0,d=0;else l=0,f=0,d=2;else l=0,f=0,d=1;else l=0,f=0,d=0;while(0);return c=u[11152+(c*216|0)+(f*72|0)+(l*24|0)+(d<<3)+4>>2]|0,c|0}function A1(l,c){return l=l|0,c=c|0,(u[7728+(l*28|0)+20>>2]|0)==(c|0)?(c=1,c|0):(c=(u[7728+(l*28|0)+24>>2]|0)==(c|0),c|0)}function id(l,c){return l=l|0,c=c|0,u[880+(l*28|0)+(c<<2)>>2]|0}function rd(l,c){return l=l|0,c=c|0,(u[880+(l*28|0)>>2]|0)==(c|0)?(c=0,c|0):(u[880+(l*28|0)+4>>2]|0)==(c|0)?(c=1,c|0):(u[880+(l*28|0)+8>>2]|0)==(c|0)?(c=2,c|0):(u[880+(l*28|0)+12>>2]|0)==(c|0)?(c=3,c|0):(u[880+(l*28|0)+16>>2]|0)==(c|0)?(c=4,c|0):(u[880+(l*28|0)+20>>2]|0)==(c|0)?(c=5,c|0):((u[880+(l*28|0)+24>>2]|0)==(c|0)?6:7)|0}function T3(){return 122}function w3(l){l=l|0;var c=0,f=0,d=0;c=0;do _e(c|0,0,45)|0,d=z()|0|134225919,f=l+(c<<3)|0,u[f>>2]=-1,u[f+4>>2]=d,c=c+1|0;while((c|0)!=122)}function c1(l){return l=l|0,+N[l+16>>3]<+N[l+24>>3]|0}function u1(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;return f=+N[c>>3],!(f>=+N[l+8>>3])||!(f<=+N[l>>3])?(c=0,c|0):(d=+N[l+16>>3],f=+N[l+24>>3],g=+N[c+8>>3],c=g>=f,l=g<=d&1,d<f?c&&(l=1):c||(l=0),c=(l|0)!=0,c|0)}function sd(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0;_=k,k=k+288|0,f=_+264|0,d=_+96|0,g=_,v=g,E=v+96|0;do u[v>>2]=0,v=v+4|0;while((v|0)<(E|0));return hd(c,g),v=g,E=u[v>>2]|0,v=u[v+4>>2]|0,Rs(E,v,f),Os(E,v,d),x=+pl(f,d+8|0),N[f>>3]=+N[l>>3],v=f+8|0,N[v>>3]=+N[l+16>>3],N[d>>3]=+N[l+8>>3],E=d+8|0,N[E>>3]=+N[l+24>>3],M=+pl(f,d),E=~~+bi(+(M*M/+U1(+ +Ve(+((+N[v>>3]-+N[E>>3])/(+N[f>>3]-+N[d>>3]))),3)/(x*(x*2.59807621135)*.8))),k=_,(E|0?E:1)|0}function b3(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0;E=k,k=k+288|0,d=E+264|0,g=E+96|0,v=E,_=v,x=_+96|0;do u[_>>2]=0,_=_+4|0;while((_|0)<(x|0));return hd(f,v),x=v,_=u[x>>2]|0,x=u[x+4>>2]|0,Rs(_,x,d),Os(_,x,g),M=+pl(d,g+8|0),x=~~+bi(+(+pl(l,c)/(M*2))),k=E,(x|0?x:1)|0}function x3(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0,u[l>>2]=c,u[l+4>>2]=f,u[l+8>>2]=d}function C3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0;U=c+8|0,u[U>>2]=0,x=+N[l>>3],_=+Ve(+x),M=+N[l+8>>3],E=+Ve(+M)/.8660254037844386,_=_+E*.5,f=~~_,l=~~E,_=_-+(f|0),E=E-+(l|0);do if(_<.5)if(_<.3333333333333333)if(u[c>>2]=f,E<(_+1)*.5){u[c+4>>2]=l;break}else{l=l+1|0,u[c+4>>2]=l;break}else if(H=1-_,l=(!(E<H)&1)+l|0,u[c+4>>2]=l,H<=E&E<_*2){f=f+1|0,u[c>>2]=f;break}else{u[c>>2]=f;break}else{if(!(_<.6666666666666666))if(f=f+1|0,u[c>>2]=f,E<_*.5){u[c+4>>2]=l;break}else{l=l+1|0,u[c+4>>2]=l;break}if(E<1-_){if(u[c+4>>2]=l,_*2+-1<E){u[c>>2]=f;break}}else l=l+1|0,u[c+4>>2]=l;f=f+1|0,u[c>>2]=f}while(0);do if(x<0)if(l&1){B=(l+1|0)/2|0,B=ml(f|0,((f|0)<0)<<31>>31|0,B|0,((B|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-((+(B>>>0)+4294967296*+(z()|0))*2+1)),u[c>>2]=f;break}else{B=(l|0)/2|0,B=ml(f|0,((f|0)<0)<<31>>31|0,B|0,((B|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-(+(B>>>0)+4294967296*+(z()|0))*2),u[c>>2]=f;break}while(0);B=c+4|0,M<0&&(f=f-((l<<1|1|0)/2|0)|0,u[c>>2]=f,l=0-l|0,u[B>>2]=l),d=l-f|0,(f|0)<0?(g=0-f|0,u[B>>2]=d,u[U>>2]=g,u[c>>2]=0,l=d,f=0):g=0,(l|0)<0&&(f=f-l|0,u[c>>2]=f,g=g-l|0,u[U>>2]=g,u[B>>2]=0,l=0),v=f-g|0,d=l-g|0,(g|0)<0&&(u[c>>2]=v,u[B>>2]=d,u[U>>2]=0,l=d,f=v,g=0),d=(l|0)<(f|0)?l:f,d=(g|0)<(d|0)?g:d,!((d|0)<=0)&&(u[c>>2]=f-d,u[B>>2]=l-d,u[U>>2]=g-d)}function fn(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0;c=u[l>>2]|0,_=l+4|0,f=u[_>>2]|0,(c|0)<0&&(f=f-c|0,u[_>>2]=f,v=l+8|0,u[v>>2]=(u[v>>2]|0)-c,u[l>>2]=0,c=0),(f|0)<0?(c=c-f|0,u[l>>2]=c,v=l+8|0,g=(u[v>>2]|0)-f|0,u[v>>2]=g,u[_>>2]=0,f=0):(g=l+8|0,v=g,g=u[g>>2]|0),(g|0)<0&&(c=c-g|0,u[l>>2]=c,f=f-g|0,u[_>>2]=f,u[v>>2]=0,g=0),d=(f|0)<(c|0)?f:c,d=(g|0)<(d|0)?g:d,!((d|0)<=0)&&(u[l>>2]=c-d,u[_>>2]=f-d,u[v>>2]=g-d)}function Ms(l,c){l=l|0,c=c|0;var f=0,d=0;d=u[l+8>>2]|0,f=+((u[l+4>>2]|0)-d|0),N[c>>3]=+((u[l>>2]|0)-d|0)-f*.5,N[c+8>>3]=f*.8660254037844386}function wn(l,c,f){l=l|0,c=c|0,f=f|0,u[f>>2]=(u[c>>2]|0)+(u[l>>2]|0),u[f+4>>2]=(u[c+4>>2]|0)+(u[l+4>>2]|0),u[f+8>>2]=(u[c+8>>2]|0)+(u[l+8>>2]|0)}function od(l,c,f){l=l|0,c=c|0,f=f|0,u[f>>2]=(u[l>>2]|0)-(u[c>>2]|0),u[f+4>>2]=(u[l+4>>2]|0)-(u[c+4>>2]|0),u[f+8>>2]=(u[l+8>>2]|0)-(u[c+8>>2]|0)}function f1(l,c){l=l|0,c=c|0;var f=0,d=0;f=tn(u[l>>2]|0,c)|0,u[l>>2]=f,f=l+4|0,d=tn(u[f>>2]|0,c)|0,u[f>>2]=d,l=l+8|0,c=tn(u[l>>2]|0,c)|0,u[l>>2]=c}function Rc(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;_=u[l>>2]|0,E=(_|0)<0,d=(u[l+4>>2]|0)-(E?_:0)|0,v=(d|0)<0,g=(v?0-d|0:0)+((u[l+8>>2]|0)-(E?_:0))|0,f=(g|0)<0,l=f?0:g,c=(v?0:d)-(f?g:0)|0,g=(E?0:_)-(v?d:0)-(f?g:0)|0,f=(c|0)<(g|0)?c:g,f=(l|0)<(f|0)?l:f,d=(f|0)>0,l=l-(d?f:0)|0,c=c-(d?f:0)|0;e:do switch(g-(d?f:0)|0){case 0:switch(c|0){case 0:return E=l|0?(l|0)==1?1:7:0,E|0;case 1:return E=l|0?(l|0)==1?3:7:2,E|0;default:break e}case 1:switch(c|0){case 0:return E=l|0?(l|0)==1?5:7:4,E|0;case 1:{if(!l)l=6;else break e;return l|0}default:break e}}while(0);return E=7,E|0}function h1(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;_=l+8|0,f=u[_>>2]|0,c=(u[l>>2]|0)-f|0,E=l+4|0,f=(u[E>>2]|0)-f|0,d=Nc(+((c*3|0)-f|0)/7)|0,u[l>>2]=d,c=Nc(+((f<<1)+c|0)/7)|0,u[E>>2]=c,u[_>>2]=0,f=c-d|0,(d|0)<0?(v=0-d|0,u[E>>2]=f,u[_>>2]=v,u[l>>2]=0,c=f,d=0,f=v):f=0,(c|0)<0&&(d=d-c|0,u[l>>2]=d,f=f-c|0,u[_>>2]=f,u[E>>2]=0,c=0),v=d-f|0,g=c-f|0,(f|0)<0?(u[l>>2]=v,u[E>>2]=g,u[_>>2]=0,c=g,g=v,f=0):g=d,d=(c|0)<(g|0)?c:g,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(u[l>>2]=g-d,u[E>>2]=c-d,u[_>>2]=f-d)}function ad(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;_=l+8|0,f=u[_>>2]|0,c=(u[l>>2]|0)-f|0,E=l+4|0,f=(u[E>>2]|0)-f|0,d=Nc(+((c<<1)+f|0)/7)|0,u[l>>2]=d,c=Nc(+((f*3|0)-c|0)/7)|0,u[E>>2]=c,u[_>>2]=0,f=c-d|0,(d|0)<0?(v=0-d|0,u[E>>2]=f,u[_>>2]=v,u[l>>2]=0,c=f,d=0,f=v):f=0,(c|0)<0&&(d=d-c|0,u[l>>2]=d,f=f-c|0,u[_>>2]=f,u[E>>2]=0,c=0),v=d-f|0,g=c-f|0,(f|0)<0?(u[l>>2]=v,u[E>>2]=g,u[_>>2]=0,c=g,g=v,f=0):g=d,d=(c|0)<(g|0)?c:g,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(u[l>>2]=g-d,u[E>>2]=c-d,u[_>>2]=f-d)}function Oc(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;c=u[l>>2]|0,_=l+4|0,f=u[_>>2]|0,E=l+8|0,d=u[E>>2]|0,g=f+(c*3|0)|0,u[l>>2]=g,f=d+(f*3|0)|0,u[_>>2]=f,c=(d*3|0)+c|0,u[E>>2]=c,d=f-g|0,(g|0)<0?(c=c-g|0,u[_>>2]=d,u[E>>2]=c,u[l>>2]=0,f=d,d=0):d=g,(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),v=d-c|0,g=f-c|0,(c|0)<0?(u[l>>2]=v,u[_>>2]=g,u[E>>2]=0,d=v,c=0):g=f,f=(g|0)<(d|0)?g:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[_>>2]=g-f,u[E>>2]=c-f)}function Bs(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;g=u[l>>2]|0,_=l+4|0,c=u[_>>2]|0,E=l+8|0,f=u[E>>2]|0,d=(c*3|0)+g|0,g=f+(g*3|0)|0,u[l>>2]=g,u[_>>2]=d,c=(f*3|0)+c|0,u[E>>2]=c,f=d-g|0,(g|0)<0?(c=c-g|0,u[_>>2]=f,u[E>>2]=c,u[l>>2]=0,g=0):f=d,(f|0)<0&&(g=g-f|0,u[l>>2]=g,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),v=g-c|0,d=f-c|0,(c|0)<0?(u[l>>2]=v,u[_>>2]=d,u[E>>2]=0,g=v,c=0):d=f,f=(d|0)<(g|0)?d:g,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=g-f,u[_>>2]=d-f,u[E>>2]=c-f)}function d1(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0;(c+-1|0)>>>0>=6||(g=(u[15472+(c*12|0)>>2]|0)+(u[l>>2]|0)|0,u[l>>2]=g,E=l+4|0,d=(u[15472+(c*12|0)+4>>2]|0)+(u[E>>2]|0)|0,u[E>>2]=d,_=l+8|0,c=(u[15472+(c*12|0)+8>>2]|0)+(u[_>>2]|0)|0,u[_>>2]=c,f=d-g|0,(g|0)<0?(c=c-g|0,u[E>>2]=f,u[_>>2]=c,u[l>>2]=0,d=0):(f=d,d=g),(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[_>>2]=c,u[E>>2]=0,f=0),v=d-c|0,g=f-c|0,(c|0)<0?(u[l>>2]=v,u[E>>2]=g,u[_>>2]=0,d=v,c=0):g=f,f=(g|0)<(d|0)?g:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[E>>2]=g-f,u[_>>2]=c-f))}function p1(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;g=u[l>>2]|0,_=l+4|0,c=u[_>>2]|0,E=l+8|0,f=u[E>>2]|0,d=c+g|0,g=f+g|0,u[l>>2]=g,u[_>>2]=d,c=f+c|0,u[E>>2]=c,f=d-g|0,(g|0)<0?(c=c-g|0,u[_>>2]=f,u[E>>2]=c,u[l>>2]=0,d=0):(f=d,d=g),(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),v=d-c|0,g=f-c|0,(c|0)<0?(u[l>>2]=v,u[_>>2]=g,u[E>>2]=0,d=v,c=0):g=f,f=(g|0)<(d|0)?g:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[_>>2]=g-f,u[E>>2]=c-f)}function Fc(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;c=u[l>>2]|0,_=l+4|0,d=u[_>>2]|0,E=l+8|0,f=u[E>>2]|0,g=d+c|0,u[l>>2]=g,d=f+d|0,u[_>>2]=d,c=f+c|0,u[E>>2]=c,f=d-g|0,(g|0)<0?(c=c-g|0,u[_>>2]=f,u[E>>2]=c,u[l>>2]=0,d=0):(f=d,d=g),(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),v=d-c|0,g=f-c|0,(c|0)<0?(u[l>>2]=v,u[_>>2]=g,u[E>>2]=0,d=v,c=0):g=f,f=(g|0)<(d|0)?g:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[_>>2]=g-f,u[E>>2]=c-f)}function Ls(l){switch(l=l|0,l|0){case 1:{l=5;break}case 5:{l=4;break}case 4:{l=6;break}case 6:{l=2;break}case 2:{l=3;break}case 3:{l=1;break}}return l|0}function Dr(l){switch(l=l|0,l|0){case 1:{l=3;break}case 3:{l=2;break}case 2:{l=6;break}case 6:{l=4;break}case 4:{l=5;break}case 5:{l=1;break}}return l|0}function g1(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;c=u[l>>2]|0,_=l+4|0,f=u[_>>2]|0,E=l+8|0,d=u[E>>2]|0,g=f+(c<<1)|0,u[l>>2]=g,f=d+(f<<1)|0,u[_>>2]=f,c=(d<<1)+c|0,u[E>>2]=c,d=f-g|0,(g|0)<0?(c=c-g|0,u[_>>2]=d,u[E>>2]=c,u[l>>2]=0,f=d,d=0):d=g,(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),v=d-c|0,g=f-c|0,(c|0)<0?(u[l>>2]=v,u[_>>2]=g,u[E>>2]=0,d=v,c=0):g=f,f=(g|0)<(d|0)?g:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[_>>2]=g-f,u[E>>2]=c-f)}function m1(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;g=u[l>>2]|0,_=l+4|0,c=u[_>>2]|0,E=l+8|0,f=u[E>>2]|0,d=(c<<1)+g|0,g=f+(g<<1)|0,u[l>>2]=g,u[_>>2]=d,c=(f<<1)+c|0,u[E>>2]=c,f=d-g|0,(g|0)<0?(c=c-g|0,u[_>>2]=f,u[E>>2]=c,u[l>>2]=0,g=0):f=d,(f|0)<0&&(g=g-f|0,u[l>>2]=g,c=c-f|0,u[E>>2]=c,u[_>>2]=0,f=0),v=g-c|0,d=f-c|0,(c|0)<0?(u[l>>2]=v,u[_>>2]=d,u[E>>2]=0,g=v,c=0):d=f,f=(d|0)<(g|0)?d:g,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=g-f,u[_>>2]=d-f,u[E>>2]=c-f)}function ld(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0;return _=(u[l>>2]|0)-(u[c>>2]|0)|0,E=(_|0)<0,d=(u[l+4>>2]|0)-(u[c+4>>2]|0)-(E?_:0)|0,v=(d|0)<0,g=(E?0-_|0:0)+(u[l+8>>2]|0)-(u[c+8>>2]|0)+(v?0-d|0:0)|0,l=(g|0)<0,c=l?0:g,f=(v?0:d)-(l?g:0)|0,g=(E?0:_)-(v?d:0)-(l?g:0)|0,l=(f|0)<(g|0)?f:g,l=(c|0)<(l|0)?c:l,d=(l|0)>0,c=c-(d?l:0)|0,f=f-(d?l:0)|0,l=g-(d?l:0)|0,l=(l|0)>-1?l:0-l|0,f=(f|0)>-1?f:0-f|0,c=(c|0)>-1?c:0-c|0,c=(f|0)>(c|0)?f:c,((l|0)>(c|0)?l:c)|0}function S3(l,c){l=l|0,c=c|0;var f=0;f=u[l+8>>2]|0,u[c>>2]=(u[l>>2]|0)-f,u[c+4>>2]=(u[l+4>>2]|0)-f}function P3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0;d=u[l>>2]|0,u[c>>2]=d,l=u[l+4>>2]|0,_=c+4|0,u[_>>2]=l,E=c+8|0,u[E>>2]=0,f=l-d|0,(d|0)<0?(l=0-d|0,u[_>>2]=f,u[E>>2]=l,u[c>>2]=0,d=0):(f=l,l=0),(f|0)<0&&(d=d-f|0,u[c>>2]=d,l=l-f|0,u[E>>2]=l,u[_>>2]=0,f=0),v=d-l|0,g=f-l|0,(l|0)<0?(u[c>>2]=v,u[_>>2]=g,u[E>>2]=0,f=g,g=v,l=0):g=d,d=(f|0)<(g|0)?f:g,d=(l|0)<(d|0)?l:d,!((d|0)<=0)&&(u[c>>2]=g-d,u[_>>2]=f-d,u[E>>2]=l-d)}function _1(l){l=l|0;var c=0,f=0,d=0,g=0;c=l+8|0,g=u[c>>2]|0,f=g-(u[l>>2]|0)|0,u[l>>2]=f,d=l+4|0,l=(u[d>>2]|0)-g|0,u[d>>2]=l,u[c>>2]=0-(l+f)}function I3(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;f=u[l>>2]|0,c=0-f|0,u[l>>2]=c,_=l+8|0,u[_>>2]=0,E=l+4|0,d=u[E>>2]|0,g=d+f|0,(f|0)>0?(u[E>>2]=g,u[_>>2]=f,u[l>>2]=0,c=0,d=g):f=0,(d|0)<0?(v=c-d|0,u[l>>2]=v,f=f-d|0,u[_>>2]=f,u[E>>2]=0,g=v-f|0,c=0-f|0,(f|0)<0?(u[l>>2]=g,u[E>>2]=c,u[_>>2]=0,d=c,f=0):(d=0,g=v)):g=c,c=(d|0)<(g|0)?d:g,c=(f|0)<(c|0)?f:c,!((c|0)<=0)&&(u[l>>2]=g-c,u[E>>2]=d-c,u[_>>2]=f-c)}function M3(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;d=k,k=k+16|0,g=d,B3(l,c,f,g),C3(g,f+4|0),k=d}function B3(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0;if(x=k,k=k+32|0,v=x,MI(l,v),u[f>>2]=0,g=+Vt(15888,v),_=+Vt(15912,v),_<g&&(u[f>>2]=1,g=_),_=+Vt(15936,v),_<g&&(u[f>>2]=2,g=_),_=+Vt(15960,v),_<g&&(u[f>>2]=3,g=_),_=+Vt(15984,v),_<g&&(u[f>>2]=4,g=_),_=+Vt(16008,v),_<g&&(u[f>>2]=5,g=_),_=+Vt(16032,v),_<g&&(u[f>>2]=6,g=_),_=+Vt(16056,v),_<g&&(u[f>>2]=7,g=_),_=+Vt(16080,v),_<g&&(u[f>>2]=8,g=_),_=+Vt(16104,v),_<g&&(u[f>>2]=9,g=_),_=+Vt(16128,v),_<g&&(u[f>>2]=10,g=_),_=+Vt(16152,v),_<g&&(u[f>>2]=11,g=_),_=+Vt(16176,v),_<g&&(u[f>>2]=12,g=_),_=+Vt(16200,v),_<g&&(u[f>>2]=13,g=_),_=+Vt(16224,v),_<g&&(u[f>>2]=14,g=_),_=+Vt(16248,v),_<g&&(u[f>>2]=15,g=_),_=+Vt(16272,v),_<g&&(u[f>>2]=16,g=_),_=+Vt(16296,v),_<g&&(u[f>>2]=17,g=_),_=+Vt(16320,v),_<g&&(u[f>>2]=18,g=_),_=+Vt(16344,v),_<g&&(u[f>>2]=19,g=_),_=+Xi(+(1-g*.5)),_<1e-16){u[d>>2]=0,u[d+4>>2]=0,u[d+8>>2]=0,u[d+12>>2]=0,k=x;return}if(f=u[f>>2]|0,g=+N[16368+(f*24|0)>>3],g=+dl(g-+dl(+D3(15568+(f<<4)|0,l))),ci(c)|0?E=+dl(g+-.3334731722518321):E=g,g=+Ot(+_)/.381966011250105,(c|0)>0){v=0;do g=g*2.6457513110645907,v=v+1|0;while((v|0)!=(c|0))}_=+qe(+E)*g,N[d>>3]=_,E=+Je(+E)*g,N[d+8>>3]=E,k=x}function hl(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0;if(v=+II(l),v<1e-16){c=15568+(c<<4)|0,u[g>>2]=u[c>>2],u[g+4>>2]=u[c+4>>2],u[g+8>>2]=u[c+8>>2],u[g+12>>2]=u[c+12>>2];return}if(_=+vt(+ +N[l+8>>3],+ +N[l>>3]),(f|0)>0){l=0;do v=v/2.6457513110645907,l=l+1|0;while((l|0)!=(f|0))}d?(v=v/3,f=(ci(f)|0)==0,v=+Fr(+((f?v:v/2.6457513110645907)*.381966011250105))):(v=+Fr(+(v*.381966011250105)),ci(f)|0&&(_=+dl(_+.3334731722518321))),k3(15568+(c<<4)|0,+dl(+N[16368+(c*24|0)>>3]-_),v,g)}function L3(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;d=k,k=k+16|0,g=d,Ms(l+4|0,g),hl(g,u[l>>2]|0,c,0,f),k=d}function v1(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0,me=0,Ne=0,lt=0,st=0,ft=0,nt=0,dt=0,pt=0,Oe=0;if(dt=k,k=k+272|0,v=dt+256|0,$=dt+240|0,st=dt,ft=dt+224|0,nt=dt+208|0,ae=dt+176|0,W=dt+160|0,Ee=dt+192|0,we=dt+144|0,de=dt+128|0,me=dt+112|0,Ne=dt+96|0,lt=dt+80|0,u[v>>2]=c,u[$>>2]=u[l>>2],u[$+4>>2]=u[l+4>>2],u[$+8>>2]=u[l+8>>2],u[$+12>>2]=u[l+12>>2],y1($,v,st),u[g>>2]=0,$=d+f+((d|0)==5&1)|0,($|0)<=(f|0)){k=dt;return}x=u[v>>2]|0,M=ft+4|0,B=ae+4|0,U=f+5|0,H=16848+(x<<2)|0,J=16928+(x<<2)|0,te=de+8|0,ne=me+8|0,ue=Ne+8|0,ve=nt+4|0,E=f;e:for(;;){_=st+(((E|0)%5|0)<<4)|0,u[nt>>2]=u[_>>2],u[nt+4>>2]=u[_+4>>2],u[nt+8>>2]=u[_+8>>2],u[nt+12>>2]=u[_+12>>2];do;while((Bo(nt,x,0,1)|0)==2);if((E|0)>(f|0)&(ci(c)|0)!=0){if(u[ae>>2]=u[nt>>2],u[ae+4>>2]=u[nt+4>>2],u[ae+8>>2]=u[nt+8>>2],u[ae+12>>2]=u[nt+12>>2],Ms(M,W),d=u[ae>>2]|0,v=u[17008+(d*80|0)+(u[ft>>2]<<2)>>2]|0,u[ae>>2]=u[18608+(d*80|0)+(v*20|0)>>2],_=u[18608+(d*80|0)+(v*20|0)+16>>2]|0,(_|0)>0){l=0;do p1(B),l=l+1|0;while((l|0)<(_|0))}switch(_=18608+(d*80|0)+(v*20|0)+4|0,u[Ee>>2]=u[_>>2],u[Ee+4>>2]=u[_+4>>2],u[Ee+8>>2]=u[_+8>>2],f1(Ee,(u[H>>2]|0)*3|0),wn(B,Ee,B),fn(B),Ms(B,we),pt=+(u[J>>2]|0),N[de>>3]=pt*3,N[te>>3]=0,Oe=pt*-1.5,N[me>>3]=Oe,N[ne>>3]=pt*2.598076211353316,N[Ne>>3]=Oe,N[ue>>3]=pt*-2.598076211353316,u[17008+((u[ae>>2]|0)*80|0)+(u[nt>>2]<<2)>>2]|0){case 1:{l=me,d=de;break}case 3:{l=Ne,d=me;break}case 2:{l=de,d=Ne;break}default:{l=12;break e}}L1(W,we,d,l,lt),hl(lt,u[ae>>2]|0,x,1,g+8+(u[g>>2]<<4)|0),u[g>>2]=(u[g>>2]|0)+1}if((E|0)<(U|0)&&(Ms(ve,ae),hl(ae,u[nt>>2]|0,x,1,g+8+(u[g>>2]<<4)|0),u[g>>2]=(u[g>>2]|0)+1),u[ft>>2]=u[nt>>2],u[ft+4>>2]=u[nt+4>>2],u[ft+8>>2]=u[nt+8>>2],u[ft+12>>2]=u[nt+12>>2],E=E+1|0,(E|0)>=($|0)){l=3;break}}if((l|0)==3){k=dt;return}else(l|0)==12&&tt(22474,22521,581,22531)}function y1(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0;x=k,k=k+128|0,d=x+64|0,g=x,v=d,_=20208,E=v+60|0;do u[v>>2]=u[_>>2],v=v+4|0,_=_+4|0;while((v|0)<(E|0));v=g,_=20272,E=v+60|0;do u[v>>2]=u[_>>2],v=v+4|0,_=_+4|0;while((v|0)<(E|0));E=(ci(u[c>>2]|0)|0)==0,d=E?d:g,g=l+4|0,g1(g),m1(g),ci(u[c>>2]|0)|0&&(Bs(g),u[c>>2]=(u[c>>2]|0)+1),u[f>>2]=u[l>>2],c=f+4|0,wn(g,d,c),fn(c),u[f+16>>2]=u[l>>2],c=f+20|0,wn(g,d+12|0,c),fn(c),u[f+32>>2]=u[l>>2],c=f+36|0,wn(g,d+24|0,c),fn(c),u[f+48>>2]=u[l>>2],c=f+52|0,wn(g,d+36|0,c),fn(c),u[f+64>>2]=u[l>>2],f=f+68|0,wn(g,d+48|0,f),fn(f),k=x}function Bo(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0;if(te=k,k=k+32|0,H=te+12|0,E=te,J=l+4|0,U=u[16928+(c<<2)>>2]|0,B=(d|0)!=0,U=B?U*3|0:U,g=u[J>>2]|0,M=l+8|0,_=u[M>>2]|0,B){if(v=l+12|0,d=u[v>>2]|0,g=_+g+d|0,(g|0)==(U|0))return J=1,k=te,J|0;x=v}else x=l+12|0,d=u[x>>2]|0,g=_+g+d|0;if((g|0)<=(U|0))return J=0,k=te,J|0;do if((d|0)>0){if(d=u[l>>2]|0,(_|0)>0){v=18608+(d*80|0)+60|0,d=l;break}d=18608+(d*80|0)+40|0,f?(x3(H,U,0,0),od(J,H,E),Fc(E),wn(E,H,J),v=d,d=l):(v=d,d=l)}else v=18608+((u[l>>2]|0)*80|0)+20|0,d=l;while(0);if(u[d>>2]=u[v>>2],g=v+16|0,(u[g>>2]|0)>0){d=0;do p1(J),d=d+1|0;while((d|0)<(u[g>>2]|0))}return l=v+4|0,u[H>>2]=u[l>>2],u[H+4>>2]=u[l+4>>2],u[H+8>>2]=u[l+8>>2],c=u[16848+(c<<2)>>2]|0,f1(H,B?c*3|0:c),wn(J,H,J),fn(J),B?d=((u[M>>2]|0)+(u[J>>2]|0)+(u[x>>2]|0)|0)==(U|0)?1:2:d=2,J=d,k=te,J|0}function R3(l,c){l=l|0,c=c|0;var f=0;do f=Bo(l,c,0,1)|0;while((f|0)==2);return f|0}function E1(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0,me=0,Ne=0,lt=0,st=0;if(Ne=k,k=k+240|0,v=Ne+224|0,Ee=Ne+208|0,we=Ne,de=Ne+192|0,me=Ne+176|0,ue=Ne+160|0,ve=Ne+144|0,$=Ne+128|0,ae=Ne+112|0,W=Ne+96|0,u[v>>2]=c,u[Ee>>2]=u[l>>2],u[Ee+4>>2]=u[l+4>>2],u[Ee+8>>2]=u[l+8>>2],u[Ee+12>>2]=u[l+12>>2],T1(Ee,v,we),u[g>>2]=0,ne=d+f+((d|0)==6&1)|0,(ne|0)<=(f|0)){k=Ne;return}x=u[v>>2]|0,M=f+6|0,B=16928+(x<<2)|0,U=ve+8|0,H=$+8|0,J=ae+8|0,te=de+4|0,_=0,E=f,d=-1;e:for(;;){if(v=(E|0)%6|0,l=we+(v<<4)|0,u[de>>2]=u[l>>2],u[de+4>>2]=u[l+4>>2],u[de+8>>2]=u[l+8>>2],u[de+12>>2]=u[l+12>>2],l=_,_=Bo(de,x,0,1)|0,(E|0)>(f|0)&(ci(c)|0)!=0&&(l|0)!=1&&(u[de>>2]|0)!=(d|0)){switch(Ms(we+(((v+5|0)%6|0)<<4)+4|0,me),Ms(we+(v<<4)+4|0,ue),lt=+(u[B>>2]|0),N[ve>>3]=lt*3,N[U>>3]=0,st=lt*-1.5,N[$>>3]=st,N[H>>3]=lt*2.598076211353316,N[ae>>3]=st,N[J>>3]=lt*-2.598076211353316,v=u[Ee>>2]|0,u[17008+(v*80|0)+(((d|0)==(v|0)?u[de>>2]|0:d)<<2)>>2]|0){case 1:{l=$,d=ve;break}case 3:{l=ae,d=$;break}case 2:{l=ve,d=ae;break}default:{l=8;break e}}L1(me,ue,d,l,W),!(R1(me,W)|0)&&!(R1(ue,W)|0)&&(hl(W,u[Ee>>2]|0,x,1,g+8+(u[g>>2]<<4)|0),u[g>>2]=(u[g>>2]|0)+1)}if((E|0)<(M|0)&&(Ms(te,me),hl(me,u[de>>2]|0,x,1,g+8+(u[g>>2]<<4)|0),u[g>>2]=(u[g>>2]|0)+1),E=E+1|0,(E|0)>=(ne|0)){l=3;break}else d=u[de>>2]|0}if((l|0)==3){k=Ne;return}else(l|0)==8&&tt(22557,22521,746,22602)}function T1(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0;x=k,k=k+160|0,d=x+80|0,g=x,v=d,_=20336,E=v+72|0;do u[v>>2]=u[_>>2],v=v+4|0,_=_+4|0;while((v|0)<(E|0));v=g,_=20416,E=v+72|0;do u[v>>2]=u[_>>2],v=v+4|0,_=_+4|0;while((v|0)<(E|0));E=(ci(u[c>>2]|0)|0)==0,d=E?d:g,g=l+4|0,g1(g),m1(g),ci(u[c>>2]|0)|0&&(Bs(g),u[c>>2]=(u[c>>2]|0)+1),u[f>>2]=u[l>>2],c=f+4|0,wn(g,d,c),fn(c),u[f+16>>2]=u[l>>2],c=f+20|0,wn(g,d+12|0,c),fn(c),u[f+32>>2]=u[l>>2],c=f+36|0,wn(g,d+24|0,c),fn(c),u[f+48>>2]=u[l>>2],c=f+52|0,wn(g,d+36|0,c),fn(c),u[f+64>>2]=u[l>>2],c=f+68|0,wn(g,d+48|0,c),fn(c),u[f+80>>2]=u[l>>2],f=f+84|0,wn(g,d+60|0,f),fn(f),k=x}function dl(l){l=+l;var c=0;return c=l<0?l+6.283185307179586:l,+(l>=6.283185307179586?c+-6.283185307179586:c)}function Lo(l,c){return l=l|0,c=c|0,+Ve(+(+N[l>>3]-+N[c>>3]))<17453292519943298e-27?(c=+Ve(+(+N[l+8>>3]-+N[c+8>>3]))<17453292519943298e-27,c|0):(c=0,c|0)}function O3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0;return g=+N[c>>3],d=+N[l>>3],v=+Je(+((g-d)*.5)),f=+Je(+((+N[c+8>>3]-+N[l+8>>3])*.5)),f=v*v+f*(+qe(+g)*+qe(+d)*f),+(+vt(+ +We(+f),+ +We(+(1-f)))*2)}function pl(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0;return g=+N[c>>3],d=+N[l>>3],v=+Je(+((g-d)*.5)),f=+Je(+((+N[c+8>>3]-+N[l+8>>3])*.5)),f=v*v+f*(+qe(+g)*+qe(+d)*f),+(+vt(+ +We(+f),+ +We(+(1-f)))*2*6371.007180918475)}function F3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0;return g=+N[c>>3],d=+N[l>>3],v=+Je(+((g-d)*.5)),f=+Je(+((+N[c+8>>3]-+N[l+8>>3])*.5)),f=v*v+f*(+qe(+g)*+qe(+d)*f),+(+vt(+ +We(+f),+ +We(+(1-f)))*2*6371.007180918475*1e3)}function D3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0;return v=+N[c>>3],d=+qe(+v),g=+N[c+8>>3]-+N[l+8>>3],_=d*+Je(+g),f=+N[l>>3],+ +vt(+_,+(+Je(+v)*+qe(+f)-+qe(+g)*(d*+Je(+f))))}function k3(l,c,f,d){l=l|0,c=+c,f=+f,d=d|0;var g=0,v=0,_=0,E=0;if(f<1e-16){u[d>>2]=u[l>>2],u[d+4>>2]=u[l+4>>2],u[d+8>>2]=u[l+8>>2],u[d+12>>2]=u[l+12>>2];return}v=c<0?c+6.283185307179586:c,v=c>=6.283185307179586?v+-6.283185307179586:v;do if(v<1e-16)c=+N[l>>3]+f,N[d>>3]=c,g=d;else{if(g=+Ve(+(v+-3.141592653589793))<1e-16,c=+N[l>>3],g){c=c-f,N[d>>3]=c,g=d;break}if(_=+qe(+f),f=+Je(+f),c=_*+Je(+c)+ +qe(+v)*(f*+qe(+c)),c=c>1?1:c,c=+Co(+(c<-1?-1:c)),N[d>>3]=c,+Ve(+(c+-1.5707963267948966))<1e-16){N[d>>3]=1.5707963267948966,N[d+8>>3]=0;return}if(+Ve(+(c+1.5707963267948966))<1e-16){N[d>>3]=-1.5707963267948966,N[d+8>>3]=0;return}if(E=+qe(+c),v=f*+Je(+v)/E,f=+N[l>>3],c=(_-+Je(+c)*+Je(+f))/+qe(+f)/E,_=v>1?1:v,c=c>1?1:c,c=+N[l+8>>3]+ +vt(+(_<-1?-1:_),+(c<-1?-1:c)),c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);N[d+8>>3]=c;return}while(0);if(+Ve(+(c+-1.5707963267948966))<1e-16){N[g>>3]=1.5707963267948966,N[d+8>>3]=0;return}if(+Ve(+(c+1.5707963267948966))<1e-16){N[g>>3]=-1.5707963267948966,N[d+8>>3]=0;return}if(c=+N[l+8>>3],c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);N[d+8>>3]=c}function N3(l){return l=l|0,+ +N[20496+(l<<3)>>3]}function U3(l){return l=l|0,+ +N[20624+(l<<3)>>3]}function G3(l){return l=l|0,+ +N[20752+(l<<3)>>3]}function z3(l){return l=l|0,+ +N[20880+(l<<3)>>3]}function V3(l){l=l|0;var c=0;return c=21008+(l<<3)|0,l=u[c>>2]|0,Pe(u[c+4>>2]|0),l|0}function Ro(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0;return H=+N[c>>3],B=+N[l>>3],x=+Je(+((H-B)*.5)),v=+N[c+8>>3],M=+N[l+8>>3],_=+Je(+((v-M)*.5)),E=+qe(+B),U=+qe(+H),_=x*x+_*(U*E*_),_=+vt(+ +We(+_),+ +We(+(1-_)))*2,x=+N[f>>3],H=+Je(+((x-H)*.5)),d=+N[f+8>>3],v=+Je(+((d-v)*.5)),g=+qe(+x),v=H*H+v*(U*g*v),v=+vt(+ +We(+v),+ +We(+(1-v)))*2,x=+Je(+((B-x)*.5)),d=+Je(+((M-d)*.5)),d=x*x+d*(E*g*d),d=+vt(+ +We(+d),+ +We(+(1-d)))*2,g=(_+v+d)*.5,+(+Fr(+ +We(+(+Ot(+(g*.5))*+Ot(+((g-_)*.5))*+Ot(+((g-v)*.5))*+Ot(+((g-d)*.5)))))*4)}function j3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0;if(v=k,k=k+192|0,d=v+168|0,g=v,Rs(l,c,d),Os(l,c,g),c=u[g>>2]|0,(c|0)<=0)return f=0,k=v,+f;if(f=+Ro(g+8|0,g+8+(((c|0)!=1&1)<<4)|0,d)+0,(c|0)==1)return k=v,+f;l=1;do _=l,l=l+1|0,f=f+ +Ro(g+8+(_<<4)|0,g+8+(((l|0)%(c|0)|0)<<4)|0,d);while((l|0)<(c|0));return k=v,+f}function H3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0;if(v=k,k=k+192|0,d=v+168|0,g=v,Rs(l,c,d),Os(l,c,g),c=u[g>>2]|0,(c|0)>0){if(f=+Ro(g+8|0,g+8+(((c|0)!=1&1)<<4)|0,d)+0,(c|0)!=1){l=1;do _=l,l=l+1|0,f=f+ +Ro(g+8+(_<<4)|0,g+8+(((l|0)%(c|0)|0)<<4)|0,d);while((l|0)<(c|0))}}else f=0;return k=v,+(f*6371.007180918475*6371.007180918475)}function W3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0;if(v=k,k=k+192|0,d=v+168|0,g=v,Rs(l,c,d),Os(l,c,g),c=u[g>>2]|0,(c|0)>0){if(f=+Ro(g+8|0,g+8+(((c|0)!=1&1)<<4)|0,d)+0,(c|0)!=1){l=1;do _=l,l=l+1|0,f=f+ +Ro(g+8+(_<<4)|0,g+8+(((l|0)%(c|0)|0)<<4)|0,d);while((l|0)<(c|0))}}else f=0;return k=v,+(f*6371.007180918475*6371.007180918475*1e3*1e3)}function Q3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0;if(_=k,k=k+176|0,v=_,Dc(l,c,v),l=u[v>>2]|0,(l|0)<=1)return g=0,k=_,+g;c=l+-1|0,l=0,f=0,d=+N[v+8>>3],g=+N[v+16>>3];do l=l+1|0,x=d,d=+N[v+8+(l<<4)>>3],M=+Je(+((d-x)*.5)),E=g,g=+N[v+8+(l<<4)+8>>3],E=+Je(+((g-E)*.5)),E=M*M+E*(+qe(+d)*+qe(+x)*E),f=f+ +vt(+ +We(+E),+ +We(+(1-E)))*2;while((l|0)<(c|0));return k=_,+f}function X3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0;if(_=k,k=k+176|0,v=_,Dc(l,c,v),l=u[v>>2]|0,(l|0)<=1)return g=0,k=_,+g;c=l+-1|0,l=0,f=0,d=+N[v+8>>3],g=+N[v+16>>3];do l=l+1|0,x=d,d=+N[v+8+(l<<4)>>3],M=+Je(+((d-x)*.5)),E=g,g=+N[v+8+(l<<4)+8>>3],E=+Je(+((g-E)*.5)),E=M*M+E*(+qe(+x)*+qe(+d)*E),f=f+ +vt(+ +We(+E),+ +We(+(1-E)))*2;while((l|0)!=(c|0));return M=f*6371.007180918475,k=_,+M}function J3(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0;if(_=k,k=k+176|0,v=_,Dc(l,c,v),l=u[v>>2]|0,(l|0)<=1)return g=0,k=_,+g;c=l+-1|0,l=0,f=0,d=+N[v+8>>3],g=+N[v+16>>3];do l=l+1|0,x=d,d=+N[v+8+(l<<4)>>3],M=+Je(+((d-x)*.5)),E=g,g=+N[v+8+(l<<4)+8>>3],E=+Je(+((g-E)*.5)),E=M*M+E*(+qe(+x)*+qe(+d)*E),f=f+ +vt(+ +We(+E),+ +We(+(1-E)))*2;while((l|0)!=(c|0));return M=f*6371.007180918475*1e3,k=_,+M}function Y3(l,c){return l=l|0,c=c|0,c=ce(l|0,c|0,52)|0,z()|0,c&15|0}function w1(l,c){return l=l|0,c=c|0,c=ce(l|0,c|0,45)|0,z()|0,c&127|0}function b1(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0;if(!(!0&(c&-16777216|0)==134217728)||(_=ce(l|0,c|0,45)|0,z()|0,_=_&127,_>>>0>121))return c=0,c|0;f=ce(l|0,c|0,52)|0,z()|0,f=f&15;do if(f|0){for(g=1,d=0;;){if(v=ce(l|0,c|0,(15-g|0)*3|0)|0,z()|0,v=v&7,(v|0)!=0&(d^1))if((v|0)==1&(Ge(_)|0)!=0){E=0,d=13;break}else d=1;if((v|0)==7){E=0,d=13;break}if(g>>>0<f>>>0)g=g+1|0;else{d=9;break}}if((d|0)==9){if((f|0)==15)E=1;else break;return E|0}else if((d|0)==13)return E|0}while(0);for(;;){if(E=ce(l|0,c|0,(14-f|0)*3|0)|0,z()|0,!((E&7|0)==7&!0)){E=0,d=13;break}if(f>>>0<14)f=f+1|0;else{E=1,d=13;break}}return(d|0)==13?E|0:0}function Ad(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,(d|0)>=(f|0)){if((d|0)!=(f|0))if(f>>>0<=15){if(g=_e(f|0,0,52)|0,l=g|l,c=z()|0|c&-15728641,(d|0)>(f|0))do g=_e(7,0,(14-f|0)*3|0)|0,f=f+1|0,l=g|l,c=z()|0|c;while((f|0)<(d|0))}else c=0,l=0}else c=0,l=0;return Pe(c|0),l|0}function K3(l,c,f){return l=l|0,c=c|0,f=f|0,l=ce(l|0,c|0,52)|0,z()|0,l=l&15,(f|0)<16&(l|0)<=(f|0)?(f=kc(7,f-l|0)|0,f|0):(f=0,f|0)}function Bn(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0,B=0;if(_=ce(l|0,c|0,52)|0,z()|0,_=_&15,!!((f|0)<16&(_|0)<=(f|0))){if((_|0)==(f|0)){f=d,u[f>>2]=l,u[f+4>>2]=c;return}if(x=kc(7,f-_|0)|0,M=(x|0)/7|0,E=ce(l|0,c|0,45)|0,z()|0,!(Ge(E&127)|0))v=0;else{e:do if(!_)g=0;else for(v=1;;){if(g=ce(l|0,c|0,(15-v|0)*3|0)|0,z()|0,g=g&7,g|0)break e;if(v>>>0<_>>>0)v=v+1|0;else{g=0;break}}while(0);v=(g|0)==0}if(B=_e(_+1|0,0,52)|0,g=z()|0|c&-15728641,E=(14-_|0)*3|0,c=_e(7,0,E|0)|0,c=(B|l)&~c,_=g&~(z()|0),Bn(c,_,f,d),g=d+(M<<3)|0,!v){B=_e(1,0,E|0)|0,Bn(B|c,z()|0|_,f,g),B=g+(M<<3)|0,x=_e(2,0,E|0)|0,Bn(x|c,z()|0|_,f,B),B=B+(M<<3)|0,x=_e(3,0,E|0)|0,Bn(x|c,z()|0|_,f,B),B=B+(M<<3)|0,x=_e(4,0,E|0)|0,Bn(x|c,z()|0|_,f,B),B=B+(M<<3)|0,x=_e(5,0,E|0)|0,Bn(x|c,z()|0|_,f,B),x=_e(6,0,E|0)|0,Bn(x|c,z()|0|_,f,B+(M<<3)|0);return}v=g+(M<<3)|0,(x|0)>6&&(x=g+8|0,B=(v>>>0>x>>>0?v:x)+-1+(0-g)|0,Pi(g|0,0,B+8&-8|0)|0,g=x+(B>>>3<<3)|0),B=_e(2,0,E|0)|0,Bn(B|c,z()|0|_,f,g),B=g+(M<<3)|0,x=_e(3,0,E|0)|0,Bn(x|c,z()|0|_,f,B),B=B+(M<<3)|0,x=_e(4,0,E|0)|0,Bn(x|c,z()|0|_,f,B),B=B+(M<<3)|0,x=_e(5,0,E|0)|0,Bn(x|c,z()|0|_,f,B),x=_e(6,0,E|0)|0,Bn(x|c,z()|0|_,f,B+(M<<3)|0)}}function Xt(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;if(g=ce(l|0,c|0,45)|0,z()|0,!(Ge(g&127)|0))return g=0,g|0;g=ce(l|0,c|0,52)|0,z()|0,g=g&15;e:do if(!g)f=0;else for(d=1;;){if(f=ce(l|0,c|0,(15-d|0)*3|0)|0,z()|0,f=f&7,f|0)break e;if(d>>>0<g>>>0)d=d+1|0;else{f=0;break}}while(0);return g=(f|0)==0&1,g|0}function Z3(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,(f|0)<16&(d|0)<=(f|0)){if((d|0)!=(f|0)&&(g=_e(f|0,0,52)|0,l=g|l,c=z()|0|c&-15728641,(d|0)<(f|0)))do g=_e(7,0,(14-d|0)*3|0)|0,d=d+1|0,l=l&~g,c=c&~(z()|0);while((d|0)<(f|0))}else c=0,l=0;return Pe(c|0),l|0}function q3(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0,me=0;if(!f)return de=0,de|0;if(g=l,d=u[g>>2]|0,g=u[g+4>>2]|0,!0&(g&15728640|0)==0){if((f|0)<=0||(de=c,u[de>>2]=d,u[de+4>>2]=g,(f|0)==1))return de=0,de|0;d=1;do Ee=l+(d<<3)|0,we=u[Ee+4>>2]|0,de=c+(d<<3)|0,u[de>>2]=u[Ee>>2],u[de+4>>2]=we,d=d+1|0;while((d|0)!=(f|0));return d=0,d|0}if(Ee=f<<3,we=Ji(Ee)|0,!we)return de=-3,de|0;if(Gc(we|0,l|0,Ee|0)|0,W=Si(f,8)|0,!W)return ze(we),de=-3,de|0;d=f;e:for(;;){_=we,B=u[_>>2]|0,_=u[_+4>>2]|0,$=ce(B|0,_|0,52)|0,z()|0,$=$&15,ae=$+-1|0,ve=(d|0)>0;t:do if(ve){if(ue=((d|0)<0)<<31>>31,te=_e(ae|0,0,52)|0,ne=z()|0,ae>>>0>15)for(g=0,l=B,f=_;;){if(!((l|0)==0&(f|0)==0)){if(v=ce(l|0,f|0,52)|0,z()|0,v=v&15,E=(v|0)<(ae|0),v=(v|0)==(ae|0),M=E?0:v?l:0,l=E?0:v?f:0,f=Nr(M|0,l|0,d|0,ue|0)|0,z()|0,v=W+(f<<3)|0,E=v,x=u[E>>2]|0,E=u[E+4>>2]|0,(x|0)==0&(E|0)==0)f=M;else for(te=0,J=f,H=E,f=M;;){if((te|0)>(d|0)){de=41;break e}if((x|0)==(f|0)&(H&-117440513|0)==(l|0)){M=ce(x|0,H|0,56)|0,z()|0,M=M&7,U=M+1|0,ne=ce(x|0,H|0,45)|0,z()|0;n:do if(!(Ge(ne&127)|0))E=7;else{if(x=ce(x|0,H|0,52)|0,z()|0,x=x&15,!x){E=6;break}for(E=1;;){if(ne=_e(7,0,(15-E|0)*3|0)|0,!((ne&f|0)==0&((z()|0)&l|0)==0)){E=7;break n}if(E>>>0<x>>>0)E=E+1|0;else{E=6;break}}}while(0);if((M+2|0)>>>0>E>>>0){de=51;break e}ne=_e(U|0,0,56)|0,l=z()|0|l&-117440513,E=v,u[E>>2]=0,u[E+4>>2]=0,E=J,f=ne|f}else E=(J+1|0)%(d|0)|0;if(v=W+(E<<3)|0,H=v,x=u[H>>2]|0,H=u[H+4>>2]|0,(x|0)==0&(H|0)==0)break;te=te+1|0,J=E}ne=v,u[ne>>2]=f,u[ne+4>>2]=l}if(g=g+1|0,(g|0)>=(d|0))break t;f=we+(g<<3)|0,l=u[f>>2]|0,f=u[f+4>>2]|0}for(g=0,l=B,f=_;;){if(!((l|0)==0&(f|0)==0)){if(E=ce(l|0,f|0,52)|0,z()|0,E=E&15,(E|0)>=(ae|0)){if((E|0)!=(ae|0)&&(l=l|te,f=f&-15728641|ne,E>>>0>=$>>>0)){v=ae;do J=_e(7,0,(14-v|0)*3|0)|0,v=v+1|0,l=J|l,f=z()|0|f;while(v>>>0<E>>>0)}}else l=0,f=0;if(E=Nr(l|0,f|0,d|0,ue|0)|0,z()|0,v=W+(E<<3)|0,x=v,M=u[x>>2]|0,x=u[x+4>>2]|0,!((M|0)==0&(x|0)==0))for(J=0;;){if((J|0)>(d|0)){de=41;break e}if((M|0)==(l|0)&(x&-117440513|0)==(f|0)){U=ce(M|0,x|0,56)|0,z()|0,U=U&7,H=U+1|0,me=ce(M|0,x|0,45)|0,z()|0;n:do if(!(Ge(me&127)|0))x=7;else{if(M=ce(M|0,x|0,52)|0,z()|0,M=M&15,!M){x=6;break}for(x=1;;){if(me=_e(7,0,(15-x|0)*3|0)|0,!((me&l|0)==0&((z()|0)&f|0)==0)){x=7;break n}if(x>>>0<M>>>0)x=x+1|0;else{x=6;break}}}while(0);if((U+2|0)>>>0>x>>>0){de=51;break e}me=_e(H|0,0,56)|0,f=z()|0|f&-117440513,H=v,u[H>>2]=0,u[H+4>>2]=0,l=me|l}else E=(E+1|0)%(d|0)|0;if(v=W+(E<<3)|0,x=v,M=u[x>>2]|0,x=u[x+4>>2]|0,(M|0)==0&(x|0)==0)break;J=J+1|0}me=v,u[me>>2]=l,u[me+4>>2]=f}if(g=g+1|0,(g|0)>=(d|0))break t;f=we+(g<<3)|0,l=u[f>>2]|0,f=u[f+4>>2]|0}}while(0);if((d+5|0)>>>0<11){de=99;break}if(ne=Si((d|0)/6|0,8)|0,!ne){de=58;break}t:do if(ve){J=0,H=0;do{if(E=W+(J<<3)|0,l=E,g=u[l>>2]|0,l=u[l+4>>2]|0,!((g|0)==0&(l|0)==0)){x=ce(g|0,l|0,56)|0,z()|0,x=x&7,f=x+1|0,M=l&-117440513,me=ce(g|0,l|0,45)|0,z()|0;n:do if(Ge(me&127)|0){if(U=ce(g|0,l|0,52)|0,z()|0,U=U&15,U|0)for(v=1;;){if(me=_e(7,0,(15-v|0)*3|0)|0,!((g&me|0)==0&(M&(z()|0)|0)==0))break n;if(v>>>0<U>>>0)v=v+1|0;else break}l=_e(f|0,0,56)|0,g=l|g,l=z()|0|M,f=E,u[f>>2]=g,u[f+4>>2]=l,f=x+2|0}while(0);(f|0)==7&&(me=ne+(H<<3)|0,u[me>>2]=g,u[me+4>>2]=l&-117440513,H=H+1|0)}J=J+1|0}while((J|0)!=(d|0));if(ve){if(te=((d|0)<0)<<31>>31,U=_e(ae|0,0,52)|0,J=z()|0,ae>>>0>15)for(l=0,g=0;;){do if(!((B|0)==0&(_|0)==0)){for(x=ce(B|0,_|0,52)|0,z()|0,x=x&15,v=(x|0)<(ae|0),x=(x|0)==(ae|0),E=v?0:x?B:0,x=v?0:x?_:0,v=Nr(E|0,x|0,d|0,te|0)|0,z()|0,f=0;;){if((f|0)>(d|0)){de=98;break e}if(me=W+(v<<3)|0,M=u[me+4>>2]|0,(M&-117440513|0)==(x|0)&&(u[me>>2]|0)==(E|0)){de=70;break}if(v=(v+1|0)%(d|0)|0,me=W+(v<<3)|0,(u[me>>2]|0)==(E|0)&&(u[me+4>>2]|0)==(x|0))break;f=f+1|0}if((de|0)==70&&(de=0,!0&(M&117440512|0)==100663296))break;me=c+(g<<3)|0,u[me>>2]=B,u[me+4>>2]=_,g=g+1|0}while(0);if(l=l+1|0,(l|0)>=(d|0)){d=H;break t}_=we+(l<<3)|0,B=u[_>>2]|0,_=u[_+4>>2]|0}for(l=0,g=0;;){do if(!((B|0)==0&(_|0)==0)){if(x=ce(B|0,_|0,52)|0,z()|0,x=x&15,(x|0)>=(ae|0))if((x|0)!=(ae|0))if(f=B|U,v=_&-15728641|J,x>>>0<$>>>0)x=v;else{E=ae;do me=_e(7,0,(14-E|0)*3|0)|0,E=E+1|0,f=me|f,v=z()|0|v;while(E>>>0<x>>>0);x=v}else f=B,x=_;else f=0,x=0;for(E=Nr(f|0,x|0,d|0,te|0)|0,z()|0,v=0;;){if((v|0)>(d|0)){de=98;break e}if(me=W+(E<<3)|0,M=u[me+4>>2]|0,(M&-117440513|0)==(x|0)&&(u[me>>2]|0)==(f|0)){de=93;break}if(E=(E+1|0)%(d|0)|0,me=W+(E<<3)|0,(u[me>>2]|0)==(f|0)&&(u[me+4>>2]|0)==(x|0))break;v=v+1|0}if((de|0)==93&&(de=0,!0&(M&117440512|0)==100663296))break;me=c+(g<<3)|0,u[me>>2]=B,u[me+4>>2]=_,g=g+1|0}while(0);if(l=l+1|0,(l|0)>=(d|0)){d=H;break t}_=we+(l<<3)|0,B=u[_>>2]|0,_=u[_+4>>2]|0}}else g=0,d=H}else g=0,d=0;while(0);if(Pi(W|0,0,Ee|0)|0,Gc(we|0,ne|0,d<<3|0)|0,ze(ne),d)c=c+(g<<3)|0;else break}return(de|0)==41?(ze(we),ze(W),me=-1,me|0):(de|0)==51?(ze(we),ze(W),me=-2,me|0):(de|0)==58?(ze(we),ze(W),me=-3,me|0):(de|0)==98?(ze(ne),ze(we),ze(W),me=-1,me|0):((de|0)==99&&Gc(c|0,we|0,d<<3|0)|0,ze(we),ze(W),me=0,me|0)}function $3(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0;if((c|0)<=0)return g=0,g|0;if((g|0)>=16){for(v=0;;){if(B=l+(v<<3)|0,!((u[B>>2]|0)==0&(u[B+4>>2]|0)==0)){v=14;break}if(v=v+1|0,(v|0)>=(c|0)){_=0,v=16;break}}if((v|0)==14)return((d|0)>0?-2:-1)|0;if((v|0)==16)return _|0}v=0,B=0;e:for(;;){M=l+(B<<3)|0,E=M,_=u[E>>2]|0,E=u[E+4>>2]|0;do if(!((_|0)==0&(E|0)==0)){if((v|0)>=(d|0)){_=-1,v=16;break e}if(x=ce(_|0,E|0,52)|0,z()|0,x=x&15,(x|0)>(g|0)){_=-2,v=16;break e}if((x|0)==(g|0)){M=f+(v<<3)|0,u[M>>2]=_,u[M+4>>2]=E,v=v+1|0;break}if(_=(kc(7,g-x|0)|0)+v|0,(_|0)>(d|0)){_=-1,v=16;break e}Bn(u[M>>2]|0,u[M+4>>2]|0,g,f+(v<<3)|0),v=_}while(0);if(B=B+1|0,(B|0)>=(c|0)){_=0,v=16;break}}return(v|0)==16?_|0:0}function eI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0;if((c|0)<=0)return f=0,f|0;if((f|0)>=16){for(d=0;;){if(_=l+(d<<3)|0,!((u[_>>2]|0)==0&(u[_+4>>2]|0)==0)){d=-1,g=13;break}if(d=d+1|0,(d|0)>=(c|0)){d=0,g=13;break}}if((g|0)==13)return d|0}d=0,_=0;e:for(;;){g=l+(_<<3)|0,v=u[g>>2]|0,g=u[g+4>>2]|0;do if(!((v|0)==0&(g|0)==0)){if(g=ce(v|0,g|0,52)|0,z()|0,g=g&15,(g|0)>(f|0)){d=-1,g=13;break e}if((g|0)==(f|0)){d=d+1|0;break}else{d=(kc(7,f-g|0)|0)+d|0;break}}while(0);if(_=_+1|0,(_|0)>=(c|0)){g=13;break}}return(g|0)==13?d|0:0}function tI(l,c){return l=l|0,c=c|0,c=ce(l|0,c|0,52)|0,z()|0,c&1|0}function Ln(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;if(g=ce(l|0,c|0,52)|0,z()|0,g=g&15,!g)return g=0,g|0;for(d=1;;){if(f=ce(l|0,c|0,(15-d|0)*3|0)|0,z()|0,f=f&7,f|0){d=5;break}if(d>>>0<g>>>0)d=d+1|0;else{f=0,d=5;break}}return(d|0)==5?f|0:0}function cd(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0;if(x=ce(l|0,c|0,52)|0,z()|0,x=x&15,!x)return E=c,x=l,Pe(E|0),x|0;for(E=1,f=0;;){v=(15-E|0)*3|0,d=_e(7,0,v|0)|0,g=z()|0,_=ce(l|0,c|0,v|0)|0,z()|0,v=_e(Ls(_&7)|0,0,v|0)|0,_=z()|0,l=v|l&~d,c=_|c&~g;e:do if(!f)if((v&d|0)==0&(_&g|0)==0)f=0;else if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(_=ce(l|0,c|0,(15-f|0)*3|0)|0,z()|0,_&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(_=(15-f|0)*3|0,g=ce(l|0,c|0,_|0)|0,z()|0,v=_e(7,0,_|0)|0,c=c&~(z()|0),_=_e(Ls(g&7)|0,0,_|0)|0,l=l&~v|_,c=c|(z()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(0);if(E>>>0<x>>>0)E=E+1|0;else break}return Pe(c|0),l|0}function kr(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0;if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,!d)return f=c,d=l,Pe(f|0),d|0;for(f=1;v=(15-f|0)*3|0,_=ce(l|0,c|0,v|0)|0,z()|0,g=_e(7,0,v|0)|0,c=c&~(z()|0),v=_e(Ls(_&7)|0,0,v|0)|0,l=v|l&~g,c=z()|0|c,f>>>0<d>>>0;)f=f+1|0;return Pe(c|0),l|0}function nI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0;if(x=ce(l|0,c|0,52)|0,z()|0,x=x&15,!x)return E=c,x=l,Pe(E|0),x|0;for(E=1,f=0;;){v=(15-E|0)*3|0,d=_e(7,0,v|0)|0,g=z()|0,_=ce(l|0,c|0,v|0)|0,z()|0,v=_e(Dr(_&7)|0,0,v|0)|0,_=z()|0,l=v|l&~d,c=_|c&~g;e:do if(!f)if((v&d|0)==0&(_&g|0)==0)f=0;else if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(_=ce(l|0,c|0,(15-f|0)*3|0)|0,z()|0,_&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(g=(15-f|0)*3|0,v=_e(7,0,g|0)|0,_=c&~(z()|0),c=ce(l|0,c|0,g|0)|0,z()|0,c=_e(Dr(c&7)|0,0,g|0)|0,l=l&~v|c,c=_|(z()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(0);if(E>>>0<x>>>0)E=E+1|0;else break}return Pe(c|0),l|0}function ud(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0;if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,!d)return f=c,d=l,Pe(f|0),d|0;for(f=1;_=(15-f|0)*3|0,v=_e(7,0,_|0)|0,g=c&~(z()|0),c=ce(l|0,c|0,_|0)|0,z()|0,c=_e(Dr(c&7)|0,0,_|0)|0,l=c|l&~v,c=z()|0|g,f>>>0<d>>>0;)f=f+1|0;return Pe(c|0),l|0}function iI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0;if(x=k,k=k+64|0,E=x+40|0,d=x+24|0,g=x+12|0,v=x,_e(c|0,0,52)|0,f=z()|0|134225919,!c)return(u[l+4>>2]|0)>2||(u[l+8>>2]|0)>2||(u[l+12>>2]|0)>2?(_=0,E=0,Pe(_|0),k=x,E|0):(_e(Hn(l)|0,0,45)|0,_=z()|0|f,E=-1,Pe(_|0),k=x,E|0);if(u[E>>2]=u[l>>2],u[E+4>>2]=u[l+4>>2],u[E+8>>2]=u[l+8>>2],u[E+12>>2]=u[l+12>>2],_=E+4|0,(c|0)>0)for(l=-1;u[d>>2]=u[_>>2],u[d+4>>2]=u[_+4>>2],u[d+8>>2]=u[_+8>>2],c&1?(h1(_),u[g>>2]=u[_>>2],u[g+4>>2]=u[_+4>>2],u[g+8>>2]=u[_+8>>2],Oc(g)):(ad(_),u[g>>2]=u[_>>2],u[g+4>>2]=u[_+4>>2],u[g+8>>2]=u[_+8>>2],Bs(g)),od(d,g,v),fn(v),B=(15-c|0)*3|0,M=_e(7,0,B|0)|0,f=f&~(z()|0),B=_e(Rc(v)|0,0,B|0)|0,l=B|l&~M,f=z()|0|f,(c|0)>1;)c=c+-1|0;else l=-1;e:do if((u[_>>2]|0)<=2&&(u[E+8>>2]|0)<=2&&(u[E+12>>2]|0)<=2){if(d=Hn(E)|0,c=_e(d|0,0,45)|0,c=c|l,l=z()|0|f&-1040385,v=v3(E)|0,!(Ge(d)|0)){if((v|0)<=0)break;for(g=0;;){if(d=ce(c|0,l|0,52)|0,z()|0,d=d&15,d)for(f=1;B=(15-f|0)*3|0,E=ce(c|0,l|0,B|0)|0,z()|0,M=_e(7,0,B|0)|0,l=l&~(z()|0),B=_e(Ls(E&7)|0,0,B|0)|0,c=c&~M|B,l=l|(z()|0),f>>>0<d>>>0;)f=f+1|0;if(g=g+1|0,(g|0)==(v|0))break e}}g=ce(c|0,l|0,52)|0,z()|0,g=g&15;t:do if(g){f=1;n:for(;;){switch(B=ce(c|0,l|0,(15-f|0)*3|0)|0,z()|0,B&7){case 1:break n;case 0:break;default:break t}if(f>>>0<g>>>0)f=f+1|0;else break t}if(A1(d,u[E>>2]|0)|0)for(f=1;E=(15-f|0)*3|0,M=_e(7,0,E|0)|0,B=l&~(z()|0),l=ce(c|0,l|0,E|0)|0,z()|0,l=_e(Dr(l&7)|0,0,E|0)|0,c=c&~M|l,l=B|(z()|0),f>>>0<g>>>0;)f=f+1|0;else for(f=1;B=(15-f|0)*3|0,E=ce(c|0,l|0,B|0)|0,z()|0,M=_e(7,0,B|0)|0,l=l&~(z()|0),B=_e(Ls(E&7)|0,0,B|0)|0,c=c&~M|B,l=l|(z()|0),f>>>0<g>>>0;)f=f+1|0}while(0);if((v|0)>0){f=0;do c=cd(c,l)|0,l=z()|0,f=f+1|0;while((f|0)!=(v|0))}}else c=0,l=0;while(0);return M=l,B=c,Pe(M|0),k=x,B|0}function ci(l){return l=l|0,(l|0)%2|0|0}function x1(l,c){l=l|0,c=c|0;var f=0,d=0;return d=k,k=k+16|0,f=d,c>>>0<=15&&(u[l+4>>2]&2146435072|0)!=2146435072&&(u[l+8+4>>2]&2146435072|0)!=2146435072?(M3(l,c,f),c=iI(f,c)|0,l=z()|0):(l=0,c=0),Pe(l|0),k=d,c|0}function fd(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0;if(g=f+4|0,v=ce(l|0,c|0,52)|0,z()|0,v=v&15,_=ce(l|0,c|0,45)|0,z()|0,d=(v|0)==0,Ge(_&127)|0){if(d)return _=1,_|0;d=1}else{if(d)return _=0,_|0;!(u[g>>2]|0)&&!(u[f+8>>2]|0)?d=(u[f+12>>2]|0)!=0&1:d=1}for(f=1;f&1?Oc(g):Bs(g),_=ce(l|0,c|0,(15-f|0)*3|0)|0,z()|0,d1(g,_&7),f>>>0<v>>>0;)f=f+1|0;return d|0}function gl(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0;B=k,k=k+16|0,x=B,M=ce(l|0,c|0,45)|0,z()|0,M=M&127;e:do if(Ge(M)|0&&(v=ce(l|0,c|0,52)|0,z()|0,v=v&15,(v|0)!=0)){d=1;t:for(;;){switch(E=ce(l|0,c|0,(15-d|0)*3|0)|0,z()|0,E&7){case 5:break t;case 0:break;default:{d=c;break e}}if(d>>>0<v>>>0)d=d+1|0;else{d=c;break e}}for(g=1,d=c;c=(15-g|0)*3|0,_=_e(7,0,c|0)|0,E=d&~(z()|0),d=ce(l|0,d|0,c|0)|0,z()|0,d=_e(Dr(d&7)|0,0,c|0)|0,l=l&~_|d,d=E|(z()|0),g>>>0<v>>>0;)g=g+1|0}else d=c;while(0);if(E=7728+(M*28|0)|0,u[f>>2]=u[E>>2],u[f+4>>2]=u[E+4>>2],u[f+8>>2]=u[E+8>>2],u[f+12>>2]=u[E+12>>2],!(fd(l,d,f)|0)){k=B;return}if(_=f+4|0,u[x>>2]=u[_>>2],u[x+4>>2]=u[_+4>>2],u[x+8>>2]=u[_+8>>2],v=ce(l|0,d|0,52)|0,z()|0,E=v&15,v&1?(Bs(_),v=E+1|0):v=E,!(Ge(M)|0))d=0;else{e:do if(!E)d=0;else for(c=1;;){if(g=ce(l|0,d|0,(15-c|0)*3|0)|0,z()|0,g=g&7,g|0){d=g;break e}if(c>>>0<E>>>0)c=c+1|0;else{d=0;break}}while(0);d=(d|0)==4&1}if(!(Bo(f,v,d,0)|0))(v|0)!=(E|0)&&(u[_>>2]=u[x>>2],u[_+4>>2]=u[x+4>>2],u[_+8>>2]=u[x+8>>2]);else{if(Ge(M)|0)do;while(Bo(f,v,0,0)|0);(v|0)!=(E|0)&&ad(_)}k=B}function Rs(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;d=k,k=k+16|0,g=d,gl(l,c,g),c=ce(l|0,c|0,52)|0,z()|0,L3(g,c&15,f),k=d}function Os(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0;_=k,k=k+16|0,v=_,gl(l,c,v),d=ce(l|0,c|0,45)|0,z()|0,d=(Ge(d&127)|0)==0,g=ce(l|0,c|0,52)|0,z()|0,g=g&15;e:do if(!d){if(g|0)for(d=1;;){if(E=_e(7,0,(15-d|0)*3|0)|0,!((E&l|0)==0&((z()|0)&c|0)==0))break e;if(d>>>0<g>>>0)d=d+1|0;else break}v1(v,g,0,5,f),k=_;return}while(0);E1(v,g,0,6,f),k=_}function rI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;if(d=ce(l|0,c|0,45)|0,z()|0,!(Ge(d&127)|0))return d=2,d|0;if(d=ce(l|0,c|0,52)|0,z()|0,d=d&15,!d)return d=5,d|0;for(f=1;;){if(g=_e(7,0,(15-f|0)*3|0)|0,!((g&l|0)==0&((z()|0)&c|0)==0)){f=2,l=6;break}if(f>>>0<d>>>0)f=f+1|0;else{f=5,l=6;break}}return(l|0)==6?f|0:0}function C1(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0;U=k,k=k+128|0,M=U+112|0,v=U+96|0,B=U,g=ce(l|0,c|0,52)|0,z()|0,E=g&15,u[M>>2]=E,_=ce(l|0,c|0,45)|0,z()|0,_=_&127;e:do if(Ge(_)|0){if(E|0)for(d=1;;){if(x=_e(7,0,(15-d|0)*3|0)|0,!((x&l|0)==0&((z()|0)&c|0)==0)){g=0;break e}if(d>>>0<E>>>0)d=d+1|0;else break}if(g&1)g=1;else{x=_e(E+1|0,0,52)|0,B=z()|0|c&-15728641,M=_e(7,0,(14-E|0)*3|0)|0,C1((x|l)&~M,B&~(z()|0),f),k=U;return}}else g=0;while(0);gl(l,c,v),g?(y1(v,M,B),x=5):(T1(v,M,B),x=6);e:do if(Ge(_)|0)if(!E)d=20;else for(d=1;;){if(_=_e(7,0,(15-d|0)*3|0)|0,!((_&l|0)==0&((z()|0)&c|0)==0)){d=8;break e}if(d>>>0<E>>>0)d=d+1|0;else{d=20;break}}else d=8;while(0);if(Pi(f|0,-1,d|0)|0,g){g=0;do{for(v=B+(g<<4)|0,R3(v,u[M>>2]|0)|0,v=u[v>>2]|0,d=0;_=f+(d<<2)|0,E=u[_>>2]|0,!((E|0)==-1|(E|0)==(v|0));)d=d+1|0;u[_>>2]=v,g=g+1|0}while((g|0)!=(x|0))}else{g=0;do{for(v=B+(g<<4)|0,Bo(v,u[M>>2]|0,0,1)|0,v=u[v>>2]|0,d=0;_=f+(d<<2)|0,E=u[_>>2]|0,!((E|0)==-1|(E|0)==(v|0));)d=d+1|0;u[_>>2]=v,g=g+1|0}while((g|0)!=(x|0))}k=U}function sI(){return 12}function hd(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0;if(_e(l|0,0,52)|0,E=z()|0|134225919,(l|0)<1){d=0,f=0;do Ge(d)|0&&(_e(d|0,0,45)|0,_=E|(z()|0),l=c+(f<<3)|0,u[l>>2]=-1,u[l+4>>2]=_,f=f+1|0),d=d+1|0;while((d|0)!=122);return}_=0,f=0;do{if(Ge(_)|0){for(_e(_|0,0,45)|0,d=1,g=-1,v=E|(z()|0);x=_e(7,0,(15-d|0)*3|0)|0,g=g&~x,v=v&~(z()|0),(d|0)!=(l|0);)d=d+1|0;x=c+(f<<3)|0,u[x>>2]=g,u[x+4>>2]=v,f=f+1|0}_=_+1|0}while((_|0)!=122)}function S1(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0;if(E=k,k=k+64|0,_=E,(l|0)==(f|0)&(c|0)==(d|0)|(!1|(c&2013265920|0)!=134217728|(!1|(d&2013265920|0)!=134217728))||(g=ce(l|0,c|0,52)|0,z()|0,g=g&15,v=ce(f|0,d|0,52)|0,z()|0,(g|0)!=(v&15|0)))return _=0,k=E,_|0;if(v=g+-1|0,g>>>0>1&&(M=Ad(l,c,v)|0,x=z()|0,v=Ad(f,d,v)|0,(M|0)==(v|0)&(x|0)==(z()|0))&&(v=(g^15)*3|0,g=ce(l|0,c|0,v|0)|0,z()|0,g=g&7,v=ce(f|0,d|0,v|0)|0,z()|0,v=v&7,(g|0)==0|(v|0)==0||(u[21136+(g<<2)>>2]|0)==(v|0)||(u[21168+(g<<2)>>2]|0)==(v|0)))return M=1,k=E,M|0;g=_,v=g+56|0;do u[g>>2]=0,g=g+4|0;while((g|0)<(v|0));return Mo(l,c,1,_),M=_,!((u[M>>2]|0)==(f|0)&&(u[M+4>>2]|0)==(d|0))&&(M=_+8|0,!((u[M>>2]|0)==(f|0)&&(u[M+4>>2]|0)==(d|0)))&&(M=_+16|0,!((u[M>>2]|0)==(f|0)&&(u[M+4>>2]|0)==(d|0)))&&(M=_+24|0,!((u[M>>2]|0)==(f|0)&&(u[M+4>>2]|0)==(d|0)))&&(M=_+32|0,!((u[M>>2]|0)==(f|0)&&(u[M+4>>2]|0)==(d|0)))&&(M=_+40|0,!((u[M>>2]|0)==(f|0)&&(u[M+4>>2]|0)==(d|0)))?(g=_+48|0,g=((u[g>>2]|0)==(f|0)?(u[g+4>>2]|0)==(d|0):0)&1):g=1,M=g,k=E,M|0}function oI(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0,B=0;if(M=k,k=k+16|0,_=M,!(S1(l,c,f,d)|0))return E=0,x=0,Pe(E|0),k=M,x|0;for(E=c&-2130706433,g=(Xt(l,c)|0)==0,g=g?1:2;u[_>>2]=0,B=L(l,c,g,_)|0,v=g+1|0,!((B|0)==(f|0)&(z()|0)==(d|0));)if(v>>>0<7)g=v;else{g=0,l=0,x=6;break}return(x|0)==6?(Pe(g|0),k=M,l|0):(B=_e(g|0,0,56)|0,x=E|(z()|0)|268435456,B=l|B,Pe(x|0),k=M,B|0)}function aI(l,c){l=l|0,c=c|0;var f=0;return f=!0&(c&2013265920|0)==268435456,Pe((f?c&-2130706433|134217728:0)|0),(f?l:0)|0}function lI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;return d=k,k=k+16|0,f=d,!0&(c&2013265920|0)==268435456?(g=ce(l|0,c|0,56)|0,z()|0,u[f>>2]=0,f=L(l,c&-2130706433|134217728,g&7,f)|0,c=z()|0,Pe(c|0),k=d,f|0):(c=0,f=0,Pe(c|0),k=d,f|0)}function AI(l,c){l=l|0,c=c|0;var f=0;if(!(!0&(c&2013265920|0)==268435456))return f=0,f|0;switch(f=ce(l|0,c|0,56)|0,z()|0,f&7){case 0:case 7:return f=0,f|0}return f=c&-2130706433|134217728,!0&(c&117440512|0)==16777216&(Xt(l,f)|0)!=0?(f=0,f|0):(f=b1(l,f)|0,f|0)}function cI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0;v=k,k=k+16|0,d=v,_=!0&(c&2013265920|0)==268435456,g=c&-2130706433|134217728,E=f,u[E>>2]=_?l:0,u[E+4>>2]=_?g:0,_?(c=ce(l|0,c|0,56)|0,z()|0,u[d>>2]=0,l=L(l,g,c&7,d)|0,c=z()|0):(l=0,c=0),E=f+8|0,u[E>>2]=l,u[E+4>>2]=c,k=v}function uI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;g=(Xt(l,c)|0)==0,c=c&-2130706433,d=f,u[d>>2]=g?l:0,u[d+4>>2]=g?c|285212672:0,d=f+8|0,u[d>>2]=l,u[d+4>>2]=c|301989888,d=f+16|0,u[d>>2]=l,u[d+4>>2]=c|318767104,d=f+24|0,u[d>>2]=l,u[d+4>>2]=c|335544320,d=f+32|0,u[d>>2]=l,u[d+4>>2]=c|352321536,f=f+40|0,u[f>>2]=l,u[f+4>>2]=c|369098752}function Dc(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0;if(_=k,k=k+16|0,v=_,d=ce(l|0,c|0,56)|0,z()|0,E=!0&(c&2013265920|0)==268435456,g=E?l:0,l=E?c&-2130706433|134217728:0,c=LI(g,l,d&7)|0,(c|0)==-1){u[f>>2]=0,k=_;return}gl(g,l,v),d=ce(g|0,l|0,52)|0,z()|0,d=d&15,Xt(g,l)|0?v1(v,d,c,2,f):E1(v,d,c,2,f),k=_}function fI(l){l=l|0;var c=0,f=0,d=0;return c=Si(1,12)|0,c||tt(22691,22646,49,22704),f=l+4|0,d=u[f>>2]|0,d|0?(d=d+8|0,u[d>>2]=c,u[f>>2]=c,c|0):(u[l>>2]|0&&tt(22721,22646,61,22744),d=l,u[d>>2]=c,u[f>>2]=c,c|0)}function hI(l,c){l=l|0,c=c|0;var f=0,d=0;return d=Ji(24)|0,d||tt(22758,22646,78,22772),u[d>>2]=u[c>>2],u[d+4>>2]=u[c+4>>2],u[d+8>>2]=u[c+8>>2],u[d+12>>2]=u[c+12>>2],u[d+16>>2]=0,c=l+4|0,f=u[c>>2]|0,f|0?(u[f+16>>2]=d,u[c>>2]=d,d|0):(u[l>>2]|0&&tt(22787,22646,82,22772),u[l>>2]=d,u[c>>2]=d,d|0)}function dI(l){l=l|0;var c=0,f=0,d=0,g=0;if(l)for(d=1;;){if(c=u[l>>2]|0,c|0)do{if(f=u[c>>2]|0,f|0)do g=f,f=u[f+16>>2]|0,ze(g);while(f|0);g=c,c=u[c+8>>2]|0,ze(g)}while(c|0);if(c=l,l=u[l+8>>2]|0,d||ze(c),l)d=0;else break}}function P1(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0,me=0,Ne=0,lt=0,st=0,ft=0,nt=0,dt=0,pt=0,Oe=0;if(g=l+8|0,u[g>>2]|0)return Oe=1,Oe|0;if(d=u[l>>2]|0,!d)return Oe=0,Oe|0;c=d,f=0;do f=f+1|0,c=u[c+8>>2]|0;while(c|0);if(f>>>0<2)return Oe=0,Oe|0;dt=Ji(f<<2)|0,dt||tt(22807,22646,317,22826),nt=Ji(f<<5)|0,nt||tt(22848,22646,321,22826),u[l>>2]=0,we=l+4|0,u[we>>2]=0,u[g>>2]=0,f=0,ft=0,Ee=0,U=0;e:for(;;){if(B=u[d>>2]|0,B){v=0,_=B;do{if(x=+N[_+8>>3],c=_,_=u[_+16>>2]|0,M=(_|0)==0,g=M?B:_,E=+N[g+8>>3],+Ve(+(x-E))>3.141592653589793){Oe=14;break}v=v+(E-x)*(+N[c>>3]+ +N[g>>3])}while(!M);if((Oe|0)==14){Oe=0,v=0,c=B;do W=+N[c+8>>3],st=c+16|0,lt=u[st>>2]|0,lt=lt|0?lt:B,ae=+N[lt+8>>3],v=v+(+N[c>>3]+ +N[lt>>3])*((ae<0?ae+6.283185307179586:ae)-(W<0?W+6.283185307179586:W)),c=u[(c|0?st:d)>>2]|0;while(c|0)}v>0?(u[dt+(ft<<2)>>2]=d,ft=ft+1|0,g=Ee,c=U):Oe=19}else Oe=19;if((Oe|0)==19){Oe=0;do if(f){if(c=f+8|0,u[c>>2]|0){Oe=21;break e}if(f=Si(1,12)|0,!f){Oe=23;break e}u[c>>2]=f,g=f+4|0,_=f,c=U}else if(U){g=we,_=U+8|0,c=d,f=l;break}else if(u[l>>2]|0){Oe=27;break e}else{g=we,_=l,c=d,f=l;break}while(0);if(u[_>>2]=d,u[g>>2]=d,_=nt+(Ee<<5)|0,M=u[d>>2]|0,M){for(B=nt+(Ee<<5)+8|0,N[B>>3]=17976931348623157e292,U=nt+(Ee<<5)+24|0,N[U>>3]=17976931348623157e292,N[_>>3]=-17976931348623157e292,H=nt+(Ee<<5)+16|0,N[H>>3]=-17976931348623157e292,ve=17976931348623157e292,$=-17976931348623157e292,g=0,J=M,x=17976931348623157e292,ne=17976931348623157e292,ue=-17976931348623157e292,E=-17976931348623157e292;v=+N[J>>3],W=+N[J+8>>3],J=u[J+16>>2]|0,te=(J|0)==0,ae=+N[(te?M:J)+8>>3],v<x&&(N[B>>3]=v,x=v),W<ne&&(N[U>>3]=W,ne=W),v>ue?N[_>>3]=v:v=ue,W>E&&(N[H>>3]=W,E=W),ve=W>0&W<ve?W:ve,$=W<0&W>$?W:$,g=g|+Ve(+(W-ae))>3.141592653589793,!te;)ue=v;g&&(N[H>>3]=$,N[U>>3]=ve)}else u[_>>2]=0,u[_+4>>2]=0,u[_+8>>2]=0,u[_+12>>2]=0,u[_+16>>2]=0,u[_+20>>2]=0,u[_+24>>2]=0,u[_+28>>2]=0;g=Ee+1|0}if(st=d+8|0,d=u[st>>2]|0,u[st>>2]=0,d)Ee=g,U=c;else{Oe=45;break}}if((Oe|0)==21)tt(22624,22646,35,22658);else if((Oe|0)==23)tt(22678,22646,37,22658);else if((Oe|0)==27)tt(22721,22646,61,22744);else if((Oe|0)==45){e:do if((ft|0)>0){for(st=(g|0)==0,Ne=g<<2,lt=(l|0)==0,me=0,c=0;;){if(de=u[dt+(me<<2)>>2]|0,st)Oe=73;else{if(Ee=Ji(Ne)|0,!Ee){Oe=50;break}if(we=Ji(Ne)|0,!we){Oe=52;break}t:do if(lt)f=0;else{for(g=0,f=0,_=l;d=nt+(g<<5)|0,I1(u[_>>2]|0,d,u[de>>2]|0)|0?(u[Ee+(f<<2)>>2]=_,u[we+(f<<2)>>2]=d,te=f+1|0):te=f,_=u[_+8>>2]|0,_;)g=g+1|0,f=te;if((te|0)>0)if(d=u[Ee>>2]|0,(te|0)==1)f=d;else for(H=0,J=-1,f=d,U=d;;){for(M=u[U>>2]|0,d=0,_=0;g=u[u[Ee+(_<<2)>>2]>>2]|0,(g|0)==(M|0)?B=d:B=d+((I1(g,u[we+(_<<2)>>2]|0,u[M>>2]|0)|0)&1)|0,_=_+1|0,(_|0)!=(te|0);)d=B;if(g=(B|0)>(J|0),f=g?U:f,d=H+1|0,(d|0)==(te|0))break t;H=d,J=g?B:J,U=u[Ee+(d<<2)>>2]|0}else f=0}while(0);if(ze(Ee),ze(we),f){if(g=f+4|0,d=u[g>>2]|0,d)f=d+8|0;else if(u[f>>2]|0){Oe=70;break}u[f>>2]=de,u[g>>2]=de}else Oe=73}if((Oe|0)==73){if(Oe=0,c=u[de>>2]|0,c|0)do we=c,c=u[c+16>>2]|0,ze(we);while(c|0);ze(de),c=2}if(me=me+1|0,(me|0)>=(ft|0)){pt=c;break e}}(Oe|0)==50?tt(22863,22646,249,22882):(Oe|0)==52?tt(22901,22646,252,22882):(Oe|0)==70&&tt(22721,22646,61,22744)}else pt=0;while(0);return ze(dt),ze(nt),Oe=pt,Oe|0}return 0}function I1(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0;if(!(u1(c,f)|0)||(c=c1(c)|0,M=+N[f>>3],d=+N[f+8>>3],d=c&d<0?d+6.283185307179586:d,l=u[l>>2]|0,!l))return l=0,l|0;if(c){c=0,f=l;e:for(;;){for(;_=+N[f>>3],x=+N[f+8>>3],f=f+16|0,B=u[f>>2]|0,B=B|0?B:l,v=+N[B>>3],g=+N[B+8>>3],_>v?(E=_,_=x):(E=v,v=_,_=g,g=x),!!(M<v|M>E);)if(f=u[f>>2]|0,!f){f=22;break e}if(x=g<0?g+6.283185307179586:g,_=_<0?_+6.283185307179586:_,d=_==d|x==d?d+-2220446049250313e-31:d,x=x+(M-v)/(E-v)*(_-x),(x<0?x+6.283185307179586:x)>d&&(c=c^1),f=u[f>>2]|0,!f){f=22;break}}if((f|0)==22)return c|0}else{c=0,f=l;e:for(;;){for(;_=+N[f>>3],x=+N[f+8>>3],f=f+16|0,B=u[f>>2]|0,B=B|0?B:l,v=+N[B>>3],g=+N[B+8>>3],_>v?(E=_,_=x):(E=v,v=_,_=g,g=x),!!(M<v|M>E);)if(f=u[f>>2]|0,!f){f=22;break e}if(d=_==d|g==d?d+-2220446049250313e-31:d,g+(M-v)/(E-v)*(_-g)>d&&(c=c^1),f=u[f>>2]|0,!f){f=22;break}}if((f|0)==22)return c|0}return 0}function cr(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0;if($=k,k=k+32|0,ve=$+16|0,ue=$,v=ce(l|0,c|0,52)|0,z()|0,v=v&15,J=ce(f|0,d|0,52)|0,z()|0,(v|0)!=(J&15|0))return ve=1,k=$,ve|0;if(M=ce(l|0,c|0,45)|0,z()|0,M=M&127,B=ce(f|0,d|0,45)|0,z()|0,B=B&127,J=(M|0)!=(B|0),J){if(E=rd(M,B)|0,(E|0)==7)return ve=2,k=$,ve|0;x=rd(B,M)|0,(x|0)==7?tt(22925,22949,151,22959):(te=E,_=x)}else te=0,_=0;U=Ge(M)|0,H=Ge(B)|0,u[ve>>2]=0,u[ve+4>>2]=0,u[ve+8>>2]=0,u[ve+12>>2]=0;do if(te){if(B=u[4304+(M*28|0)+(te<<2)>>2]|0,E=(B|0)>0,H)if(E){M=0,x=f,E=d;do x=nI(x,E)|0,E=z()|0,_=Dr(_)|0,(_|0)==1&&(_=Dr(1)|0),M=M+1|0;while((M|0)!=(B|0));B=_,M=x,x=E}else B=_,M=f,x=d;else if(E){M=0,x=f,E=d;do x=ud(x,E)|0,E=z()|0,_=Dr(_)|0,M=M+1|0;while((M|0)!=(B|0));B=_,M=x,x=E}else B=_,M=f,x=d;if(fd(M,x,ve)|0,J||tt(22972,22949,181,22959),E=(U|0)!=0,_=(H|0)!=0,E&_&&tt(22999,22949,182,22959),E){if(_=Ln(l,c)|0,Me[22032+(_*7|0)+te>>0]|0){v=3;break}x=u[21200+(_*28|0)+(te<<2)>>2]|0,M=x,ne=26}else if(_){if(_=Ln(M,x)|0,Me[22032+(_*7|0)+B>>0]|0){v=4;break}M=0,x=u[21200+(B*28|0)+(_<<2)>>2]|0,ne=26}else _=0;if((ne|0)==26)if((x|0)<=-1&&tt(23030,22949,212,22959),(M|0)<=-1&&tt(23053,22949,213,22959),(x|0)>0){E=ve+4|0,_=0;do Fc(E),_=_+1|0;while((_|0)!=(x|0));_=M}else _=M;if(u[ue>>2]=0,u[ue+4>>2]=0,u[ue+8>>2]=0,d1(ue,te),v|0)for(;ci(v)|0?Oc(ue):Bs(ue),(v|0)>1;)v=v+-1|0;if((_|0)>0){v=0;do Fc(ue),v=v+1|0;while((v|0)!=(_|0))}ne=ve+4|0,wn(ne,ue,ne),fn(ne),ne=50}else if(fd(f,d,ve)|0,(U|0)!=0&(H|0)!=0)if((B|0)!=(M|0)&&tt(23077,22949,243,22959),_=Ln(l,c)|0,v=Ln(f,d)|0,Me[22032+(_*7|0)+v>>0]|0)v=5;else if(_=u[21200+(_*28|0)+(v<<2)>>2]|0,(_|0)>0){E=ve+4|0,v=0;do Fc(E),v=v+1|0;while((v|0)!=(_|0));ne=50}else ne=50;else ne=50;while(0);return(ne|0)==50&&(v=ve+4|0,u[g>>2]=u[v>>2],u[g+4>>2]=u[v+4>>2],u[g+8>>2]=u[v+8>>2],v=0),ve=v,k=$,ve|0}function M1(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0;if(te=k,k=k+48|0,_=te+36|0,E=te+24|0,x=te+12|0,M=te,v=ce(l|0,c|0,52)|0,z()|0,v=v&15,H=ce(l|0,c|0,45)|0,z()|0,H=H&127,B=Ge(H)|0,_e(v|0,0,52)|0,ue=z()|0|134225919,ne=d,u[ne>>2]=-1,u[ne+4>>2]=ue,!v)return(u[f>>2]|0)>1||(u[f+4>>2]|0)>1||(u[f+8>>2]|0)>1||(g=id(H,Rc(f)|0)|0,(g|0)==127)?(ue=1,k=te,ue|0):(J=_e(g|0,0,45)|0,ne=z()|0,H=d,ne=u[H+4>>2]&-1040385|ne,ue=d,u[ue>>2]=u[H>>2]|J,u[ue+4>>2]=ne,ue=0,k=te,ue|0);for(u[_>>2]=u[f>>2],u[_+4>>2]=u[f+4>>2],u[_+8>>2]=u[f+8>>2];u[E>>2]=u[_>>2],u[E+4>>2]=u[_+4>>2],u[E+8>>2]=u[_+8>>2],ci(v)|0?(h1(_),u[x>>2]=u[_>>2],u[x+4>>2]=u[_+4>>2],u[x+8>>2]=u[_+8>>2],Oc(x)):(ad(_),u[x>>2]=u[_>>2],u[x+4>>2]=u[_+4>>2],u[x+8>>2]=u[_+8>>2],Bs(x)),od(E,x,M),fn(M),ne=d,ve=u[ne>>2]|0,ne=u[ne+4>>2]|0,$=(15-v|0)*3|0,f=_e(7,0,$|0)|0,ne=ne&~(z()|0),$=_e(Rc(M)|0,0,$|0)|0,ne=z()|0|ne,ue=d,u[ue>>2]=$|ve&~f,u[ue+4>>2]=ne,(v|0)>1;)v=v+-1|0;e:do if((u[_>>2]|0)<=1&&(u[_+4>>2]|0)<=1&&(u[_+8>>2]|0)<=1){v=Rc(_)|0,E=id(H,v)|0,(E|0)==127?M=0:M=Ge(E)|0;t:do if(v){if(B){if(_=21408+((Ln(l,c)|0)*28|0)+(v<<2)|0,_=u[_>>2]|0,(_|0)>0){f=0;do v=Ls(v)|0,f=f+1|0;while((f|0)!=(_|0))}if((v|0)==1){g=3;break e}f=id(H,v)|0,(f|0)==127&&tt(23104,22949,376,23134),Ge(f)|0?tt(23147,22949,377,23134):(J=_,U=v,g=f)}else J=0,U=v,g=E;if(x=u[4304+(H*28|0)+(U<<2)>>2]|0,(x|0)<=-1&&tt(23178,22949,384,23134),!M){if((J|0)<=-1&&tt(23030,22949,417,23134),J|0){_=d,v=0,f=u[_>>2]|0,_=u[_+4>>2]|0;do f=kr(f,_)|0,_=z()|0,$=d,u[$>>2]=f,u[$+4>>2]=_,v=v+1|0;while((v|0)<(J|0))}if((x|0)<=0){v=54;break}for(_=d,v=0,f=u[_>>2]|0,_=u[_+4>>2]|0;;)if(f=kr(f,_)|0,_=z()|0,$=d,u[$>>2]=f,u[$+4>>2]=_,v=v+1|0,(v|0)==(x|0)){v=54;break t}}if(E=rd(g,H)|0,(E|0)==7&&tt(22925,22949,393,23134),v=d,f=u[v>>2]|0,v=u[v+4>>2]|0,(x|0)>0){_=0;do f=kr(f,v)|0,v=z()|0,$=d,u[$>>2]=f,u[$+4>>2]=v,_=_+1|0;while((_|0)!=(x|0))}if(f=Ln(f,v)|0,$=Qt(g)|0,f=u[($?21824:21616)+(E*28|0)+(f<<2)>>2]|0,(f|0)<=-1&&tt(23030,22949,412,23134),!f)v=54;else{E=d,v=0,_=u[E>>2]|0,E=u[E+4>>2]|0;do _=cd(_,E)|0,E=z()|0,$=d,u[$>>2]=_,u[$+4>>2]=E,v=v+1|0;while((v|0)<(f|0));v=54}}else if((B|0)!=0&(M|0)!=0)if($=Ln(l,c)|0,v=d,v=21408+($*28|0)+((Ln(u[v>>2]|0,u[v+4>>2]|0)|0)<<2)|0,v=u[v>>2]|0,(v|0)<=-1&&tt(23201,22949,433,23134),!v)g=E,v=55;else{_=d,g=0,f=u[_>>2]|0,_=u[_+4>>2]|0;do f=kr(f,_)|0,_=z()|0,$=d,u[$>>2]=f,u[$+4>>2]=_,g=g+1|0;while((g|0)<(v|0));g=E,v=54}else g=E,v=54;while(0);if((v|0)==54&&M&&(v=55),(v|0)==55&&($=d,(Ln(u[$>>2]|0,u[$+4>>2]|0)|0)==1)){g=4;break}$=d,ue=u[$>>2]|0,$=u[$+4>>2]&-1040385,ve=_e(g|0,0,45)|0,$=$|(z()|0),g=d,u[g>>2]=ue|ve,u[g+4>>2]=$,g=0}else g=2;while(0);return $=g,k=te,$|0}function pI(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0;return _=k,k=k+16|0,v=_,l=cr(l,c,f,d,v)|0,l||(S3(v,g),l=0),k=_,l|0}function gI(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0;return g=k,k=k+16|0,v=g,P3(f,v),d=M1(l,c,v,d)|0,k=g,d|0}function mI(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0;return _=k,k=k+32|0,g=_+12|0,v=_,!(cr(l,c,l,c,g)|0)&&!(cr(l,c,f,d,v)|0)?l=ld(g,v)|0:l=-1,k=_,l|0}function _I(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0,_=0;return _=k,k=k+32|0,g=_+12|0,v=_,!(cr(l,c,l,c,g)|0)&&!(cr(l,c,f,d,v)|0)?l=ld(g,v)|0:l=-1,k=_,(l>>>31^1)+l|0}function vI(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0;if(Ee=k,k=k+48|0,v=Ee+24|0,_=Ee+12|0,W=Ee,!(cr(l,c,l,c,v)|0)&&!(cr(l,c,f,d,_)|0)){if(ae=ld(v,_)|0,(ae|0)<0)return W=ae,k=Ee,W|0;for(u[v>>2]=0,u[v+4>>2]=0,u[v+8>>2]=0,u[_>>2]=0,u[_+4>>2]=0,u[_+8>>2]=0,cr(l,c,l,c,v)|0,cr(l,c,f,d,_)|0,_1(v),_1(_),ae?(B=u[v>>2]|0,J=+(ae|0),ue=v+4|0,U=u[ue>>2]|0,ve=v+8|0,H=u[ve>>2]|0,$=v,f=B,d=U,v=H,te=+((u[_>>2]|0)-B|0)/J,ne=+((u[_+4>>2]|0)-U|0)/J,J=+((u[_+8>>2]|0)-H|0)/J):(d=v+4|0,H=v+8|0,ue=d,ve=H,$=v,f=u[v>>2]|0,d=u[d>>2]|0,v=u[H>>2]|0,te=0,ne=0,J=0),u[W>>2]=f,H=W+4|0,u[H>>2]=d,U=W+8|0,u[U>>2]=v,B=0;;){x=+(B|0),we=te*x+ +(f|0),E=ne*x+ +(u[ue>>2]|0),x=J*x+ +(u[ve>>2]|0),d=~~+Uc(+we),_=~~+Uc(+E),f=~~+Uc(+x),we=+Ve(+(+(d|0)-we)),E=+Ve(+(+(_|0)-E)),x=+Ve(+(+(f|0)-x));do if(we>E&we>x)d=0-(_+f)|0,v=_;else if(M=0-d|0,E>x){v=M-f|0;break}else{v=_,f=M-_|0;break}while(0);if(u[W>>2]=d,u[H>>2]=v,u[U>>2]=f,I3(W),M1(l,c,W,g+(B<<3)|0)|0,(B|0)==(ae|0))break;B=B+1|0,f=u[$>>2]|0}return W=0,k=Ee,W|0}return W=-1,k=Ee,W|0}function kc(l,c){l=l|0,c=c|0;var f=0;if(!c)return f=1,f|0;f=l,l=1;do l=tn(c&1|0?f:1,l)|0,c=c>>1,f=tn(f,f)|0;while(c|0);return l|0}function B1(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0;if(!(u1(c,f)|0)||(c=c1(c)|0,H=+N[f>>3],d=+N[f+8>>3],d=c&d<0?d+6.283185307179586:d,U=u[l>>2]|0,(U|0)<=0))return U=0,U|0;if(B=u[l+4>>2]|0,c){c=0,f=-1,l=0;e:for(;;){for(M=l;_=+N[B+(M<<4)>>3],x=+N[B+(M<<4)+8>>3],l=(f+2|0)%(U|0)|0,v=+N[B+(l<<4)>>3],g=+N[B+(l<<4)+8>>3],_>v?(E=_,_=x):(E=v,v=_,_=g,g=x),!!(H<v|H>E);)if(f=M+1|0,(f|0)<(U|0))l=M,M=f,f=l;else{f=22;break e}if(x=g<0?g+6.283185307179586:g,_=_<0?_+6.283185307179586:_,d=_==d|x==d?d+-2220446049250313e-31:d,x=x+(H-v)/(E-v)*(_-x),(x<0?x+6.283185307179586:x)>d&&(c=c^1),l=M+1|0,(l|0)>=(U|0)){f=22;break}else f=M}if((f|0)==22)return c|0}else{c=0,f=-1,l=0;e:for(;;){for(M=l;_=+N[B+(M<<4)>>3],x=+N[B+(M<<4)+8>>3],l=(f+2|0)%(U|0)|0,v=+N[B+(l<<4)>>3],g=+N[B+(l<<4)+8>>3],_>v?(E=_,_=x):(E=v,v=_,_=g,g=x),!!(H<v|H>E);)if(f=M+1|0,(f|0)<(U|0))l=M,M=f,f=l;else{f=22;break e}if(d=_==d|g==d?d+-2220446049250313e-31:d,g+(H-v)/(E-v)*(_-g)>d&&(c=c^1),l=M+1|0,(l|0)>=(U|0)){f=22;break}else f=M}if((f|0)==22)return c|0}return 0}function dd(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0;if(te=u[l>>2]|0,!te){u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;return}if(ne=c+8|0,N[ne>>3]=17976931348623157e292,ue=c+24|0,N[ue>>3]=17976931348623157e292,N[c>>3]=-17976931348623157e292,ve=c+16|0,N[ve>>3]=-17976931348623157e292,!((te|0)<=0)){for(H=u[l+4>>2]|0,M=17976931348623157e292,B=-17976931348623157e292,U=0,l=-1,v=17976931348623157e292,_=17976931348623157e292,x=-17976931348623157e292,d=-17976931348623157e292,J=0;f=+N[H+(J<<4)>>3],E=+N[H+(J<<4)+8>>3],l=l+2|0,g=+N[H+(((l|0)==(te|0)?0:l)<<4)+8>>3],f<v&&(N[ne>>3]=f,v=f),E<_&&(N[ue>>3]=E,_=E),f>x?N[c>>3]=f:f=x,E>d&&(N[ve>>3]=E,d=E),M=E>0&E<M?E:M,B=E<0&E>B?E:B,U=U|+Ve(+(E-g))>3.141592653589793,l=J+1|0,(l|0)!=(te|0);)$=J,x=f,J=l,l=$;U&&(N[ve>>3]=B,N[ue>>3]=M)}}function yI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0,we=0,de=0;if(te=u[l>>2]|0,te){if(ne=c+8|0,N[ne>>3]=17976931348623157e292,ue=c+24|0,N[ue>>3]=17976931348623157e292,N[c>>3]=-17976931348623157e292,ve=c+16|0,N[ve>>3]=-17976931348623157e292,(te|0)>0){for(g=u[l+4>>2]|0,H=17976931348623157e292,J=-17976931348623157e292,d=0,f=-1,x=17976931348623157e292,M=17976931348623157e292,U=-17976931348623157e292,_=-17976931348623157e292,$=0;v=+N[g+($<<4)>>3],B=+N[g+($<<4)+8>>3],we=f+2|0,E=+N[g+(((we|0)==(te|0)?0:we)<<4)+8>>3],v<x&&(N[ne>>3]=v,x=v),B<M&&(N[ue>>3]=B,M=B),v>U?N[c>>3]=v:v=U,B>_&&(N[ve>>3]=B,_=B),H=B>0&B<H?B:H,J=B<0&B>J?B:J,d=d|+Ve(+(B-E))>3.141592653589793,f=$+1|0,(f|0)!=(te|0);)we=$,U=v,$=f,f=we;d&&(N[ve>>3]=J,N[ue>>3]=H)}}else u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;if(we=l+8|0,f=u[we>>2]|0,!((f|0)<=0)){Ee=l+12|0,W=0;do if(g=u[Ee>>2]|0,d=W,W=W+1|0,ue=c+(W<<5)|0,ve=u[g+(d<<3)>>2]|0,ve){if($=c+(W<<5)+8|0,N[$>>3]=17976931348623157e292,l=c+(W<<5)+24|0,N[l>>3]=17976931348623157e292,N[ue>>3]=-17976931348623157e292,ae=c+(W<<5)+16|0,N[ae>>3]=-17976931348623157e292,(ve|0)>0){for(te=u[g+(d<<3)+4>>2]|0,H=17976931348623157e292,J=-17976931348623157e292,g=0,d=-1,ne=0,x=17976931348623157e292,M=17976931348623157e292,B=-17976931348623157e292,_=-17976931348623157e292;v=+N[te+(ne<<4)>>3],U=+N[te+(ne<<4)+8>>3],d=d+2|0,E=+N[te+(((d|0)==(ve|0)?0:d)<<4)+8>>3],v<x&&(N[$>>3]=v,x=v),U<M&&(N[l>>3]=U,M=U),v>B?N[ue>>3]=v:v=B,U>_&&(N[ae>>3]=U,_=U),H=U>0&U<H?U:H,J=U<0&U>J?U:J,g=g|+Ve(+(U-E))>3.141592653589793,d=ne+1|0,(d|0)!=(ve|0);)de=ne,ne=d,B=v,d=de;g&&(N[ae>>3]=J,N[l>>3]=H)}}else u[ue>>2]=0,u[ue+4>>2]=0,u[ue+8>>2]=0,u[ue+12>>2]=0,u[ue+16>>2]=0,u[ue+20>>2]=0,u[ue+24>>2]=0,u[ue+28>>2]=0,f=u[we>>2]|0;while((W|0)<(f|0))}}function EI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0;if(!(B1(l,c,f)|0))return g=0,g|0;if(g=l+8|0,(u[g>>2]|0)<=0)return g=1,g|0;for(d=l+12|0,l=0;;){if(v=l,l=l+1|0,B1((u[d>>2]|0)+(v<<3)|0,c+(l<<5)|0,f)|0){l=0,d=6;break}if((l|0)>=(u[g>>2]|0)){l=1,d=6;break}}return(d|0)==6?l|0:0}function TI(){return 8}function wI(){return 16}function bI(){return 168}function xI(){return 8}function CI(){return 16}function SI(){return 12}function PI(){return 8}function II(l){l=l|0;var c=0,f=0;return f=+N[l>>3],c=+N[l+8>>3],+ +We(+(f*f+c*c))}function L1(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0;M=+N[l>>3],x=+N[c>>3]-M,E=+N[l+8>>3],_=+N[c+8>>3]-E,U=+N[f>>3],v=+N[d>>3]-U,H=+N[f+8>>3],B=+N[d+8>>3]-H,v=(v*(E-H)-(M-U)*B)/(x*B-_*v),N[g>>3]=M+x*v,N[g+8>>3]=E+_*v}function R1(l,c){return l=l|0,c=c|0,+N[l>>3]!=+N[c>>3]?(c=0,c|0):(c=+N[l+8>>3]==+N[c+8>>3],c|0)}function Vt(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;return g=+N[l>>3]-+N[c>>3],d=+N[l+8>>3]-+N[c+8>>3],f=+N[l+16>>3]-+N[c+16>>3],+(g*g+d*d+f*f)}function MI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0;f=+N[l>>3],d=+qe(+f),f=+Je(+f),N[c+16>>3]=f,f=+N[l+8>>3],g=d*+qe(+f),N[c>>3]=g,f=d*+Je(+f),N[c+8>>3]=f}function BI(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0;if(M=k,k=k+32|0,g=M+16|0,v=M,gl(l,c,g),_=w1(l,c)|0,x=Ln(l,c)|0,y3(_,v),c=E3(_,u[g>>2]|0)|0,!(Ge(_)|0))return x=c,k=M,x|0;do switch(_|0){case 4:{l=0,f=14;break}case 14:{l=1,f=14;break}case 24:{l=2,f=14;break}case 38:{l=3,f=14;break}case 49:{l=4,f=14;break}case 58:{l=5,f=14;break}case 63:{l=6,f=14;break}case 72:{l=7,f=14;break}case 83:{l=8,f=14;break}case 97:{l=9,f=14;break}case 107:{l=10,f=14;break}case 117:{l=11,f=14;break}default:E=0,d=0}while(0);return(f|0)==14&&(E=u[22096+(l*24|0)+8>>2]|0,d=u[22096+(l*24|0)+16>>2]|0),l=u[g>>2]|0,(l|0)!=(u[v>>2]|0)&&(_=Qt(_)|0,l=u[g>>2]|0,_|(l|0)==(d|0)&&(c=(c+1|0)%6|0)),(x|0)==3&(l|0)==(d|0)?(x=(c+5|0)%6|0,k=M,x|0):(x|0)==5&(l|0)==(E|0)?(x=(c+1|0)%6|0,k=M,x|0):(x=c,k=M,x|0)}function LI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;return d=Xt(l,c)|0,(f+-1|0)>>>0>5||(g=(d|0)!=0,(f|0)==1&g)?(f=-1,f|0):(d=BI(l,c)|0,g?(f=(5-d+(u[22384+(f<<2)>>2]|0)|0)%5|0,f|0):(f=(6-d+(u[22416+(f<<2)>>2]|0)|0)%6|0,f|0))}function O1(l,c,f){l=l|0,c=c|0,f=f|0;var d=0;(c|0)>0?(d=Si(c,4)|0,u[l>>2]=d,d||tt(23230,23253,40,23267)):u[l>>2]=0,u[l+4>>2]=c,u[l+8>>2]=0,u[l+12>>2]=f}function F1(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0;g=l+4|0,v=l+12|0,_=l+8|0;e:for(;;){for(f=u[g>>2]|0,c=0;;){if((c|0)>=(f|0))break e;if(d=u[l>>2]|0,E=u[d+(c<<2)>>2]|0,!E)c=c+1|0;else break}c=d+(~~(+Ve(+(+_t(10,+ +(15-(u[v>>2]|0)|0))*(+N[E>>3]+ +N[E+8>>3])))%+(f|0))>>>0<<2)|0,f=u[c>>2]|0;t:do if(f|0){if(d=E+32|0,(f|0)==(E|0))u[c>>2]=u[d>>2];else{if(f=f+32|0,c=u[f>>2]|0,!c)break;for(;(c|0)!=(E|0);)if(f=c+32|0,c=u[f>>2]|0,!c)break t;u[f>>2]=u[d>>2]}ze(E),u[_>>2]=(u[_>>2]|0)+-1}while(0)}ze(u[l>>2]|0)}function D1(l){l=l|0;var c=0,f=0,d=0;for(d=u[l+4>>2]|0,f=0;;){if((f|0)>=(d|0)){c=0,f=4;break}if(c=u[(u[l>>2]|0)+(f<<2)>>2]|0,!c)f=f+1|0;else{f=4;break}}return(f|0)==4?c|0:0}function k1(l,c){l=l|0,c=c|0;var f=0,d=0,g=0,v=0;if(f=~~(+Ve(+(+_t(10,+ +(15-(u[l+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[l+4>>2]|0))>>>0,f=(u[l>>2]|0)+(f<<2)|0,d=u[f>>2]|0,!d)return v=1,v|0;v=c+32|0;do if((d|0)!=(c|0)){if(f=u[d+32>>2]|0,!f)return v=1,v|0;for(g=f;;){if((g|0)==(c|0)){g=8;break}if(f=u[g+32>>2]|0,f)d=g,g=f;else{f=1,g=10;break}}if((g|0)==8){u[d+32>>2]=u[v>>2];break}else if((g|0)==10)return f|0}else u[f>>2]=u[v>>2];while(0);return ze(c),v=l+8|0,u[v>>2]=(u[v>>2]|0)+-1,v=0,v|0}function RI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0;v=Ji(40)|0,v||tt(23283,23253,98,23296),u[v>>2]=u[c>>2],u[v+4>>2]=u[c+4>>2],u[v+8>>2]=u[c+8>>2],u[v+12>>2]=u[c+12>>2],g=v+16|0,u[g>>2]=u[f>>2],u[g+4>>2]=u[f+4>>2],u[g+8>>2]=u[f+8>>2],u[g+12>>2]=u[f+12>>2],u[v+32>>2]=0,g=~~(+Ve(+(+_t(10,+ +(15-(u[l+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[l+4>>2]|0))>>>0,g=(u[l>>2]|0)+(g<<2)|0,d=u[g>>2]|0;do if(!d)u[g>>2]=v;else{for(;!(Lo(d,c)|0&&Lo(d+16|0,f)|0);)if(g=u[d+32>>2]|0,d=g|0?g:d,!(u[d+32>>2]|0)){_=10;break}if((_|0)==10){u[d+32>>2]=v;break}return ze(v),_=d,_|0}while(0);return _=l+8|0,u[_>>2]=(u[_>>2]|0)+1,_=v,_|0}function OI(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0;if(g=~~(+Ve(+(+_t(10,+ +(15-(u[l+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[l+4>>2]|0))>>>0,g=u[(u[l>>2]|0)+(g<<2)>>2]|0,!g)return f=0,f|0;if(!f){for(l=g;;){if(Lo(l,c)|0){d=10;break}if(l=u[l+32>>2]|0,!l){l=0,d=10;break}}if((d|0)==10)return l|0}for(l=g;;){if(Lo(l,c)|0&&Lo(l+16|0,f)|0){d=10;break}if(l=u[l+32>>2]|0,!l){l=0,d=10;break}}return(d|0)==10?l|0:0}function FI(l,c){l=l|0,c=c|0;var f=0;if(f=~~(+Ve(+(+_t(10,+ +(15-(u[l+12>>2]|0)|0))*(+N[c>>3]+ +N[c+8>>3])))%+(u[l+4>>2]|0))>>>0,l=u[(u[l>>2]|0)+(f<<2)>>2]|0,!l)return f=0,f|0;for(;;){if(Lo(l,c)|0){c=5;break}if(l=u[l+32>>2]|0,!l){l=0,c=5;break}}return(c|0)==5?l|0:0}function DI(){return 23312}function kI(l){return l=+l,+ +G1(+l)}function Nc(l){return l=+l,~~+kI(l)|0}function Ji(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0,ne=0,ue=0,ve=0,$=0,ae=0,W=0,Ee=0;Ee=k,k=k+16|0,H=Ee;do if(l>>>0<245){if(M=l>>>0<11?16:l+11&-8,l=M>>>3,U=u[5829]|0,f=U>>>l,f&3|0)return c=(f&1^1)+l|0,l=23356+(c<<1<<2)|0,f=l+8|0,d=u[f>>2]|0,g=d+8|0,v=u[g>>2]|0,(v|0)==(l|0)?u[5829]=U&~(1<<c):(u[v+12>>2]=l,u[f>>2]=v),W=c<<3,u[d+4>>2]=W|3,W=d+W+4|0,u[W>>2]=u[W>>2]|1,W=g,k=Ee,W|0;if(B=u[5831]|0,M>>>0>B>>>0){if(f|0)return c=2<<l,c=f<<l&(c|0-c),c=(c&0-c)+-1|0,E=c>>>12&16,c=c>>>E,f=c>>>5&8,c=c>>>f,v=c>>>2&4,c=c>>>v,l=c>>>1&2,c=c>>>l,d=c>>>1&1,d=(f|E|v|l|d)+(c>>>d)|0,c=23356+(d<<1<<2)|0,l=c+8|0,v=u[l>>2]|0,E=v+8|0,f=u[E>>2]|0,(f|0)==(c|0)?(l=U&~(1<<d),u[5829]=l):(u[f+12>>2]=c,u[l>>2]=f,l=U),W=d<<3,_=W-M|0,u[v+4>>2]=M|3,g=v+M|0,u[g+4>>2]=_|1,u[v+W>>2]=_,B|0&&(d=u[5834]|0,c=B>>>3,f=23356+(c<<1<<2)|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5829]=l|c,c=f,l=f+8|0),u[l>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=f),u[5831]=_,u[5834]=g,W=E,k=Ee,W|0;if(v=u[5830]|0,v){for(f=(v&0-v)+-1|0,g=f>>>12&16,f=f>>>g,d=f>>>5&8,f=f>>>d,_=f>>>2&4,f=f>>>_,E=f>>>1&2,f=f>>>E,x=f>>>1&1,x=u[23620+((d|g|_|E|x)+(f>>>x)<<2)>>2]|0,f=x,E=x,x=(u[x+4>>2]&-8)-M|0;l=u[f+16>>2]|0,!(!l&&(l=u[f+20>>2]|0,!l));)_=(u[l+4>>2]&-8)-M|0,g=_>>>0<x>>>0,f=l,E=g?l:E,x=g?_:x;if(_=E+M|0,_>>>0>E>>>0){g=u[E+24>>2]|0,c=u[E+12>>2]|0;do if((c|0)==(E|0)){if(l=E+20|0,c=u[l>>2]|0,!c&&(l=E+16|0,c=u[l>>2]|0,!c)){f=0;break}for(;;)if(d=c+20|0,f=u[d>>2]|0,f)c=f,l=d;else if(d=c+16|0,f=u[d>>2]|0,f)c=f,l=d;else break;u[l>>2]=0,f=c}else f=u[E+8>>2]|0,u[f+12>>2]=c,u[c+8>>2]=f,f=c;while(0);do if(g|0){if(c=u[E+28>>2]|0,l=23620+(c<<2)|0,(E|0)==(u[l>>2]|0)){if(u[l>>2]=f,!f){u[5830]=v&~(1<<c);break}}else if(W=g+16|0,u[((u[W>>2]|0)==(E|0)?W:g+20|0)>>2]=f,!f)break;u[f+24>>2]=g,c=u[E+16>>2]|0,c|0&&(u[f+16>>2]=c,u[c+24>>2]=f),c=u[E+20>>2]|0,c|0&&(u[f+20>>2]=c,u[c+24>>2]=f)}while(0);return x>>>0<16?(W=x+M|0,u[E+4>>2]=W|3,W=E+W+4|0,u[W>>2]=u[W>>2]|1):(u[E+4>>2]=M|3,u[_+4>>2]=x|1,u[_+x>>2]=x,B|0&&(d=u[5834]|0,c=B>>>3,f=23356+(c<<1<<2)|0,c=1<<c,c&U?(l=f+8|0,c=u[l>>2]|0):(u[5829]=c|U,c=f,l=f+8|0),u[l>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=f),u[5831]=x,u[5834]=_),W=E+8|0,k=Ee,W|0}else U=M}else U=M}else U=M}else if(l>>>0<=4294967231)if(l=l+11|0,M=l&-8,d=u[5830]|0,d){g=0-M|0,l=l>>>8,l?M>>>0>16777215?x=31:(U=(l+1048320|0)>>>16&8,ne=l<<U,E=(ne+520192|0)>>>16&4,ne=ne<<E,x=(ne+245760|0)>>>16&2,x=14-(E|U|x)+(ne<<x>>>15)|0,x=M>>>(x+7|0)&1|x<<1):x=0,f=u[23620+(x<<2)>>2]|0;e:do if(!f)f=0,l=0,ne=61;else for(l=0,E=M<<((x|0)==31?0:25-(x>>>1)|0),v=0;;){if(_=(u[f+4>>2]&-8)-M|0,_>>>0<g>>>0)if(_)l=f,g=_;else{l=f,g=0,ne=65;break e}if(ne=u[f+20>>2]|0,f=u[f+16+(E>>>31<<2)>>2]|0,v=(ne|0)==0|(ne|0)==(f|0)?v:ne,f)E=E<<1;else{f=v,ne=61;break}}while(0);if((ne|0)==61){if((f|0)==0&(l|0)==0){if(l=2<<x,l=(l|0-l)&d,!l){U=M;break}U=(l&0-l)+-1|0,_=U>>>12&16,U=U>>>_,v=U>>>5&8,U=U>>>v,E=U>>>2&4,U=U>>>E,x=U>>>1&2,U=U>>>x,f=U>>>1&1,l=0,f=u[23620+((v|_|E|x|f)+(U>>>f)<<2)>>2]|0}f?ne=65:(E=l,_=g)}if((ne|0)==65)for(v=f;;)if(U=(u[v+4>>2]&-8)-M|0,f=U>>>0<g>>>0,g=f?U:g,l=f?v:l,f=u[v+16>>2]|0,f||(f=u[v+20>>2]|0),f)v=f;else{E=l,_=g;break}if(E|0&&_>>>0<((u[5831]|0)-M|0)>>>0&&(B=E+M|0,B>>>0>E>>>0)){v=u[E+24>>2]|0,c=u[E+12>>2]|0;do if((c|0)==(E|0)){if(l=E+20|0,c=u[l>>2]|0,!c&&(l=E+16|0,c=u[l>>2]|0,!c)){c=0;break}for(;;)if(g=c+20|0,f=u[g>>2]|0,f)c=f,l=g;else if(g=c+16|0,f=u[g>>2]|0,f)c=f,l=g;else break;u[l>>2]=0}else W=u[E+8>>2]|0,u[W+12>>2]=c,u[c+8>>2]=W;while(0);do if(v){if(l=u[E+28>>2]|0,f=23620+(l<<2)|0,(E|0)==(u[f>>2]|0)){if(u[f>>2]=c,!c){d=d&~(1<<l),u[5830]=d;break}}else if(W=v+16|0,u[((u[W>>2]|0)==(E|0)?W:v+20|0)>>2]=c,!c)break;u[c+24>>2]=v,l=u[E+16>>2]|0,l|0&&(u[c+16>>2]=l,u[l+24>>2]=c),l=u[E+20>>2]|0,l&&(u[c+20>>2]=l,u[l+24>>2]=c)}while(0);e:do if(_>>>0<16)W=_+M|0,u[E+4>>2]=W|3,W=E+W+4|0,u[W>>2]=u[W>>2]|1;else{if(u[E+4>>2]=M|3,u[B+4>>2]=_|1,u[B+_>>2]=_,c=_>>>3,_>>>0<256){f=23356+(c<<1<<2)|0,l=u[5829]|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5829]=l|c,c=f,l=f+8|0),u[l>>2]=B,u[c+12>>2]=B,u[B+8>>2]=c,u[B+12>>2]=f;break}if(c=_>>>8,c?_>>>0>16777215?f=31:(ae=(c+1048320|0)>>>16&8,W=c<<ae,$=(W+520192|0)>>>16&4,W=W<<$,f=(W+245760|0)>>>16&2,f=14-($|ae|f)+(W<<f>>>15)|0,f=_>>>(f+7|0)&1|f<<1):f=0,c=23620+(f<<2)|0,u[B+28>>2]=f,l=B+16|0,u[l+4>>2]=0,u[l>>2]=0,l=1<<f,!(d&l)){u[5830]=d|l,u[c>>2]=B,u[B+24>>2]=c,u[B+12>>2]=B,u[B+8>>2]=B;break}c=u[c>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(_|0)){for(d=_<<((f|0)==31?0:25-(f>>>1)|0);f=c+16+(d>>>31<<2)|0,l=u[f>>2]|0,!!l;)if((u[l+4>>2]&-8|0)==(_|0)){c=l;break t}else d=d<<1,c=l;u[f>>2]=B,u[B+24>>2]=c,u[B+12>>2]=B,u[B+8>>2]=B;break e}while(0);ae=c+8|0,W=u[ae>>2]|0,u[W+12>>2]=B,u[ae>>2]=B,u[B+8>>2]=W,u[B+12>>2]=c,u[B+24>>2]=0}while(0);return W=E+8|0,k=Ee,W|0}else U=M}else U=M;else U=-1;while(0);if(f=u[5831]|0,f>>>0>=U>>>0)return c=f-U|0,l=u[5834]|0,c>>>0>15?(W=l+U|0,u[5834]=W,u[5831]=c,u[W+4>>2]=c|1,u[l+f>>2]=c,u[l+4>>2]=U|3):(u[5831]=0,u[5834]=0,u[l+4>>2]=f|3,W=l+f+4|0,u[W>>2]=u[W>>2]|1),W=l+8|0,k=Ee,W|0;if(_=u[5832]|0,_>>>0>U>>>0)return $=_-U|0,u[5832]=$,W=u[5835]|0,ae=W+U|0,u[5835]=ae,u[ae+4>>2]=$|1,u[W+4>>2]=U|3,W=W+8|0,k=Ee,W|0;if(u[5947]|0?l=u[5949]|0:(u[5949]=4096,u[5948]=4096,u[5950]=-1,u[5951]=-1,u[5952]=0,u[5940]=0,u[5947]=H&-16^1431655768,l=4096),E=U+48|0,x=U+47|0,v=l+x|0,g=0-l|0,M=v&g,M>>>0<=U>>>0||(l=u[5939]|0,l|0&&(B=u[5937]|0,H=B+M|0,H>>>0<=B>>>0|H>>>0>l>>>0)))return W=0,k=Ee,W|0;e:do if(u[5940]&4)c=0,ne=143;else{f=u[5835]|0;t:do if(f){for(d=23764;H=u[d>>2]|0,!(H>>>0<=f>>>0&&(H+(u[d+4>>2]|0)|0)>>>0>f>>>0);)if(l=u[d+8>>2]|0,l)d=l;else{ne=128;break t}if(c=v-_&g,c>>>0<2147483647)if(l=Ur(c|0)|0,(l|0)==((u[d>>2]|0)+(u[d+4>>2]|0)|0)){if((l|0)!=-1){_=c,v=l,ne=145;break e}}else d=l,ne=136;else c=0}else ne=128;while(0);do if((ne|0)==128)if(f=Ur(0)|0,(f|0)!=-1&&(c=f,J=u[5948]|0,te=J+-1|0,c=(te&c|0?(te+c&0-J)-c|0:0)+M|0,J=u[5937]|0,te=c+J|0,c>>>0>U>>>0&c>>>0<2147483647)){if(H=u[5939]|0,H|0&&te>>>0<=J>>>0|te>>>0>H>>>0){c=0;break}if(l=Ur(c|0)|0,(l|0)==(f|0)){_=c,v=f,ne=145;break e}else d=l,ne=136}else c=0;while(0);do if((ne|0)==136){if(f=0-c|0,!(E>>>0>c>>>0&(c>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){c=0;break}else{_=c,v=d,ne=145;break e}if(l=u[5949]|0,l=x-c+l&0-l,l>>>0>=2147483647){_=c,v=d,ne=145;break e}if((Ur(l|0)|0)==-1){Ur(f|0)|0,c=0;break}else{_=l+c|0,v=d,ne=145;break e}}while(0);u[5940]=u[5940]|4,ne=143}while(0);if((ne|0)==143&&M>>>0<2147483647&&($=Ur(M|0)|0,te=Ur(0)|0,ue=te-$|0,ve=ue>>>0>(U+40|0)>>>0,!(($|0)==-1|ve^1|$>>>0<te>>>0&(($|0)!=-1&(te|0)!=-1)^1))&&(_=ve?ue:c,v=$,ne=145),(ne|0)==145){c=(u[5937]|0)+_|0,u[5937]=c,c>>>0>(u[5938]|0)>>>0&&(u[5938]=c),x=u[5835]|0;e:do if(x){for(c=23764;;){if(l=u[c>>2]|0,f=u[c+4>>2]|0,(v|0)==(l+f|0)){ne=154;break}if(d=u[c+8>>2]|0,d)c=d;else break}if((ne|0)==154&&(ae=c+4|0,(u[c+12>>2]&8|0)==0)&&v>>>0>x>>>0&l>>>0<=x>>>0){u[ae>>2]=f+_,W=(u[5832]|0)+_|0,$=x+8|0,$=$&7|0?0-$&7:0,ae=x+$|0,$=W-$|0,u[5835]=ae,u[5832]=$,u[ae+4>>2]=$|1,u[x+W+4>>2]=40,u[5836]=u[5951];break}for(v>>>0<(u[5833]|0)>>>0&&(u[5833]=v),f=v+_|0,c=23764;;){if((u[c>>2]|0)==(f|0)){ne=162;break}if(l=u[c+8>>2]|0,l)c=l;else break}if((ne|0)==162&&!(u[c+12>>2]&8|0)){u[c>>2]=v,B=c+4|0,u[B>>2]=(u[B>>2]|0)+_,B=v+8|0,B=v+(B&7|0?0-B&7:0)|0,c=f+8|0,c=f+(c&7|0?0-c&7:0)|0,M=B+U|0,E=c-B-U|0,u[B+4>>2]=U|3;t:do if((x|0)==(c|0))W=(u[5832]|0)+E|0,u[5832]=W,u[5835]=M,u[M+4>>2]=W|1;else{if((u[5834]|0)==(c|0)){W=(u[5831]|0)+E|0,u[5831]=W,u[5834]=M,u[M+4>>2]=W|1,u[M+W>>2]=W;break}if(l=u[c+4>>2]|0,(l&3|0)==1){_=l&-8,d=l>>>3;n:do if(l>>>0<256)if(l=u[c+8>>2]|0,f=u[c+12>>2]|0,(f|0)==(l|0)){u[5829]=u[5829]&~(1<<d);break}else{u[l+12>>2]=f,u[f+8>>2]=l;break}else{v=u[c+24>>2]|0,l=u[c+12>>2]|0;do if((l|0)==(c|0)){if(f=c+16|0,d=f+4|0,l=u[d>>2]|0,l)f=d;else if(l=u[f>>2]|0,!l){l=0;break}for(;;)if(g=l+20|0,d=u[g>>2]|0,d)l=d,f=g;else if(g=l+16|0,d=u[g>>2]|0,d)l=d,f=g;else break;u[f>>2]=0}else W=u[c+8>>2]|0,u[W+12>>2]=l,u[l+8>>2]=W;while(0);if(!v)break;f=u[c+28>>2]|0,d=23620+(f<<2)|0;do if((u[d>>2]|0)!=(c|0)){if(W=v+16|0,u[((u[W>>2]|0)==(c|0)?W:v+20|0)>>2]=l,!l)break n}else{if(u[d>>2]=l,l|0)break;u[5830]=u[5830]&~(1<<f);break n}while(0);if(u[l+24>>2]=v,f=c+16|0,d=u[f>>2]|0,d|0&&(u[l+16>>2]=d,u[d+24>>2]=l),f=u[f+4>>2]|0,!f)break;u[l+20>>2]=f,u[f+24>>2]=l}while(0);c=c+_|0,g=_+E|0}else g=E;if(c=c+4|0,u[c>>2]=u[c>>2]&-2,u[M+4>>2]=g|1,u[M+g>>2]=g,c=g>>>3,g>>>0<256){f=23356+(c<<1<<2)|0,l=u[5829]|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5829]=l|c,c=f,l=f+8|0),u[l>>2]=M,u[c+12>>2]=M,u[M+8>>2]=c,u[M+12>>2]=f;break}c=g>>>8;do if(!c)d=0;else{if(g>>>0>16777215){d=31;break}ae=(c+1048320|0)>>>16&8,W=c<<ae,$=(W+520192|0)>>>16&4,W=W<<$,d=(W+245760|0)>>>16&2,d=14-($|ae|d)+(W<<d>>>15)|0,d=g>>>(d+7|0)&1|d<<1}while(0);if(c=23620+(d<<2)|0,u[M+28>>2]=d,l=M+16|0,u[l+4>>2]=0,u[l>>2]=0,l=u[5830]|0,f=1<<d,!(l&f)){u[5830]=l|f,u[c>>2]=M,u[M+24>>2]=c,u[M+12>>2]=M,u[M+8>>2]=M;break}c=u[c>>2]|0;n:do if((u[c+4>>2]&-8|0)!=(g|0)){for(d=g<<((d|0)==31?0:25-(d>>>1)|0);f=c+16+(d>>>31<<2)|0,l=u[f>>2]|0,!!l;)if((u[l+4>>2]&-8|0)==(g|0)){c=l;break n}else d=d<<1,c=l;u[f>>2]=M,u[M+24>>2]=c,u[M+12>>2]=M,u[M+8>>2]=M;break t}while(0);ae=c+8|0,W=u[ae>>2]|0,u[W+12>>2]=M,u[ae>>2]=M,u[M+8>>2]=W,u[M+12>>2]=c,u[M+24>>2]=0}while(0);return W=B+8|0,k=Ee,W|0}for(c=23764;l=u[c>>2]|0,!(l>>>0<=x>>>0&&(W=l+(u[c+4>>2]|0)|0,W>>>0>x>>>0));)c=u[c+8>>2]|0;g=W+-47|0,l=g+8|0,l=g+(l&7|0?0-l&7:0)|0,g=x+16|0,l=l>>>0<g>>>0?x:l,c=l+8|0,f=_+-40|0,$=v+8|0,$=$&7|0?0-$&7:0,ae=v+$|0,$=f-$|0,u[5835]=ae,u[5832]=$,u[ae+4>>2]=$|1,u[v+f+4>>2]=40,u[5836]=u[5951],f=l+4|0,u[f>>2]=27,u[c>>2]=u[5941],u[c+4>>2]=u[5942],u[c+8>>2]=u[5943],u[c+12>>2]=u[5944],u[5941]=v,u[5942]=_,u[5944]=0,u[5943]=c,c=l+24|0;do ae=c,c=c+4|0,u[c>>2]=7;while((ae+8|0)>>>0<W>>>0);if((l|0)!=(x|0)){if(v=l-x|0,u[f>>2]=u[f>>2]&-2,u[x+4>>2]=v|1,u[l>>2]=v,c=v>>>3,v>>>0<256){f=23356+(c<<1<<2)|0,l=u[5829]|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5829]=l|c,c=f,l=f+8|0),u[l>>2]=x,u[c+12>>2]=x,u[x+8>>2]=c,u[x+12>>2]=f;break}if(c=v>>>8,c?v>>>0>16777215?d=31:(ae=(c+1048320|0)>>>16&8,W=c<<ae,$=(W+520192|0)>>>16&4,W=W<<$,d=(W+245760|0)>>>16&2,d=14-($|ae|d)+(W<<d>>>15)|0,d=v>>>(d+7|0)&1|d<<1):d=0,f=23620+(d<<2)|0,u[x+28>>2]=d,u[x+20>>2]=0,u[g>>2]=0,c=u[5830]|0,l=1<<d,!(c&l)){u[5830]=c|l,u[f>>2]=x,u[x+24>>2]=f,u[x+12>>2]=x,u[x+8>>2]=x;break}c=u[f>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(v|0)){for(d=v<<((d|0)==31?0:25-(d>>>1)|0);f=c+16+(d>>>31<<2)|0,l=u[f>>2]|0,!!l;)if((u[l+4>>2]&-8|0)==(v|0)){c=l;break t}else d=d<<1,c=l;u[f>>2]=x,u[x+24>>2]=c,u[x+12>>2]=x,u[x+8>>2]=x;break e}while(0);ae=c+8|0,W=u[ae>>2]|0,u[W+12>>2]=x,u[ae>>2]=x,u[x+8>>2]=W,u[x+12>>2]=c,u[x+24>>2]=0}}else W=u[5833]|0,(W|0)==0|v>>>0<W>>>0&&(u[5833]=v),u[5941]=v,u[5942]=_,u[5944]=0,u[5838]=u[5947],u[5837]=-1,u[5842]=23356,u[5841]=23356,u[5844]=23364,u[5843]=23364,u[5846]=23372,u[5845]=23372,u[5848]=23380,u[5847]=23380,u[5850]=23388,u[5849]=23388,u[5852]=23396,u[5851]=23396,u[5854]=23404,u[5853]=23404,u[5856]=23412,u[5855]=23412,u[5858]=23420,u[5857]=23420,u[5860]=23428,u[5859]=23428,u[5862]=23436,u[5861]=23436,u[5864]=23444,u[5863]=23444,u[5866]=23452,u[5865]=23452,u[5868]=23460,u[5867]=23460,u[5870]=23468,u[5869]=23468,u[5872]=23476,u[5871]=23476,u[5874]=23484,u[5873]=23484,u[5876]=23492,u[5875]=23492,u[5878]=23500,u[5877]=23500,u[5880]=23508,u[5879]=23508,u[5882]=23516,u[5881]=23516,u[5884]=23524,u[5883]=23524,u[5886]=23532,u[5885]=23532,u[5888]=23540,u[5887]=23540,u[5890]=23548,u[5889]=23548,u[5892]=23556,u[5891]=23556,u[5894]=23564,u[5893]=23564,u[5896]=23572,u[5895]=23572,u[5898]=23580,u[5897]=23580,u[5900]=23588,u[5899]=23588,u[5902]=23596,u[5901]=23596,u[5904]=23604,u[5903]=23604,W=_+-40|0,$=v+8|0,$=$&7|0?0-$&7:0,ae=v+$|0,$=W-$|0,u[5835]=ae,u[5832]=$,u[ae+4>>2]=$|1,u[v+W+4>>2]=40,u[5836]=u[5951];while(0);if(c=u[5832]|0,c>>>0>U>>>0)return $=c-U|0,u[5832]=$,W=u[5835]|0,ae=W+U|0,u[5835]=ae,u[ae+4>>2]=$|1,u[W+4>>2]=U|3,W=W+8|0,k=Ee,W|0}return W=DI()|0,u[W>>2]=12,W=0,k=Ee,W|0}function ze(l){l=l|0;var c=0,f=0,d=0,g=0,v=0,_=0,E=0,x=0;if(!l)return;f=l+-8|0,g=u[5833]|0,l=u[l+-4>>2]|0,c=l&-8,x=f+c|0;do if(l&1)E=f,_=f;else{if(d=u[f>>2]|0,!(l&3)||(_=f+(0-d)|0,v=d+c|0,_>>>0<g>>>0))return;if((u[5834]|0)==(_|0)){if(l=x+4|0,c=u[l>>2]|0,(c&3|0)!=3){E=_,c=v;break}u[5831]=v,u[l>>2]=c&-2,u[_+4>>2]=v|1,u[_+v>>2]=v;return}if(f=d>>>3,d>>>0<256)if(l=u[_+8>>2]|0,c=u[_+12>>2]|0,(c|0)==(l|0)){u[5829]=u[5829]&~(1<<f),E=_,c=v;break}else{u[l+12>>2]=c,u[c+8>>2]=l,E=_,c=v;break}g=u[_+24>>2]|0,l=u[_+12>>2]|0;do if((l|0)==(_|0)){if(c=_+16|0,f=c+4|0,l=u[f>>2]|0,l)c=f;else if(l=u[c>>2]|0,!l){l=0;break}for(;;)if(d=l+20|0,f=u[d>>2]|0,f)l=f,c=d;else if(d=l+16|0,f=u[d>>2]|0,f)l=f,c=d;else break;u[c>>2]=0}else E=u[_+8>>2]|0,u[E+12>>2]=l,u[l+8>>2]=E;while(0);if(g){if(c=u[_+28>>2]|0,f=23620+(c<<2)|0,(u[f>>2]|0)==(_|0)){if(u[f>>2]=l,!l){u[5830]=u[5830]&~(1<<c),E=_,c=v;break}}else if(E=g+16|0,u[((u[E>>2]|0)==(_|0)?E:g+20|0)>>2]=l,!l){E=_,c=v;break}u[l+24>>2]=g,c=_+16|0,f=u[c>>2]|0,f|0&&(u[l+16>>2]=f,u[f+24>>2]=l),c=u[c+4>>2]|0,c?(u[l+20>>2]=c,u[c+24>>2]=l,E=_,c=v):(E=_,c=v)}else E=_,c=v}while(0);if(_>>>0>=x>>>0||(l=x+4|0,d=u[l>>2]|0,!(d&1)))return;if(d&2)u[l>>2]=d&-2,u[E+4>>2]=c|1,u[_+c>>2]=c,g=c;else{if((u[5835]|0)==(x|0)){if(x=(u[5832]|0)+c|0,u[5832]=x,u[5835]=E,u[E+4>>2]=x|1,(E|0)!=(u[5834]|0))return;u[5834]=0,u[5831]=0;return}if((u[5834]|0)==(x|0)){x=(u[5831]|0)+c|0,u[5831]=x,u[5834]=_,u[E+4>>2]=x|1,u[_+x>>2]=x;return}g=(d&-8)+c|0,f=d>>>3;do if(d>>>0<256)if(c=u[x+8>>2]|0,l=u[x+12>>2]|0,(l|0)==(c|0)){u[5829]=u[5829]&~(1<<f);break}else{u[c+12>>2]=l,u[l+8>>2]=c;break}else{v=u[x+24>>2]|0,l=u[x+12>>2]|0;do if((l|0)==(x|0)){if(c=x+16|0,f=c+4|0,l=u[f>>2]|0,l)c=f;else if(l=u[c>>2]|0,!l){f=0;break}for(;;)if(d=l+20|0,f=u[d>>2]|0,f)l=f,c=d;else if(d=l+16|0,f=u[d>>2]|0,f)l=f,c=d;else break;u[c>>2]=0,f=l}else f=u[x+8>>2]|0,u[f+12>>2]=l,u[l+8>>2]=f,f=l;while(0);if(v|0){if(l=u[x+28>>2]|0,c=23620+(l<<2)|0,(u[c>>2]|0)==(x|0)){if(u[c>>2]=f,!f){u[5830]=u[5830]&~(1<<l);break}}else if(d=v+16|0,u[((u[d>>2]|0)==(x|0)?d:v+20|0)>>2]=f,!f)break;u[f+24>>2]=v,l=x+16|0,c=u[l>>2]|0,c|0&&(u[f+16>>2]=c,u[c+24>>2]=f),l=u[l+4>>2]|0,l|0&&(u[f+20>>2]=l,u[l+24>>2]=f)}}while(0);if(u[E+4>>2]=g|1,u[_+g>>2]=g,(E|0)==(u[5834]|0)){u[5831]=g;return}}if(l=g>>>3,g>>>0<256){f=23356+(l<<1<<2)|0,c=u[5829]|0,l=1<<l,c&l?(c=f+8|0,l=u[c>>2]|0):(u[5829]=c|l,l=f,c=f+8|0),u[c>>2]=E,u[l+12>>2]=E,u[E+8>>2]=l,u[E+12>>2]=f;return}l=g>>>8,l?g>>>0>16777215?d=31:(_=(l+1048320|0)>>>16&8,x=l<<_,v=(x+520192|0)>>>16&4,x=x<<v,d=(x+245760|0)>>>16&2,d=14-(v|_|d)+(x<<d>>>15)|0,d=g>>>(d+7|0)&1|d<<1):d=0,l=23620+(d<<2)|0,u[E+28>>2]=d,u[E+20>>2]=0,u[E+16>>2]=0,c=u[5830]|0,f=1<<d;e:do if(!(c&f))u[5830]=c|f,u[l>>2]=E,u[E+24>>2]=l,u[E+12>>2]=E,u[E+8>>2]=E;else{l=u[l>>2]|0;t:do if((u[l+4>>2]&-8|0)!=(g|0)){for(d=g<<((d|0)==31?0:25-(d>>>1)|0);f=l+16+(d>>>31<<2)|0,c=u[f>>2]|0,!!c;)if((u[c+4>>2]&-8|0)==(g|0)){l=c;break t}else d=d<<1,l=c;u[f>>2]=E,u[E+24>>2]=l,u[E+12>>2]=E,u[E+8>>2]=E;break e}while(0);_=l+8|0,x=u[_>>2]|0,u[x+12>>2]=E,u[_>>2]=E,u[E+8>>2]=x,u[E+12>>2]=l,u[E+24>>2]=0}while(0);if(x=(u[5837]|0)+-1|0,u[5837]=x,!(x|0)){for(l=23772;l=u[l>>2]|0,l;)l=l+8|0;u[5837]=-1}}function Si(l,c){l=l|0,c=c|0;var f=0;return l?(f=tn(c,l)|0,(c|l)>>>0>65535&&(f=((f>>>0)/(l>>>0)|0|0)==(c|0)?f:-1)):f=0,l=Ji(f)|0,!l||!(u[l+-4>>2]&3)||Pi(l|0,0,f|0)|0,l|0}function NI(l,c,f,d){return l=l|0,c=c|0,f=f|0,d=d|0,f=l+f>>>0,Pe(c+d+(f>>>0<l>>>0|0)>>>0|0),f|0|0}function ml(l,c,f,d){return l=l|0,c=c|0,f=f|0,d=d|0,d=c-d-(f>>>0>l>>>0|0)>>>0,Pe(d|0),l-f>>>0|0|0}function N1(l){return l=l|0,(l?31-(Vn(l^l-1)|0)|0:32)|0}function UI(l,c,f,d,g){l=l|0,c=c|0,f=f|0,d=d|0,g=g|0;var v=0,_=0,E=0,x=0,M=0,B=0,U=0,H=0,J=0,te=0;if(B=l,x=c,M=x,_=f,H=d,E=H,!M)return v=(g|0)!=0,E?v?(u[g>>2]=l|0,u[g+4>>2]=c&0,H=0,g=0,Pe(H|0),g|0):(H=0,g=0,Pe(H|0),g|0):(v&&(u[g>>2]=(B>>>0)%(_>>>0),u[g+4>>2]=0),H=0,g=(B>>>0)/(_>>>0)>>>0,Pe(H|0),g|0);v=(E|0)==0;do if(_){if(!v){if(v=(Vn(E|0)|0)-(Vn(M|0)|0)|0,v>>>0<=31){U=v+1|0,E=31-v|0,c=v-31>>31,_=U,l=B>>>(U>>>0)&c|M<<E,c=M>>>(U>>>0)&c,v=0,E=B<<E;break}return g?(u[g>>2]=l|0,u[g+4>>2]=x|c&0,H=0,g=0,Pe(H|0),g|0):(H=0,g=0,Pe(H|0),g|0)}if(v=_-1|0,v&_|0){E=(Vn(_|0)|0)+33-(Vn(M|0)|0)|0,te=64-E|0,U=32-E|0,x=U>>31,J=E-32|0,c=J>>31,_=E,l=U-1>>31&M>>>(J>>>0)|(M<<U|B>>>(E>>>0))&c,c=c&M>>>(E>>>0),v=B<<te&x,E=(M<<te|B>>>(J>>>0))&x|B<<U&E-33>>31;break}return g|0&&(u[g>>2]=v&B,u[g+4>>2]=0),(_|0)==1?(J=x|c&0,te=l|0|0,Pe(J|0),te|0):(te=N1(_|0)|0,J=M>>>(te>>>0)|0,te=M<<32-te|B>>>(te>>>0)|0,Pe(J|0),te|0)}else{if(v)return g|0&&(u[g>>2]=(M>>>0)%(_>>>0),u[g+4>>2]=0),J=0,te=(M>>>0)/(_>>>0)>>>0,Pe(J|0),te|0;if(!B)return g|0&&(u[g>>2]=0,u[g+4>>2]=(M>>>0)%(E>>>0)),J=0,te=(M>>>0)/(E>>>0)>>>0,Pe(J|0),te|0;if(v=E-1|0,!(v&E))return g|0&&(u[g>>2]=l|0,u[g+4>>2]=v&M|c&0),J=0,te=M>>>((N1(E|0)|0)>>>0),Pe(J|0),te|0;if(v=(Vn(E|0)|0)-(Vn(M|0)|0)|0,v>>>0<=30){c=v+1|0,E=31-v|0,_=c,l=M<<E|B>>>(c>>>0),c=M>>>(c>>>0),v=0,E=B<<E;break}return g?(u[g>>2]=l|0,u[g+4>>2]=x|c&0,J=0,te=0,Pe(J|0),te|0):(J=0,te=0,Pe(J|0),te|0)}while(0);if(!_)M=E,x=0,E=0;else{U=f|0|0,B=H|d&0,M=NI(U|0,B|0,-1,-1)|0,f=z()|0,x=E,E=0;do d=x,x=v>>>31|x<<1,v=E|v<<1,d=l<<1|d>>>31|0,H=l>>>31|c<<1|0,ml(M|0,f|0,d|0,H|0)|0,te=z()|0,J=te>>31|((te|0)<0?-1:0)<<1,E=J&1,l=ml(d|0,H|0,J&U|0,(((te|0)<0?-1:0)>>31|((te|0)<0?-1:0)<<1)&B|0)|0,c=z()|0,_=_-1|0;while(_|0);M=x,x=0}return _=0,g|0&&(u[g>>2]=l,u[g+4>>2]=c),J=(v|0)>>>31|(M|_)<<1|(_<<1|v>>>31)&0|x,te=(v<<1|0>>>31)&-2|E,Pe(J|0),te|0}function Nr(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var g=0,v=0;return v=k,k=k+16|0,g=v|0,UI(l,c,f,d,g)|0,k=v,Pe(u[g+4>>2]|0),u[g>>2]|0|0}function ce(l,c,f){return l=l|0,c=c|0,f=f|0,(f|0)<32?(Pe(c>>>f|0),l>>>f|(c&(1<<f)-1)<<32-f):(Pe(0),c>>>f-32|0)}function _e(l,c,f){return l=l|0,c=c|0,f=f|0,(f|0)<32?(Pe(c<<f|(l&(1<<f)-1<<32-f)>>>32-f|0),l<<f):(Pe(l<<f-32|0),0)}function U1(l,c){return l=+l,c=+c,l!=l?+c:c!=c?+l:+xi(+l,+c)}function Uc(l){return l=+l,l>=0?+et(l+.5):+bi(l-.5)}function Gc(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0;if((f|0)>=8192)return jn(l|0,c|0,f|0)|0,l|0;if(v=l|0,g=l+f|0,(l&3)==(c&3)){for(;l&3;){if(!f)return v|0;Me[l>>0]=Me[c>>0]|0,l=l+1|0,c=c+1|0,f=f-1|0}for(f=g&-4|0,d=f-64|0;(l|0)<=(d|0);)u[l>>2]=u[c>>2],u[l+4>>2]=u[c+4>>2],u[l+8>>2]=u[c+8>>2],u[l+12>>2]=u[c+12>>2],u[l+16>>2]=u[c+16>>2],u[l+20>>2]=u[c+20>>2],u[l+24>>2]=u[c+24>>2],u[l+28>>2]=u[c+28>>2],u[l+32>>2]=u[c+32>>2],u[l+36>>2]=u[c+36>>2],u[l+40>>2]=u[c+40>>2],u[l+44>>2]=u[c+44>>2],u[l+48>>2]=u[c+48>>2],u[l+52>>2]=u[c+52>>2],u[l+56>>2]=u[c+56>>2],u[l+60>>2]=u[c+60>>2],l=l+64|0,c=c+64|0;for(;(l|0)<(f|0);)u[l>>2]=u[c>>2],l=l+4|0,c=c+4|0}else for(f=g-4|0;(l|0)<(f|0);)Me[l>>0]=Me[c>>0]|0,Me[l+1>>0]=Me[c+1>>0]|0,Me[l+2>>0]=Me[c+2>>0]|0,Me[l+3>>0]=Me[c+3>>0]|0,l=l+4|0,c=c+4|0;for(;(l|0)<(g|0);)Me[l>>0]=Me[c>>0]|0,l=l+1|0,c=c+1|0;return v|0}function Pi(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,g=0,v=0,_=0;if(v=l+f|0,c=c&255,(f|0)>=67){for(;l&3;)Me[l>>0]=c,l=l+1|0;for(d=v&-4|0,_=c|c<<8|c<<16|c<<24,g=d-64|0;(l|0)<=(g|0);)u[l>>2]=_,u[l+4>>2]=_,u[l+8>>2]=_,u[l+12>>2]=_,u[l+16>>2]=_,u[l+20>>2]=_,u[l+24>>2]=_,u[l+28>>2]=_,u[l+32>>2]=_,u[l+36>>2]=_,u[l+40>>2]=_,u[l+44>>2]=_,u[l+48>>2]=_,u[l+52>>2]=_,u[l+56>>2]=_,u[l+60>>2]=_,l=l+64|0;for(;(l|0)<(d|0);)u[l>>2]=_,l=l+4|0}for(;(l|0)<(v|0);)Me[l>>0]=c,l=l+1|0;return v-f|0}function G1(l){return l=+l,l>=0?+et(l+.5):+bi(l-.5)}function Ur(l){l=l|0;var c=0,f=0,d=0;return d=So()|0,f=u[Ze>>2]|0,c=f+l|0,(l|0)>0&(c|0)<(f|0)|(c|0)<0?(Al(c|0)|0,ll(12),-1):(c|0)>(d|0)&&!(Po(c|0)|0)?(ll(12),-1):(u[Ze>>2]=c,f|0)}return{___uremdi3:Nr,_bitshift64Lshr:ce,_bitshift64Shl:_e,_calloc:Si,_cellAreaKm2:H3,_cellAreaM2:W3,_cellAreaRads2:j3,_compact:q3,_destroyLinkedPolygon:dI,_edgeLengthKm:G3,_edgeLengthM:z3,_emscripten_replace_memory:cl,_exactEdgeLengthKm:X3,_exactEdgeLengthM:J3,_exactEdgeLengthRads:Q3,_experimentalH3ToLocalIj:pI,_experimentalLocalIjToH3:gI,_free:ze,_geoToH3:x1,_getDestinationH3IndexFromUnidirectionalEdge:lI,_getH3IndexesFromUnidirectionalEdge:cI,_getH3UnidirectionalEdge:oI,_getH3UnidirectionalEdgeBoundary:Dc,_getH3UnidirectionalEdgesFromHexagon:uI,_getOriginH3IndexFromUnidirectionalEdge:aI,_getPentagonIndexes:hd,_getRes0Indexes:w3,_h3Distance:mI,_h3GetBaseCell:w1,_h3GetFaces:C1,_h3GetResolution:Y3,_h3IndexesAreNeighbors:S1,_h3IsPentagon:Xt,_h3IsResClassIII:tI,_h3IsValid:b1,_h3Line:vI,_h3LineSize:_I,_h3SetToLinkedGeo:zt,_h3ToCenterChild:Z3,_h3ToChildren:Bn,_h3ToGeo:Rs,_h3ToGeoBoundary:Os,_h3ToParent:Ad,_h3UnidirectionalEdgeIsValid:AI,_hexAreaKm2:N3,_hexAreaM2:U3,_hexRing:O,_i64Subtract:ml,_kRing:Mo,_kRingDistances:Lc,_llvm_minnum_f64:U1,_llvm_round_f64:Uc,_malloc:Ji,_maxFaceCount:rI,_maxH3ToChildrenSize:K3,_maxKringSize:Bc,_maxPolyfillSize:G,_maxUncompactSize:eI,_memcpy:Gc,_memset:Pi,_numHexagons:V3,_pentagonIndexCount:sI,_pointDistKm:pl,_pointDistM:F3,_pointDistRads:O3,_polyfill:K,_res0IndexCount:T3,_round:G1,_sbrk:Ur,_sizeOfCoordIJ:PI,_sizeOfGeoBoundary:bI,_sizeOfGeoCoord:wI,_sizeOfGeoPolygon:CI,_sizeOfGeofence:xI,_sizeOfH3Index:TI,_sizeOfLinkedGeoPolygon:SI,_uncompact:$3,establishStackSpace:nd,stackAlloc:ul,stackRestore:Ci,stackSave:Io}}(xc,Cc,D);e.___uremdi3=fe.___uremdi3,e._bitshift64Lshr=fe._bitshift64Lshr,e._bitshift64Shl=fe._bitshift64Shl,e._calloc=fe._calloc,e._cellAreaKm2=fe._cellAreaKm2,e._cellAreaM2=fe._cellAreaM2,e._cellAreaRads2=fe._cellAreaRads2,e._compact=fe._compact,e._destroyLinkedPolygon=fe._destroyLinkedPolygon,e._edgeLengthKm=fe._edgeLengthKm,e._edgeLengthM=fe._edgeLengthM;var ed=e._emscripten_replace_memory=fe._emscripten_replace_memory;e._exactEdgeLengthKm=fe._exactEdgeLengthKm,e._exactEdgeLengthM=fe._exactEdgeLengthM,e._exactEdgeLengthRads=fe._exactEdgeLengthRads,e._experimentalH3ToLocalIj=fe._experimentalH3ToLocalIj,e._experimentalLocalIjToH3=fe._experimentalLocalIjToH3,e._free=fe._free,e._geoToH3=fe._geoToH3,e._getDestinationH3IndexFromUnidirectionalEdge=fe._getDestinationH3IndexFromUnidirectionalEdge,e._getH3IndexesFromUnidirectionalEdge=fe._getH3IndexesFromUnidirectionalEdge,e._getH3UnidirectionalEdge=fe._getH3UnidirectionalEdge,e._getH3UnidirectionalEdgeBoundary=fe._getH3UnidirectionalEdgeBoundary,e._getH3UnidirectionalEdgesFromHexagon=fe._getH3UnidirectionalEdgesFromHexagon,e._getOriginH3IndexFromUnidirectionalEdge=fe._getOriginH3IndexFromUnidirectionalEdge,e._getPentagonIndexes=fe._getPentagonIndexes,e._getRes0Indexes=fe._getRes0Indexes,e._h3Distance=fe._h3Distance,e._h3GetBaseCell=fe._h3GetBaseCell,e._h3GetFaces=fe._h3GetFaces,e._h3GetResolution=fe._h3GetResolution,e._h3IndexesAreNeighbors=fe._h3IndexesAreNeighbors,e._h3IsPentagon=fe._h3IsPentagon,e._h3IsResClassIII=fe._h3IsResClassIII,e._h3IsValid=fe._h3IsValid,e._h3Line=fe._h3Line,e._h3LineSize=fe._h3LineSize,e._h3SetToLinkedGeo=fe._h3SetToLinkedGeo,e._h3ToCenterChild=fe._h3ToCenterChild,e._h3ToChildren=fe._h3ToChildren,e._h3ToGeo=fe._h3ToGeo,e._h3ToGeoBoundary=fe._h3ToGeoBoundary,e._h3ToParent=fe._h3ToParent,e._h3UnidirectionalEdgeIsValid=fe._h3UnidirectionalEdgeIsValid,e._hexAreaKm2=fe._hexAreaKm2,e._hexAreaM2=fe._hexAreaM2,e._hexRing=fe._hexRing,e._i64Subtract=fe._i64Subtract,e._kRing=fe._kRing,e._kRingDistances=fe._kRingDistances,e._llvm_minnum_f64=fe._llvm_minnum_f64,e._llvm_round_f64=fe._llvm_round_f64,e._malloc=fe._malloc,e._maxFaceCount=fe._maxFaceCount,e._maxH3ToChildrenSize=fe._maxH3ToChildrenSize,e._maxKringSize=fe._maxKringSize,e._maxPolyfillSize=fe._maxPolyfillSize,e._maxUncompactSize=fe._maxUncompactSize,e._memcpy=fe._memcpy,e._memset=fe._memset,e._numHexagons=fe._numHexagons,e._pentagonIndexCount=fe._pentagonIndexCount,e._pointDistKm=fe._pointDistKm,e._pointDistM=fe._pointDistM,e._pointDistRads=fe._pointDistRads,e._polyfill=fe._polyfill,e._res0IndexCount=fe._res0IndexCount,e._round=fe._round,e._sbrk=fe._sbrk,e._sizeOfCoordIJ=fe._sizeOfCoordIJ,e._sizeOfGeoBoundary=fe._sizeOfGeoBoundary,e._sizeOfGeoCoord=fe._sizeOfGeoCoord,e._sizeOfGeoPolygon=fe._sizeOfGeoPolygon,e._sizeOfGeofence=fe._sizeOfGeofence,e._sizeOfH3Index=fe._sizeOfH3Index,e._sizeOfLinkedGeoPolygon=fe._sizeOfLinkedGeoPolygon,e._uncompact=fe._uncompact,e.establishStackSpace=fe.establishStackSpace;var Sc=e.stackAlloc=fe.stackAlloc,td=e.stackRestore=fe.stackRestore,Pc=e.stackSave=fe.stackSave;if(e.asm=fe,e.cwrap=I,e.setValue=T,e.getValue=b,e.getTempRet0=m,Rt){Ec(Rt)||(Rt=s(Rt));{yc();var ol=function(Y){Y.byteLength&&(Y=new Uint8Array(Y)),le.set(Y,y),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Eo()},Ic=function(){o(Rt,ol,function(){throw"could not load memory initializer "+Rt})},Mc=sl(Rt);if(Mc)ol(Mc.buffer);else if(e.memoryInitializerRequest){var Is=function(){var Y=e.memoryInitializerRequest,ie=Y.response;if(Y.status!==200&&Y.status!==0){var he=sl(e.memoryInitializerRequestURL);if(he)ie=he.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Y.status+", retrying "+Rt),Ic();return}}ol(ie)};e.memoryInitializerRequest.response?setTimeout(Is,0):e.memoryInitializerRequest.addEventListener("load",Is)}else Ic()}}var xo;Rr=function Y(){xo||al(),xo||(Rr=Y)};function al(Y){if(Tn>0||(Bt(),Tn>0))return;function ie(){xo||(xo=!0,!C&&(Ar(),Lt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),un()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),ie()},1)):ie()}e.run=al;function Qi(Y){throw e.onAbort&&e.onAbort(Y),Y+="",a(Y),A(Y),C=!0,"abort("+Y+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Qi,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return al(),t}(typeof xt=="object"?xt:{}),Ie="number",Ol=Ie,Fe=Ie,je=Ie,Rn=Ie,$e=Ie,Ij=[["sizeOfH3Index",Ie],["sizeOfGeoCoord",Ie],["sizeOfGeoBoundary",Ie],["sizeOfGeoPolygon",Ie],["sizeOfGeofence",Ie],["sizeOfLinkedGeoPolygon",Ie],["sizeOfCoordIJ",Ie],["h3IsValid",Ol,[Fe,je]],["geoToH3",Fe,[Ie,Ie,Rn]],["h3ToGeo",null,[Fe,je,$e]],["h3ToGeoBoundary",null,[Fe,je,$e]],["maxKringSize",Ie,[Ie]],["kRing",null,[Fe,je,Ie,$e]],["kRingDistances",null,[Fe,je,Ie,$e,$e]],["hexRing",null,[Fe,je,Ie,$e]],["maxPolyfillSize",Ie,[$e,Rn]],["polyfill",null,[$e,Rn,$e]],["h3SetToLinkedGeo",null,[$e,Ie,$e]],["destroyLinkedPolygon",null,[$e]],["compact",Ie,[$e,$e,Ie]],["uncompact",Ie,[$e,Ie,$e,Ie,Rn]],["maxUncompactSize",Ie,[$e,Ie,Rn]],["h3IsPentagon",Ol,[Fe,je]],["h3IsResClassIII",Ol,[Fe,je]],["h3GetBaseCell",Ie,[Fe,je]],["h3GetResolution",Ie,[Fe,je]],["maxFaceCount",Ie,[Fe,je]],["h3GetFaces",null,[Fe,je,$e]],["h3ToParent",Fe,[Fe,je,Rn]],["h3ToChildren",null,[Fe,je,Rn,$e]],["h3ToCenterChild",Fe,[Fe,je,Rn]],["maxH3ToChildrenSize",Ie,[Fe,je,Rn]],["h3IndexesAreNeighbors",Ol,[Fe,je,Fe,je]],["getH3UnidirectionalEdge",Fe,[Fe,je,Fe,je]],["getOriginH3IndexFromUnidirectionalEdge",Fe,[Fe,je]],["getDestinationH3IndexFromUnidirectionalEdge",Fe,[Fe,je]],["h3UnidirectionalEdgeIsValid",Ol,[Fe,je]],["getH3IndexesFromUnidirectionalEdge",null,[Fe,je,$e]],["getH3UnidirectionalEdgesFromHexagon",null,[Fe,je,$e]],["getH3UnidirectionalEdgeBoundary",null,[Fe,je,$e]],["h3Distance",Ie,[Fe,je,Fe,je]],["h3Line",Ie,[Fe,je,Fe,je,$e]],["h3LineSize",Ie,[Fe,je,Fe,je]],["experimentalH3ToLocalIj",Ie,[Fe,je,Fe,je,$e]],["experimentalLocalIjToH3",Ie,[Fe,je,$e,$e]],["hexAreaM2",Ie,[Rn]],["hexAreaKm2",Ie,[Rn]],["edgeLengthM",Ie,[Rn]],["edgeLengthKm",Ie,[Rn]],["pointDistM",Ie,[$e,$e]],["pointDistKm",Ie,[$e,$e]],["pointDistRads",Ie,[$e,$e]],["cellAreaM2",Ie,[Fe,je]],["cellAreaKm2",Ie,[Fe,je]],["cellAreaRads2",Ie,[Fe,je]],["exactEdgeLengthM",Ie,[Fe,je]],["exactEdgeLengthKm",Ie,[Fe,je]],["exactEdgeLengthRads",Ie,[Fe,je]],["numHexagons",Ie,[Rn]],["getRes0Indexes",null,[$e]],["res0IndexCount",Ie],["getPentagonIndexes",null,[Ie,$e]],["pentagonIndexCount",Ie]],en={};Ij.forEach(function(e){en[e[0]]=xt.cwrap.apply(xt,e)});var ha=16,Mj=4,PE=4,Ga=8,Bj=en.sizeOfH3Index(),qS=en.sizeOfGeoCoord(),Lj=en.sizeOfGeoBoundary();en.sizeOfGeoPolygon();en.sizeOfGeofence();var Rj=en.sizeOfLinkedGeoPolygon();en.sizeOfCoordIJ();var IE={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function Oj(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw new Error("Invalid resolution: "+t)}var Fj=/[^0-9a-fA-F]/;function co(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||Fj.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),ha),n=parseInt(t.substring(t.length-8),ha);return[n,e]}function ME(t){if(t>=0)return t.toString(ha);t=t&2147483647;var e=$S(8,t.toString(ha)),n=(parseInt(e[0],ha)+8).toString(ha);return e=n+e.substring(1),e}function Dj(t,e){return ME(e)+$S(8,ME(t))}function $S(t,e){for(var n=t-e.length,i="",r=0;r<n;r++)i+="0";return i=i+e,i}function kj(t){var e=xt.getTempRet0();return[t,e]}function Nj(t){var e=kj(t),n=e[0],i=e[1];return i?Dj(n,i):null}function Uj(t,e,n){xt.HEAPU32.set(co(t),e/Mj+2*n)}function Gj(t,e){for(var n=e.length,i=0;i<n;i++)Uj(e[i],t,i)}function ah(t){return Zj(xt.getValue(t,"double"))}function V_(t){return[ah(t),ah(t+Ga)]}function eP(t){return[ah(t+Ga),ah(t)]}function zj(t,e,n){for(var i=xt.getValue(t,"i32"),r=t+Ga,s=[],o=e?eP:V_,a=0;a<i*2;a+=2)s.push(o(r+Ga*a));return n&&s.push(s[0]),s}function Vj(t,e){for(var n=[],i=e?eP:V_,r,s,o,a;t;){for(n.push(r=[]),s=xt.getValue(t,"i8*");s;){for(r.push(o=[]),a=xt.getValue(s,"i8*");a;)o.push(i(a)),a=xt.getValue(a+Ga*2,"i8*");e&&o.push(o[0]),s=xt.getValue(s+PE*2,"i8*")}t=xt.getValue(t+PE*2,"i8*")}return n}function jj(t){var e=co(t),n=e[0],i=e[1];return Boolean(en.h3IsPentagon(n,i))}function Hj(t){var e=co(t),n=e[0],i=e[1];return en.h3IsValid(n,i)?en.h3GetResolution(n,i):-1}function Wj(t,e,n){var i=xt._malloc(qS);xt.HEAPF64.set([t,e].map(Kj),i/Ga);var r=Nj(en.geoToH3(i,n));return xt._free(i),r}function j_(t){var e=xt._malloc(qS),n=co(t),i=n[0],r=n[1];en.h3ToGeo(i,r,e);var s=V_(e);return xt._free(e),s}function Qj(t,e){var n=xt._malloc(Lj),i=co(t),r=i[0],s=i[1];en.h3ToGeoBoundary(r,s,n);var o=zj(n,e,e);return xt._free(n),o}function Xj(t,e){if(!t||!t.length)return[];var n=t.length,i=xt._calloc(n,Bj);Gj(i,t);var r=xt._calloc(Rj),s=r;en.h3SetToLinkedGeo(i,n,r);var o=Vj(r,e);return en.destroyLinkedPolygon(s),xt._free(s),xt._free(i),o}function Jj(t,e){var n=co(t),i=n[0],r=n[1],s=co(e),o=s[0],a=s[1];return en.h3Distance(i,r,o,a)}function Yj(t,e){switch(Oj(t),e){case IE.m:return en.edgeLengthM(t);case IE.km:return en.edgeLengthKm(t);default:throw new Error("Unknown unit: "+e)}}function Kj(t){return t*Math.PI/180}function Zj(t){return t*180/Math.PI}const qj={getHexagons:{type:"accessor",value:t=>t.hexagons}};class tP extends qa{initializeState(){_o._checkH3Lib()}updateState({props:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagons){const{data:i,getHexagons:r}=e,s=[],{iterable:o,objectInfo:a}=Ts(i);for(const A of o){a.index++;const h=r(A,a),p=Xj(h,!0);for(const m of p)s.push(this.getSubLayerRow({polygon:m},A,a.index))}this.setState({polygons:s})}}indexToBounds(){return{data:this.state.polygons,getPolygon:e=>e.polygon}}}w(tP,"layerName","H3ClusterLayer");w(tP,"defaultProps",qj);const $j=10;function nP(t,e){e=e===void 0?t[0][0]:e;for(const n of t){const i=n[0]-e;i>180?n[0]-=360:i<-180&&(n[0]+=360)}}function eH(t,e,n){const[i,r]=j_(t),s=e.length;nP(e,r);const o=e[0]===e[s-1]?s-1:s;for(let a=0;a<o;a++)e[a][0]=Gi(r,e[a][0],n),e[a][1]=Gi(i,e[a][1],n)}function tH(t,e,n){const i=t(e,n),[r,s]=j_(i);return[s,r]}function BE(t,e=1){const n=Qj(t,!0);return e!==1?eH(t,n,e):nP(n),n}function nH(t){const e=new Float64Array(t.length*2);let n=0;for(const i of t)e[n++]=i[0],e[n++]=i[1];return e}function iH(t,e){let n;return t==null?n=e:typeof t=="object"?n={...t,coverage:e}:n={getHexagon:t,coverage:e},n}const rH={...Ka.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class _o extends Lr{constructor(...e){super(...e),w(this,"state",void 0)}initializeState(){_o._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:n}){if(e.highPrecision!==!0&&(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagon)){const i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,n=!1,i=!1;const{iterable:r,objectInfo:s}=Ts(this.props.data);for(const o of r){s.index++;const a=this.props.getHexagon(o,s),A=Hj(a);if(e<0){if(e=A,!this.props.highPrecision)break}else if(e!==A){i=!0;break}if(jj(a)){n=!0;break}}return{resolution:e,edgeLengthKM:e>=0?Yj(e,"km"):0,hasMultipleRes:i,hasPentagon:n}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:n,hasMultipleRes:i}=this.state,{viewport:r}=this.context;return Boolean(r==null?void 0:r.resolution)||i||n||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:n,edgeLengthKM:i,centerHex:r}=this.state;if(n<0)return;const s=this.props.centerHexagon||Wj(e.latitude,e.longitude,n);if(r===s)return;if(r){const y=Jj(r,s);if(y>=0&&y*i<$j)return}const{unitsPerMeter:o}=e.distanceScales;let a=BE(s);const[A,h]=j_(s),[p,m]=e.projectFlat([h,A]);a=a.map(y=>{const T=e.projectFlat(y);return[(T[0]-p)/o[0],(T[1]-m)/o[1]]}),this.setState({centerHex:s,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:n,coverage:i,extruded:r,wireframe:s,stroked:o,filled:a,lineWidthUnits:A,lineWidthScale:h,lineWidthMinPixels:p,lineWidthMaxPixels:m,getFillColor:y,getElevation:T,getLineColor:b,getLineWidth:C,transitions:R,updateTriggers:S}=this.props;return{elevationScale:e,extruded:r,coverage:i,wireframe:s,stroked:o,filled:a,lineWidthUnits:A,lineWidthScale:h,lineWidthMinPixels:p,lineWidthMaxPixels:m,material:n,getElevation:T,getFillColor:y,getLineColor:b,getLineWidth:C,transitions:R,updateTriggers:{getFillColor:S.getFillColor,getElevation:S.getElevation,getLineColor:S.getLineColor,getLineWidth:S.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:n,updateTriggers:i,coverage:r}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",Ka),o=this._getForwardProps();return o.updateTriggers.getPolygon=iH(i.getHexagon,r),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,A)=>{const h=n(a,A);return nH(BE(h,r))}})}_renderColumnLayer(){const{data:e,getHexagon:n,updateTriggers:i}=this.props,r=this.getSubLayerClass("hexagon-cell",Nh),s=this._getForwardProps();return s.updateTriggers.getPosition=i.getHexagon,new r(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:tH.bind(null,n)})}}w(_o,"defaultProps",rH);w(_o,"layerName","H3HexagonLayer");w(_o,"_checkH3Lib",()=>{});const C0=Math.PI/180,Bu=new Float32Array(16),LE=new Float32Array(12);function RE(t,e,n){const i=e[0]*C0,r=e[1]*C0,s=e[2]*C0,o=Math.sin(s),a=Math.sin(i),A=Math.sin(r),h=Math.cos(s),p=Math.cos(i),m=Math.cos(r),y=n[0],T=n[1],b=n[2];t[0]=y*m*p,t[1]=y*A*p,t[2]=y*-a,t[3]=T*(-A*h+m*a*o),t[4]=T*(m*h+A*a*o),t[5]=T*p*o,t[6]=b*(A*o+m*a*h),t[7]=b*(-m*o+A*a*h),t[8]=b*p*h}function OE(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const iP={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:i,getOrientation:r,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,A=Array.isArray(a),h=A&&a.length===16,p=Array.isArray(s),m=Array.isArray(r),y=Array.isArray(o),T=h||!A&&Boolean(a(i[0]));T?t.constant=h:t.constant=m&&p&&y;const b=t.value;if(t.constant){let C;T?(Bu.set(a),C=OE(Bu)):(C=LE,RE(C,r,s),C.set(o,9)),t.value=new Float32Array(C)}else{let C=e*t.size;const{iterable:R,objectInfo:S}=Ts(i,e,n);for(const P of R){S.index++;let I;if(T)Bu.set(h?a:a(P,S)),I=OE(Bu);else{I=LE;const F=m?r:r(P,S),j=p?s:s(P,S);RE(I,F,j),I.set(y?o:o(P,S),9)}b[C++]=I[0],b[C++]=I[1],b[C++]=I[2],b[C++]=I[3],b[C++]=I[4],b[C++]=I[5],b[C++]=I[6],b[C++]=I[7],b[C++]=I[8],b[C++]=I[9],b[C++]=I[10],b[C++]=I[11]}}}};function rP(t,e){return e===De.CARTESIAN||e===De.METER_OFFSETS||e===De.DEFAULT&&!t.isGeospatial}const sH=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs

// Scale the model
uniform float sizeScale;
uniform bool composeModelMatrix;

// Primitive attributes
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;

// Instance attributes
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;

// Outputs to fragment shader
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    // using instancePositions as world coordinates
    // when using globe mode, this branch does not re-orient the model to align with the surface of the earth
    // call project_normal before setting position to avoid rotation
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oH=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {

// NOTE(Tarek): This is necessary because
// headless.gl reports the extension as
// available but does not support it in
// the shader.
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function FE(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),Re.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function aH(t,e){if(t.attributes)return FE(t.attributes,e),t instanceof Sn?t:new Sn(t);if(t.positions||t.POSITION)return FE(t,e),new Sn({attributes:t});throw Error("Invalid mesh")}const lH=[0,0,0,255],AH={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:lH},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}};class YA extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){const e=!He(this.context.gl),n={};return Lh(this.context.gl,ht.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:sH,fs:oH,modules:[Ei,OC,Ti],transpileToGLSL100:e,defines:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:iP}),this.setState({emptyTexture:new Gt(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e;if(n.mesh!==i.mesh||r.extensionsChanged){var s;if((s=this.state.model)===null||s===void 0||s.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:Boolean(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==i.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:r,_instanced:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!s||rP(n,r),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new cn(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:aH(e,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:r}=this.state;return n.setUniforms({sampler:i||r,hasTexture:Boolean(i)}),n}setTexture(e){const{emptyTexture:n,model:i}=this.state;i&&i.setUniforms({sampler:e||n,hasTexture:Boolean(e)})}}w(YA,"defaultProps",AH);w(YA,"layerName","SimpleMeshLayer");class xa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||ji(this.constructor.name),this.display=!0,this.position=new Z,this.rotation=new Z,this.scale=new Z(1,1,1),this.matrix=new Ue,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}setPosition(e){return ge(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return ge(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return ge(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:i,scale:r,update:s=!0}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(i),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:i,scale:r}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,n){ge(e),n=n||this.matrix;const i=new Ue(e).multiplyRight(n),r=i.invert(),s=r.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:i,worldInverseMatrix:r,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class fA extends xa{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;xe.assert(n.every(i=>i instanceof xa),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const r of n)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const n=this.children,i=n.indexOf(e);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}traverse(e){let{worldMatrix:n=new Ue}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new Ue(n).multiplyRight(this.matrix);for(const r of this.children)r instanceof fA?r.traverse(e,{worldMatrix:i}):e(r,{worldMatrix:i})}}const cH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uH={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function DE(t){if(!t._animation){const e=uH[t.componentType],n=cH[t.type],i=n*t.count,{buffer:r,byteOffset:s}=t.bufferView.data,o=new e(r,s+(t.byteOffset||0),i);if(n===1)t._animation=Array.from(o);else{const a=[];for(let A=0;A<o.length;A+=n)a.push(Array.from(o.slice(A,A+n)));t._animation=a}}return t._animation}const fH=new Ue;function hH(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=fH.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const S0=new DA;function dH(t,e,n,i,r){if(e==="rotation"){S0.slerp({start:n,target:i,ratio:r});for(let s=0;s<S0.length;s++)t[e][s]=S0[s]}else for(let s=0;s<n.length;s++)t[e][s]=r*i[s]+(1-r)*n[s]}function pH(t,e,n){let{p0:i,outTangent0:r,inTangent1:s,p1:o,tDiff:a,ratio:A}=n;for(let h=0;h<t[e].length;h++){const p=r[h]*a,m=s[h]*a;t[e][h]=(2*Math.pow(A,3)-3*Math.pow(A,2)+1)*i[h]+(Math.pow(A,3)-2*Math.pow(A,2)+A)*p+(-2*Math.pow(A,3)+3*Math.pow(A,2))*o[h]+(Math.pow(A,3)-Math.pow(A,2))*m}}function gH(t,e,n){for(let i=0;i<n.length;i++)t[e][i]=n[i]}function mH(t,e,n,i){let{input:r,interpolation:s,output:o}=e;const a=r[r.length-1],A=t%a,h=r.findIndex(T=>T>=A),p=Math.max(0,h-1);if(!Array.isArray(n[i]))switch(i){case"translation":n[i]=[0,0,0];break;case"rotation":n[i]=[0,0,0,1];break;case"scale":n[i]=[1,1,1];break;default:xe.warn("Bad animation path ".concat(i))()}ge(n[i].length===o[p].length);const m=r[p],y=r[h];switch(s){case"STEP":gH(n,i,o[p]);break;case"LINEAR":if(y>m){const T=(A-m)/(y-m);dH(n,i,o[p],o[h],T)}break;case"CUBICSPLINE":if(y>m){const T=(A-m)/(y-m),b=y-m,C=o[3*p+1],R=o[3*p+2],S=o[3*h+0],P=o[3*h+1];pH(n,i,{p0:C,outTangent0:R,inTangent1:S,p1:P,tDiff:b,ratio:T})}break;default:xe.warn("Interpolation ".concat(s," not supported"))();break}}class _H{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:s,target:o,path:a}=r;mH(i,s,o,a),hH(o,o._node)})}}class vH{constructor(e){this.animations=e.animations.map((n,i)=>{const r=n.name||"Animation-".concat(i),s=n.samplers.map(a=>{let{input:A,interpolation:h="LINEAR",output:p}=a;return{input:DE(e.accessors[A]),interpolation:h,output:DE(e.accessors[p])}}),o=n.channels.map(a=>{let{sampler:A,target:h}=a;return{sampler:s[A],target:e.nodes[h.node],path:h.path}});return new _H({name:r,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class yH extends xa{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof cn?(this.model=e,this._setModelNodeProps(n)):this.model=new cn(e,n),this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class sP{constructor(e,n){let{attributes:i,material:r,pbrDebug:s,imageBasedLightingEnvironment:o,lights:a,useTangents:A}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Lh(e,ht.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&A,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),r&&this.parseMaterial(r)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},s=e.texture.source.image;let o,a={};s.compressed?(o=s,a={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):o={data:s};const A=new Gt(this.gl,{id:e.name||e.id,parameters:{...r,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...o});this.uniforms[n]=A,this.defineIfPresent(i,i),this.generatedTextures.push(A)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:i=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,i]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=Boolean(e.unlit),e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(xe.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const EH=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,TH=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function kE(t,e){return He(t)?`#version 300 es
`.concat(e):e}function wH(t,e){const{id:n,drawMode:i,vertexCount:r,attributes:s,modelOptions:o}=e,a=new sP(t,e);xe.info(4,"createGLTFModel defines: ",a.defines)();const A=[];A.push(...a.generatedTextures),A.push(...Object.values(s).map(p=>p.buffer));const h=new yH(t,Object.assign({id:n,drawMode:i,vertexCount:r,modules:[y_],defines:a.defines,parameters:a.parameters,vs:kE(t,EH),fs:kE(t,TH),managedResources:A},o));return h.setProps({attributes:s}),h.setUniforms(a.uniforms),h}const bH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xH={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class CH{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},xH,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new vH(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(s=>this.createNode(s));return new fA({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(s=>this.createNode(s));e.mesh&&i.push(this.createMesh(e.mesh));const r=new fA({id:e.name||e.id,children:i});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const s=new Ue().fromQuaternion(e.rotation);r.matrix.multiplyRight(s)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((s,o)=>this.createPrimitive(s,o,e)),r=new fA({id:e.name||e.id,children:i});e._mesh=r}return e._mesh}getVertexCount(e){xe.warn("getVertexCount() not found")()}createPrimitive(e,n,i){return wH(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options))}createAttributes(e,n){const i={};return Object.keys(e).forEach(r=>{i[r]=this.createAccessor(e[r],this.createBuffer(e[r],this.gl.ARRAY_BUFFER))}),n&&(i.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),xe.info(4,"glTF Attributes",{attributes:e,indices:n,generated:i})(),i}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[n]||(i.lumaBuffers[n]=new ct(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:n})),i.lumaBuffers[n]}createAccessor(e,n){return new Dn({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:bH[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function SH(t,e,n){const i=new CH(t,n),r=i.instantiate(e),s=i.createAnimator();return{scenes:r,animator:s}}const PH="3.2.13",IH="3.2.13",oP="3.2.13",MH="https://unpkg.com/@loaders.gl/textures@".concat(oP,"/dist/libs/basis_encoder.wasm"),BH="https://unpkg.com/@loaders.gl/textures@".concat(oP,"/dist/libs/basis_encoder.js");let P0;async function NE(t){const e=t.modules||{};return e.basis?e.basis:(P0=P0||LH(t),await P0)}async function LH(t){let e=null,n=null;return[e,n]=await Promise.all([await qs("basis_transcoder.js","textures",t),await qs("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await RH(e,n)}function RH(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:s,initializeBasis:o}=r;o(),i({BasisFile:s})})})}let I0;async function UE(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(I0=I0||OH(t),await I0)}async function OH(t){let e=null,n=null;return[e,n]=await Promise.all([await qs(BH,"textures",t),await qs(MH,"textures",t)]),e=e||globalThis.BASIS,await FH(e,n)}function FH(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:s,KTX2File:o,initializeBasis:a,BasisEncoder:A}=r;a(),i({BasisFile:s,KTX2File:o,BasisEncoder:A})})})}const zo={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},DH=["","WEBKIT_","MOZ_"],GE={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Lu=null;function kH(t){if(!Lu){t=t||NH()||void 0,Lu=new Set;for(const e of DH)for(const n in GE)if(t&&t.getExtension("".concat(e).concat(n))){const i=GE[n];Lu.add(i)}}return Lu}function NH(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var zE,VE,jE,HE,WE,QE,XE,JE;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(zE||(zE={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(VE||(VE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(jE||(jE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(HE||(HE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(WE||(WE={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(QE||(QE={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(XE||(XE={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(JE||(JE={}));const Xn=[171,75,84,88,32,50,48,187,13,10,26,10];function UH(t){const e=new Uint8Array(t);return!(e.byteLength<Xn.length||e[0]!==Xn[0]||e[1]!==Xn[1]||e[2]!==Xn[2]||e[3]!==Xn[3]||e[4]!==Xn[4]||e[5]!==Xn[5]||e[6]!==Xn[6]||e[7]!==Xn[7]||e[8]!==Xn[8]||e[9]!==Xn[9]||e[10]!==Xn[10]||e[11]!==Xn[11])}const GH={etc1:{basisFormat:0,compressed:!0,format:zo.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:zo.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:zo.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:zo.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:zo.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:zo.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function zH(t,e){if(e.basis.containerFormat==="auto"){if(UH(t)){const i=await UE(e);return YE(i.KTX2File,t,e)}const{BasisFile:n}=await NE(e);return M0(n,t,e)}switch(e.basis.module){case"encoder":const n=await UE(e);switch(e.basis.containerFormat){case"ktx2":return YE(n.KTX2File,t,e);case"basis":default:return M0(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await NE(e);return M0(i,t,e)}}function M0(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const r=i.getNumImages(),s=[];for(let o=0;o<r;o++){const a=i.getNumLevels(o),A=[];for(let h=0;h<a;h++)A.push(VH(i,o,h,n));s.push(A)}return s}finally{i.close(),i.delete()}}function VH(t,e,n,i){const r=t.getImageWidth(e,n),s=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:A,basisFormat:h}=aP(i,o),p=t.getImageTranscodedSizeInBytes(e,n,h),m=new Uint8Array(p);if(!t.transcodeImage(m,e,n,h,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:m,compressed:a,format:A,hasAlpha:o}}function YE(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=i.getLevels(),s=[];for(let o=0;o<r;o++){s.push(jH(i,o,n));break}return[s]}finally{i.close(),i.delete()}}function jH(t,e,n){const{alphaFlag:i,height:r,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:A}=aP(n,i),h=t.getImageTranscodedSizeInBytes(e,0,0,A),p=new Uint8Array(h);if(!t.transcodeImage(p,e,0,0,A,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:p,compressed:o,hasAlpha:i,format:a}}function aP(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=lP()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),GH[n]}function lP(){const t=kH();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const HH={name:"Basis",id:"basis",module:"textures",version:IH,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},WH={...HH,parse:zH};function $n(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function AP(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return i.substr(0,i.lastIndexOf("/")+1)+t}function QH(t,e,n){const i=t.bufferViews[n];$n(i);const r=i.buffer,s=e[r];$n(s);const o=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,i.byteLength)}const KE=["SCALAR","VEC2","VEC3","VEC4"],XH=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],JH=new Map(XH),YH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},KH={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ZH={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function cP(t){return KE[t-1]||KE[0]}function uP(t){const e=JH.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function fP(t,e){const n=ZH[t.componentType],i=YH[t.type],r=KH[t.componentType],s=t.count*i,o=t.count*i*r;return $n(o>=0&&o<=e.byteLength),{ArrayType:n,length:s,byteLength:o}}const qH={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class wi{constructor(e){w(this,"gltf",void 0),w(this,"sourceBuffers",void 0),w(this,"byteLength",void 0),this.gltf=e||{json:{...qH},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(r=>r===e),i=this.json.extensions||{};return n?i[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,i=this.gltf.buffers[n];$n(i);const r=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,{ArrayType:s,length:o}=fP(e,n),a=n.byteOffset+e.byteOffset;return new s(r,a,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,s=n.byteOffset||0;return new Uint8Array(r,s,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,i){return e.extensions=e.extensions||{},e.extensions[n]=i,this.registerUsedExtension(n),this}setObjectExtension(e,n,i){const r=e.extensions||{};r[n]=i}removeObjectExtension(e,n){const i=e.extensions||{},r=i[n];return delete i[n],r}addExtension(e,n={}){return $n(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return $n(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:i}=e;this.json.nodes=this.json.nodes||[];const r={mesh:n};return i&&(r.matrix=i),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:i,material:r,mode:s=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:s}]};if(i){const A=this._addIndices(i);a.primitives[0].indices=A}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,n){const i=qm(e),r=n||(i==null?void 0:i.mimeType),o={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const n=e.byteLength;$n(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=rc(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,n){const i={bufferView:e,type:cP(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const i=this.addBufferView(e);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,n.size));const s={size:n.size,componentType:uP(e),count:Math.round(e.length/n.size),min:r.min,max:r.max};return this.addAccessor(i,Object.assign(s,n))}addTexture(e){const{imageIndex:n}=e,i={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const i=this.byteLength,r=new ArrayBuffer(i),s=new Uint8Array(r);let o=0;for(const a of this.sourceBuffers||[])o=WL(a,s,o);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,n){let i=!0;for(;i;){const r=e.indexOf(n);r>-1?e.splice(r,1):i=!1}}_addAttributes(e={}){const n={};for(const i in e){const r=e[i],s=this._getGltfAttributeName(i),o=this.addBinaryBuffer(r.value,r);n[s]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const i={min:null,max:null};if(e.length<n)return i;i.min=[],i.max=[];const r=e.subarray(0,n);for(const s of r)i.min.push(s),i.max.push(s);for(let s=n;s<e.length;s+=n)for(let o=0;o<n;o++)i.min[0+o]=Math.min(i.min[0+o],e[s+o]),i.max[0+o]=Math.max(i.max[0+o],e[s+o]);return i}}const $H="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e7="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t7=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n7=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),i7={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},r7={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function s7(t,e,n,i,r,s="NONE"){const o=await o7();A7(o,o.exports[r7[r]],t,e,n,i,o.exports[i7[s||"NONE"]])}let B0;async function o7(){return B0||(B0=a7()),B0}async function a7(){let t=$H;WebAssembly.validate(t7)&&(t=e7,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(l7(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function l7(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const r=t.charCodeAt(i);e[i]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let i=0;i<t.length;++i)e[n++]=e[i]<60?n7[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,n)}function A7(t,e,n,i,r,s,o){const a=t.exports.sbrk,A=i+3&-4,h=a(A*r),p=a(s.length),m=new Uint8Array(t.exports.memory.buffer);m.set(s,p);const y=e(h,i,r,p,s.length);if(y===0&&o&&o(h,A,r),n.set(m.subarray(h,h+i*r)),a(h-a(0)),y!==0)throw new Error("Malformed buffer data: ".concat(y))}const H_="EXT_meshopt_compression",c7=H_;async function u7(t,e){var n;const i=new wi(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const r=[];for(const s of t.json.bufferViews||[])r.push(f7(i,s));await Promise.all(r),i.removeExtension(H_)}async function f7(t,e){const n=t.getObjectExtension(e,H_);if(n){const{byteOffset:i=0,byteLength:r=0,byteStride:s,count:o,mode:a,filter:A="NONE",buffer:h}=n,p=t.gltf.buffers[h],m=new Uint8Array(p.arrayBuffer,p.byteOffset+i,r),y=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await s7(y,o,s,m,a,A),y}return null}const h7=Object.freeze(Object.defineProperty({__proto__:null,decode:u7,name:c7},Symbol.toStringTag,{value:"Module"})),Xo="EXT_texture_webp",d7=Xo;function p7(t,e){const n=new wi(t);if(!D4("image/webp")){if(n.getRequiredExtensions().includes(Xo))throw new Error("gltf: Required extension ".concat(Xo," not supported by browser"));return}const{json:i}=n;for(const r of i.textures||[]){const s=n.getObjectExtension(r,Xo);s&&(r.source=s.source),n.removeObjectExtension(r,Xo)}n.removeExtension(Xo)}const g7=Object.freeze(Object.defineProperty({__proto__:null,name:d7,preprocess:p7},Symbol.toStringTag,{value:"Module"})),pf="KHR_texture_basisu",m7=pf;function _7(t,e){const n=new wi(t),{json:i}=n;for(const r of i.textures||[]){const s=n.getObjectExtension(r,pf);s&&(r.source=s.source),n.removeObjectExtension(r,pf)}n.removeExtension(pf)}const v7=Object.freeze(Object.defineProperty({__proto__:null,name:m7,preprocess:_7},Symbol.toStringTag,{value:"Module"})),y7="3.2.13",E7={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},T7={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:y7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:E7};function W_(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],A=a&&a.length;for(let h=0;h<A;h+=3){const p=a[h],m=a[h+1],y=a[h+2];e=p<e?p:e,n=m<n?m:n,i=y<i?y:i,r=p>r?p:r,s=m>s?m:s,o=y>o?y:o}return[[e,n,i],[r,s,o]]}function w7(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class da{constructor(e,n){w(this,"fields",void 0),w(this,"metadata",void 0),w7(Array.isArray(e)),b7(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(...e){const n=Object.create(null);for(const r of e)n[r]=!0;const i=this.fields.filter(r=>n[r.name]);return new da(i,this.metadata)}selectAt(...e){const n=e.map(i=>this.fields[i]).filter(Boolean);return new da(n,this.metadata)}assign(e){let n,i=this.metadata;if(e instanceof da){const o=e;n=o.fields,i=ZE(ZE(new Map,this.metadata),o.metadata)}else n=e;const r=Object.create(null);for(const o of this.fields)r[o.name]=o;for(const o of n)r[o.name]=o;const s=Object.values(r);return new da(s,i)}}function b7(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function ZE(t,e){return new Map([...t||new Map,...e||new Map])}class lh{constructor(e,n,i=!1,r=new Map){w(this,"name",void 0),w(this,"type",void 0),w(this,"nullable",void 0),w(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=i,this.metadata=r}get typeId(){return this.type&&this.type.typeId}clone(){return new lh(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let wt;(function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"})(wt||(wt={}));let hP,dP,pP;class Q_{static isNull(e){return e&&e.typeId===wt.Null}static isInt(e){return e&&e.typeId===wt.Int}static isFloat(e){return e&&e.typeId===wt.Float}static isBinary(e){return e&&e.typeId===wt.Binary}static isUtf8(e){return e&&e.typeId===wt.Utf8}static isBool(e){return e&&e.typeId===wt.Bool}static isDecimal(e){return e&&e.typeId===wt.Decimal}static isDate(e){return e&&e.typeId===wt.Date}static isTime(e){return e&&e.typeId===wt.Time}static isTimestamp(e){return e&&e.typeId===wt.Timestamp}static isInterval(e){return e&&e.typeId===wt.Interval}static isList(e){return e&&e.typeId===wt.List}static isStruct(e){return e&&e.typeId===wt.Struct}static isUnion(e){return e&&e.typeId===wt.Union}static isFixedSizeBinary(e){return e&&e.typeId===wt.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===wt.FixedSizeList}static isMap(e){return e&&e.typeId===wt.Map}static isDictionary(e){return e&&e.typeId===wt.Dictionary}get typeId(){return wt.NONE}compareTo(e){return this===e}}hP=Symbol.toStringTag;class $a extends Q_{constructor(e,n){super(),w(this,"isSigned",void 0),w(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return wt.Int}get[hP](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class x7 extends $a{constructor(){super(!0,8)}}class C7 extends $a{constructor(){super(!0,16)}}class S7 extends $a{constructor(){super(!0,32)}}class P7 extends $a{constructor(){super(!1,8)}}class I7 extends $a{constructor(){super(!1,16)}}class M7 extends $a{constructor(){super(!1,32)}}const gP={HALF:16,SINGLE:32,DOUBLE:64};dP=Symbol.toStringTag;class mP extends Q_{constructor(e){super(),w(this,"precision",void 0),this.precision=e}get typeId(){return wt.Float}get[dP](){return"Float"}toString(){return"Float".concat(this.precision)}}class B7 extends mP{constructor(){super(gP.SINGLE)}}class L7 extends mP{constructor(){super(gP.DOUBLE)}}pP=Symbol.toStringTag;class R7 extends Q_{constructor(e,n){super(),w(this,"listSize",void 0),w(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return wt.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[pP](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function O7(t){switch(t.constructor){case Int8Array:return new x7;case Uint8Array:return new P7;case Int16Array:return new C7;case Uint16Array:return new I7;case Int32Array:return new S7;case Uint32Array:return new M7;case Float32Array:return new B7;case Float64Array:return new L7;default:throw new Error("array type not supported")}}function F7(t,e,n){const i=O7(e.value),r=n||D7(e);return new lh(t,new R7(e.size,new lh("value",i)),!1,r)}function D7(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function k7(t,e,n){const i=_P(e.metadata),r=[],s=N7(e.attributes);for(const o in t){const a=t[o],A=qE(o,a,s[o]);r.push(A)}if(n){const o=qE("indices",n);r.push(o)}return new da(r,i)}function N7(t){const e={};for(const n in t){const i=t[n];e[i.name||"undefined"]=i}return e}function qE(t,e,n){const i=n?_P(n.metadata):void 0;return F7(t,e,i)}function _P(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const $E={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},U7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},G7=4;class z7{constructor(e){w(this,"draco",void 0),w(this,"decoder",void 0),w(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(i),s=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const y="DRACO decompression failed: ".concat(o.error_msg());throw new Error(y)}const a=this._getDracoLoaderData(s,r,n),A=this._getMeshData(s,a,n),h=W_(A.attributes),p=k7(A.attributes,a,A.indices);return{loader:"draco",loaderData:a,header:{vertexCount:s.num_points(),boundingBox:h},...A,schema:p}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,n,i){const r=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,i);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:s}}_getDracoAttributes(e,n){const i={};for(let r=0;r<e.num_attributes();r++){const s=this.decoder.GetAttribute(e,r),o=this._getAttributeMetadata(e,r);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:r,metadata:o};const a=this._getQuantizationTransform(s,n);a&&(i[s.unique_id()].quantization_transform=a);const A=this._getOctahedronTransform(s,n);A&&(i[s.unique_id()].octahedron_transform=A)}return i}_getMeshData(e,n,i){const r=this._getMeshAttributes(n,e,i);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,n,i){const r={};for(const s of Object.values(e.attributes)){const o=this._deduceAttributeName(s,i);s.name=o;const{value:a,size:A}=this._getAttributeValues(n,s);r[o]={value:a,size:A,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return r}_getTriangleListIndices(e){const i=e.num_faces()*3,r=i*G7,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,i).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),H7(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const i=U7[n.data_type],r=n.num_components,o=e.num_points()*r,a=o*i.BYTES_PER_ELEMENT,A=V7(this.draco,i);let h;const p=this.draco._malloc(a);try{const m=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,m,A,a,p),h=new i(this.draco.HEAPF32.buffer,p,o).slice()}finally{this.draco._free(p)}return{value:h,size:r}}_deduceAttributeName(e,n){const i=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===i)return o;const r=e.attribute_type;for(const o in $E)if(this.draco[o]===r)return $E[o];const s=n.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const i=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},i=this.metadataQuerier.NumEntries(e);for(let r=0;r<i;r++){const s=this.metadataQuerier.GetEntryName(e,r);n[s]=this._getDracoMetadataField(e,s)}return n}_getDracoMetadataField(e,n){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,i);const r=j7(i);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:r}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:i=[]}=e,r=[...n,...i];for(const s of r)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,n){const{quantizedAttributes:i=[]}=n,r=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:i=[]}=n,r=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function V7(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function j7(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}function H7(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}const X_="1.4.1",W7="https://www.gstatic.com/draco/versioned/decoders/".concat(X_,"/draco_decoder.js"),Q7="https://www.gstatic.com/draco/versioned/decoders/".concat(X_,"/draco_wasm_wrapper.js"),X7="https://www.gstatic.com/draco/versioned/decoders/".concat(X_,"/draco_decoder.wasm");let Fl;async function J7(t){const e=t.modules||{};return e.draco3d?Fl=Fl||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):Fl=Fl||Y7(t),await Fl}async function Y7(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await qs(W7,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await qs(Q7,"draco",t),await qs(X7,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await K7(e,n)}function K7(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t({...n,onModuleLoaded:r=>i({draco:r})})})}const vP={...T7,parse:Z7};async function Z7(t,e){const{draco:n}=await J7(e),i=new z7(n);try{return i.parseSync(t,e==null?void 0:e.draco)}finally{i.destroy()}}function q7(t){const e={};for(const n in t){const i=t[n];if(n!=="indices"){const r=yP(i);e[n]=r}}return e}function yP(t){const{buffer:e,size:n,count:i}=$7(t);return{value:e,size:n,byteOffset:0,count:i,type:cP(n),componentType:uP(e)}}function $7(t){let e=t,n=1,i=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=eW(e,Float32Array)),i=e.length/n),{buffer:e,size:n,count:i}}function eW(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const uo="KHR_draco_mesh_compression",tW=uo;function nW(t,e,n){const i=new wi(t);for(const r of EP(i))i.getObjectExtension(r,uo)}async function iW(t,e,n){var i;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const r=new wi(t),s=[];for(const o of EP(r))r.getObjectExtension(o,uo)&&s.push(sW(r,o,e,n));await Promise.all(s),r.removeExtension(uo)}function rW(t,e={}){const n=new wi(t);for(const i of n.json.meshes||[])oW(i),n.addRequiredExtension(uo)}async function sW(t,e,n,i){const r=t.getObjectExtension(e,uo);if(!r)return;const s=t.getTypedArrayForBufferView(r.bufferView),o=Xm(s.buffer,s.byteOffset),{parse:a}=i,A={...n};delete A["3d-tiles"];const h=await a(o,vP,A,i),p=q7(h.attributes);for(const[m,y]of Object.entries(p))if(m in e.attributes){const T=e.attributes[m],b=t.getAccessor(T);b!=null&&b.min&&b!==null&&b!==void 0&&b.max&&(y.min=b.min,y.max=b.max)}e.attributes=p,h.indices&&(e.indices=yP(h.indices)),aW(e)}function oW(t,e,n=4,i,r){var s;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:t}),a=r==null||(s=r.parseSync)===null||s===void 0?void 0:s.call(r,{attributes:t}),A=i._addFauxAttributes(a.attributes),h=i.addBufferView(o);return{primitives:[{attributes:A,mode:n,extensions:{[uo]:{bufferView:h,attributes:A}}}]}}function aW(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*EP(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const lW=Object.freeze(Object.defineProperty({__proto__:null,decode:iW,encode:rW,name:tW,preprocess:nW},Symbol.toStringTag,{value:"Module"})),Js="KHR_lights_punctual",AW=Js;async function cW(t){const e=new wi(t),{json:n}=e,i=e.getExtension(Js);i&&(e.json.lights=i.lights,e.removeExtension(Js));for(const r of n.nodes||[]){const s=e.getObjectExtension(r,Js);s&&(r.light=s.light),e.removeObjectExtension(r,Js)}}async function uW(t){const e=new wi(t),{json:n}=e;if(n.lights){const i=e.addExtension(Js);$n(!i.lights),i.lights=n.lights,delete n.lights}if(e.json.lights){for(const i of e.json.lights){const r=i.node;e.addObjectExtension(r,Js,i)}delete e.json.lights}}const fW=Object.freeze(Object.defineProperty({__proto__:null,decode:cW,encode:uW,name:AW},Symbol.toStringTag,{value:"Module"})),KA="KHR_materials_unlit",hW=KA;async function dW(t){const e=new wi(t),{json:n}=e;e.removeExtension(KA);for(const i of n.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,KA)}function pW(t){const e=new wi(t),{json:n}=e;if(e.materials)for(const i of n.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,KA,{}),e.addExtension(KA))}const gW=Object.freeze(Object.defineProperty({__proto__:null,decode:dW,encode:pW,name:hW},Symbol.toStringTag,{value:"Module"})),Jl="KHR_techniques_webgl",mW=Jl;async function _W(t){const e=new wi(t),{json:n}=e,i=e.getExtension(Jl);if(i){const r=yW(i,e);for(const s of n.materials||[]){const o=e.getObjectExtension(s,Jl);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=EW(s.technique,e)),e.removeObjectExtension(s,Jl)}e.removeExtension(Jl)}}async function vW(t,e){}function yW(t,e){const{programs:n=[],shaders:i=[],techniques:r=[]}=t,s=new TextDecoder;return i.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=i[o.fragmentShader],o.vertexShader=i[o.vertexShader]}),r.forEach(o=>{o.program=n[o.program]}),r}function EW(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in n)&&(n[i]=t.uniforms[i].value)}),Object.keys(n).forEach(i=>{typeof n[i]=="object"&&n[i].index!==void 0&&(n[i].texture=e.getTexture(n[i].index))}),n}const TW=Object.freeze(Object.defineProperty({__proto__:null,decode:_W,encode:vW,name:mW},Symbol.toStringTag,{value:"Module"})),TP=[h7,g7,v7,lW,fW,gW,TW];function wW(t,e={},n){const i=TP.filter(s=>wP(s.name,e));for(const s of i){var r;(r=s.preprocess)===null||r===void 0||r.call(s,t,e,n)}}async function bW(t,e={},n){const i=TP.filter(s=>wP(s.name,e));for(const s of i){var r;await((r=s.decode)===null||r===void 0?void 0:r.call(s,t,e,n))}}function wP(t,e){var n;const i=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in i&&!i[t])}const L0="KHR_binary_glTF";function xW(t){const e=new wi(t),{json:n}=e;for(const i of n.images||[]){const r=e.getObjectExtension(i,L0);r&&Object.assign(i,r),e.removeObjectExtension(i,L0)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(L0)}const eT={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},CW={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class SW{constructor(){w(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),w(this,"json",void 0)}normalize(e,n){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),xW(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in eT)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const i=e[n];if(!(!i||Array.isArray(i))){e[n]=[];for(const r in i){const s=i[r];s.id=s.id||r;const o=e[n].length;e[n].push(s),this.idToIndexMap[n][r]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in eT)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:i,indices:r,material:s}=n;for(const o in i)i[o]=this._convertIdToIndex(i[o],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),s&&(n.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const i of e[n])for(const r in i){const s=i[r],o=this._convertIdToIndex(s,r);i[r]=o}}_convertIdToIndex(e,n){const i=CW[n];if(i in this.idToIndexMap){const r=this.idToIndexMap[i][e];if(!Number.isFinite(r))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return r}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const s of e.materials){var n,i,r;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=s.values)===null||n===void 0?void 0:n.tex)||((i=s.values)===null||i===void 0?void 0:i.texture2d_0)||((r=s.values)===null||r===void 0?void 0:r.diffuseTex),a=e.textures.findIndex(A=>A.id===o);a!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:a})}}}function PW(t,e={}){return new SW().normalize(t,e)}const IW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},MW={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ui={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},BW={magFilter:ui.TEXTURE_MAG_FILTER,minFilter:ui.TEXTURE_MIN_FILTER,wrapS:ui.TEXTURE_WRAP_S,wrapT:ui.TEXTURE_WRAP_T},LW={[ui.TEXTURE_MAG_FILTER]:ui.LINEAR,[ui.TEXTURE_MIN_FILTER]:ui.NEAREST_MIPMAP_LINEAR,[ui.TEXTURE_WRAP_S]:ui.REPEAT,[ui.TEXTURE_WRAP_T]:ui.REPEAT};function RW(t){return MW[t]}function OW(t){return IW[t]}class FW{constructor(){w(this,"baseUri",""),w(this,"json",{}),w(this,"buffers",[]),w(this,"images",[])}postProcess(e,n={}){const{json:i,buffers:r=[],images:s=[],baseUri:o=""}=e;return $n(i),this.baseUri=o,this.json=i,this.buffers=r,this.images=s,this._resolveTree(this.json,n),this.json}_resolveTree(e,n={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map((i,r)=>this._resolveBufferView(i,r))),e.images&&(e.images=e.images.map((i,r)=>this._resolveImage(i,r))),e.samplers&&(e.samplers=e.samplers.map((i,r)=>this._resolveSampler(i,r))),e.textures&&(e.textures=e.textures.map((i,r)=>this._resolveTexture(i,r))),e.accessors&&(e.accessors=e.accessors.map((i,r)=>this._resolveAccessor(i,r))),e.materials&&(e.materials=e.materials.map((i,r)=>this._resolveMaterial(i,r))),e.meshes&&(e.meshes=e.meshes.map((i,r)=>this._resolveMesh(i,r))),e.nodes&&(e.nodes=e.nodes.map((i,r)=>this._resolveNode(i,r))),e.skins&&(e.skins=e.skins.map((i,r)=>this._resolveSkin(i,r))),e.scenes&&(e.scenes=e.scenes.map((i,r)=>this._resolveScene(i,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),i}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(i=>this.getNode(i)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(i=>this.getNode(i))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((i,r)=>{const s=this.getMesh(r);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(i=>{i={...i};const r=i.attributes;i.attributes={};for(const s in r)i.attributes[s]=this.getAccessor(r[s]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=RW(e.componentType),e.components=OW(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const i=e.bufferView.buffer,{ArrayType:r,byteLength:s}=fP(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset;let a=i.arrayBuffer.slice(o,o+s);e.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(i,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new r(a)}return e}_getValueFromInterleavedBuffer(e,n,i,r,s){const o=new Uint8Array(s*r);for(let a=0;a<s;a++){const A=n+a*i;o.set(new Uint8Array(e.arrayBuffer.slice(A,A+r)),a*r)}return o.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):LW,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const i in e){const r=this._enumSamplerParameter(i);r!==void 0&&(e.parameters[r]=e[i])}return e}_enumSamplerParameter(e){return BW[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[n];return i&&(e.image=i),e}_resolveBufferView(e,n){const i=e.buffer,r={id:"bufferView-".concat(n),...e,buffer:this.buffers[i]},s=this.buffers[i].arrayBuffer;let o=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),r.data=new Uint8Array(s,o,e.byteLength),r}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function DW(t,e){return new FW().postProcess(t,e)}const tT=1735152710,J_=12,Ah=8,kW=1313821514,NW=5130562,UW=0,GW=1,zW=0,za=!0;function VW(t,e=0){return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function jW(t,e=0,n={}){const i=new DataView(t),{magic:r=tT}=n,s=i.getUint32(e,!1);return s===r||s===tT}function HW(t,e,n=0,i={}){const r=new DataView(e),s=VW(r,n+0),o=r.getUint32(n+4,za),a=r.getUint32(n+8,za);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),n+=J_,t.version){case 1:return WW(t,r,n);case 2:return QW(t,r,n,i={});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function WW(t,e,n){At(t.header.byteLength>J_+Ah);const i=e.getUint32(n+0,za),r=e.getUint32(n+4,za);return n+=Ah,At(r===zW),jg(t,e,n,i),n+=i,n+=Hg(t,e,n,t.header.byteLength),n}function QW(t,e,n,i){return At(t.header.byteLength>J_+Ah),XW(t,e,n,i),n+t.header.byteLength}function XW(t,e,n,i){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,za),s=e.getUint32(n+4,za);switch(n+=Ah,s){case kW:jg(t,e,n,r);break;case NW:Hg(t,e,n,r);break;case UW:i.strict||jg(t,e,n,r);break;case GW:i.strict||Hg(t,e,n,r);break}n+=rc(r,4)}return n}function jg(t,e,n,i){const r=new Uint8Array(e.buffer,n,i),o=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(o),rc(i,4)}function Hg(t,e,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),rc(i,4)}async function JW(t,e,n=0,i,r){var s,o,a,A;YW(t,e,n,i),PW(t,{normalize:i==null||(s=i.gltf)===null||s===void 0?void 0:s.normalize}),wW(t,i,r);const h=[];if(i!=null&&(o=i.gltf)!==null&&o!==void 0&&o.loadBuffers&&t.json.buffers&&await KW(t,i,r),i!=null&&(a=i.gltf)!==null&&a!==void 0&&a.loadImages){const m=ZW(t,i,r);h.push(m)}const p=bW(t,i,r);return h.push(p),await Promise.all(h),i!=null&&(A=i.gltf)!==null&&A!==void 0&&A.postProcess?DW(t,i):t}function YW(t,e,n,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!jW(e,n,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=zL(e);else if(e instanceof ArrayBuffer){const o={};n=HW(o,e,n,i.glb),$n(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),t._glb=o,t.json=o.json}else $n(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=t.json.images||[];t.images=new Array(s.length).fill({})}async function KW(t,e,n){const i=t.json.buffers||[];for(let o=0;o<i.length;++o){const a=i[o];if(a.uri){var r,s;const{fetch:A}=n;$n(A);const h=AP(a.uri,e),p=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,h)),m=await(p==null||(s=p.arrayBuffer)===null||s===void 0?void 0:s.call(p));t.buffers[o]={arrayBuffer:m,byteOffset:0,byteLength:m.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function ZW(t,e,n){const i=qW(t),r=t.json.images||[],s=[];for(const o of i)s.push($W(t,r[o],o,e,n));return await Promise.all(s)}function qW(t){const e=new Set,n=t.json.textures||[];for(const i of n)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function $W(t,e,n,i,r){const{fetch:s,parse:o}=r;let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const h=AP(e.uri,i);a=await(await s(h)).arrayBuffer()}if(Number.isFinite(e.bufferView)){const h=QH(t.json,t.buffers,e.bufferView);a=Xm(h.buffer,h.byteOffset,h.byteLength)}$n(a,"glTF image has no data");let A=await o(a,[$m,WH],{mimeType:e.mimeType,basis:i.basis||{format:lP()}},r);A&&A[0]&&(A={compressed:!0,mipmaps:!1,width:A[0].width,height:A[0].height,data:A[0]}),t.images=t.images||[],t.images[n]=A}const ZA={name:"glTF",id:"gltf",module:"gltf",version:PH,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:eQ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function eQ(t,e={},n){e={...ZA.options,...e},e.gltf={...ZA.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await JW({},t,i,e,n)}async function tQ(t){const e=[];return t.scenes.forEach(n=>{n.traverse(i=>{Object.values(i.model.getUniforms()).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await nQ(()=>e.some(n=>!n.loaded))}async function nQ(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const iQ=`#version 300 es

// Instance attributes
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;

// Uniforms
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;

// Attributes
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif

// Varying
out vec4 vColor;

// MODULE_PBR contains all the varying definitions needed
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif

// Main
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    // using instancePositions as world coordinates
    // when using globe mode, this branch does not re-orient the model to align with the surface of the earth
    // call project_normal before setting position to avoid rotation
    geometry.normal = project_normal(normal);
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    // set PBR data
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rQ=`#version 300 es

// Uniforms
uniform float opacity;

// Varying
in vec4 vColor;

out vec4 fragmentColor;

// MODULE_PBR contains all the varying definitions needed
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,bP=[255,255,255,255],sQ={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:bP},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[ZA]};class Y_ extends Mn{constructor(...e){super(...e),w(this,"state",void 0)}getShaders(){const e=[Ei,Ti];return this.props._lighting==="pbr"&&e.push(y_),{vs:iQ,fs:rQ,modules:e}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:bP,transition:!0},instanceModelMatrix:iP})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.scenegraph!==i.scenegraph?this._updateScenegraph():n._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let i=null;if(e.scenegraph instanceof xa)i={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const a=e.scenegraph,A=SH(n,a,this._getModelOptions());i={gltf:a,...A},tQ(A).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(Re.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=e.scenegraph);const r={layer:this,gl:n},s=e.getScene(i,r),o=e.getAnimator(i,r);s instanceof xa?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,o,e._animations),this.setState({scenegraph:s,animator:o})):s!==null&&Re.warn("invalid scenegraph:",s)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(i=>{this._setModelAttributes(i.model,n)})}}_applyAnimationsProp(e,n,i){if(!e||!n||!i)return;const r=n.getAnimations();Object.keys(i).sort().forEach(s=>{const o=i[s];if(s==="*")r.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(s))){const a=Number(s);a>=0&&a<r.length?Object.assign(r[a],o):Re.warn("animation ".concat(s," not found"))()}else{const a=r.find(({name:A})=>A===s);a?Object.assign(a,o):Re.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof xa&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!He(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:i}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:r}=this.context,{sizeScale:s,sizeMinPixels:o,sizeMaxPixels:a,opacity:A,coordinateSystem:h}=this.props,p=this.getNumInstances();this.state.scenegraph.traverse((m,{worldMatrix:y})=>{m.model.setInstanceCount(p),m.updateModuleSettings(e),m.draw({parameters:n,uniforms:{sizeScale:s,opacity:A,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:rP(r,h),sceneModelMatrix:y,u_Camera:m.model.getUniforms().project_uCameraPosition}})})}}w(Y_,"defaultProps",sQ);w(Y_,"layerName","ScenegraphLayer");const oQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs

// Scale the model
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;

// Primitive attributes
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;

// Instance attributes
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;

// Outputs to fragment shader
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    // https://github.com/Esri/i3s-spec/blob/master/docs/1.7/geometryUVRegion.cmn.md
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    // set PBR data
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,aQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {

// NOTE(Tarek): This is necessary because
// headless.gl reports the extension as
// available but does not support it in
// the shader.
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function lQ(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const AQ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class K_ extends YA{getShaders(){const e=super.getShaders();return e.modules.push(y_),{...e,vs:oQ,fs:aQ}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(n)}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:i}=this.props,r=this.parseMaterial(i,e);this.setState({materialParser:r});const s=this.getShaders();return lQ(e.attributes),new cn(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...s.defines,...r==null?void 0:r.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:r==null?void 0:r.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:i}=this.props,r=this.parseMaterial(e,i);this.setState({materialParser:r}),n.setUniforms(r.uniforms)}}parseMaterial(e,n){var i;const r=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new sP(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:r,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,i=new Uint8ClampedArray(n.length*e.size),r=[];for(let s=0;s<n.length;s++)this.encodePickingColor(n[s],r),i[s*3]=r[0],i[s*3+1]=r[1],i[s*3+2]=r[2];e.value=i}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}w(K_,"layerName","MeshLayer");w(K_,"defaultProps",AQ);const cQ=6378137,uQ=6378137,fQ=6356752314245179e-9;function jh(t){return t}new Z;function hQ(t,e=[],n=jh){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function dQ(t,e=[]){return hQ(t,e,Zt._cartographicRadians?jh:D6)}function pQ(t,e,n=jh){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function gQ(t,e){return pQ(t,e,Zt._cartographicRadians?jh:k6)}const Vo=new Z,mQ=new Z,_Q=new Z;function vQ(t,e,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:r,centerToleranceSquared:s}=e;Vo.from(t);const o=Vo.x,a=Vo.y,A=Vo.z,h=i.x,p=i.y,m=i.z,y=o*o*h*h,T=a*a*p*p,b=A*A*m*m,C=y+T+b,R=Math.sqrt(1/C);if(!Number.isFinite(R))return;const S=mQ;if(S.copy(t).scale(R),C<s)return S.to(n);const P=r.x,I=r.y,F=r.z,j=_Q;j.set(S.x*P*2,S.y*I*2,S.z*F*2);let X=(1-R)*Vo.len()/(.5*j.len()),q=0,ee,Q,V,D;do{X-=q,ee=1/(1+X*P),Q=1/(1+X*I),V=1/(1+X*F);const re=ee*ee,le=Q*Q,pe=V*V,Be=re*ee,Ye=le*Q,Qe=pe*V;D=y*re+T*le+b*pe-1;const ye=-2*(y*Be*P+T*Ye*I+b*Qe*F);q=D/ye}while(Math.abs(D)>kA.EPSILON12);return Vo.scale([ee,Q,V]).to(n)}const nT=1e-14,yQ=new Z,iT={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},R0={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Dl={east:new Z,north:new Z,up:new Z,west:new Z,south:new Z,down:new Z},EQ=new Z,TQ=new Z,wQ=new Z;function rT(t,e,n,i,r,s){const o=iT[e]&&iT[e][n];Oi(o&&(!i||i===o));let a,A,h;const p=yQ.copy(r);if(ni(p.x,0,nT)&&ni(p.y,0,nT)){const y=Math.sign(p.z);a=EQ.fromArray(R0[e]),e!=="east"&&e!=="west"&&a.scale(y),A=TQ.fromArray(R0[n]),n!=="east"&&n!=="west"&&A.scale(y),h=wQ.fromArray(R0[i]),i!=="east"&&i!=="west"&&h.scale(y)}else{const{up:y,east:T,north:b}=Dl;T.set(-p.y,p.x,0).normalize(),t.geodeticSurfaceNormal(p,y),b.copy(y).cross(T);const{down:C,west:R,south:S}=Dl;C.copy(y).scale(-1),R.copy(T).scale(-1),S.copy(b).scale(-1),a=Dl[e],A=Dl[n],h=Dl[i]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=A.x,s[5]=A.y,s[6]=A.z,s[7]=0,s[8]=h.x,s[9]=h.y,s[10]=h.z,s[11]=0,s[12]=p.x,s[13]=p.y,s[14]=p.z,s[15]=1,s}const Ru=new Z,sT=new Z,bQ=new Z,Mi=new Z,xQ=new Z,Ou=new Z;class $t{constructor(e=0,n=0,i=0){w(this,"radii",void 0),w(this,"radiiSquared",void 0),w(this,"radiiToTheFourth",void 0),w(this,"oneOverRadii",void 0),w(this,"oneOverRadiiSquared",void 0),w(this,"minimumRadius",void 0),w(this,"maximumRadius",void 0),w(this,"centerToleranceSquared",kA.EPSILON1),w(this,"squaredXOverSquaredZ",void 0),Oi(e>=0),Oi(n>=0),Oi(i>=0),this.radii=new Z(e,n,i),this.radiiSquared=new Z(e*e,n*n,i*i),this.radiiToTheFourth=new Z(e*e*e*e,n*n*n*n,i*i*i*i),this.oneOverRadii=new Z(e===0?0:1/e,n===0?0:1/n,i===0?0:1/i),this.oneOverRadiiSquared=new Z(e===0?0:1/(e*e),n===0?0:1/(n*n),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,n,i),this.maximumRadius=Math.max(e,n,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const i=sT,r=bQ,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,i),r.copy(this.radiiSquared).scale(i);const o=Math.sqrt(i.dot(r));return r.scale(1/o),i.scale(s),r.add(i),r.to(n)}cartesianToCartographic(e,n=[0,0,0]){Ou.from(e);const i=this.scaleToGeodeticSurface(Ou,Mi);if(!i)return;const r=this.geodeticSurfaceNormal(i,sT),s=xQ;s.copy(Ou).subtract(i);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),A=Math.sign(h_(s,Ou))*yC(s);return gQ([o,a,A],n)}eastNorthUpToFixedFrame(e,n=new Ue){return rT(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,i,r,s=new Ue){return rT(this,e,n,i,r,s)}geocentricSurfaceNormal(e,n=[0,0,0]){return Ru.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const i=dQ(e),r=i[0],s=i[1],o=Math.cos(s);return Ru.set(o*Math.cos(r),o*Math.sin(r),Math.sin(s)).normalize(),Ru.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return Ru.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return vQ(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){Mi.from(e);const i=Mi.x,r=Mi.y,s=Mi.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+r*r*o.y+s*s*o.z);return Mi.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return Mi.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return Mi.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,i=[0,0,0]){Oi(ni(this.radii.x,this.radii.y,kA.EPSILON15)),Oi(this.radii.z>0),Mi.from(e);const r=Mi.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return Mi.set(0,0,r).to(i)}}w($t,"WGS84",new $t(cQ,uQ,fQ));class CQ{constructor(e,n,i){w(this,"item",void 0),w(this,"previous",void 0),w(this,"next",void 0),this.item=e,this.previous=n,this.next=i}}class SQ{constructor(){w(this,"head",null),w(this,"tail",null),w(this,"_length",0)}get length(){return this._length}add(e){const n=new CQ(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const i=e.next;e.next=n,this.tail===e?this.tail=n:i.previous=n,n.next=i,n.previous=e,++this._length}}function O0(t){return t!=null}class PQ{constructor(){w(this,"_list",void 0),w(this,"_sentinel",void 0),w(this,"_trimTiles",void 0),this._list=new SQ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;O0(n)&&this._list.splice(this._sentinel,n)}add(e,n,i){O0(n._cacheNode)||(n._cacheNode=this._list.add(n),i&&i(e,n))}unloadTile(e,n,i){const r=n._cacheNode;O0(r)&&(this._list.remove(r),n._cacheNode=void 0,i&&i(e,n))}unloadTiles(e,n){const i=this._trimTiles;this._trimTiles=!1;const r=this._list,s=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=r.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>s||i);){const A=a.item;a=a.next,this.unloadTile(e,A,n)}}trim(){this._trimTiles=!0}}function IQ(t,e){At(t),At(e);const{rtcCenter:n,gltfUpAxis:i}=e,{computedTransform:r,boundingVolume:{center:s}}=t;let o=new Ue(r);switch(n&&o.translate(n),i){case"Z":break;case"Y":const m=new Ue().rotateX(Math.PI/2);o=o.multiplyRight(m);break;case"X":const y=new Ue().rotateY(-Math.PI/2);o=o.multiplyRight(y);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new Z(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const A=$t.WGS84.cartesianToCartographic(a,new Z),p=$t.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=p.multiplyRight(o),e.cartographicOrigin=A,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const oT=new Z,F0=new Z,Wg=new qn([new pi,new pi,new pi,new pi,new pi,new pi]);function MQ(t,e){const{cameraDirection:n,cameraUp:i,height:r}=t,{metersPerUnit:s}=t.distanceScales,o=gf(t,t.center),a=$t.WGS84.eastNorthUpToFixedFrame(o),A=t.unprojectPosition(t.cameraPosition),h=$t.WGS84.cartographicToCartesian(A,new Z),p=new Z(a.transformAsVector(new Z(n).scale(s))).normalize(),m=new Z(a.transformAsVector(new Z(i).scale(s))).normalize();LQ(t);const y=t.constructor,{longitude:T,latitude:b,width:C,bearing:R,zoom:S}=t,P=new y({longitude:T,latitude:b,height:r,width:C,bearing:R,zoom:S,pitch:0});return{camera:{position:h,direction:p,up:m},viewport:t,topDownViewport:P,height:r,cullingVolume:Wg,frameNumber:e,sseDenominator:1.15}}function BQ(t,e,n){if(n===0||t.length<=n)return[t,[]];const i=[],{longitude:r,latitude:s}=e.viewport;for(const[h,p]of t.entries()){const[m,y]=p.header.mbs,T=Math.abs(r-m),b=Math.abs(s-y),C=Math.sqrt(b*b+T*T);i.push([h,C])}const o=i.sort((h,p)=>h[1]-p[1]),a=[];for(let h=0;h<n;h++)a.push(t[o[h][0]]);const A=[];for(let h=n;h<o.length;h++)A.push(t[o[h][0]]);return[a,A]}function LQ(t){const e=t.getFrustumPlanes(),n=aT(e.near,t.cameraPosition),i=gf(t,n),r=gf(t,t.cameraPosition,F0);let s=0;Wg.planes[s++].fromPointNormal(i,oT.copy(i).subtract(r));for(const o in e){if(o==="near")continue;const a=e[o],A=aT(a,n,F0),h=gf(t,A,F0);Wg.planes[s++].fromPointNormal(h,oT.copy(i).subtract(h))}}function aT(t,e,n=new Z){const i=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-i).add(e),n}function gf(t,e,n=new Z){const i=t.unprojectPosition(e);return $t.WGS84.cartographicToCartesian(i,n)}const RQ=6378137,OQ=6378137,Qg=6356752314245179e-9,lT=new Z;function FQ(t,e){if(t instanceof _c){const{halfAxes:n}=t,i=kQ(n);return Math.log2(Qg/(i+e[2]))}else if(t instanceof mc){const{radius:n}=t;return Math.log2(Qg/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:i}=t,r=Math.log2(RQ/n),s=Math.log2(OQ/i);return(r+s)/2}return 1}function xP(t,e,n){const i=$t.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new Z),r=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)+Math.pow(i[2]-n[2],2));return Math.log2(Qg/(r+e[2]))}function DQ(t,e,n){const[i,r,s,o]=t;return xP({xmin:i,xmax:s,ymin:r,ymax:o,zmin:0,zmax:0},e,n)}function kQ(t){t.getColumn(0,lT);const e=t.getColumn(1),n=t.getColumn(2);return lT.add(e).add(n).len()}const Jn={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},yr={ADD:1,REPLACE:2},Ca={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},tr={I3S:"I3S",TILES3D:"TILES3D"},Hh={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},NQ={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function CP(t){return t!=null}const UQ=new Z,GQ=new Z,zQ=new Z;function D0(t,e,n){if(At(t,"3D Tile: boundingVolume must be defined"),t.box)return VQ(t.box,e,n);if(t.region){const[i,r,s,o,a,A]=t.region,h=$t.WGS84.cartographicToCartesian([Wl(i),Wl(o),a],GQ),p=$t.WGS84.cartographicToCartesian([Wl(s),Wl(r),A],zQ),m=new Z().addVectors(h,p).multiplyScalar(.5),y=new Z().subVectors(h,p).len()/2;return AT([m[0],m[1],m[2],y],new Ue)}if(t.sphere)return AT(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function VQ(t,e,n){const i=new Z(t[0],t[1],t[2]);e.transform(i,i);let r=[];if(t.length===10){const h=t.slice(3,6),p=new DA;p.fromArray(t,6);const m=new Z([1,0,0]),y=new Z([0,1,0]),T=new Z([0,0,1]);m.transformByQuaternion(p),m.scale(h[0]),y.transformByQuaternion(p),y.scale(h[1]),T.transformByQuaternion(p),T.scale(h[2]),r=[...m.toArray(),...y.toArray(),...T.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const s=e.transformAsVector(r.slice(0,3)),o=e.transformAsVector(r.slice(3,6)),a=e.transformAsVector(r.slice(6,9)),A=new qt([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return CP(n)?(n.center=i,n.halfAxes=A,n):new _c(i,A)}function AT(t,e,n){const i=new Z(t[0],t[1],t[2]);e.transform(i,i);const r=e.getScale(UQ),s=Math.max(Math.max(r[0],r[1]),r[2]),o=t[3]*s;return CP(n)?(n.center=i,n.radius=o,n):new mc(i,o)}new Z;new Z;new Ue;new Z;new Z;new Z;function jQ(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function HQ(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return jQ(e,n)*i}return 0}function WQ(t,e,n){const i=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=n?r:t.lodMetricValue;if(s===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:A}=e,{viewDistanceScale:h}=i.options;let p=s*a*(h||1)/(o*A);return p-=HQ(i,o),p}const k0=new Z,cT=new Z,Xr=new Z,uT=new Z,QQ=new Z,N0=new Ue,fT=new Ue;function XQ(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*SP(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function SP(t,e){const{topDownViewport:n}=e,i=t.header.mbs[1],r=t.header.mbs[0],s=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],A=n.unprojectPosition(n.cameraPosition);$t.WGS84.cartographicToCartesian(A,k0),cT.copy(k0).subtract(a).normalize(),$t.WGS84.eastNorthUpToFixedFrame(a,N0),fT.copy(N0).invert(),Xr.copy(k0).transform(fT);const h=Math.sqrt(Xr[0]*Xr[0]+Xr[1]*Xr[1]),p=h*h/Xr[2];uT.copy([Xr[0],Xr[1],p]);const y=uT.transform(N0).subtract(a).normalize(),b=cT.cross(y).normalize().scale(o).add(a),C=$t.WGS84.cartesianToCartographic(b),R=n.project([r,i,s]),S=n.project(C);return QQ.copy(R).subtract(S).magnitude()}function JQ(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class hT{constructor(e=0){w(this,"_map",new Map),w(this,"_array",void 0),w(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return At(e<this._array.length),this._array[e]}set(e,n){At(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){At(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){At(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const YQ={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Wh{traversalFinished(e){return!0}constructor(e){w(this,"options",void 0),w(this,"root",void 0),w(this,"requestedTiles",void 0),w(this,"selectedTiles",void 0),w(this,"emptyTiles",void 0),w(this,"lastUpdate",new Date().getTime()),w(this,"updateDebounceTime",1e3),w(this,"_traversalStack",void 0),w(this,"_emptyTraversalStack",void 0),w(this,"_frameNumber",void 0),this.options={...YQ,...e},this._traversalStack=new hT,this._emptyTraversalStack=new hT,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(e,n,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const s=i.pop();let o=!1;this.canTraverse(s,n)&&(this.updateChildTiles(s,n),o=this.updateAndPushChildren(s,n,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const a=s.parent,A=Boolean(!a||a._shouldRefine),h=!o;s.hasRenderContent?s.refine===yr.ADD?(this.loadTile(s,n),this.selectTile(s,n)):s.refine===yr.REPLACE&&(this.loadTile(s,n),h&&this.selectTile(s,n)):(this.emptyTiles[s.id]=s,this.loadTile(s,n),h&&this.selectTile(s,n)),this.touchTile(s,n),s._shouldRefine=o&&A}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const i=e.children;for(const r of i)this.updateTile(r,n);return!0}updateAndPushChildren(e,n,i,r){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const A=e.refine===yr.REPLACE&&e.hasRenderContent&&!o;let h=!1,p=!0;for(const m of a)if(m._selectionDepth=r,m.isVisibleAndInRequestVolume?(i.find(m)&&i.delete(m),i.push(m),h=!0):(A||s)&&(this.loadTile(m,n),this.touchTile(m,n)),A){let y;if(m._inRequestVolume?m.hasRenderContent?y=m.contentAvailable:y=this.executeEmptyTraversal(m,n):y=!1,p=p&&y,!p)return!1}return h||(p=!1),p}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n,i=!1,r=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!r&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n,i){let r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(n,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const i=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&i.push(r);else i.push(n.viewport.id);e.updateVisibility(n,i)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let i=!1;for(const r of e.children)r.updateVisibility(n),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,n){let i=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0&&i;){const s=r.pop();if(this.updateTile(s,n),s.isVisibleAndInRequestVolume||this.loadTile(s,n),this.touchTile(s,n),!s.hasRenderContent&&this.canTraverse(s,n,!1,!0)){const a=s.children;for(const A of a)r.find(A)&&r.delete(A),r.push(A)}else s.contentAvailable||(i=!1)}return i}}const dT=new Z;function KQ(t){return t!=null}class Xg{constructor(e,n,i,r=""){w(this,"tileset",void 0),w(this,"header",void 0),w(this,"id",void 0),w(this,"url",void 0),w(this,"parent",void 0),w(this,"refine",void 0),w(this,"type",void 0),w(this,"contentUrl",void 0),w(this,"lodMetricType",void 0),w(this,"lodMetricValue",void 0),w(this,"boundingVolume",void 0),w(this,"content",void 0),w(this,"contentState",void 0),w(this,"gpuMemoryUsageInBytes",void 0),w(this,"children",void 0),w(this,"depth",void 0),w(this,"viewportIds",void 0),w(this,"transform",void 0),w(this,"extensions",void 0),w(this,"userData",void 0),w(this,"computedTransform",void 0),w(this,"hasEmptyContent",void 0),w(this,"hasTilesetContent",void 0),w(this,"traverser",void 0),w(this,"_cacheNode",void 0),w(this,"_frameNumber",void 0),w(this,"_lodJudge",void 0),w(this,"_expireDate",void 0),w(this,"_expiredContent",void 0),w(this,"_shouldRefine",void 0),w(this,"_distanceToCamera",void 0),w(this,"_centerZDepth",void 0),w(this,"_screenSpaceError",void 0),w(this,"_visibilityPlaneMask",void 0),w(this,"_visible",void 0),w(this,"_inRequestVolume",void 0),w(this,"_stackLength",void 0),w(this,"_selectionDepth",void 0),w(this,"_touchedFrame",void 0),w(this,"_visitedFrame",void 0),w(this,"_selectedFrame",void 0),w(this,"_requestedFrame",void 0),w(this,"_priority",void 0),w(this,"_contentBoundingVolume",void 0),w(this,"_viewerRequestVolume",void 0),w(this,"_initialTransform",void 0),this.header=n,this.tileset=e,this.id=r||n.id,this.url=n.url,this.parent=i,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=Jn.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new Wh({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new Ue,this.transform=new Ue,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Jn.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Jn.UNLOADED}get contentExpired(){return this.contentState===Jn.EXPIRED}get contentFailed(){return this.contentState===Jn.FAILED}getScreenSpaceError(e,n){switch(this.tileset.type){case tr.I3S:return SP(this,e);case tr.TILES3D:return WQ(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,i=this.refine===yr.ADD||n;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Jn.UNLOADED)return-1;const r=this.parent,o=r&&(!i||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Jn.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=Jn.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,s={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await xr(i,r,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Jn.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Jn.FAILED,i}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Jn.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const i=this.parent,r=i?i._visibilityPlaneMask:qn.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==qn.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const n=this.boundingVolume;return dT.subVectors(n.center,e.position),e.direction.dot(dT)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(KQ(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Jn.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Ue(e.transform):new Ue;const n=this.parent,i=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Ue(r).multiplyRight(this.transform);const s=n&&n._initialTransform?n._initialTransform.clone():new Ue;this._initialTransform=new Ue(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Jn.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=qn.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||yr.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(e){this.boundingVolume=D0(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=D0(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=D0(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Ue){const n=e.clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return JQ(this.tileset.tileset)}}}class ZQ extends Wh{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const r=e.refine===yr.REPLACE,s=e._optimChildrenWithinParent===NQ.USE_OPTIMIZATION;if(r&&s&&i&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==yr.ADD?!1:!this.shouldRefine(e,n,!0)}}class qQ{constructor(){w(this,"frameNumberMap",new Map)}register(e,n){const i=this.frameNumberMap.get(e)||new Map,r=i.get(n)||0;i.set(n,r+1),this.frameNumberMap.set(e,i)}deregister(e,n){const i=this.frameNumberMap.get(e);if(!i)return;const r=i.get(n)||1;i.set(n,r-1)}isZero(e,n){var i;return(((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(n))||0)===0}}const U0={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class $Q{constructor(){w(this,"_statusMap",void 0),w(this,"pendingTilesRegister",new qQ),this._statusMap={}}add(e,n,i,r){if(!this._statusMap[n]){const{frameNumber:s,viewport:{id:o}}=r;this._statusMap[n]={request:e,callback:i,key:n,frameState:r,status:U0.REQUESTED},this.pendingTilesRegister.register(o,s),e().then(a=>{this._statusMap[n].status=U0.COMPLETED;const{frameNumber:A,viewport:{id:h}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(h,A),this._statusMap[n].callback(a,r)}).catch(a=>{this._statusMap[n].status=U0.ERROR;const{frameNumber:A,viewport:{id:h}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(h,A),i(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i);const{frameNumber:s,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,s),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class eX extends Wh{traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}constructor(e){super(e),w(this,"_tileManager",void 0),this._tileManager=new $Q}shouldRefine(e,n){return e._lodJudge=XQ(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const i=e.header.children||[],r=e.children,s=e.tileset;for(const o of i){const a="".concat(o.id,"-").concat(n.viewport.id),A=r&&r.find(h=>h.id===a);if(A)A&&this.updateTile(A,n);else{let h=()=>this._loadTile(o.id,s);this._tileManager.find(a)?this._tileManager.update(a,n):(s.tileset.nodePages&&(h=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(h,a,m=>this._onTileLoad(m,e,a),n))}}return!1}async _loadTile(e,n){const{loader:i}=n,r=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),s={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0,loadContent:!1}};return await xr(r,i,s)}_onTileLoad(e,n,i){const r=new Xg(n.tileset,e,n,i);n.children.push(r);const s=this._tileManager.find(r.id).frameState;this.updateTile(r,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,s)}}const tX={description:"",ellipsoid:$t.WGS84,modelMatrix:new Ue,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Fu="Tiles In Tileset(s)",G0="Tiles In Memory",pT="Tiles In View",gT="Tiles To Render",mT="Tiles Loaded",z0="Tiles Loading",_T="Tiles Unloaded",vT="Failed Tile Loads",yT="Points/Vertices",V0="Tile Memory Use";class nX{constructor(e,n){w(this,"options",void 0),w(this,"loadOptions",void 0),w(this,"type",void 0),w(this,"tileset",void 0),w(this,"loader",void 0),w(this,"url",void 0),w(this,"basePath",void 0),w(this,"modelMatrix",void 0),w(this,"ellipsoid",void 0),w(this,"lodMetricType",void 0),w(this,"lodMetricValue",void 0),w(this,"refine",void 0),w(this,"root",void 0),w(this,"roots",void 0),w(this,"asset",void 0),w(this,"description",void 0),w(this,"properties",void 0),w(this,"extras",void 0),w(this,"attributions",void 0),w(this,"credits",void 0),w(this,"stats",void 0),w(this,"traverseCounter",void 0),w(this,"geometricError",void 0),w(this,"selectedTiles",void 0),w(this,"updatePromise",null),w(this,"tilesetInitializationPromise",void 0),w(this,"cartographicCenter",void 0),w(this,"cartesianCenter",void 0),w(this,"zoom",void 0),w(this,"boundingVolume",void 0),w(this,"gpuMemoryUsageInBytes",void 0),w(this,"dynamicScreenSpaceErrorComputedDensity",void 0),w(this,"_traverser",void 0),w(this,"_cache",void 0),w(this,"_requestScheduler",void 0),w(this,"_frameNumber",void 0),w(this,"_queryParamsString",void 0),w(this,"_queryParams",void 0),w(this,"_extensionsUsed",void 0),w(this,"_tiles",void 0),w(this,"_pendingCount",void 0),w(this,"lastUpdatedVieports",void 0),w(this,"_requestedTiles",void 0),w(this,"_emptyTiles",void 0),w(this,"frameStateData",void 0),w(this,"maximumMemoryUsage",void 0),At(e),this.options={...tX,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||mx(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new PQ,this._requestScheduler=new gx({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new sc({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return this._queryParamsString||(this._queryParamsString=iX(this._queryParams)),this._queryParamsString}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const i=[];for(const r of n){const s=r.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(const r of n){const s=r.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;const o=MQ(r,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[s,o]=BQ(r,e,this.options.maximumTilesSelected);i.selectedTiles=s;for(const a of o)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const i=new Set(e.map(o=>o.id)),r=new Set(n.map(o=>o.id));let s=e.filter(o=>!r.has(o.id)).length>0;return s=s||n.filter(o=>!i.has(o.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?n+=i.content.pointCount:n+=i.content.vertexCount);this.stats.get(pT).count=this.selectedTiles.length,this.stats.get(gT).count=e,this.stats.get(yT).count=n}async _initializeTileSet(e){this.type===tr.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===tr.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===tr.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:s,ymin:o,ymax:a,zmin:A,zmax:h}=n;this.cartographicCenter=new Z(r+(s-r)/2,o+(a-o)/2,A+(h-A)/2),this.cartesianCenter=$t.WGS84.cartographicToCartesian(this.cartographicCenter,new Z),this.zoom=xP(n,this.cartographicCenter,this.cartesianCenter);return}const i=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(i){const[r,s,o,a]=i;this.cartographicCenter=new Z(r+(o-r)/2,s+(a-s)/2,0),this.cartesianCenter=$t.WGS84.cartographicToCartesian(this.cartographicCenter,new Z),this.zoom=DQ(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Z,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root;At(e);const{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Z,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=$t.WGS84.cartesianToCartographic(n,new Z):this.cartographicCenter=new Z(0,0,-$t.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=FQ(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Fu),this.stats.get(z0),this.stats.get(G0),this.stats.get(pT),this.stats.get(gT),this.stats.get(mT),this.stats.get(_T),this.stats.get(vT),this.stats.get(yT),this.stats.get(V0,"memory")}_initializeTileHeaders(e,n){const i=new Xg(this,e.root,n);if(n&&(n.children.push(i),i.depth=n.depth+1),this.type===tr.TILES3D){const r=[];for(r.push(i);r.length>0;){const s=r.pop();this.stats.get(Fu).incrementCount();const o=s.header.children||[];for(const a of o){const A=new Xg(this,a,s);s.children.push(A),A.depth=s.depth+1,r.push(A)}}}return i}_initializeTraverser(){let e;switch(this.type){case tr.TILES3D:e=ZQ;break;case tr.I3S:e=eX;break;default:e=Wh}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(i){this._onTileLoadError(e,i)}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(vT).incrementCount();const i=n.message||n.toString(),r=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,r)}_onTileLoad(e,n){if(n){if(this.type===tr.I3S){var i,r;const s=((i=this.tileset)===null||i===void 0||(r=i.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(Fu).reset(),this.stats.get(Fu).addCount(s)}e&&e.content&&IQ(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(z0).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(z0).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(mT).incrementCount(),this.stats.get(G0).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get(V0).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.content&&e.content.byteLength||0,this.stats.get(G0).decrementCount(),this.stats.get(_T).incrementCount(),this.stats.get(V0).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const i of n.children)e.push(i);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,i=[];for(i.push(n);i.length>0;){e=i.pop();for(const r of e.children)i.push(r);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}function iX(t){const e=[];for(const n of Object.keys(t))e.push("".concat(n,"=").concat(t[n]));switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}const PP="3.2.13",kl={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function IP(t,e,n){At(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return i.decode(r)}function rX(t,e=0){const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const sX={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},jt={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},it={...sX,...jt},j0={[jt.DOUBLE]:Float64Array,[jt.FLOAT]:Float32Array,[jt.UNSIGNED_SHORT]:Uint16Array,[jt.UNSIGNED_INT]:Uint32Array,[jt.UNSIGNED_BYTE]:Uint8Array,[jt.BYTE]:Int8Array,[jt.SHORT]:Int16Array,[jt.INT]:Int32Array},oX={DOUBLE:jt.DOUBLE,FLOAT:jt.FLOAT,UNSIGNED_SHORT:jt.UNSIGNED_SHORT,UNSIGNED_INT:jt.UNSIGNED_INT,UNSIGNED_BYTE:jt.UNSIGNED_BYTE,BYTE:jt.BYTE,SHORT:jt.SHORT,INT:jt.INT},H0="Failed to convert GL type";class sr{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in j0)if(j0[n]===e)return n;throw new Error(H0)}static fromName(e){const n=oX[e];if(!n)throw new Error(H0);return n}static getArrayType(e){switch(e){case jt.UNSIGNED_SHORT_5_6_5:case jt.UNSIGNED_SHORT_4_4_4_4:case jt.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=j0[e];if(!n)throw new Error(H0);return n}}static getByteSize(e){return sr.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(sr.getArrayType(e))}static createTypedArray(e,n,i=0,r){r===void 0&&(r=(n.byteLength-i)/sr.getByteSize(e));const s=sr.getArrayType(e);return new s(n,i,r)}}function aX(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function lX(t,e=[0,0,0]){const n=t>>11&31,i=t>>5&63,r=t&31;return e[0]=n<<3,e[1]=i<<2,e[2]=r<<3,e}new f_;new Z;new f_;new f_;function ET(t,e=255){return rn(t,0,e)/e*2-1}function TT(t){return t<0?-1:1}function AX(t,e,n,i){if(aX(i),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=ET(t,n),i.y=ET(e,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const r=i.x;i.x=(1-Math.abs(i.y))*TT(r),i.y=(1-Math.abs(r))*TT(i.y)}return i.normalize()}function cX(t,e,n){return AX(t,e,255,n)}class Z_{constructor(e,n){w(this,"json",void 0),w(this,"buffer",void 0),w(this,"featuresLength",0),w(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,n=it.UNSIGNED_INT,i=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,n,i,1,r.byteOffset):r}getPropertyArray(e,n,i){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=sr.fromName(r.componentType)),this._getTypedArrayFromBinary(e,n,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,n,r)}getProperty(e,n,i,r,s){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,i);if(i===1)return a[r];for(let A=0;A<i;++A)s[A]=a[i*r+A];return s}_getTypedArrayFromBinary(e,n,i,r,s){const o=this._cachedTypedArrays;let a=o[e];return a||(a=sr.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+s,r*i),o[e]=a),a}_getTypedArrayFromArray(e,n,i){const r=this._cachedTypedArrays;let s=r[e];return s||(s=sr.createTypedArray(n,i),r[e]=s),s}}const uX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},fX={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},hX={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function dX(t,e,n,i){const{componentType:r}=t;At(t.componentType);const s=typeof r=="string"?sr.fromName(r):r,o=uX[t.type],a=fX[t.type],A=hX[t.type];return n+=t.byteOffset,{values:sr.createTypedArray(s,e,n,o*i),type:s,size:o,unpacker:a,packer:A}}const rr=t=>t!==void 0;function pX(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?gX(i,n):null}function gX(t,e){let n,i,r;const s=t.instancesLength,o=t.classes;let a=t.classIds,A=t.parentCounts,h=t.parentIds,p=s;rr(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,r=getBinaryAccessor(a),a=r.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let m;if(rr(A))for(rr(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,r=getBinaryAccessor(A),A=r.createArrayBufferView(e.buffer,e.byteOffset+A.byteOffset,s)),m=new Uint16Array(s),p=0,n=0;n<s;++n)m[n]=p,p+=A[n];rr(h)&&rr(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,p));const y=o.length;for(n=0;n<y;++n){const R=o[n].length,S=o[n].instances,P=getBinaryProperties(R,S,e);o[n].instances=combine(P,S)}const T=new Array(y).fill(0),b=new Uint16Array(s);for(n=0;n<s;++n)i=a[n],b[n]=T[i],++T[i];const C={classes:o,classIds:a,classIndexes:b,parentCounts:A,parentIndexes:m,parentIds:h};return vX(C),C}function Nl(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?mX(t,e,n):_X(t,e,n)}function mX(t,e,n){const i=t.classIds,r=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=i.length,A=scratchVisited;A.length=Math.max(A.length,a);const h=++marker,p=scratchStack;for(p.length=0,p.push(e);p.length>0;){if(e=p.pop(),A[e]===h)continue;A[e]=h;const m=n(t,e);if(rr(m))return m;const y=r[e],T=o[e];for(let b=0;b<y;++b){const C=s[T+b];C!==e&&p.push(C)}}return null}function _X(t,e,n){let i=!0;for(;i;){const r=n(t,e);if(rr(r))return r;const s=t.parentIds[e];i=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function vX(t){const n=t.classIds.length;for(let i=0;i<n;++i)MP(t,i,stack)}function MP(t,e,n){const i=t.parentCounts,r=t.parentIds,s=t.parentIndexes,a=t.classIds.length;if(!rr(r))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const A=rr(i)?i[e]:1,h=rr(i)?s[e]:e;for(let p=0;p<A;++p){const m=r[h+p];m!==e&&MP(t,m,n)}n.pop(e)}function On(t){return t!=null}const Du=(t,e)=>t,yX={HIERARCHY:!0,extensions:!0,extras:!0};class BP{constructor(e,n,i,r={}){var s;w(this,"json",void 0),w(this,"binary",void 0),w(this,"featureCount",void 0),w(this,"_extensions",void 0),w(this,"_properties",void 0),w(this,"_binaryProperties",void 0),w(this,"_hierarchy",void 0),At(i>=0),this.json=e||{},this.binary=n,this.featureCount=i,this._extensions=((s=this.json)===null||s===void 0?void 0:s.extensions)||{},this._properties={};for(const o in this.json)yX[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=pX(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),At(typeof n=="string",n),this._hierarchy){const i=Nl(this._hierarchy,e,(r,s)=>{const o=r.classIds[s];return r.classes[o].name===n});return On(i)}return!1}isExactClass(e,n){return At(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),At(typeof n=="string",n),On(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=On(n)?n:[],n.length=0;const i=Object.keys(this._properties);return n.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),At(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(On(r))return this._getBinaryProperty(r,e)}const i=this._properties[n];if(On(i))return Du(i[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,n);if(On(r))return r}}setProperty(e,n,i){const r=this.featureCount;if(this._checkBatchId(e),At(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,i))return;let s=this._properties[n];On(s)||(this._properties[n]=new Array(r),s=this._properties[n]),s[e]=Du(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,i){e.pack(i,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const i=this._properties[n],r=this._initializeBinaryProperty(n,i);r&&(e=e||{},e[n]=r)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const i=n;At(this.binary,"Property ".concat(e," requires a batch table binary.")),At(i.type,"Property ".concat(e," requires a type."));const r=dX(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const i=Nl(this._hierarchy,e,(r,s)=>{const o=r.classIds[s],a=r.classes[o].instances;return On(a[n])});return On(i)}_getPropertyNamesInHierarchy(e,n){Nl(this._hierarchy,e,(i,r)=>{const s=i.classIds[r],o=i.classes[s].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return Nl(this._hierarchy,e,(i,r)=>{const s=i.classIds[r],o=i.classes[s],a=i.classIndexes[r],A=o.instances[n];return On(A)?On(A.typedArray)?this._getBinaryProperty(A,a):Du(A[a]):null})}_setHierarchyProperty(e,n,i,r){const s=Nl(this._hierarchy,n,(o,a)=>{const A=o.classIds[a],h=o.classes[A],p=o.classIndexes[a],m=h.instances[i];return On(m)?(At(a===n,'Inherited property "'.concat(i,'" is read-only.')),On(m.typedArray)?this._setBinaryProperty(m,p,r):m[p]=Du(r),!0):!1});return On(s)}}const W0=4;function Qh(t,e,n=0){const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=W0,t.version=i.getUint32(n,!0),n+=W0,t.byteLength=i.getUint32(n,!0),n+=W0,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const jo=4,wT="b3dm tile in legacy format.";function q_(t,e,n){const i=new DataView(e);let r;t.header=t.header||{};let s=i.getUint32(n,!0);n+=jo;let o=i.getUint32(n,!0);n+=jo;let a=i.getUint32(n,!0);n+=jo;let A=i.getUint32(n,!0);return n+=jo,a>=570425344?(n-=jo*2,r=s,a=o,A=0,s=0,o=0,console.warn(wT)):A>=570425344&&(n-=jo,r=a,a=s,A=o,s=0,o=0,console.warn(wT)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=A,t.header.batchLength=r,n}function $_(t,e,n,i){return n=EX(t,e,n),n=TX(t,e,n),n}function EX(t,e,n,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:s,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},r>0){const a=IP(e,n,r);t.featureTableJson=JSON.parse(a)}return n+=r,t.featureTableBinary=new Uint8Array(e,n,s),n+=s,n}function TX(t,e,n,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:s}=t.header;if(r>0){const o=IP(e,n,r);t.batchTableJson=JSON.parse(o),n+=r,s>0&&(t.batchTableBinary=new Uint8Array(e,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}function LP(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:i,isRGB565:r,pointCount:s}=t;if(i&&n){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const A=i[a],p=n.getProperty(A,"dimensions").map(m=>m*255);o[a*3]=p[0],o[a*3+1]=p[1],o[a*3+2]=p[2]}return{type:it.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(r){const o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const A=lX(e[a]);o[a*3]=A[0],o[a*3+1]=A[1],o[a*3+2]=A[2]}return{type:it.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===s*3?{type:it.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:it.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const bT=new Z;function wX(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let i=0;i<t.pointsLength;i++)cX(e[i*2],e[i*2+1],bT),bT.toArray(n,i*3);return{type:it.FLOAT,size:2,value:n}}return{type:it.FLOAT,size:2,value:e}}function bX(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,xX(t,e)):{type:it.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function xX(t,e){const n=new Z,i=new Float32Array(t.pointCount*3);for(let r=0;r<t.pointCount;r++)n.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,r*3);return i}async function CX(t,e,n,i,r){n=Qh(t,e,n),n=q_(t,e,n),n=$_(t,e,n),SX(t);const{featureTable:s,batchTable:o}=PX(t);return await RX(t,s,o,i,r),IX(t,s,i),MX(t,s,o),BX(t,s),n}function SX(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function PX(t){const e=new Z_(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",it.FLOAT,3);const i=LX(t,e);return{featureTable:e,batchTable:i}}function IX(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",it.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",it.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=(1<<16)-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",it.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",it.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=bX(t,i,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function MX(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",it.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",it.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",it.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=LP(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",it.UNSIGNED_BYTE,4))}function BX(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",it.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",it.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=wX(t,n)}}function LX(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",it.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=t;n=new BP(r,s,i)}return n}async function RX(t,e,n,i,r){let s,o,a;const A=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];A&&(a=A.properties);const h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const m=h.byteOffset,y=h.byteLength;if(!o||!Number.isFinite(m)||!y)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(m,m+y),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const p={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await OX(t,p,i,r)}async function OX(t,e,n,i){const{parse:r}=i,s={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const o=await r(e.buffer,vP,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,A=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,h=o.attributes.NORMAL&&o.attributes.NORMAL.value,p=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,m=a&&o.attributes.POSITION.value.quantization,y=h&&o.attributes.NORMAL.value.quantization;if(m){const b=o.POSITION.data.quantization,C=b.range;t.quantizedVolumeScale=new Z(C,C,C),t.quantizedVolumeOffset=new Z(b.minValues),t.quantizedRange=(1<<b.quantizationBits)-1,t.isQuantizedDraco=!0}y&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const T={};if(e.batchTableProperties)for(const b of Object.keys(e.batchTableProperties))o.attributes[b]&&o.attributes[b].value&&(T[b.toLowerCase()]=o.attributes[b].value);t.attributes={positions:a,colors:LP(t,A,void 0),normals:h,batchIds:p,...T}}const Jg={URI:0,EMBEDDED:1};function RP(t,e,n,i){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Xm(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function OP(t,e,n,i){const r=n["3d-tiles"]||{};if(FX(t,e),r.loadGLTF){const{parse:s,fetch:o}=i;t.gltfUrl&&(t.gltfArrayBuffer=await o(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await s(t.gltfArrayBuffer,ZA,n,i),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function FX(t,e,n){switch(e){case Jg.URI:const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(i);t.gltfUrl=s.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Jg.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function DX(t,e,n,i,r){var s;n=kX(t,e,n,i),await OP(t,Jg.EMBEDDED,i,r);const o=t==null||(s=t.gltf)===null||s===void 0?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}function kX(t,e,n,i,r){n=Qh(t,e,n),n=q_(t,e,n),n=$_(t,e,n),n=RP(t,e,n,i);const s=new Z_(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",it.FLOAT,3),n}async function NX(t,e,n,i,r){return n=UX(t,e,n,i),await OP(t,t.gltfFormat,i,r),n}function UX(t,e,n,i,r){if(n=Qh(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=q_(t,e,n);const s=new DataView(e);if(t.gltfFormat=s.getUint32(n,!0),n+=4,n=$_(t,e,n),n=RP(t,e,n,i),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Z_(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",it.FLOAT,3);const A=new BP(t.batchTableJson,t.batchTableBinary,a);return GX(t,o,A,a),n}function GX(t,e,n,i){const s={instances:new Array(i),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new Z;new Z,new Z,new Z;const a=new qt,A=new DA,h=new Z,p={},m=new Ue,y=[],T=[],b=new Z,C=new Z;for(let R=0;R<i;R++){let S;if(e.hasProperty("POSITION"))S=e.getProperty("POSITION",it.FLOAT,3,R,o);else if(e.hasProperty("POSITION_QUANTIZED")){S=e.getProperty("POSITION_QUANTIZED",it.UNSIGNED_SHORT,3,R,o);const q=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",it.FLOAT,3,b);if(!q)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ee=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",it.FLOAT,3,C);if(!ee)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Q=65535;for(let V=0;V<3;V++)S[V]=S[V]/Q*ee[V]+q[V]}if(!S)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(S),p.translation=o,t.normalUp=e.getProperty("NORMAL_UP",it.FLOAT,3,R,y),t.normalRight=e.getProperty("NORMAL_RIGHT",it.FLOAT,3,R,T),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",it.UNSIGNED_SHORT,2,y),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",it.UNSIGNED_SHORT,2,T),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?($t.WGS84.eastNorthUpToFixedFrame(o,m),m.getRotationMatrix3(a)):a.identity()}A.fromMatrix3(a),p.rotation=A,h.set(1,1,1);const P=e.getProperty("SCALE",it.FLOAT,1,R);Number.isFinite(P)&&h.multiplyByScalar(P);const I=e.getProperty("SCALE_NON_UNIFORM",it.FLOAT,3,R,y);I&&h.scale(I),p.scale=h;let F=e.getProperty("BATCH_ID",it.UNSIGNED_SHORT,1,R);F===void 0&&(F=R);const j=new Ue().fromQuaternion(p.rotation);m.identity(),m.translate(p.translation),m.multiplyRight(j),m.scale(p.scale);const X=m.clone();s[R]={modelMatrix:X,batchId:F}}t.instances=s}async function zX(t,e,n,i,r,s){n=Qh(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const a={};t.tiles.push(a),n=await s(e,n,i,r,a)}return n}async function VX(t,e,n,i){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:r}=i;t.gltf=await r(e,ZA,n,i)}async function FP(t,e=0,n,i,r={}){switch(r.byteOffset=e,r.type=rX(t,e),r.type){case kl.COMPOSITE:return await zX(r,t,e,n,i,FP);case kl.BATCHED_3D_MODEL:return await DX(r,t,e,n,i);case kl.GLTF:return await VX(r,t,n,i);case kl.INSTANCED_3D_MODEL:return await NX(r,t,e,n,i);case kl.POINT_CLOUD:return await CX(r,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}const jX=1952609651,HX=1;async function WX(t){if(new Uint32Array(t.slice(0,4))[0]!==jX)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==HX)throw new Error("Wrong subtree file verson, must be 1");const i=xT(t.slice(8,16)),r=new Uint8Array(t,24,i),o=new TextDecoder("utf8").decode(r),a=JSON.parse(o),A=xT(t.slice(16,24));let h=new ArrayBuffer(0);return A&&(h=t.slice(24+i)),"bufferView"in a.tileAvailability&&(a.tileAvailability.explicitBitstream=await Q0(a,"tileAvailability",h)),"bufferView"in a.contentAvailability&&(a.contentAvailability.explicitBitstream=await Q0(a,"contentAvailability",h)),"bufferView"in a.childSubtreeAvailability&&(a.childSubtreeAvailability.explicitBitstream=await Q0(a,"childSubtreeAvailability",h)),a}async function Q0(t,e,n){const i=t[e].bufferView,r=t.bufferViews[i],s=t.buffers[r.buffer];if(s.uri){const a=await(await eg(s.uri)).arrayBuffer();return new Uint8Array(a,r.byteOffset,r.byteLength)}return new Uint8Array(n,r.byteOffset,r.byteLength)}function xT(t){const e=new DataView(t),n=e.getUint32(0,!0),i=e.getUint32(4,!0);return n+2**32*i}const DP={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:PP,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:WX,options:{}},QX=4,XX=8,JX={QUADTREE:QX,OCTREE:XX};async function kP(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:r={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;let{subtree:s,level:o=0}=t;const{subdivisionScheme:a,subtreeLevels:A,maximumLevel:h,contentUrlTemplate:p,subtreesUriTemplate:m,basePath:y}=e,T={children:[],lodMetricValue:0,contentUrl:""},b=JX[a],C=i&1,R=i>>1&1,S=i>>2&1,P=(b**o-1)/(b-1);let I=Ns(n.mortonIndex,i),F=P+I,j=Ns(n.x,C),X=Ns(n.y,R),q=Ns(n.z,S),ee=!1;o+1>A&&(ee=X0(s.childSubtreeAvailability,I));const Q=Ns(r.x,j),V=Ns(r.y,X),D=Ns(r.z,q),re=o+r.level;if(ee){const Qe="".concat(y,"/").concat(m),oe=Yg(Qe,re,Q,V,D);s=await xr(oe,DP),r.mortonIndex=I,r.x=j,r.y=X,r.z=q,r.level=o,I=0,F=0,j=0,X=0,q=0,o=0}if(!X0(s.tileAvailability,F)||o>h)return T;X0(s.contentAvailability,F)&&(T.contentUrl=Yg(p,re,Q,V,D));const Be=o+1,Ye={mortonIndex:I,x:j,y:X,z:q};for(let Qe=0;Qe<b;Qe++){const oe=await kP({subtree:s,options:e,parentData:Ye,childIndex:Qe,level:Be,globalData:r});if(oe.contentUrl||oe.children.length){const ye=re+1,Le=YX(oe,ye,{childTileX:j,childTileY:X,childTileZ:q},e);T.children.push(Le)}}return T}function X0(t,e){return"constant"in t?Boolean(t.constant):t.explicitBitstream?qX(e,t.explicitBitstream):!1}function YX(t,e,n,i){const{basePath:r,refine:s,getRefine:o,lodMetricType:a,getTileType:A,rootLodMetricValue:h,rootBoundingVolume:p}=i,m=t.contentUrl&&t.contentUrl.replace("".concat(r,"/"),""),y=h/2**e,T=KX(e,p,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:m},id:t.contentUrl,refine:o(s),type:A(t),lodMetricType:a,lodMetricValue:y,boundingVolume:T}}function KX(t,e,n){if(e.region){const{childTileX:i,childTileY:r,childTileZ:s}=n,[o,a,A,h,p,m]=e.region,y=2**t,T=(A-o)/y,b=(h-a)/y,C=(m-p)/y,[R,S]=[o+T*i,o+T*(i+1)],[P,I]=[a+b*r,a+b*(r+1)],[F,j]=[p+C*s,p+C*(s+1)];return{region:[R,P,S,I,F,j]}}return console.warn("Unsupported bounding volume type: ",e),null}function Ns(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function Yg(t,e,n,i,r){const s=ZX({level:e,x:n,y:i,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function ZX(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function qX(t,e){const n=Math.floor(t/8),i=t%8;return(e[n]>>i&1)===1}function e1(t){if(!t.contentUrl)return Ca.EMPTY;const n=t.contentUrl.split(".").pop();switch(n){case"pnts":return Ca.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ca.SCENEGRAPH;default:return n}}function t1(t){switch(t){case"REPLACE":case"replace":return yr.REPLACE;case"ADD":case"add":return yr.ADD;default:return t}}function Kg(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(t,"".concat(e,"/"));return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function CT(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=Kg(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=Hh.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=e1(t),t.refine=t1(t.refine),t}function $X(t){const e=t.basePath,n=CT(t.root,t),i=[];for(i.push(n);i.length>0;){const s=(i.pop()||{}).children||[];for(const o of s)CT(o,{basePath:e}),i.push(o)}return n}async function eJ(t){if(!t.root)return null;const e=t.basePath,n=t.root.extensions["3DTILES_implicit_tiling"],{subdivisionScheme:i,maximumLevel:r,subtreeLevels:s,subtrees:{uri:o}}=n,a=Yg(o,0,0,0,0),A=Kg(a,e),h=await xr(A,DP),p=Kg(t.root.content.uri,e),m=t.root.refine,y=t.root.geometricError,T=t.root.boundingVolume,b={contentUrlTemplate:p,subtreesUriTemplate:o,subdivisionScheme:i,subtreeLevels:s,maximumLevel:r,refine:m,basePath:e,lodMetricType:Hh.GEOMETRIC_ERROR,rootLodMetricValue:y,rootBoundingVolume:T,getTileType:e1,getRefine:t1};return await tJ(t.root,h,b)}async function tJ(t,e,n){if(!t)return null;t.lodMetricType=Hh.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:i,contentUrl:r}=await kP({subtree:e,options:n});return r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(n.basePath,"/"),"")}),t.refine=t1(t.refine),t.type=e1(t),t.children=i,t.id=t.contentUrl,t}const ST="3DTILES_implicit_tiling",NP={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:PP,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:sJ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function nJ(t){return mx(t.url)}async function iJ(t,e,n){const i={content:{featureIds:null}};return await FP(t,0,e,n,i.content),i.content}async function rJ(t,e,n){var i;const r=JSON.parse(new TextDecoder().decode(t));return r.loader=e.loader||NP,r.url=n.url,r.basePath=nJ(r),r.root=oJ(r)?await eJ(r):$X(r),r.type=tr.TILES3D,r.lodMetricType=Hh.GEOMETRIC_ERROR,r.lodMetricValue=((i=r.root)===null||i===void 0?void 0:i.lodMetricValue)||0,r}async function sJ(t,e,n){const i=e["3d-tiles"]||{};let r;return i.isTileset==="auto"?r=n.url&&n.url.indexOf(".json")!==-1:r=i.isTileset,r?t=await rJ(t,e,n):t=await iJ(t,e,n),t}function oJ(t){var e,n;return(t==null||(e=t.extensionsRequired)===null||e===void 0?void 0:e.includes(ST))&&(t==null||(n=t.extensionsUsed)===null||n===void 0?void 0:n.includes(ST))}const PT=[0],aJ={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:NP,onTilesetLoad:{type:"function",value:t=>{},compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:(t,e,n)=>{},compare:!1},_getMeshColor:{type:"function",value:t=>[255,255,255],compare:!1}};class UP extends Lr{constructor(...e){super(...e),w(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Re.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:i}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:r}=this.state;for(const s in r)r[s].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,n[e.id]=e;const r=i==null?void 0:i[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const{layerMap:i}=this.state,r=n&&n.id;if(r){const s=r.substring(this.id.length+1),o=s.substring(s.indexOf("-")+1);e.object=i[o]&&i[o].tile}return e}filterSubLayer({layer:e,viewport:n}){const{tile:i}=e.props,{id:r}=n;return i.selected&&i.viewportIds.includes(r)}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const r={loadOptions:{...n}};if(i.preload){const a=await i.preload(e,n);a.headers&&(r.loadOptions.fetch={...r.loadOptions.fetch,headers:a.headers}),Object.assign(r,a)}const s=await xr(e,i,r.loadOptions),o=new nX(s,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...r});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:i}=this.context,r=Object.keys(e).length;!i||!r||!n||n.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case Ca.POINTCLOUD:return this._makePointCloudLayer(e,n);case Ca.SCENEGRAPH:return this._make3DModelLayer(e);case Ca.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:i,pointCount:r,constantRGBA:s,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:A,normals:h,colors:p}=i;if(!A)return null;const m=n&&n.props.data||{header:{vertexCount:r},attributes:{POSITION:A,NORMAL:h,COLOR_0:p}},{pointSize:y,getPointColor:T}=this.props,b=this.getSubLayerClass("pointcloud",B_);return new b({pointSize:y},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:m,coordinateSystem:De.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:s||T,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:i,cartographicOrigin:r,modelMatrix:s}=e.content,o=this.getSubLayerClass("scenegraph",Y_);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:i||PT,scenegraph:n,coordinateSystem:De.METER_OFFSETS,coordinateOrigin:r,modelMatrix:s,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const i=e.content,{attributes:r,indices:s,modelMatrix:o,cartographicOrigin:a,coordinateSystem:A=De.METER_OFFSETS,material:h,featureIds:p}=i,{_getMeshColor:m}=this.props,y=n&&n.props.mesh||new Sn({drawMode:4,attributes:lJ(r),indices:s}),T=this.getSubLayerClass("mesh",K_);return new T(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:y,data:PT,getColor:m(e),pbrMaterial:h,modelMatrix:o,coordinateOrigin:a,coordinateSystem:A,featureIds:p,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(i=>{const r=n[i.id]=n[i.id]||{tile:i};let{layer:s}=r;return i.selected&&(s?r.needsUpdate&&(s=this._getSubLayer(i,s),r.needsUpdate=!1):s=this._getSubLayer(i)),r.layer=s,s}).filter(Boolean):null}}w(UP,"defaultProps",aJ);w(UP,"layerName","Tile3DLayer");function lJ(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const AJ=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function J0(t){return t>>1^-(t&1)}function cJ(t){let e=0;const n={};for(const[i,r]of AJ){const s=r===8?t.getFloat64:t.getFloat32;n[i]=s.call(t,e,!0),e+=r}return{header:n,headerEndPosition:e}}function uJ(t,e){let n=e;const i=3,r=t.getUint32(n,!0),s=new Uint16Array(r*i);n+=Uint32Array.BYTES_PER_ELEMENT;const o=Uint16Array.BYTES_PER_ELEMENT,a=r*o,A=n,h=A+a,p=h+a;let m=0,y=0,T=0;for(let b=0;b<r;b++)m+=J0(t.getUint16(A+o*b,!0)),y+=J0(t.getUint16(h+o*b,!0)),T+=J0(t.getUint16(p+o*b,!0)),s[b]=m,s[b+r]=y,s[b+r*2]=T;return n+=a*3,{vertexData:s,vertexDataEndPosition:n}}function Yl(t,e,n,i,r=!0){let s;if(i===2?s=new Uint16Array(t,e,n):s=new Uint32Array(t,e,n),!r)return s;let o=0;for(let a=0;a<s.length;++a){const A=s[a];s[a]=o-A,A===0&&++o}return s}function fJ(t,e,n){let i=n;const r=3,o=e.length/r>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%o!==0&&(i+=o-i%o);const a=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const A=a*3,h=Yl(t.buffer,i,A,o);return i+=A*o,{triangleIndicesEndPosition:i,triangleIndices:h}}function hJ(t,e,n){let i=n;const r=3,o=e.length/r>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,a=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const A=Yl(t.buffer,i,a,o,!1);i+=a*o;const h=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const p=Yl(t.buffer,i,h,o,!1);i+=h*o;const m=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const y=Yl(t.buffer,i,m,o,!1);i+=m*o;const T=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const b=Yl(t.buffer,i,T,o,!1);return i+=T*o,{edgeIndicesEndPosition:i,westIndices:A,southIndices:p,eastIndices:y,northIndices:b}}function dJ(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function pJ(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function gJ(t,e){const n={};if(t.byteLength<=e)return{extensions:n,extensionsEndPosition:e};let i=e;for(;i<t.byteLength;){const r=t.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;const s=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const o=new DataView(t.buffer,i,s);switch(r){case 1:{n.vertexNormals=dJ(o);break}case 2:{n.waterMask=pJ(o);break}}i+=s}return{extensions:n,extensionsEndPosition:i}}const pa={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},mJ={maxDecodingStep:pa.extensions};function _J(t,e){const n=Object.assign({},mJ,e),i=new DataView(t),{header:r,headerEndPosition:s}=cJ(i);if(n.maxDecodingStep<pa.vertices)return{header:r};const{vertexData:o,vertexDataEndPosition:a}=uJ(i,s);if(n.maxDecodingStep<pa.triangleIndices)return{header:r,vertexData:o};const{triangleIndices:A,triangleIndicesEndPosition:h}=fJ(i,o,a);if(n.maxDecodingStep<pa.edgeIndices)return{header:r,vertexData:o,triangleIndices:A};const{westIndices:p,southIndices:m,eastIndices:y,northIndices:T,edgeIndicesEndPosition:b}=hJ(i,o,h);if(n.maxDecodingStep<pa.extensions)return{header:r,vertexData:o,triangleIndices:A,westIndices:p,northIndices:T,eastIndices:y,southIndices:m};const{extensions:C}=gJ(i,b);return{header:r,vertexData:o,triangleIndices:A,westIndices:p,northIndices:T,eastIndices:y,southIndices:m,extensions:C}}function GP(t,e,n,i){const r=i?yJ(i,t.POSITION.value):vJ(e),s=new t.POSITION.value.constructor(r.length*6),o=new t.TEXCOORD_0.value.constructor(r.length*4),a=new e.constructor(r.length*6);for(let h=0;h<r.length;h++){const p=r[h];EJ({edge:p,edgeIndex:h,attributes:t,skirtHeight:n,newPosition:s,newTexcoord0:o,newTriangles:a})}t.POSITION.value=Qd(t.POSITION.value,s),t.TEXCOORD_0.value=Qd(t.TEXCOORD_0.value,o);const A=e instanceof Array?e.concat(a):Qd(e,a);return{attributes:t,triangles:A}}function vJ(t){const e=[];for(let o=0;o<t.length;o+=3)e.push([t[o],t[o+1]]),e.push([t[o+1],t[o+2]]),e.push([t[o+2],t[o]]);e.sort((o,a)=>Math.min(...o)-Math.min(...a)||Math.max(...o)-Math.max(...a));const n=[];let i=0;for(;i<e.length;){var r,s;e[i][0]===((r=e[i+1])===null||r===void 0?void 0:r[1])&&e[i][1]===((s=e[i+1])===null||s===void 0?void 0:s[0])?i+=2:(n.push(e[i]),i++)}return n}function yJ(t,e){t.westIndices.sort((i,r)=>e[3*i+1]-e[3*r+1]),t.eastIndices.sort((i,r)=>e[3*r+1]-e[3*i+1]),t.southIndices.sort((i,r)=>e[3*r]-e[3*i]),t.northIndices.sort((i,r)=>e[3*i]-e[3*r]);const n=[];for(const i in t){const r=t[i];for(let s=0;s<r.length-1;s++)n.push([r[s],r[s+1]])}return n}function EJ({edge:t,edgeIndex:e,attributes:n,skirtHeight:i,newPosition:r,newTexcoord0:s,newTriangles:o}){const a=n.POSITION.value.length,A=e*2,h=e*2+1;r.set(n.POSITION.value.subarray(t[0]*3,t[0]*3+3),A*3),r[A*3+2]=r[A*3+2]-i,r.set(n.POSITION.value.subarray(t[1]*3,t[1]*3+3),h*3),r[h*3+2]=r[h*3+2]-i,s.set(n.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),A*2),s.set(n.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),h*2);const p=e*2*3;o[p]=t[0],o[p+1]=a/3+h,o[p+2]=t[1],o[p+3]=a/3+h,o[p+4]=t[0],o[p+5]=a/3+A}function TJ(t,e,n){const{minHeight:i,maxHeight:r}=e,[s,o,a,A]=n||[0,0,1,1],h=a-s,p=A-o,m=r-i,y=t.length/3,T=new Float32Array(y*3),b=new Float32Array(y*2);for(let C=0;C<y;C++){const R=t[C]/32767,S=t[C+y]/32767,P=t[C+y*2]/32767;T[3*C+0]=R*h+s,T[3*C+1]=S*p+o,T[3*C+2]=P*m+i,b[2*C+0]=R,b[2*C+1]=S}return{POSITION:{value:T,size:3},TEXCOORD_0:{value:b,size:2}}}function wJ(t,e){if(!t)return null;const{bounds:n}=e,{header:i,vertexData:r,triangleIndices:s,westIndices:o,northIndices:a,eastIndices:A,southIndices:h}=_J(t,pa.triangleIndices);let p=s,m=TJ(r,i,n);const y=W_(m);if(e.skirtHeight){const{attributes:T,triangles:b}=GP(m,p,e.skirtHeight,{westIndices:o,northIndices:a,eastIndices:A,southIndices:h});m=T,p=b}return{loaderData:{header:{}},header:{vertexCount:p.length,boundingBox:y},mode:4,indices:{value:p,size:1},attributes:m}}function IT(t,e){return wJ(t,e["quantized-mesh"])}class bJ{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let r=i+2,s=0,o=0,a=0,A=0,h=0,p=0;for(r&1?a=A=h=n:s=o=p=n;(r>>=1)>1;){const y=s+a>>1,T=o+A>>1;r&1?(a=s,A=o,s=h,o=p):(s=a,o=A,a=h,A=p),h=y,p=T}const m=i*4;this.coords[m+0]=s,this.coords[m+1]=o,this.coords[m+2]=a,this.coords[m+3]=A}}createTile(e){return new xJ(e,this)}}class xJ{constructor(e,n){const i=n.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:i,gridSize:r}=this.martini,{terrain:s,errors:o}=this;for(let a=e-1;a>=0;a--){const A=a*4,h=i[A+0],p=i[A+1],m=i[A+2],y=i[A+3],T=h+m>>1,b=p+y>>1,C=T+b-p,R=b+h-T,S=(s[p*r+h]+s[y*r+m])/2,P=b*r+T,I=Math.abs(S-s[P]);if(o[P]=Math.max(o[P],I),a<n){const F=(p+R>>1)*r+(h+C>>1),j=(y+R>>1)*r+(m+C>>1);o[P]=Math.max(o[P],o[F],o[j])}}}getMesh(e=0){const{gridSize:n,indices:i}=this.martini,{errors:r}=this;let s=0,o=0;const a=n-1;i.fill(0);function A(T,b,C,R,S,P){const I=T+C>>1,F=b+R>>1;Math.abs(T-S)+Math.abs(b-P)>1&&r[F*n+I]>e?(A(S,P,T,b,I,F),A(C,R,S,P,I,F)):(i[b*n+T]=i[b*n+T]||++s,i[R*n+C]=i[R*n+C]||++s,i[P*n+S]=i[P*n+S]||++s,o++)}A(0,0,a,a,a,0),A(a,a,0,0,0,a);const h=new Uint16Array(s*2),p=new Uint32Array(o*3);let m=0;function y(T,b,C,R,S,P){const I=T+C>>1,F=b+R>>1;if(Math.abs(T-S)+Math.abs(b-P)>1&&r[F*n+I]>e)y(S,P,T,b,I,F),y(C,R,S,P,I,F);else{const j=i[b*n+T]-1,X=i[R*n+C]-1,q=i[P*n+S]-1;h[2*j]=T,h[2*j+1]=b,h[2*X]=C,h[2*X+1]=R,h[2*q]=S,h[2*q+1]=P,p[m++]=j,p[m++]=X,p[m++]=q}}return y(0,0,a,a,a,0),y(a,a,0,0,0,a),{vertices:h,triangles:p}}}class CJ{constructor(e,n,i=n){this.data=e,this.width=n,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;const r=n-1,s=i-1,o=this._addPoint(0,0),a=this._addPoint(r,0),A=this._addPoint(0,s),h=this._addPoint(r,s),p=this._addTriangle(h,o,A,-1,-1,-1);this._addTriangle(o,h,a,p,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,n){return this.data[this.width*n+e]}_flush(){const e=this.coords;for(let n=0;n<this._pendingLen;n++){const i=this._pending[n],r=2*this.triangles[i*3+0],s=2*this.triangles[i*3+1],o=2*this.triangles[i*3+2];this._findCandidate(e[r],e[r+1],e[s],e[s+1],e[o],e[o+1],i)}this._pendingLen=0}_findCandidate(e,n,i,r,s,o,a){const A=Math.min(e,i,s),h=Math.min(n,r,o),p=Math.max(e,i,s),m=Math.max(n,r,o);let y=Us(i,r,s,o,A,h),T=Us(s,o,e,n,A,h),b=Us(e,n,i,r,A,h);const C=r-n,R=e-i,S=o-r,P=i-s,I=n-o,F=s-e,j=Us(e,n,i,r,s,o),X=this.heightAt(e,n)/j,q=this.heightAt(i,r)/j,ee=this.heightAt(s,o)/j;let Q=0,V=0,D=0,re=0;for(let le=h;le<=m;le++){let pe=0;y<0&&S!==0&&(pe=Math.max(pe,Math.floor(-y/S))),T<0&&I!==0&&(pe=Math.max(pe,Math.floor(-T/I))),b<0&&C!==0&&(pe=Math.max(pe,Math.floor(-b/C)));let Be=y+S*pe,Ye=T+I*pe,Qe=b+C*pe,oe=!1;for(let ye=A+pe;ye<=p;ye++){if(Be>=0&&Ye>=0&&Qe>=0){oe=!0;const Ce=X*Be+q*Ye+ee*Qe,Le=Math.abs(Ce-this.heightAt(ye,le));re+=Le*Le,Le>Q&&(Q=Le,V=ye,D=le)}else if(oe)break;Be+=S,Ye+=I,Qe+=C}y+=P,T+=F,b+=R}(V===e&&D===n||V===i&&D===r||V===s&&D===o)&&(Q=0),this._candidates[2*a]=V,this._candidates[2*a+1]=D,this._rms[a]=re,this._queuePush(a,Q,re)}_step(){const e=this._queuePop(),n=e*3+0,i=e*3+1,r=e*3+2,s=this.triangles[n],o=this.triangles[i],a=this.triangles[r],A=this.coords[2*s],h=this.coords[2*s+1],p=this.coords[2*o],m=this.coords[2*o+1],y=this.coords[2*a],T=this.coords[2*a+1],b=this._candidates[2*e],C=this._candidates[2*e+1],R=this._addPoint(b,C);if(Us(A,h,p,m,b,C)===0)this._handleCollinear(R,n);else if(Us(p,m,y,T,b,C)===0)this._handleCollinear(R,i);else if(Us(y,T,A,h,b,C)===0)this._handleCollinear(R,r);else{const S=this._halfedges[n],P=this._halfedges[i],I=this._halfedges[r],F=this._addTriangle(s,o,R,S,-1,-1,n),j=this._addTriangle(o,a,R,P,-1,F+1),X=this._addTriangle(a,s,R,I,F+2,j+1);this._legalize(F),this._legalize(j),this._legalize(X)}}_addPoint(e,n){const i=this.coords.length>>1;return this.coords.push(e,n),i}_addTriangle(e,n,i,r,s,o,a=this.triangles.length){const A=a/3;return this.triangles[a+0]=e,this.triangles[a+1]=n,this.triangles[a+2]=i,this._halfedges[a+0]=r,this._halfedges[a+1]=s,this._halfedges[a+2]=o,r>=0&&(this._halfedges[r]=a+0),s>=0&&(this._halfedges[s]=a+1),o>=0&&(this._halfedges[o]=a+2),this._candidates[2*A+0]=0,this._candidates[2*A+1]=0,this._queueIndices[A]=-1,this._rms[A]=0,this._pending[this._pendingLen++]=A,a}_legalize(e){const n=this._halfedges[e];if(n<0)return;const i=e-e%3,r=n-n%3,s=i+(e+1)%3,o=i+(e+2)%3,a=r+(n+2)%3,A=r+(n+1)%3,h=this.triangles[o],p=this.triangles[e],m=this.triangles[s],y=this.triangles[a],T=this.coords;if(!SJ(T[2*h],T[2*h+1],T[2*p],T[2*p+1],T[2*m],T[2*m+1],T[2*y],T[2*y+1]))return;const b=this._halfedges[s],C=this._halfedges[o],R=this._halfedges[a],S=this._halfedges[A];this._queueRemove(i/3),this._queueRemove(r/3);const P=this._addTriangle(h,y,m,-1,R,b,i),I=this._addTriangle(y,h,p,P,C,S,r);this._legalize(P+1),this._legalize(I+2)}_handleCollinear(e,n){const i=n-n%3,r=i+(n+1)%3,s=i+(n+2)%3,o=this.triangles[s],a=this.triangles[n],A=this.triangles[r],h=this._halfedges[r],p=this._halfedges[s],m=this._halfedges[n];if(m<0){const X=this._addTriangle(e,o,a,-1,p,-1,i),q=this._addTriangle(o,e,A,X,-1,h);this._legalize(X+1),this._legalize(q+2);return}const y=m-m%3,T=y+(m+2)%3,b=y+(m+1)%3,C=this.triangles[T],R=this._halfedges[T],S=this._halfedges[b];this._queueRemove(y/3);const P=this._addTriangle(o,a,e,p,-1,-1,i),I=this._addTriangle(a,C,e,S,-1,P+1,y),F=this._addTriangle(C,A,e,R,-1,I+1),j=this._addTriangle(A,o,e,h,P+2,F+1);this._legalize(P),this._legalize(I),this._legalize(F),this._legalize(j)}_queuePush(e,n,i){const r=this._queue.length;this._queueIndices[e]=r,this._queue.push(e),this._errors.push(n),this._rmsSum+=i,this._queueUp(r)}_queuePop(){const e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){const e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){const n=this._queueIndices[e];if(n<0){const r=this._pending.indexOf(e);if(r!==-1)this._pending[r]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const i=this._queue.length-1;i!==n&&(this._queueSwap(n,i),this._queueDown(n,i)||this._queueUp(n)),this._queuePopBack()}_queueLess(e,n){return this._errors[e]>this._errors[n]}_queueSwap(e,n){const i=this._queue[e],r=this._queue[n];this._queue[e]=r,this._queue[n]=i,this._queueIndices[i]=n,this._queueIndices[r]=e;const s=this._errors[e];this._errors[e]=this._errors[n],this._errors[n]=s}_queueUp(e){let n=e;for(;;){const i=n-1>>1;if(i===n||!this._queueLess(n,i))break;this._queueSwap(i,n),n=i}}_queueDown(e,n){let i=e;for(;;){const r=2*i+1;if(r>=n||r<0)break;const s=r+1;let o=r;if(s<n&&this._queueLess(s,r)&&(o=s),!this._queueLess(o,i))break;this._queueSwap(i,o),i=o}return i>e}}function Us(t,e,n,i,r,s){return(n-r)*(e-s)-(i-s)*(t-r)}function SJ(t,e,n,i,r,s,o,a){const A=t-o,h=e-a,p=n-o,m=i-a,y=r-o,T=s-a,b=A*A+h*h,C=p*p+m*m,R=y*y+T*T;return A*(m*R-C*T)-h*(p*R-C*y)+b*(p*T-m*y)<0}function ku(t,e,n,i,r){const{rScaler:s,bScaler:o,gScaler:a,offset:A}=i,h=new Float32Array((e+1)*(n+1));for(let p=0,m=0;m<n;m++)for(let y=0;y<e;y++,p++){const T=p*4,b=t[T+0],C=t[T+1],R=t[T+2];h[p+m]=b*s+C*a+R*o+A}if(r==="martini"){for(let p=(e+1)*e,m=0;m<e;m++,p++)h[p]=h[p-e-1];for(let p=n,m=0;m<n+1;m++,p+=n+1)h[p]=h[p-1]}return h}function PJ(t,e,n,i,r){const s=n+1,o=t.length/2,a=new Float32Array(o*3),A=new Float32Array(o*2),[h,p,m,y]=r||[0,0,n,i],T=(m-h)/n,b=(y-p)/i;for(let C=0;C<o;C++){const R=t[C*2],S=t[C*2+1],P=S*s+R;a[3*C+0]=R*T+h,a[3*C+1]=-S*b+y,a[3*C+2]=e[P],A[2*C+0]=R/n,A[2*C+1]=S/i}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:A,size:2}}}function IJ(t,e){if(t===null)return null;const{meshMaxError:n,bounds:i,elevationDecoder:r}=e,{data:s,width:o,height:a}=t;let A,h;switch(e.tesselator){case"martini":A=ku(s,o,a,r,e.tesselator),h=MT(n,o,A);break;case"delatin":A=ku(s,o,a,r,e.tesselator),h=BT(n,o,a,A);break;default:o===a&&!(a&o-1)?(A=ku(s,o,a,r,"martini"),h=MT(n,o,A)):(A=ku(s,o,a,r,"delatin"),h=BT(n,o,a,A));break}const{vertices:p}=h;let{triangles:m}=h,y=PJ(p,A,o,a,i);const T=W_(y);if(e.skirtHeight){const{attributes:b,triangles:C}=GP(y,m,e.skirtHeight);y=b,m=C}return{loaderData:{header:{}},header:{vertexCount:m.length,boundingBox:T},mode:4,indices:{value:Uint32Array.from(m),size:1},attributes:y}}function MT(t,e,n){const i=e+1,s=new bJ(i).createTile(n),{vertices:o,triangles:a}=s.getMesh(t);return{vertices:o,triangles:a}}function BT(t,e,n,i){const r=new CJ(i,e+1,n+1);r.run(t);const{coords:s,triangles:o}=r;return{vertices:s,triangles:o}}async function MJ(t,e,n){const i={...e,mimeType:"application/x.image",image:{...e.image,type:"data"}},r=await n.parse(t,i);return IJ(r,e.terrain)}const zP="3.2.13",VP={name:"Terrain",id:"terrain",module:"terrain",version:zP,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}},BJ={name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:zP,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};({...VP});({...BJ});const LT=[1],LJ={...vc.defaultProps,elevationData:Gg,texture:{...Gg,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:{type:"string",value:null},wireframe:!1,material:!0,loaders:[VP]};function RT(t){return Array.isArray(t)?t.join(";"):t||""}class jP extends Lr{constructor(...e){super(...e),w(this,"state",void 0)}updateState({props:e,oldProps:n}){const i=e.elevationData!==n.elevationData;if(i){const{elevationData:s}=e,o=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:o})}const r=i||e.meshMaxError!==n.meshMaxError||e.elevationDecoder!==n.elevationDecoder||e.bounds!==n.bounds;if(!this.state.isTiled&&r){const s=this.loadTerrain(e);this.setState({terrain:s})}e.workerUrl&&Re.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:n,elevationDecoder:i,meshMaxError:r,signal:s}){var o;if(!e)return null;let a=this.getLoadOptions();a={...a,terrain:{skirtHeight:this.state.isTiled?r*2:0,...(o=a)===null||o===void 0?void 0:o.terrain,bounds:n,meshMaxError:r,elevationDecoder:i}};const{fetch:A}=this.props;return A(e,{propName:"elevationData",layer:this,loadOptions:a,signal:s})}getTiledTerrainData(e){const{elevationData:n,fetch:i,texture:r,elevationDecoder:s,meshMaxError:o}=this.props,{viewport:a}=this.context,A=oh(n,e),h=r&&oh(r,e),{signal:p}=e;let m=[0,0],y=[0,0];if(a.isGeospatial){const R=e.bbox;m=a.projectFlat([R.west,R.south]),y=a.projectFlat([R.east,R.north])}else{const R=e.bbox;m=[R.left,R.bottom],y=[R.right,R.top]}const T=[m[0],m[1],y[0],y[1]],b=this.loadTerrain({elevationData:A,bounds:T,elevationDecoder:s,meshMaxError:o,signal:p}),C=h?i(h,{propName:"texture",layer:this,loaders:[],signal:p}).catch(R=>null):Promise.resolve(null);return Promise.all([b,C])}renderSubLayers(e){const n=this.getSubLayerClass("mesh",YA),{color:i,wireframe:r,material:s}=this.props,{data:o}=e;if(!o)return null;const[a,A]=o;return new n(e,{data:LT,mesh:a,texture:A,_instanced:!1,coordinateSystem:De.CARTESIAN,getPosition:h=>[0,0,0],getColor:i,wireframe:r,material:s})}onViewportLoad(e){if(!e)return;const{zRange:n}=this.state,i=e.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(A=>A[2]));if(i.length===0)return;const r=Math.min(...i.map(o=>o[0])),s=Math.max(...i.map(o=>o[1]));(!n||r<n[0]||s>n[1])&&this.setState({zRange:[r,s]})}renderLayers(){const{color:e,material:n,elevationData:i,texture:r,wireframe:s,meshMaxError:o,elevationDecoder:a,tileSize:A,maxZoom:h,minZoom:p,extent:m,maxRequests:y,onTileLoad:T,onTileUnload:b,onTileError:C,maxCacheSize:R,maxCacheByteSize:S,refinementStrategy:P}=this.props;if(this.state.isTiled)return new vc(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:RT(i),texture:RT(r),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:A,maxZoom:h,minZoom:p,extent:m,maxRequests:y,onTileLoad:T,onTileUnload:b,onTileError:C,maxCacheSize:R,maxCacheByteSize:S,refinementStrategy:P});const I=this.getSubLayerClass("mesh",YA);return new I(this.getSubLayerProps({id:"mesh"}),{data:LT,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:F=>[0,0,0],getColor:e,material:n,wireframe:s})}}w(jP,"defaultProps",LJ);w(jP,"layerName","TerrainLayer");function RJ(t,e,n){const i=OJ(t),r=Object.keys(i).filter(s=>i[s]!==Array);return FJ(t,{propArrayTypes:i,...e},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array})}function OJ(t){const e={};for(const n of t)if(n.properties)for(const i in n.properties){const r=n.properties[i];e[i]=zJ(r,e[i])}return e}function FJ(t,e,n){const{pointPositionsCount:i,pointFeaturesCount:r,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:A,polygonObjectsCount:h,polygonRingsCount:p,polygonFeaturesCount:m,propArrayTypes:y,coordLength:T}=e,{numericPropKeys:b=[],PositionDataType:C=Float32Array}=n,R=t[0]&&"id"in t[0],S=t.length>65535?Uint32Array:Uint16Array,P={type:"Point",positions:new C(i*T),globalFeatureIds:new S(i),featureIds:r>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},I={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new C(s*T),globalFeatureIds:new S(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},F={type:"Polygon",polygonIndices:A>65535?new Uint32Array(h+1):new Uint16Array(h+1),primitivePolygonIndices:A>65535?new Uint32Array(p+1):new Uint16Array(p+1),positions:new C(A*T),triangles:[],globalFeatureIds:new S(A),featureIds:m>65535?new Uint32Array(A):new Uint16Array(A),numericProps:{},properties:[],fields:[]};for(const X of[P,I,F])for(const q of b){const ee=y[q];X.numericProps[q]=new ee(X.positions.length/T)}I.pathIndices[o]=s,F.polygonIndices[h]=A,F.primitivePolygonIndices[p]=A;const j={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const X of t){const q=X.geometry,ee=X.properties||{};switch(q.type){case"Point":DJ(q,P,j,T,ee),P.properties.push(K0(ee,b)),R&&P.fields.push({id:X.id}),j.pointFeature++;break;case"LineString":kJ(q,I,j,T,ee),I.properties.push(K0(ee,b)),R&&I.fields.push({id:X.id}),j.lineFeature++;break;case"Polygon":NJ(q,F,j,T,ee),F.properties.push(K0(ee,b)),R&&F.fields.push({id:X.id}),j.polygonFeature++;break;default:throw new Error("Invalid geometry type")}j.feature++}return GJ(P,I,F,T)}function DJ(t,e,n,i,r){e.positions.set(t.data,n.pointPosition*i);const s=t.data.length/i;n1(e,r,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function kJ(t,e,n,i,r){e.positions.set(t.data,n.linePosition*i);const s=t.data.length/i;n1(e,r,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){const A=t.indices[o],h=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(h-A)/i}}function NJ(t,e,n,i,r){e.positions.set(t.data,n.polygonPosition*i);const s=t.data.length/i;n1(e,r,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){const A=n.polygonPosition;e.polygonIndices[n.polygonObject++]=A;const h=t.areas[o],p=t.indices[o],m=t.indices[o+1];for(let T=0,b=p.length;T<b;++T){const C=p[T],R=T===b-1?m===void 0?t.data.length:m[0]:p[T+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(R-C)/i}const y=n.polygonPosition;UJ(e,h,p,{startPosition:A,endPosition:y,coordLength:i})}}function UJ(t,e,n,{startPosition:i,endPosition:r,coordLength:s}){const o=i*s,a=r*s,A=t.positions.subarray(o,a),h=n[0],p=n.slice(1).map(y=>(y-h)/s),m=Sz(A,p,s,e);for(let y=0,T=m.length;y<T;++y)t.triangles.push(i+m[y])}function Y0(t,e){const n={};for(const i in t)n[i]={value:t[i],size:e};return n}function GJ(t,e,n,i){return{points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:Y0(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:Y0(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:i},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},triangles:{value:new Uint32Array(n.triangles),size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:Y0(n.numericProps,1)}}}function n1(t,e,n,i){for(const r in t.numericProps)if(r in e){const s=e[r];t.numericProps[r].fill(s,n,n+i)}}function K0(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}function zJ(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function OT(t,e){const n=e==null?void 0:e.globalFeatureId;return n!==void 0?VJ(t,n):jJ(t,e==null?void 0:e.type)}function VJ(t,e){const n=HP(t);for(const i of n){let r=0,s=i.featureIds.value[0];for(let o=0;o<i.featureIds.value.length;o++){const a=i.featureIds.value[o];if(a!==s){if(e===i.globalFeatureIds.value[r])return ch(i,r,o);r=o,s=a}}if(e===i.globalFeatureIds.value[r])return ch(i,r,i.featureIds.value.length)}throw new Error("featureId:".concat(e," not found"))}function jJ(t,e){const n=HP(t,e);return WJ(n)}function HJ(t,e,n){switch(t.type){case"Point":return YJ(t,e,n);case"LineString":return JJ(t,e,n);case"Polygon":return WP(t,e,n);default:const i=t;throw new Error("Unsupported geometry type: ".concat(i==null?void 0:i.type))}}function HP(t,e){if(!Boolean(t.points||t.lines||t.polygons))return t.type=e||KJ(t),[t];const i=[];return t.points&&(t.points.type="Point",i.push(t.points)),t.lines&&(t.lines.type="LineString",i.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",i.push(t.polygons)),i}function WJ(t){const e=[];for(const n of t){if(n.featureIds.value.length===0)continue;let i=0,r=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const o=n.featureIds.value[s];o!==r&&(e.push(ch(n,i,s)),i=s,r=o)}e.push(ch(n,i,n.featureIds.value.length))}return e}function ch(t,e,n){const i=HJ(t,e,n),r=XJ(t,e),s=QJ(t,e);return{type:"Feature",geometry:i,properties:r,...s}}function QJ(t,e=0,n){return t.fields&&t.fields[t.featureIds.value[e]]}function XJ(t,e=0,n){const i=Object.assign({},t.properties[t.featureIds.value[e]]);for(const r in t.numericProps)i[r]=t.numericProps[r].value[e];return i}function WP(t,e=-1/0,n=1/0){const{positions:i}=t,r=t.polygonIndices.value.filter(A=>A>=e&&A<=n),s=t.primitivePolygonIndices.value.filter(A=>A>=e&&A<=n);if(!(r.length>2)){const A=[];for(let h=0;h<s.length-1;h++){const p=s[h],m=s[h+1],y=uh(i,p,m);A.push(y)}return{type:"Polygon",coordinates:A}}const a=[];for(let A=0;A<r.length-1;A++){const h=r[A],p=r[A+1],m=WP(t,h,p).coordinates;a.push(m)}return{type:"MultiPolygon",coordinates:a}}function JJ(t,e=-1/0,n=1/0){const{positions:i}=t,r=t.pathIndices.value.filter(a=>a>=e&&a<=n);if(!(r.length>2))return{type:"LineString",coordinates:uh(i,r[0],r[1])};const o=[];for(let a=0;a<r.length-1;a++){const A=uh(i,r[a],r[a+1]);o.push(A)}return{type:"MultiLineString",coordinates:o}}function YJ(t,e,n){const{positions:i}=t,r=uh(i,e,n);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function uh(t,e,n){e=e||0,n=n||t.value.length/t.size;const i=[];for(let r=e;r<n;r++){const s=Array();for(let o=r*t.size;o<(r+1)*t.size;o++)s.push(Number(t.value[o]));i.push(s)}return i}function KJ(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var i1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i1.read=function(t,e,n,i,r){var s,o,a=r*8-i-1,A=(1<<a)-1,h=A>>1,p=-7,m=n?r-1:0,y=n?-1:1,T=t[e+m];for(m+=y,s=T&(1<<-p)-1,T>>=-p,p+=a;p>0;s=s*256+t[e+m],m+=y,p-=8);for(o=s&(1<<-p)-1,s>>=-p,p+=i;p>0;o=o*256+t[e+m],m+=y,p-=8);if(s===0)s=1-h;else{if(s===A)return o?NaN:(T?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(T?-1:1)*o*Math.pow(2,s-i)};i1.write=function(t,e,n,i,r,s){var o,a,A,h=s*8-r-1,p=(1<<h)-1,m=p>>1,y=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=i?0:s-1,b=i?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=p):(o=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-o))<1&&(o--,A*=2),o+m>=1?e+=y/A:e+=y*Math.pow(2,1-m),e*A>=2&&(o++,A/=2),o+m>=p?(a=0,o=p):o+m>=1?(a=(e*A-1)*Math.pow(2,r),o=o+m):(a=e*Math.pow(2,m-1)*Math.pow(2,r),o=0));r>=8;t[n+T]=a&255,T+=b,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;t[n+T]=o&255,T+=b,o/=256,h-=8);t[n+T-b]|=C*128};var QP=ot,Nu=i1;function ot(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ot.Varint=0;ot.Fixed64=1;ot.Bytes=2;ot.Fixed32=5;var Zg=(1<<16)*(1<<16),FT=1/Zg,ZJ=12,XP=typeof TextDecoder>"u"?null:new TextDecoder("utf8");ot.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Uu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=kT(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Uu(this.buf,this.pos)+Uu(this.buf,this.pos+4)*Zg;return this.pos+=8,t},readSFixed64:function(){var t=Uu(this.buf,this.pos)+kT(this.buf,this.pos+4)*Zg;return this.pos+=8,t},readFloat:function(){var t=Nu.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Nu.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,i;return i=e[this.pos++],n=i&127,i<128||(i=e[this.pos++],n|=(i&127)<<7,i<128)||(i=e[this.pos++],n|=(i&127)<<14,i<128)||(i=e[this.pos++],n|=(i&127)<<21,i<128)?n:(i=e[this.pos],n|=(i&15)<<28,qJ(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=ZJ&&XP?fY(this.buf,e,t):uY(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ot.Bytes)return t.push(this.readVarint(e));var n=hr(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ot.Bytes)return t.push(this.readSVarint());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ot.Bytes)return t.push(this.readBoolean());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ot.Bytes)return t.push(this.readFloat());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ot.Bytes)return t.push(this.readDouble());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ot.Bytes)return t.push(this.readFixed32());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ot.Bytes)return t.push(this.readSFixed32());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ot.Bytes)return t.push(this.readFixed64());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ot.Bytes)return t.push(this.readSFixed64());var e=hr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===ot.Varint)for(;this.buf[this.pos++]>127;);else if(e===ot.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ot.Fixed32)this.pos+=4;else if(e===ot.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Wo(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Wo(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Wo(this.buf,t&-1,this.pos),Wo(this.buf,Math.floor(t*FT),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Wo(this.buf,t&-1,this.pos),Wo(this.buf,Math.floor(t*FT),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){$J(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=hY(this.buf,t,this.pos);var n=this.pos-e;n>=128&&DT(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Nu.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Nu.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&DT(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,ot.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,nY,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,iY,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,oY,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,rY,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,sY,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,aY,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,lY,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,AY,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,cY,e)},writeBytesField:function(t,e){this.writeTag(t,ot.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ot.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ot.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ot.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ot.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ot.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ot.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ot.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ot.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ot.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function qJ(t,e,n){var i=n.buf,r,s;if(s=i[n.pos++],r=(s&112)>>4,s<128||(s=i[n.pos++],r|=(s&127)<<3,s<128)||(s=i[n.pos++],r|=(s&127)<<10,s<128)||(s=i[n.pos++],r|=(s&127)<<17,s<128)||(s=i[n.pos++],r|=(s&127)<<24,s<128)||(s=i[n.pos++],r|=(s&1)<<31,s<128))return Ho(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function hr(t){return t.type===ot.Bytes?t.readVarint()+t.pos:t.pos+1}function Ho(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function $J(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),eY(n,i,e),tY(i,e)}function eY(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function tY(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function DT(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function nY(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function iY(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function rY(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function sY(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function oY(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function aY(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function lY(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function AY(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function cY(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Uu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function Wo(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function kT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function uY(t,e,n){for(var i="",r=e;r<n;){var s=t[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>n)break;var A,h,p;a===1?s<128&&(o=s):a===2?(A=t[r+1],(A&192)===128&&(o=(s&31)<<6|A&63,o<=127&&(o=null))):a===3?(A=t[r+1],h=t[r+2],(A&192)===128&&(h&192)===128&&(o=(s&15)<<12|(A&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(A=t[r+1],h=t[r+2],p=t[r+3],(A&192)===128&&(h&192)===128&&(p&192)===128&&(o=(s&15)<<18|(A&63)<<12|(h&63)<<6|p&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function fY(t,e,n){return XP.decode(t.subarray(e,n))}function hY(t,e,n){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):s=r;continue}else s&&(t[n++]=239,t[n++]=191,t[n++]=189,s=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=r&63|128)}return n}function dY(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let s=0;s<e;s++){const o=pY(t[s]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&n.push(i),n}function pY(t){let e=0;for(let n=0,i=t.length-1,r,s;n<t.length;i=n++)r=t[n],s=t[i],e+=(s[0]-r[0])*(r[1]+s[1]);return e}function gY(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?mY(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function mY(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let _Y=class JP{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(e,n,i,r,s){w(this,"properties",void 0),w(this,"extent",void 0),w(this,"type",void 0),w(this,"id",void 0),w(this,"_pbf",void 0),w(this,"_geometry",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,e.readFields(gY,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0;const a=[];let A;for(;e.pos<n;){if(r<=0){const h=e.readVarint();i=h&7,r=h>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),i===1&&(A&&a.push(A),A=[]),A&&A.push([s,o]);else if(i===7)A&&A.push(A[0].slice());else throw new Error("unknown command ".concat(i))}return A&&a.push(A),a}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0,a=1/0,A=-1/0,h=1/0,p=-1/0;for(;e.pos<n;){if(r<=0){const m=e.readVarint();i=m&7,r=m>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>A&&(A=s),o<h&&(h=o),o>p&&(p=o);else if(i!==7)throw new Error("unknown command ".concat(i))}return[a,h,A,p]}_toGeoJSON(e){let n=this.loadGeometry(),i=JP.types[this.type],r,s;switch(this.type){case 1:const a=[];for(r=0;r<n.length;r++)a[r]=n[r][0];n=a,e(n,this);break;case 2:for(r=0;r<n.length;r++)e(n[r],this);break;case 3:for(n=dY(n),r=0;r<n.length;r++)for(s=0;s<n[r].length;s++)e(n[r][s],this);break}n.length===1?n=n[0]:i="Multi".concat(i);const o={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(o.id=this.id),o}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;function A(h){for(let p=0;p<h.length;p++){const m=h[p];m[0]=(m[0]+o)*360/s-180;const y=180-(m[1]+a)*360/s;m[1]=360/Math.PI*Math.atan(Math.exp(y*Math.PI/180))-90}}return this._toGeoJSON(A)}},vY=class{constructor(e,n){w(this,"version",void 0),w(this,"name",void 0),w(this,"extent",void 0),w(this,"length",void 0),w(this,"_pbf",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),w(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(yY,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new _Y(this._pbf,n,this.extent,this._keys,this._values)}};function yY(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(EY(n)))}function EY(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}let TY=class{constructor(e,n){w(this,"layers",void 0),this.layers=e.readFields(wY,{},n)}};function wY(t,e,n){if(t===3&&n){const i=new vY(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function bY(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[eh(t.data)]],indices:[t.indices]};const i=[],r=[];let s=[],o=[],a,A=0;for(let h,p=0,m;p<e;p++){m=t.indices[p]-A,h=t.indices[p+1]-A||t.data.length;const y=t.data.slice(m,h),T=eh(y);if(T===0){const b=t.data.slice(0,m),C=t.data.slice(h);t.data=b.concat(C),A+=h-m;continue}a===void 0&&(a=T<0),a===T<0?(o.length&&(i.push(s),r.push(o)),o=[m],s=[T]):(s.push(T),o.push(m))}return s&&i.push(s),o.length&&r.push(o),{type:n,areas:i,indices:r,data:t.data}}function xY(t,e,n,i){for(let r=0,s=t.length;r<s;r+=2){t[r]=(t[r]+e)*360/i-180;const o=180-(t[r+1]+n)*360/i;t[r+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function CY(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?SY(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function SY(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let NT,Gs,Z0,Gu,q0,$0,Ul;class PY{constructor(e,n,i,r,s,o){w(this,"properties",void 0),w(this,"extent",void 0),w(this,"type",void 0),w(this,"id",void 0),w(this,"_pbf",void 0),w(this,"_geometry",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),w(this,"_geometryInfo",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,this._geometryInfo=o,e.readFields(CY,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,NT=e.readVarint()+e.pos,Gs=1,Gu=0,q0=0,$0=0,Ul=0;const n=[],i=[];for(;e.pos<NT;)if(Gu<=0&&(Z0=e.readVarint(),Gs=Z0&7,Gu=Z0>>3),Gu--,Gs===1||Gs===2)q0+=e.readSVarint(),$0+=e.readSVarint(),Gs===1&&n.push(Ul),i.push(q0,$0),Ul+=2;else if(Gs===7){if(Ul>0){const r=n[n.length-1];i.push(i[r],i[r+1]),Ul+=2}}else throw new Error("unknown command ".concat(Gs));return{data:i,indices:n}}_toBinaryCoordinates(e){const n=this.loadGeometry();let i;e(n.data,this);const r=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/r,i={type:"LineString",...n};break;case 3:i=bY(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const o of i.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=i.data.length/r;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}const s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;return this._toBinaryCoordinates(A=>xY(A,o,a,s))}}class IY{constructor(e,n){w(this,"version",void 0),w(this,"name",void 0),w(this,"extent",void 0),w(this,"length",void 0),w(this,"_pbf",void 0),w(this,"_keys",void 0),w(this,"_values",void 0),w(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(MY,this,n),this.length=this._features.length}feature(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new PY(this._pbf,i,this.extent,this._keys,this._values,n)}}function MY(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(BY(n)))}function BY(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class LY{constructor(e,n){w(this,"layers",void 0),this.layers=e.readFields(RY,{},n)}}function RY(t,e,n){if(t===3&&n){const i=new IY(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function UT(t,e){var n,i;const r=FY(e),s=(e==null||(n=e.gis)===null||n===void 0?void 0:n.format)||(e==null||(i=e.mvt)===null||i===void 0?void 0:i.shape);switch(s){case"columnar-table":return{shape:"columnar-table",data:ep(t,r)};case"geojson-row-table":return{shape:"geojson-row-table",data:GT(t,r)};case"geojson":return GT(t,r);case"binary-geometry":return ep(t,r);case"binary":return ep(t,r);default:throw new Error(s)}}function ep(t,e){const[n,i]=OY(t,e),r=RJ(n,i);return r.byteLength=t.byteLength,r}function OY(t,e){const n=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,i];const r=new LY(new QP(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(o=>{const a=r.layers[o];if(a)for(let A=0;A<a.length;A++){const h=a.feature(A,i),p=kY(h,e,o);n.push(p)}}),[n,i]}function GT(t,e){if(t.byteLength<=0)return[];const n=[],i=new TY(new QP(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{const o=i.layers[s];if(o)for(let a=0;a<o.length;a++){const A=o.feature(a),h=DY(A,e,s);n.push(h)}}),n}function FY(t){var e;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const n=((e=t.mvt)===null||e===void 0?void 0:e.coordinates)==="wgs84",{tileIndex:i}=t.mvt,r=i&&Number.isFinite(i.x)&&Number.isFinite(i.y)&&Number.isFinite(i.z);if(n&&!r)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function DY(t,e,n){const i=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:NY);return e.layerProperty&&(i.properties[e.layerProperty]=n),i}function kY(t,e,n){const i=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:UY);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=n),i}function NY(t,e){const{extent:n}=e;for(let i=0;i<t.length;i++){const r=t[i];r[0]/=n,r[1]/=n}}function UY(t,e){const{extent:n}=e;for(let i=0,r=t.length;i<r;++i)t[i]/=n}const GY="3.2.13",zY={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},YP={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:GY,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:zY};({...YP});const VY=`
  uniform bool brushing_enabled;
  uniform int brushing_target;
  uniform vec2 brushing_mousePos;
  uniform float brushing_radius;

  #ifdef NON_INSTANCED_MODEL
  attribute vec2 brushingTargets;
  #else
  attribute vec2 instanceBrushingTargets;
  #endif

  varying float brushing_isVisible;

  bool brushing_isPointInRange(vec2 position) {
    if (!brushing_enabled) {
      return true;
    }
    vec2 source_commonspace = project_position(position);
    vec2 target_commonspace = project_position(brushing_mousePos);
    float distance = length((target_commonspace - source_commonspace) / project_uCommonUnitsPerMeter.xy);

    return distance <= brushing_radius;
  }

  bool brushing_arePointsInRange(vec2 sourcePos, vec2 targetPos) {
    return brushing_isPointInRange(sourcePos) || brushing_isPointInRange(targetPos);
  }

  void brushing_setVisible(bool visible) {
    brushing_isVisible = float(visible);
  }
`,jY=`
  uniform bool brushing_enabled;
  varying float brushing_isVisible;
`,HY={source:0,target:1,custom:2,source_target:3},WY={"vs:DECKGL_FILTER_GL_POSITION":`
    vec2 brushingTarget;
    vec2 brushingSource;
    if (brushing_target == 3) {
      brushingTarget = geometry.worldPositionAlt.xy;
      brushingSource = geometry.worldPosition.xy;
    } else if (brushing_target == 0) {
      brushingTarget = geometry.worldPosition.xy;
    } else if (brushing_target == 1) {
      brushingTarget = geometry.worldPositionAlt.xy;
    } else {
      #ifdef NON_INSTANCED_MODEL
      brushingTarget = brushingTargets;
      #else
      brushingTarget = instanceBrushingTargets;
      #endif
    }
    bool visible;
    if (brushing_target == 3) {
      visible = brushing_arePointsInRange(brushingSource, brushingTarget);
    } else {
      visible = brushing_isPointInRange(brushingTarget);
    }
    brushing_setVisible(visible);
  `,"fs:DECKGL_FILTER_COLOR":`
    if (brushing_enabled && brushing_isVisible < 0.5) {
      discard;
    }
  `},QY={name:"brushing",dependencies:[go],vs:VY,fs:jY,inject:WY,getUniforms:t=>{if(!t||!("viewport"in t))return{};const{brushingEnabled:e=!0,brushingRadius:n=1e4,brushingTarget:i="source",mousePosition:r,viewport:s}=t;return{brushing_enabled:Boolean(e&&r&&s.containsPixel(r)),brushing_radius:n,brushing_target:HY[i]||0,brushing_mousePos:r?s.unproject([r.x-s.x,r.y-s.y]):[0,0]}}},XY={getBrushingTarget:{type:"accessor",value:[0,0]},brushingTarget:"source",brushingEnabled:!0,brushingRadius:1e4};class KP extends ws{getShaders(){return{modules:[QY]}}initializeState(e,n){const i=this.getAttributeManager();i&&i.add({brushingTargets:{size:2,accessor:"getBrushingTarget",update:this.props.getBrushingTarget?void 0:n.useConstantTargetPositions,shaderAttributes:{brushingTargets:{divisor:0},instanceBrushingTargets:{divisor:1}}}}),this.state.onMouseMove=()=>{var r;(r=this.getCurrentLayer())===null||r===void 0||r.setNeedsRedraw()},e.deck&&e.deck.eventManager.on({pointermove:this.state.onMouseMove,pointerleave:this.state.onMouseMove})}finalizeState(e,n){e.deck&&e.deck.eventManager.off({pointermove:this.state.onMouseMove,pointerleave:this.state.onMouseMove})}useConstantTargetPositions(e){e.constant=!0,e.value=new Float32Array(2)}}w(KP,"defaultProps",XY);w(KP,"extensionName","BrushingExtension");const ZP=`
uniform DATAFILTER_TYPE filter_min;
uniform DATAFILTER_TYPE filter_softMin;
uniform DATAFILTER_TYPE filter_softMax;
uniform DATAFILTER_TYPE filter_max;
uniform bool filter_useSoftMargin;
uniform bool filter_enabled;
uniform bool filter_transformSize;

#ifdef NON_INSTANCED_MODEL
  #define DATAFILTER_ATTRIB filterValues
  #define DATAFILTER_ATTRIB_64LOW filterValues64Low
#else
  #define DATAFILTER_ATTRIB instanceFilterValues
  #define DATAFILTER_ATTRIB_64LOW instanceFilterValues64Low
#endif

attribute DATAFILTER_TYPE DATAFILTER_ATTRIB;
#ifdef DATAFILTER_DOUBLE
  attribute DATAFILTER_TYPE DATAFILTER_ATTRIB_64LOW;

  uniform DATAFILTER_TYPE filter_min64High;
  uniform DATAFILTER_TYPE filter_max64High;
#endif

varying float dataFilter_value;

float dataFilter_reduceValue(float value) {
  return value;
}
float dataFilter_reduceValue(vec2 value) {
  return min(value.x, value.y);
}
float dataFilter_reduceValue(vec3 value) {
  return min(min(value.x, value.y), value.z);
}
float dataFilter_reduceValue(vec4 value) {
  return min(min(value.x, value.y), min(value.z, value.w));
}
void dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {
  if (filter_enabled) {
    if (filter_useSoftMargin) {
      dataFilter_value = dataFilter_reduceValue(
        smoothstep(filter_min, filter_softMin, valueFromMin) *
        (1.0 - smoothstep(filter_softMax, filter_max, valueFromMax))
      );
    } else {
      dataFilter_value = dataFilter_reduceValue(
        step(filter_min, valueFromMin) * step(valueFromMax, filter_max)
      );
    }
  } else {
    dataFilter_value = 1.0;
  }
}
`,qP=`
uniform bool filter_transformColor;
varying float dataFilter_value;
`;function $P(t){if(!t||!("extensions"in t))return{};const{filterRange:e=[-1,1],filterEnabled:n=!0,filterTransformSize:i=!0,filterTransformColor:r=!0}=t,s=t.filterSoftRange||e;return{...Number.isFinite(e[0])?{filter_min:e[0],filter_softMin:s[0],filter_softMax:s[1],filter_max:e[1]}:{filter_min:e.map(o=>o[0]),filter_softMin:s.map(o=>o[0]),filter_softMax:s.map(o=>o[1]),filter_max:e.map(o=>o[1])},filter_enabled:n,filter_useSoftMargin:Boolean(t.filterSoftRange),filter_transformSize:n&&i,filter_transformColor:n&&r}}function JY(t){if(!t||!("extensions"in t))return{};const e=$P(t);if(Number.isFinite(e.filter_min)){const n=Math.fround(e.filter_min);e.filter_min-=n,e.filter_softMin-=n,e.filter_min64High=n;const i=Math.fround(e.filter_max);e.filter_max-=i,e.filter_softMax-=i,e.filter_max64High=i}else{const n=e.filter_min.map(Math.fround);e.filter_min=e.filter_min.map((r,s)=>r-n[s]),e.filter_softMin=e.filter_softMin.map((r,s)=>r-n[s]),e.filter_min64High=n;const i=e.filter_max.map(Math.fround);e.filter_max=e.filter_max.map((r,s)=>r-i[s]),e.filter_softMax=e.filter_softMax.map((r,s)=>r-i[s]),e.filter_max64High=i}return e}const e3={"vs:#main-start":`
    #ifdef DATAFILTER_DOUBLE
      dataFilter_setValue(
        DATAFILTER_ATTRIB - filter_min64High + DATAFILTER_ATTRIB_64LOW,
        DATAFILTER_ATTRIB - filter_max64High + DATAFILTER_ATTRIB_64LOW
      );
    #else
      dataFilter_setValue(DATAFILTER_ATTRIB, DATAFILTER_ATTRIB);
    #endif
  `,"vs:#main-end":`
    if (dataFilter_value == 0.0) {
      gl_Position = vec4(0.);
    }
  `,"vs:DECKGL_FILTER_SIZE":`
    if (filter_transformSize) {
      size = size * dataFilter_value;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (dataFilter_value == 0.0) discard;
    if (filter_transformColor) {
      color.a *= dataFilter_value;
    }
  `},YY={name:"data-filter",vs:ZP,fs:qP,inject:e3,getUniforms:$P},KY={name:"data-filter-fp64",vs:ZP,fs:qP,inject:e3,getUniforms:JY},ZY=`#define SHADER_NAME data-filter-vertex-shader

#ifdef FLOAT_TARGET
  attribute float filterIndices;
  attribute float filterPrevIndices;
#else
  attribute vec2 filterIndices;
  attribute vec2 filterPrevIndices;
#endif

varying vec4 vColor;
const float component = 1.0 / 255.0;

void main() {
  #ifdef FLOAT_TARGET
    dataFilter_value *= float(filterIndices != filterPrevIndices);
    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
    vColor = vec4(0.0, 0.0, 0.0, 1.0);
  #else
    // Float texture is not supported: pack result into 4 channels x 256 px x 64px
    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);
    float col = filterIndices.x;
    float row = filterIndices.y * 4.0;
    float channel = floor(row);
    row = fract(row);
    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));
    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);
  #endif
  gl_PointSize = 1.0;
}
`,qY=`#define SHADER_NAME data-filter-fragment-shader
precision highp float;

varying vec4 vColor;

void main() {
  if (dataFilter_value < 0.5) {
    discard;
  }
  gl_FragColor = vColor;
}
`;function $Y(t){return Boolean(t.getExtension("EXT_float_blend")&&(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")))}function eK(t,e){return e?new kt(t,{width:1,height:1,attachments:{[36064]:new Gt(t,{format:He(t)?34836:6408,type:5126,mipmaps:!1})}}):new kt(t,{width:256,height:64,depth:!1})}function tK(t,e,n){return e.defines.NON_INSTANCED_MODEL=1,n&&(e.defines.FLOAT_TARGET=1),new cn(t,{id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,drawMode:0,vs:ZY,fs:qY,...e})}const nK={blend:!0,blendFunc:[1,1,1,1],blendEquation:[32774,32774],depthTest:!1},iK={getFilterValue:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,compare:!1},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterTransformSize:!0,filterTransformColor:!0},zT={1:"float",2:"vec2",3:"vec3",4:"vec4"};class t3 extends ws{constructor({filterSize:e=1,fp64:n=!1,countItems:i=!1}={}){if(!zT[e])throw new Error("filterSize out of range");super({filterSize:e,fp64:n,countItems:i})}getShaders(e){const{filterSize:n,fp64:i}=e.opts;return{modules:[i?KY:YY],defines:{DATAFILTER_TYPE:zT[n],DATAFILTER_DOUBLE:Boolean(i)}}}initializeState(e,n){const i=this.getAttributeManager();i&&i.add({filterValues:{size:n.opts.filterSize,type:n.opts.fp64?5130:5126,accessor:"getFilterValue",shaderAttributes:{filterValues:{divisor:0},instanceFilterValues:{divisor:1}}}});const{gl:r}=this.context;if(i&&n.opts.countItems){const s=$Y(r);i.add({filterIndices:{size:s?1:2,vertexOffset:1,type:5121,normalized:!0,accessor:(A,{index:h})=>{const p=A&&A.__source?A.__source.index:h;return s?(p+1)%255:[(p+1)%255,Math.floor(p/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});const o=eK(r,s),a=tK(r,n.getShaders.call(this,n),s);this.setState({filterFBO:o,filterModel:a})}}updateState({props:e,oldProps:n}){if(this.state.filterModel){const r=this.getAttributeManager().attributes.filterValues.needsUpdate()||e.filterEnabled!==n.filterEnabled||e.filterRange!==n.filterRange||e.filterSoftRange!==n.filterSoftRange;r&&this.setState({filterNeedsUpdate:r})}}draw(e,n){const{filterFBO:i,filterModel:r,filterNeedsUpdate:s}=this.state,{onFilteredItemsChange:o}=this.props;if(s&&o&&r){const{attributes:{filterValues:a,filterIndices:A}}=this.getAttributeManager();r.setVertexCount(this.getNumInstances());const{gl:h}=this.context;Bh(h,{framebuffer:i,color:[0,0,0,0]}),r.updateModuleSettings(e.moduleParameters).setAttributes({...a.getShaderAttributes(),...A&&A.getShaderAttributes()}).draw({framebuffer:i,parameters:{...nK,viewport:[0,0,i.width,i.height]}});const p=cc(i);let m=0;for(let y=0;y<p.length;y++)m+=p[y];o({id:this.id,count:m}),this.state.filterNeedsUpdate=!1}}finalizeState(){const{filterFBO:e,filterModel:n}=this.state;e&&(e.color.delete(),e.delete(),n.delete())}}w(t3,"defaultProps",iK);w(t3,"extensionName","DataFilterExtension");const rK=`
const vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);

uniform vec2 project_uViewProjectionMatrixFP64[16];

// longitude: lnglat_fp64.xy; latitude: lnglat_fp64.zw
void mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {

#if defined(NVIDIA_FP64_WORKAROUND)
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);
#else
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);
#endif
  out_val[1] = sum_fp64(PI_FP64,
    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));
  return;
}

void project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {
  vec2 pos_fp64[2];
  mercatorProject_fp64(position_fp64, pos_fp64);
  out_val[0] = mul_fp64(pos_fp64[0], WORLD_SCALE_FP64);
  out_val[1] = mul_fp64(pos_fp64[1], WORLD_SCALE_FP64);

  return;
}

void project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {
  vec4 position64xy = vec4(
    position.x, position64xyLow.x,
    position.y, position64xyLow.y);

  project_position_fp64(position64xy, out_val);
}

vec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {
  vec2 vertex_pos_clipspace[4];
  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,
    vertex_pos_clipspace);
  return vec4(
    vertex_pos_clipspace[0].x,
    vertex_pos_clipspace[1].x,
    vertex_pos_clipspace[2].x,
    vertex_pos_clipspace[3].x
    );
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset, out vec4 commonPosition
) {
  // This is the local offset to the instance position
  vec2 offset64[4];
  vec4_fp64(vec4(offset, 0.0), offset64);

  float z = project_size(position.z);

  // Apply web mercator projection (depends on coordinate system imn use)
  vec2 projectedPosition64xy[2];
  project_position_fp64(position.xy, position64xyLow.xy, projectedPosition64xy);

  vec2 commonPosition64[4];
  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);
  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);
  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));
  commonPosition64[3] = vec2(1.0, 0.0);

  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);

  return project_common_position_to_clipspace_fp64(commonPosition64);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(
    position, position64xyLow, offset, commonPosition
  );
}
`,{fp64ify:sK,fp64ifyMatrix4:oK}=uC,aK={name:"project64",dependencies:[go,uC],vs:rK,getUniforms:AK},lK=Ya(cK);function AK(t){if(t&&"viewport"in t){const{viewProjectionMatrix:e,scale:n}=t.viewport;return lK({viewProjectionMatrix:e,scale:n})}return{}}function cK({viewProjectionMatrix:t,scale:e}){const n=oK(t),i=sK(e);return{project_uViewProjectionMatrixFP64:n,project64_uViewProjectionMatrix:n,project64_uScale:i}}class uK extends ws{getShaders(){const{coordinateSystem:e}=this.props;if(e!==De.LNGLAT&&e!==De.DEFAULT)throw new Error("fp64: coordinateSystem must be LNGLAT");return{modules:[aK]}}}w(uK,"extensionName","Fp64Extension");const fK={inject:{"vs:#decl":`
attribute vec2 instanceDashArrays;
attribute float instanceDashOffsets;
varying vec2 vDashArray;
varying float vDashOffset;
`,"vs:#main-end":`
vDashArray = instanceDashArrays;
vDashOffset = instanceDashOffsets / width.x;
`,"fs:#decl":`
uniform float dashAlignMode;
uniform float capType;
uniform bool dashGapPickable;
varying vec2 vDashArray;
varying float vDashOffset;

float round(float x) {
  return floor(x + 0.5);
}
`,"fs:#main-start":`
  float solidLength = vDashArray.x;
  float gapLength = vDashArray.y;
  float unitLength = solidLength + gapLength;

  float offset;

  if (unitLength > 0.0) {
    if (dashAlignMode == 0.0) {
      offset = vDashOffset;
    } else {
      unitLength = vPathLength / round(vPathLength / unitLength);
      offset = solidLength / 2.0;
    }

    float unitOffset = mod(clamp(vPathPosition.y, 0.0, vPathLength) + offset, unitLength);

    if (gapLength > 0.0 && unitOffset > solidLength) {
      if (capType <= 0.5) {
        if (!(dashGapPickable && picking_uActive)) {
          discard;
        }
      } else {
        // caps are rounded, test the distance to solid ends
        float distToEnd = length(vec2(
          min(unitOffset - solidLength, unitLength - unitOffset),
          vPathPosition.x
        ));
        if (distToEnd > 1.0) {
          if (!(dashGapPickable && picking_uActive)) {
            discard;
          }
        }
      }
    }
  }
`}},hK={inject:{"vs:#decl":`
attribute float instanceOffsets;
`,"vs:DECKGL_FILTER_SIZE":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  size *= offsetWidth;
`,"vCornerOffset = offsetVec;":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  vec2 offsetCenter = -instanceOffsets * (isCap ? perp : miterVec * miterSize) * 2.0;
  vCornerOffset = vCornerOffset * offsetWidth - offsetCenter;
`,"fs:#main-start":`
  float isInside;
  isInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);
  if (isInside == 0.0) {
    discard;
  }
`}},dK={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1};class n3 extends ws{constructor({dash:e=!1,offset:n=!1,highPrecisionDash:i=!1}={}){super({dash:e||i,offset:n,highPrecisionDash:i})}isEnabled(e){return"pathTesselator"in e.state}getShaders(e){if(!e.isEnabled(this))return null;let n={};return e.opts.dash&&(n=Sg(n,fK)),e.opts.offset&&(n=Sg(n,hK)),n}initializeState(e,n){const i=this.getAttributeManager();!i||!n.isEnabled(this)||(n.opts.dash&&i.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"}}),n.opts.highPrecisionDash&&i.addInstanced({instanceDashOffsets:{size:1,accessor:"getPath",transform:n.getDashOffsets.bind(this)}}),n.opts.offset&&i.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}updateState(e,n){if(!n.isEnabled(this))return;const i={};n.opts.dash&&(i.dashAlignMode=this.props.dashJustified?1:0,i.dashGapPickable=Boolean(this.props.dashGapPickable)),this.state.model.setUniforms(i)}getDashOffsets(e){const n=[0],i=this.props.positionFormat==="XY"?2:3,r=Array.isArray(e[0]),s=r?e.length:e.length/i;let o,a;for(let A=0;A<s-1;A++)o=r?e[A]:e.slice(A*i,A*i+i),o=this.projectPosition(o),A>0&&(n[A]=n[A-1]+rk(a,o)),a=o;return n}}w(n3,"defaultProps",dK);w(n3,"extensionName","PathStyleExtension");const pK=`
#ifdef NON_INSTANCED_MODEL
  #define FILL_PATTERN_FRAME_ATTRIB fillPatternFrames
  #define FILL_PATTERN_SCALE_ATTRIB fillPatternScales
  #define FILL_PATTERN_OFFSET_ATTRIB fillPatternOffsets
#else
  #define FILL_PATTERN_FRAME_ATTRIB instanceFillPatternFrames
  #define FILL_PATTERN_SCALE_ATTRIB instanceFillPatternScales
  #define FILL_PATTERN_OFFSET_ATTRIB instanceFillPatternOffsets
#endif

attribute vec4 FILL_PATTERN_FRAME_ATTRIB;
attribute float FILL_PATTERN_SCALE_ATTRIB;
attribute vec2 FILL_PATTERN_OFFSET_ATTRIB;

uniform bool fill_patternEnabled;
uniform vec2 fill_patternTextureSize;

varying vec2 fill_uv;
varying vec4 fill_patternBounds;
varying vec4 fill_patternPlacement;
`,gK=`
uniform bool fill_patternEnabled;
uniform bool fill_patternMask;
uniform sampler2D fill_patternTexture;
uniform vec2 fill_uvCoordinateOrigin;
uniform vec2 fill_uvCoordinateOrigin64Low;

varying vec4 fill_patternBounds;
varying vec4 fill_patternPlacement;
varying vec2 fill_uv;

const float FILL_UV_SCALE = 512.0 / 40000000.0;
`,mK={"vs:DECKGL_FILTER_GL_POSITION":`
    fill_uv = geometry.position.xy;
  `,"vs:DECKGL_FILTER_COLOR":`
    if (fill_patternEnabled) {
      fill_patternBounds = FILL_PATTERN_FRAME_ATTRIB / vec4(fill_patternTextureSize, fill_patternTextureSize);
      fill_patternPlacement.xy = FILL_PATTERN_OFFSET_ATTRIB;
      fill_patternPlacement.zw = FILL_PATTERN_SCALE_ATTRIB * FILL_PATTERN_FRAME_ATTRIB.zw;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (fill_patternEnabled) {
      vec2 scale = FILL_UV_SCALE * fill_patternPlacement.zw;
      vec2 patternUV = mod(mod(fill_uvCoordinateOrigin, scale) + fill_uvCoordinateOrigin64Low + fill_uv, scale) / scale;
      patternUV = mod(fill_patternPlacement.xy + patternUV, 1.0);

      vec2 texCoords = fill_patternBounds.xy + fill_patternBounds.zw * patternUV;

      vec4 patternColor = texture2D(fill_patternTexture, texCoords);
      color.a *= patternColor.a;
      if (!fill_patternMask) {
        color.rgb = patternColor.rgb;
      }
    }
  `};function _K(t,e){if(!t)return{};if("fillPatternTexture"in t){const{fillPatternTexture:n}=t;return{fill_patternTexture:n,fill_patternTextureSize:[n.width,n.height]}}if("viewport"in t){const{fillPatternMask:n=!0,fillPatternEnabled:i=!0}=t,{project_uCommonOrigin:r}=e,s=[yg(r[0]),yg(r[1])];return{fill_uvCoordinateOrigin:r.slice(0,2),fill_uvCoordinateOrigin64Low:s,fill_patternMask:n,fill_patternEnabled:i}}return{}}const vK={name:"fill-pattern",vs:pK,fs:gK,inject:mK,dependencies:[go],getUniforms:_K},yK={fillPatternEnabled:!0,fillPatternAtlas:null,fillPatternMapping:null,fillPatternMask:!0,getFillPattern:{type:"accessor",value:t=>t.pattern},getFillPatternScale:{type:"accessor",value:1},getFillPatternOffset:{type:"accessor",value:[0,0]}},EK={[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071};class i3 extends ws{constructor({pattern:e=!1}={}){super({pattern:e})}isEnabled(e){return e.getAttributeManager()!==null&&!("pathTesselator"in e.state)}getShaders(e){return e.isEnabled(this)?{modules:[e.opts.pattern&&vK].filter(Boolean)}:null}initializeState(e,n){if(!n.isEnabled(this))return;const i=this.getAttributeManager();n.opts.pattern&&i.add({fillPatternFrames:{size:4,accessor:"getFillPattern",transform:n.getPatternFrame.bind(this),shaderAttributes:{fillPatternFrames:{divisor:0},instanceFillPatternFrames:{divisor:1}}},fillPatternScales:{size:1,accessor:"getFillPatternScale",defaultValue:1,shaderAttributes:{fillPatternScales:{divisor:0},instanceFillPatternScales:{divisor:1}}},fillPatternOffsets:{size:2,accessor:"getFillPatternOffset",shaderAttributes:{fillPatternOffsets:{divisor:0},instanceFillPatternOffsets:{divisor:1}}}}),this.setState({emptyTexture:new Gt(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState({props:e,oldProps:n},i){i.isEnabled(this)&&(e.fillPatternAtlas&&e.fillPatternAtlas!==n.fillPatternAtlas&&i.loadPatternAtlas.call(this),e.fillPatternMapping&&e.fillPatternMapping!==n.fillPatternMapping&&i.loadPatternMapping.call(this))}draw(e,n){if(!n.isEnabled(this))return;const{patternTexture:i}=this.state;this.setModuleParameters({fillPatternTexture:i||this.state.emptyTexture})}finalizeState(){const{patternTexture:e,emptyTexture:n}=this.state;e==null||e.delete(),n==null||n.delete()}async loadPatternAtlas(){var e;const{fillPatternAtlas:n,fetch:i}=this.props;(e=this.state.patternTexture)===null||e===void 0||e.delete(),this.setState({patternTexture:null});let r=n;typeof r=="string"&&(r=await i(r,{propName:"fillPatternAtlas",layer:this}));const s=r instanceof Gt?r:new Gt(this.context.gl,{data:r,parameters:EK});this.setState({patternTexture:s})}async loadPatternMapping(){const{fillPatternMapping:e,fetch:n}=this.props;this.setState({patternMapping:null});let i=e;typeof i=="string"&&(i=await n(i,{propName:"fillPatternMapping",layer:this})),this.setState({patternMapping:i}),this.getAttributeManager().invalidate("getFillPattern"),this.setNeedsUpdate()}getPatternFrame(e){const{patternMapping:n}=this.state,i=n&&n[e];return i?[i.x,i.y,i.width,i.height]:[0,0,0,0]}}w(i3,"defaultProps",yK);w(i3,"extensionName","FillStyleExtension");const r3={clipBounds:[0,0,1,1]},s3=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,TK={name:"clip-vs",vs:s3},wK={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},bK={name:"clip-fs",fs:s3},xK={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class r1 extends ws{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(e=this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[TK],inject:wK}:{modules:[bK],inject:xK}}draw({uniforms:e}){const{clipBounds:n=r3.clipBounds}=this.props;if(this.state.clipByInstance)e.clip_bounds=n;else{const i=this.projectPosition([n[0],n[1],0]),r=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[0],r[0]),Math.max(i[1],r[1])]}}}w(r1,"defaultProps",r3);w(r1,"extensionName","ClipExtension");const CK=`
uniform vec4 mask_bounds;
uniform bool mask_maskByInstance;
vec2 mask_getCoords(vec4 position) {
  return (position.xy - mask_bounds.xy) / (mask_bounds.zw - mask_bounds.xy);
}
`,SK=`
uniform sampler2D mask_texture;
uniform int mask_channel;
uniform bool mask_enabled;
bool mask_isInBounds(vec2 texCoords) {
  if (!mask_enabled) {
    return true;
  }
  vec4 maskColor = texture2D(mask_texture, texCoords);
  float maskValue = 1.0;
  if (mask_channel == 0) {
    maskValue = maskColor.r;
  } else if (mask_channel == 1) {
    maskValue = maskColor.g;
  } else if (mask_channel == 2) {
    maskValue = maskColor.b;
  } else if (mask_channel == 3) {
    maskValue = maskColor.a;
  }
  return maskValue < 0.5;
}
`,PK={"vs:#decl":`
varying vec2 mask_texCoords;
`,"vs:#main-end":`
   vec4 mask_common_position;
   if (mask_maskByInstance) {
     mask_common_position = project_position(vec4(geometry.worldPosition, 1.0));
   } else {
     mask_common_position = geometry.position;
   }
   mask_texCoords = mask_getCoords(mask_common_position);
`,"fs:#decl":`
varying vec2 mask_texCoords;
`,"fs:#main-start":`
  if (mask_enabled) {
    bool mask = mask_isInBounds(mask_texCoords);

    // Debug: show extent of render target
    // gl_FragColor = vec4(mask_texCoords, 0.0, 1.0);
    gl_FragColor = texture2D(mask_texture, mask_texCoords);

    if (!mask) discard;
  }
`},IK=t=>t&&"maskMap"in t?{mask_texture:t.maskMap}:{},MK={name:"mask",dependencies:[go],vs:CK,fs:SK,inject:PK,getUniforms:IK},BK={maskId:""};class s1 extends ws{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return"maskByInstance"in this.props&&(e=Boolean(this.props.maskByInstance)),this.state.maskByInstance=e,{modules:[MK]}}draw({uniforms:e,context:n,moduleParameters:i}){e.mask_maskByInstance=this.state.maskByInstance;const{maskId:r=""}=this.props,{maskChannels:s}=i,{viewport:o}=n;if(s&&s[r]){const{index:a,bounds:A,coordinateOrigin:h}=s[r];let{coordinateSystem:p}=s[r];e.mask_enabled=!0,e.mask_channel=a,p===De.DEFAULT&&(p=o.isGeospatial?De.LNGLAT:De.CARTESIAN);const m={modelMatrix:null,fromCoordinateOrigin:h,fromCoordinateSystem:p},y=this.projectPosition([A[0],A[1],0],m),T=this.projectPosition([A[2],A[3],0],m);e.mask_bounds=[y[0],y[1],T[0],T[1]]}else r&&Re.warn("Could not find a mask layer with id: ".concat(r))(),e.mask_enabled=!1}}w(s1,"defaultProps",BK);w(s1,"extensionName","MaskExtension");const LK={Point:o3,MultiPoint:RK,LineString:a3,MultiLineString:OK,Polygon:l3,MultiPolygon:FK};function o3([t,e],[n,i],r){const s=Gi(n[0],i[0],t),o=Gi(n[1],i[1],e);return r.unprojectFlat([s,o])}function o1(t,e,n){return t.map(i=>o3(i,e,n))}function RK(t,e,n){return o1(t,e,n)}function a3(t,e,n){return o1(t,e,n)}function OK(t,e,n){return t.map(i=>a3(i,e,n))}function l3(t,e,n){return t.map(i=>o1(i,e,n))}function FK(t,e,n){return t.map(i=>l3(i,e,n))}function DK(t,e,n){const i=n.projectFlat([e.west,e.north]),r=n.projectFlat([e.east,e.south]),s=[i,r];return{...t,coordinates:LK[t.type](t.coordinates,s,n)}}const kK=["points","lines","polygons"];function NK(t,e,n,i){for(const r of kK){const s=t[r]&&UK(t[r],e,n,i);if(s>=0)return s}return-1}function UK(t,e,n,i){const r=t.featureIds.value;if(!r.length)return-1;let s=0,o=r[r.length-1]+1;if(i){const A=GK(t,i);if(A)s=A[0],o=A[1]+1;else return-1}let a=-1;if(e in t.numericProps){const A=t.numericProps[e].value.findIndex((h,p)=>h===n&&r[p]>=s&&r[p]<o);return A>=0?t.globalFeatureIds.value[A]:-1}else e?a=VT(t.properties,A=>A[e]===n,s,o):t.fields&&(a=VT(t.fields,A=>A.id===n,s,o));return a>=0?zK(t,a):-1}function GK(t,e){if(!t.__layers){const n={},{properties:i}=t;for(let r=0;r<i.length;r++){const{layerName:s}=i[r];s&&(n[s]?n[s][1]=r:n[s]=[r,r])}t.__layers=n}return t.__layers[e]}function zK(t,e){if(!t.__ids){const n=[],i=t.featureIds.value,r=t.globalFeatureIds.value;for(let s=0;s<i.length;s++)n[i[s]]=r[s];t.__ids=n}return t.__ids[e]}function VT(t,e,n,i){for(let r=n;r<i;r++)if(e(t[r],r))return r;return-1}const tp=512,VK={...Za.defaultProps,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[YP],binary:!0};class A3 extends vc{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null})}get isLoaded(){return this.state&&this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:e,oldProps:n,context:i,changeFlags:r}){var s;r.dataChanged&&this._updateTileData(),(s=this.state)!==null&&s!==void 0&&s.data&&(super.updateState({props:e,oldProps:n,context:i,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==n.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,n=null;if(typeof e=="string"&&!_j(e)){const{onDataLoad:i,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{n=await r(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(n,{propName:"data",layer:this})}else e.tilejson&&(n=e);n&&(e=n.tiles),this.setState({data:e,tileJSON:n})}_getTilesetOptions(){const e=super._getTilesetOptions(),n=this.state.tileJSON,{minZoom:i,maxZoom:r}=this.props;return n&&(Number.isFinite(n.minzoom)&&n.minzoom>i&&(e.minZoom=n.minzoom),Number.isFinite(n.maxzoom)&&(!Number.isFinite(r)||n.maxzoom<r)&&(e.maxZoom=n.maxzoom)),e}renderLayers(){var e;return(e=this.state)!==null&&e!==void 0&&e.data?super.renderLayers():null}getTileData(e){var n;const{data:i,binary:r}=this.state,{index:s,signal:o}=e,a=oh(i,e);if(!a)return Promise.reject("Invalid URL");let A=this.getLoadOptions();const{fetch:h}=this.props;return A={...A,mimeType:"application/x-protobuf",mvt:{...(n=A)===null||n===void 0?void 0:n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:s},gis:r?{format:"binary"}:{}},h(a,{propName:"data",layer:this,loadOptions:A,signal:o})}renderSubLayers(e){const{x:n,y:i,z:r}=e.tile.index,s=Math.pow(2,r),o=tp/s,a=-o,A=tp*n/s,h=tp*(1-i/s),p=new Ue().scale([o,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=p,e.coordinateOrigin=[A,h,0],e.coordinateSystem=De.CARTESIAN,e.extensions=[...e.extensions||[],new r1]);const m=super.renderSubLayers(e);return this.state.binary&&!(m instanceof Za)&&Re.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),m}_updateAutoHighlight(e){const{uniqueIdProperty:n}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:r}=this.state,s=e.object;let o,a;s&&(o=np(s,n),a=jT(s));let{highlightColor:A}=this.props;typeof A=="function"&&(A=A(e)),(i!==o||r!==a)&&this.setState({highlightColor:A,hoveredFeatureId:o,hoveredFeatureLayerName:a})}getPickingInfo(e){const n=super.getPickingInfo(e),i=Boolean(this.context.viewport.resolution);if(this.state.binary&&n.index!==-1){const{data:r}=e.sourceLayer.props;n.object=OT(r,{globalFeatureId:n.index})}return n.object&&!i&&(n.object=WT(n.object,n.tile.bbox,this.context.viewport)),n}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:n,hoveredFeatureLayerName:i,binary:r}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,a=e.content,A=HT(o);if(!(HT(n)||A))return-1;const p=A?o:n;return Array.isArray(a)?a.findIndex(m=>{const y=np(m,s)===p,T=A||jT(m)===i;return y&&T}):a&&r?NK(a,s,p,A?"":i):-1}_pickObjects(e){const{deck:n,viewport:i}=this.context,r=i.width,s=i.height,o=i.x,a=i.y,A=[this.id];return n.pickObjects({x:o,y:a,width:r,height:s,layerIds:A,maxObjects:e})}getRenderedFeatures(e=null){const n=this._pickObjects(e),i=new Set,r=[];for(const s of n){const o=np(s.object,this.props.uniqueIdProperty);o===void 0?r.push(s.object):i.has(o)||(i.add(o),r.push(s.object))}return r}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:r}=i;if(i._contentWGS84===void 0&&vj(r)){const s=this.state.binary?OT(i.content):i.content;i._contentWGS84=s.map(o=>WT(o,r,this.context.viewport))}return i._contentWGS84}})})}}w(A3,"layerName","MVTLayer");w(A3,"defaultProps",VK);function np(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function jT(t){var e;return((e=t.properties)===null||e===void 0?void 0:e.layerName)||null}function HT(t){return t!=null&&t!==""}function WT(t,e,n){const i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>DK(t.geometry,e,n).coordinates}),i}const QT="0123456789bcdefghjkmnpqrstuvwxyz",c3={};for(let t=0;t<QT.length;t++)c3[QT.charAt(t)]=t;const jK=-90,HK=90,WK=-180,QK=180;function XK(t){let e=!0,n=HK,i=jK,r=QK,s=WK,o,a=0;for(let A=0,h=t.length;A<h;A++){const p=t[A].toLowerCase();a=c3[p];for(let m=4;m>=0;m--){const y=a>>m&1;e?(o=(r+s)/2,y===1?s=o:r=o):(o=(n+i)/2,y===1?i=o:n=o),e=!e}}return[i,s,n,r]}function JK(t){const[e,n,i,r]=XK(t);return[r,i,r,e,n,e,n,i,r,i]}const YK={getGeohash:{type:"accessor",value:t=>t.geohash}};class u3 extends qa{indexToBounds(){const{data:e,getGeohash:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,r)=>JK(n(i,r))}}}w(u3,"layerName","GeohashLayer");w(u3,"defaultProps",YK);function f3({map:t,gl:e,deck:n}){if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,r=h3({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let s;return(!n||n.props.gl===e)&&(Object.assign(r,{gl:e,width:null,height:null,touchAction:"unset",viewState:qA(t)}),t.on("move",()=>nZ(s,t))),n?(s=n,n.setProps(r),n.userData.isExternal=!0):(s=new UA(r),t.on("remove",()=>{s.finalize(),t.__deck=null})),s.userData.mapboxLayers=new Set,s.userData.mapboxVersion=eZ(t),t.__deck=s,t.on("render",()=>{s.isInitialized&&tZ(s,t)}),s}function h3(t){const e="useDevicePixels"in t?t.useDevicePixels:!0;return{...t,useDevicePixels:e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new b_({id:"mapbox"})]}}function KK(t,e){t.userData.mapboxLayers.add(e),a1(t)}function ZK(t,e){t.userData.mapboxLayers.delete(e),a1(t)}function qK(t,e){a1(t)}function $K(t,e,n){let{currentViewport:i}=t.userData,r=!1;i||(i=d3(t,e,!0),t.userData.currentViewport=i,r=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:s})=>n.id===s.id,clearStack:r,clearCanvas:!1})}function qA(t){const{lng:e,lat:n}=t.getCenter();return{longitude:(e+540)%360-180,latitude:n,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()}}function eZ(t){let e=0,n=0;const i=t.version;return i&&([e,n]=i.split(".").slice(0,2).map(Number)),{major:e,minor:n}}function d3(t,e,n=!0){const{mapboxVersion:i}=t.userData;return new Wi(Object.assign({id:"mapbox",x:0,y:0,width:t.width,height:t.height},qA(e),n?{nearZMultiplier:i.major===1&&i.minor>=3||i.major>=2?.02:1/(t.height||1)}:{nearZMultiplier:.1}))}function tZ(t,e){const{mapboxLayers:n,isExternal:i}=t.userData;if(i){const r=Array.from(n,p=>p.id),o=ao(t.props.layers,Boolean).some(p=>p&&!r.includes(p.id));let a=t.getViewports();const A=a.findIndex(p=>p.id==="mapbox"),h=a.length>1||A<0;(o||h)&&(A>=0&&(a=a.slice(),a[A]=d3(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:a,layerFilter:p=>(!t.props.layerFilter||t.props.layerFilter(p))&&(p.viewport.id!=="mapbox"||!r.includes(p.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function nZ(t,e){t.setProps({viewState:qA(e)}),t.needsRedraw({clearRedrawFlags:!0})}function a1(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(n=>{const i=n.props.type,r=new i(n.props);e.push(r)}),t.setProps({layers:e})}class iZ{constructor(e){if(w(this,"id",void 0),w(this,"type",void 0),w(this,"renderingMode",void 0),w(this,"map",void 0),w(this,"deck",void 0),w(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,n){this.map=e,this.deck=f3({map:e,gl:n,deck:this.props.deck}),KK(this.deck,this)}onRemove(){this.deck&&ZK(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&qK(this.deck)}render(){$K(this.deck,this.map,this)}}const ip="__UNDEFINED__";function zu(t,e,n,i){if(!t||!e||!t.style||!t.style._loaded)return;const r=ao(i,Boolean);if(n!==i){const a=ao(n,Boolean),A=new Set(a.map(h=>h.id));for(const h of r)A.delete(h.id);for(const h of A)t.getLayer(h)&&t.removeLayer(h)}for(const a of r){const A=t.getLayer(a.id);A?A.implementation.setProps(a.props):t.addLayer(new iZ({id:a.id,deck:e}),a.props.beforeId)}const s=t.style._order,o={};for(const a of r){let{beforeId:A}=a.props;(!A||!s.includes(A))&&(A=ip),o[A]=o[A]||[],o[A].push(a.id)}for(const a in o){const A=o[a];let h=a===ip?s.length:s.indexOf(a),p=a===ip?void 0:a;for(let m=A.length-1;m>=0;m--){const y=A[m],T=s.indexOf(y);T!==h-1&&(t.moveLayer(y,p),T>h&&h++),h--,p=y}}}class rZ{constructor(e){w(this,"_props",void 0),w(this,"_deck",void 0),w(this,"_map",void 0),w(this,"_container",void 0),w(this,"_interleaved",void 0),w(this,"_handleStyleChange",()=>{zu(this._map,this._deck,this._props.layers,this._props.layers)}),w(this,"_updateContainerSize",()=>{if(this._map&&this._container){const{clientWidth:r,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(r,"px"),height:"".concat(s,"px")})}}),w(this,"_updateViewState",()=>{const r=this._deck;r&&(r.setProps({viewState:qA(this._map)}),r.redraw())}),w(this,"_handleMouseEvent",r=>{const s=this._deck;if(!s)return;const o={type:r.type,offsetCenter:r.point,srcEvent:r};switch(r.type){case"click":o.tapCount=1,s._onPointerDown(o),s._onEvent(o);break;case"dblclick":o.type="click",o.tapCount=2,s._onEvent(o);break;case"mousemove":o.type="pointermove",s._onPointerMove(o);break;case"mouseout":o.type="pointerleave",s._onPointerMove(o);break;default:return}});const{interleaved:n=!1,...i}=e;this._interleaved=n,this._props=i}setProps(e){this._interleaved&&e.layers&&zu(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?h3(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=n,this._deck=new UA({...this._props,parent:n,viewState:qA(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}_onAddInterleaved(e){return this._deck=f3({map:e,gl:e.painter.context.gl,deck:new UA({...this._props,gl:e.painter.context.gl})}),e.on("styledata",this._handleStyleChange),zu(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){var e;const n=this._map;n&&(this._interleaved?this._onRemoveInterleaved(n):this._onRemoveOverlaid(n)),(e=this._deck)===null||e===void 0||e.finalize(),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent)}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),zu(e,this._deck,this._props.layers,[])}getDefaultPosition(){return"top-left"}pickObject(e){return Ut(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Ut(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Ut(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}}const sZ="modulepreload",oZ=function(t){return"/deck-gl-ts-adv/"+t},XT={},aZ=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=oZ(s),s in XT)return;XT[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let p=r.length-1;p>=0;p--){const m=r[p];if(m.href===s&&(!o||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":sZ,o||(h.as="script",h.crossOrigin=""),h.href=s,document.head.appendChild(h),o)return new Promise((p,m)=>{h.addEventListener("load",p),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())},lZ=Se.createContext(null);function AZ(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function JT(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function YT(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const cZ=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function KT(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const r=e[i.ref];let s=null;if("interactive"in i&&(s={...i},delete s.interactive),r){s=s||{...i},delete s.ref;for(const o of cZ)o in r&&(s[o]=r[o])}return s||i});return{...t,layers:n}}function uZ(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function qr(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!qr(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!qr(t[r],e[r]))return!1;return!0}return!1}const ZT={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},rp={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},qT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},fZ=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],hZ=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Va{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[qT[r.type]];s&&s(r)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[ZT[r.type]];if(s){if(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"){const o=this._hoveredFeatures||this._map.queryRenderedFeatures(r.point,{layers:this.props.interactiveLayerIds});r.features=o}s(r),delete r.features}},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[rp[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Va.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n,i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:o}=e;return o&&(o.bounds?r.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):i._updateViewState(o,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||dZ()||null,container:e,style:KT(n.mapStyle)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,n.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),n.cursor&&(s.getCanvas().style.cursor=n.cursor),this._createShadowTransform(s);const o=s._render;s._render=h=>{this._inRender=!0,o.call(s,h),this._inRender=!1};const a=s._renderTaskQueue.run;s._renderTaskQueue.run=h=>{a.call(s._renderTaskQueue,h),this._onBeforeRepaint()},s.on("render",()=>this._onAfterRepaint());const A=s.fire;s.fire=this._fireEvent.bind(this,A),s.on("resize",()=>{this._renderTransform.resize(s.transform.width,s.transform.height)}),s.on("styledata",()=>this._updateStyleComponents(this.props,{})),s.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const h in ZT)s.on(h,this._onPointerEvent);for(const h in rp)s.on(h,this._onCameraEvent);for(const h in qT)s.on(h,this._onEvent);this._map=s}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Va.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=AZ(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:o,bearing:a}=r,A=i.isMoving();A&&(r.cameraElevationReference="sea");const h=YT(r,{...JT(i.transform),...e});if(A&&(r.cameraElevationReference="ground"),h&&n){const p=this._deferredEvents;p.move=!0,p.zoom||(p.zoom=s!==r.zoom),p.rotate||(p.rotate=a!==r.bearing),p.pitch||(p.pitch=o!==r.pitch)}return A||YT(i.transform,e),h}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of fZ)s in e&&!qr(e[s],n[s])&&(r=!0,i[`set${s[0].toUpperCase()}${s.slice(1)}`](e[s]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(KT(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.style.loaded()&&("light"in e&&!qr(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&!qr(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&!qr(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){const i=this._map;let r=!1;for(const s of hZ){const o=e[s];qr(o,n[s])||(r=!0,o?i[s].enable(o):i[s].disable())}return r}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let a;if(s==="mousemove")try{a=this._map.queryRenderedFeatures(e.point,{layers:i.interactiveLayerIds})}catch{a=[]}else a=[];const A=a.length>0;!A&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,A&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in rp&&(typeof n=="object"&&(n.viewState=JT(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}Va.savedMaps=[];function dZ(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const pZ=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function gZ(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>t.transform.locationPoint(e.LngLat.convert(r)),unproject:r=>t.transform.pointLocation(e.Point.convert(r)),queryTerrainElevation:(r,s)=>{const o=n.transform;n.transform=t.transform;const a=n.queryTerrainElevation(r,s);return n.transform=o,a}};for(const r of mZ(n))!(r in i)&&!pZ.includes(r)&&(i[r]=n[r].bind(n));return i}function mZ(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const _Z=typeof document<"u"?Se.useLayoutEffect:Se.useEffect,vZ=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function yZ(t,e){for(const n of vZ)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const Xh=Se.createContext(null),EZ={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},l1=Se.forwardRef((t,e)=>{const n=Se.useContext(lZ),[i,r]=Se.useState(null),s=Se.useRef(),{current:o}=Se.useRef({mapLib:null,map:null});Se.useEffect(()=>{const A=t.mapLib;let h=!0,p;return Promise.resolve(A||aZ(()=>import("./mapbox-gl-317a2196.js").then(m=>m.m),[])).then(m=>{if(h){if(m.Map||(m=m.default),!m||!m.Map)throw new Error("Invalid mapLib");if(m.supported(t))yZ(m,t),t.reuseMaps&&(p=Va.reuse(t,s.current)),p||(p=new Va(m.Map,t,s.current)),o.map=gZ(p,m),o.mapLib=m,r(p),n==null||n.onMapMount(o.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(m=>{t.onError({type:"error",target:null,originalEvent:null,error:m})}),()=>{h=!1,p&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?p.recycle():p.destroy())}},[]),_Z(()=>{i&&i.setProps(t)}),Se.useImperativeHandle(e,()=>o.map,[i]);const a=Se.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return Se.createElement("div",{id:t.id,ref:s,style:a},i&&Se.createElement(Xh.Provider,{value:o},Se.createElement("div",{"mapboxgl-children":""},t.children)))});l1.displayName="Map";l1.defaultProps=EZ;const TZ=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function vo(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!TZ.test(i)?n[i]=`${r}px`:n[i]=r}}const wZ={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function p3(t){const{map:e,mapLib:n}=Se.useContext(Xh),i=Se.useRef({props:t});i.current.props=t;const r=Se.useMemo(()=>{let s=!1;Se.Children.forEach(t.children,A=>{A&&(s=!0)});const o={...t,element:s?document.createElement("div"):null},a=new n.Marker(o).setLngLat([t.longitude,t.latitude]);return a.getElement().addEventListener("click",A=>{var h,p;(p=(h=i.current.props).onClick)===null||p===void 0||p.call(h,{type:"click",target:a,originalEvent:A})}),a.on("dragstart",A=>{var h,p;const m=A;m.lngLat=r.getLngLat(),(p=(h=i.current.props).onDragStart)===null||p===void 0||p.call(h,m)}),a.on("drag",A=>{var h,p;const m=A;m.lngLat=r.getLngLat(),(p=(h=i.current.props).onDrag)===null||p===void 0||p.call(h,m)}),a.on("dragend",A=>{var h,p;const m=A;m.lngLat=r.getLngLat(),(p=(h=i.current.props).onDragEnd)===null||p===void 0||p.call(h,m)}),a},[]);return Se.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]),Se.useEffect(()=>{vo(r.getElement(),t.style)},[t.style]),(r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!uZ(r.getOffset(),t.offset)&&r.setOffset(t.offset),r.isDraggable()!==t.draggable&&r.setDraggable(t.draggable),r.getRotation()!==t.rotation&&r.setRotation(t.rotation),r.getRotationAlignment()!==t.rotationAlignment&&r.setRotationAlignment(t.rotationAlignment),r.getPitchAlignment()!==t.pitchAlignment&&r.setPitchAlignment(t.pitchAlignment),r.getPopup()!==t.popup&&r.setPopup(t.popup),dA.createPortal(t.children,r.getElement())}p3.defaultProps=wZ;Se.memo(p3);function $T(t){return new Set(t?t.trim().split(/\s+/):[])}function bZ(t){const{map:e,mapLib:n}=Se.useContext(Xh),i=Se.useMemo(()=>document.createElement("div"),[]),r=Se.useRef({props:t});r.current.props=t;const s=Se.useMemo(()=>{const o={...t},a=new n.Popup(o).setLngLat([t.longitude,t.latitude]);return a.once("open",A=>{var h,p;(p=(h=r.current.props).onOpen)===null||p===void 0||p.call(h,A)}),a},[]);if(Se.useEffect(()=>{const o=a=>{var A,h;(h=(A=r.current.props).onClose)===null||h===void 0||h.call(A,a)};return s.on("close",o),s.setDOMContent(i).addTo(e.getMap()),()=>{s.off("close",o),s.isOpen()&&s.remove()}},[]),Se.useEffect(()=>{vo(s.getElement(),t.style)},[t.style]),s.isOpen()&&((s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!qr(s.options.offset,t.offset)&&s.setOffset(t.offset),(s.options.anchor!==t.anchor||s.options.maxWidth!==t.maxWidth)&&(s.options.anchor=t.anchor,s.setMaxWidth(t.maxWidth)),s.options.className!==t.className)){const o=$T(s.options.className),a=$T(t.className);for(const A of o)a.has(A)||s.removeClassName(A);for(const A of a)o.has(A)||s.addClassName(A);s.options.className=t.className}return dA.createPortal(t.children,i)}Se.memo(bZ);function el(t,e,n,i){const r=Se.useContext(Xh),s=Se.useMemo(()=>t(r),[]);return Se.useEffect(()=>{const o=i||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,A=typeof n=="function"?n:typeof e=="function"?e:null,{map:h}=r;return h.hasControl(s)||(h.addControl(s,o==null?void 0:o.position),a&&a(r)),()=>{A&&A(r),h.hasControl(s)&&h.removeControl(s)}},[]),s}function xZ(t){const e=el(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Se.useEffect(()=>{vo(e._container,t.style)},[t.style]),null}const CZ=Se.memo(xZ);function SZ(t){const e=el(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Se.useEffect(()=>{vo(e._controlContainer,t.style)},[t.style]),null}const PZ=Se.memo(SZ),g3=Se.forwardRef((t,e)=>{const n=Se.useRef({props:t}),i=el(({mapLib:r})=>{const s=new r.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var A,h;(h=(A=n.current.props).onGeolocate)===null||h===void 0||h.call(A,a)}),s.on("error",a=>{var A,h;(h=(A=n.current.props).onError)===null||h===void 0||h.call(A,a)}),s.on("outofmaxbounds",a=>{var A,h;(h=(A=n.current.props).onOutOfMaxBounds)===null||h===void 0||h.call(A,a)}),s.on("trackuserlocationstart",a=>{var A,h;(h=(A=n.current.props).onTrackUserLocationStart)===null||h===void 0||h.call(A,a)}),s.on("trackuserlocationend",a=>{var A,h;(h=(A=n.current.props).onTrackUserLocationEnd)===null||h===void 0||h.call(A,a)}),s},{position:t.position});return n.current.props=t,Se.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),Se.useEffect(()=>{vo(i._container,t.style)},[t.style]),null});g3.displayName="GeolocateControl";Se.memo(g3);function IZ(t){const e=el(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Se.useEffect(()=>{vo(e._container,t.style)},[t.style]),null}const MZ=Se.memo(IZ),BZ={unit:"metric",maxWidth:100};function m3(t){const e=el(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),Se.useEffect(()=>{vo(e._container,t.style)},[t.style]),null}m3.defaultProps=BZ;const LZ=Se.memo(m3);function RZ({neighborhoodNames:t,addSelectedNeighborhood:e,onClickFunction:n}){return t.sort(),Sa("div",{className:"cityMenu",children:[gn("div",{style:{padding:"10px",color:"white",fontSize:"2rem"},children:"Boston Neighborhoods Crime Map"}),t.map(i=>gn("button",{onClick:()=>e(i),children:i},i)),gn("button",{onClick:()=>n(),style:{width:"400px"},children:"reset"}),Sa("div",{style:{padding:"10px",color:"white",fontSize:"1rem"},children:["Crime incident reports are provided by ",gn("a",{style:{color:"rgb(158 255 228 / 87%)"},target:"_blank",href:"https://www.kaggle.com/datasets/AnalyzeBoston/crimes-in-boston",children:"Boston Police Department (BPD)"})]})]})}function OZ(t,e,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function FZ(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ew(t[0])||!ew(t[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:t};return OZ(i,e,n)}function ew(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function _3(t,e,n){if(t!==null)for(var i,r,s,o,a,A,h,p=0,m=0,y,T=t.type,b=T==="FeatureCollection",C=T==="Feature",R=b?t.features.length:1,S=0;S<R;S++){h=b?t.features[S].geometry:C?t.geometry:t,y=h?h.type==="GeometryCollection":!1,a=y?h.geometries.length:1;for(var P=0;P<a;P++){var I=0,F=0;if(o=y?h.geometries[P]:h,o!==null){A=o.coordinates;var j=o.type;switch(p=n&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(e(A,m,S,I,F)===!1)return!1;m++,I++;break;case"LineString":case"MultiPoint":for(i=0;i<A.length;i++){if(e(A[i],m,S,I,F)===!1)return!1;m++,j==="MultiPoint"&&I++}j==="LineString"&&I++;break;case"Polygon":case"MultiLineString":for(i=0;i<A.length;i++){for(r=0;r<A[i].length-p;r++){if(e(A[i][r],m,S,I,F)===!1)return!1;m++}j==="MultiLineString"&&I++,j==="Polygon"&&F++}j==="Polygon"&&I++;break;case"MultiPolygon":for(i=0;i<A.length;i++){for(F=0,r=0;r<A[i].length;r++){for(s=0;s<A[i][r].length-p;s++){if(e(A[i][r][s],m,S,I,F)===!1)return!1;m++}F++}I++}break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(_3(o.geometries[i],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function DZ(t,e){e===void 0&&(e={});var n=0,i=0,r=0;return _3(t,function(s){n+=s[0],i+=s[1],r++},!0),FZ([n/r,i/r],e.properties)}const tw=[{neighborhood:"Allston",value:39},{neighborhood:"Back Bay",value:17},{neighborhood:"Beacon Hill",value:4},{neighborhood:"Brighton",value:64},{neighborhood:"Chinatown",value:6},{neighborhood:"Charlestown",value:38},{neighborhood:"Dorchester",value:2630},{neighborhood:"Downtown",value:23},{neighborhood:"East Boston",value:89},{neighborhood:"Fenway",value:31},{neighborhood:"Hyde park",value:190},{neighborhood:"Jamaica Plain",value:247},{neighborhood:"Leather District",value:6},{neighborhood:"Mattapan",value:450},{neighborhood:"Mission Hill",value:116},{neighborhood:"North End",value:6},{neighborhood:"Roslindale",value:100},{neighborhood:"Roxbury",value:1215},{neighborhood:"South Boston",value:170},{neighborhood:"South Boston Waterfront",value:4},{neighborhood:"South End",value:104},{neighborhood:"West End",value:4},{neighborhood:"West Roxbury",value:28}];function kZ({filteredNeighborhood:t}){let e=0,n=0,i=0;return t.length>0&&(n=tw.filter(r=>{if(r.neighborhood==t[0].properties.Name)return r}).map(r=>r.value)[0],(n==null?void 0:n.length)<1?n="no data found":(i=Math.max(...tw.map(r=>r.value)),e=n/i*400),console.log("print shotsFiredText"),console.log(n)),gn(uw,{children:Sa("div",{className:"shotsFiredMenu",style:t.length==0?{display:"None"}:{},children:[gn("div",{style:{height:"25px",width:`${e}px`,backgroundColor:"rgb(235 13 13)",transition:"width .5s"}}),Sa("div",{style:{padding:"5px",color:"white",fontSize:"1.5rem"},children:["Shots Fired: ",n||"no data found"]})]})})}const NZ="pk.eyJ1IjoiaGl1IiwiYSI6InJWNGZJSzgifQ.xK1ndT3W8XL9lwVZrT6jvQ";function UZ(){return fetch("boston_crimes_h3.json",{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>t.json()).then(t=>t).catch(t=>{console.error(t)})}function GZ(t){return el(()=>new rZ(t)).setProps(t),null}function zZ(){const t=Se.useRef(null),[e,n]=Se.useState({longitude:-71.039,latitude:42.352,zoom:9,maxZoom:15,pitch:30,bearing:0}),[i,r]=Aw.useState([]),[s,o]=Se.useState([]),[a,A]=Se.useState(""),[h,p]=Se.useState([]);Se.useEffect(()=>{fetch("Boston_Neighborhoods.geojson").then(C=>C.json()).then(C=>o(C.features))},[]);const m=s.map(C=>C.properties.Name),y=C=>{var F;A(C);const R=s.filter(j=>{if(j.properties.Name==C)return j});p(R);const S=DZ(R[0].geometry),P=S.geometry.coordinates[0],I=S.geometry.coordinates[1];(F=t.current)==null||F.flyTo({center:[P,I],zoom:11,duration:2e3})};Se.useEffect(()=>T({}),[h]),Se.useEffect(()=>{r([]),T({})},[]);function T({newData:C}){let R;C!==void 0?R=C:R=UZ();let S;h.length>0&&(console.log("filteredNeighborhood exists"),S=new Za({id:"geofence",data:h,operation:"mask"}));const P=new _o({id:"h3-hexagon-layer",data:R,pickable:!0,wireframe:!1,filled:!0,extruded:!0,elevationScale:20,getHexagon:I=>I.hex,getFillColor:I=>[255,(1-I.value/500)*255,0],getElevation:I=>I.value,extensions:[new s1],maskId:"geofence"});h.length>0?(console.log("set layers"),r([P,S])):r([P])}return Sa(uw,{children:[gn("div",{style:{height:"100vh"},children:Sa(l1,{attributionControl:!1,ref:t,initialViewState:e,mapStyle:"mapbox://styles/mapbox/light-v10",mapboxAccessToken:NZ,children:[gn(GZ,{layers:i,getTooltip:({object:C})=>C&&`${C.hex} value: ${C.value}`}),gn(MZ,{position:"top-right"}),gn(PZ,{position:"top-right"}),gn(CZ,{position:"bottom-right"}),gn(LZ,{position:"bottom-right"})]})}),gn(RZ,{onClickFunction:()=>{var C;p([]),T({}),(C=t.current)==null||C.flyTo({center:[-71.061,42.33],zoom:10,duration:2e3})},neighborhoodNames:m,addSelectedNeighborhood:y}),gn(kZ,{filteredNeighborhood:h})]})}sp.createRoot(document.getElementById("root")).render(gn(Aw.StrictMode,{children:gn(zZ,{})}));export{zI as c};
